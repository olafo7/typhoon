var CNOA_user_customers_zgcustomerClass,CNOA_user_customers_zgcustomerViewClass;var CNOA_user_customers_zgcustomer,CNOA_user_customers_zgcustomerView;var CNOA_user_customers_zglinkmanListClass,CNOA_user_customers_zglinkmanViewClass;var CNOA_user_customers_zglinkmanList;var CNOA_user_customers_zgpresalesListClass,CNOA_user_customers_zgpresalesViewClass;var CNOA_user_customers_zgpresalesList,CNOA_user_customers_zgpresalesView;var CNOA_user_customers_zgpostsalesListClass,CNOA_user_customers_zgpostsalesViewClass;var CNOA_user_customers_zgpostsalesList,CNOA_user_customers_zgpostsalesView;var CNOA_user_customers_zgrecordListClass,CNOA_user_customers_zgrecordViewClass;var CNOA_user_customers_zgrecordList,CNOA_user_customers_zgrecordView;CNOA_user_customers_zgrecordViewClass=CNOA.Class.create();CNOA_user_customers_zgrecordViewClass.prototype={init:function(a){var b=this;this.rid=a;this.cid=0;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.panel=new Ext.Panel({border:false,bodyStyle:"padding: 10px",listeners:{afterrender:function(c){b.refresh()}}});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.panel],tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.refresh()},iconCls:"icon-system-refresh",text:lang("refresh")}]})})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=recordView",params:{rid:a.rid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.panel.body)},failure:function(c){var b=Ext.decode(c.responseText)}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.recordView.parentID.replace("docs-",""))}};CNOA_user_customers_zgrecordListClass=CNOA.Class.create();CNOA_user_customers_zgrecordListClass.prototype={init:function(b){var a=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.cid=b;this.fields=[{name:"rid"},{name:"lname"},{name:"gname"},{name:"gdname"},{name:"price"},{name:"dealprice"},{name:"num"},{name:"amount"},{name:"date"},{name:"status"},{name:"checkdate"},{name:"checkname"},{name:"addname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRecordPanelList&cid="+this.cid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.store.load();this.store.on("load",function(){});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"rid",dataIndex:"rid",hidden:true},{header:"产品名称",dataIndex:"gdname",width:90,sortable:false,menuDisabled:true},{header:"联系人",dataIndex:"lname",width:90,sortable:false,menuDisabled:true},{header:"产品类型",dataIndex:"gname",width:90,sortable:false,menuDisabled:true},{header:"单价",dataIndex:"price",width:90,sortable:false,menuDisabled:true},{header:"成交单价",dataIndex:"dealprice",width:90,sortable:false,menuDisabled:true},{header:"数量",dataIndex:"num",width:90,sortable:false,menuDisabled:true},{header:"销售总额",dataIndex:"amount",width:90,sortable:false,menuDisabled:true},{header:"销售日期",dataIndex:"date",width:90,sortable:false,menuDisabled:true},{header:"审核状态",dataIndex:"status",width:90,sortable:false,menuDisabled:true},{header:"审核人",dataIndex:"checkname",width:90,sortable:false,menuDisabled:true},{header:"审核日期",dataIndex:"checkdate",width:90,sortable:false,menuDisabled:true},{header:"添加人",dataIndex:"addname",width:90,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"noIndex",width:37,sortable:true,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:0,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,autoWidth:true,border:false,listeners:{rowdblclick:function(c,d){},cellclick:function(c,g,d,f){}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){a.store.reload()},iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.grid]})},makeOperate:function(f,d,a,g,b,e){var c=a.data;return"<a href='javascript:void(0);' onclick='try{CNOA_user_customers_zgrecordList.viewRecord("+c.rid+");}catch(e){CNOA_user_customers_zgrecordList2.viewRecord("+c.rid+");}' style='color:red'>查看</a>"},viewRecord:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=recordView&rid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD","查看售销记录","icon-page-view")}};CNOA_user_customers_zgpostsalesViewClass=CNOA.Class.create();CNOA_user_customers_zgpostsalesViewClass.prototype={init:function(a){var b=this;this.pid=a;this.cid=0;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.panel=new Ext.Panel({border:false,bodyStyle:"padding: 10px",listeners:{afterrender:function(c){b.refresh()}}});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.panel],tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.refresh()},iconCls:"icon-system-refresh",text:lang("refresh")}]})})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=postsalesView",params:{pid:a.pid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.panel.body)},failure:function(c){var b=Ext.decode(c.responseText)}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.postsalesView.parentID.replace("docs-",""))}};CNOA_user_customers_zgpostsalesListClass=CNOA.Class.create();CNOA_user_customers_zgpostsalesListClass.prototype={init:function(b){var a=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.cid=b;this.fields=[{name:"pid"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"addname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPostSalesPanelList&cid="+this.cid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({});this.store.load();this.store.on("load",function(){});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"pid",dataIndex:"pid",hidden:true},{header:"联系人",dataIndex:"linkman",width:90,sortable:true,menuDisabled:true},{header:"回访方式",dataIndex:"type",width:90,sortable:false,menuDisabled:true},{header:"回访时间",dataIndex:"time",width:90,sortable:false,menuDisabled:true},{header:"下次回访",dataIndex:"nexttime",width:90,sortable:false,menuDisabled:true},{header:"回访结果",dataIndex:"content",width:100,sortable:false,menuDisabled:true},{header:"添加人",dataIndex:"addname",width:100,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"pid",width:100,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:0,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,autoWidth:true,border:false,viewConfig:{forceFit:true},listeners:{rowdblclick:function(c,d){a.editPanel()},cellclick:function(c,g,d,f){}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){a.store.reload()},iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.grid]})},makeOperate:function(f,d,a,g,b,e){var c=a.data;return"<a href='javascript:void(0);' onclick='try{CNOA_user_customers_zgpostsalesList.view("+c.pid+");}catch(e){CNOA_user_customers_zgpostsalesList2.view("+c.pid+");}' style='color:red'>查看</a>"},view:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_POSTSALES");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=postsalesView&pid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_POSTSALES","查看售后回访","icon-page-view")}};CNOA_user_customers_zgpresalesViewClass=CNOA.Class.create();CNOA_user_customers_zgpresalesViewClass.prototype={init:function(a){var b=this;this.pid=a;this.cid=0;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.panel=new Ext.Panel({border:false,bodyStyle:"padding: 10px",listeners:{afterrender:function(c){b.refresh()}}});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.panel],tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.refresh()},iconCls:"icon-system-refresh",text:lang("refresh")}]})})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=presalesView",params:{pid:a.pid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.panel.body)},failure:function(c){var b=Ext.decode(c.responseText)}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.presalesView.parentID.replace("docs-",""))}};CNOA_user_customers_zgpresalesListClass=CNOA.Class.create();CNOA_user_customers_zgpresalesListClass.prototype={init:function(b){var a=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.cid=b;this.fields=[{name:"pid"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"result"},{name:"addname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPreSalesPanelList&cid="+this.cid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"pid",dataIndex:"pid",hidden:true},{header:"跟踪内容",dataIndex:"content",width:100,sortable:false,menuDisabled:true,renderer:this.renderContent,id:"content"},{header:"跟踪结果",dataIndex:"result",width:100,sortable:false,menuDisabled:true},{header:"联系人",dataIndex:"linkman",width:90,sortable:true,menuDisabled:true},{header:"跟踪类型",dataIndex:"type",width:90,sortable:false,menuDisabled:true},{header:"跟踪时间",dataIndex:"time",width:90,sortable:false,menuDisabled:true},{header:"下次跟踪",dataIndex:"nexttime",width:90,sortable:false,menuDisabled:true},{header:"添加人",dataIndex:"addname",width:90,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"pid",width:100,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:0,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,autoWidth:true,border:false,autoExpandColumn:"content",viewConfig:{forceFit:true},listeners:{rowdblclick:function(c,d){},cellclick:function(c,g,d,f){}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){a.store.reload()},iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.grid]})},renderContent:function(b,a){a.attr='style="white-space:pre-wrap;"';return b},makeOperate:function(f,d,a,g,b,e){var c=a.data;return"<a href='javascript:void(0);' onclick='try{CNOA_user_customers_zgpresalesList.viewPresalse("+c.pid+");}catch(e){CNOA_user_customers_zgpresalesList2.viewPresalse("+c.pid+");}' style='color:red'>查看</a>"},viewPresalse:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_PRESALES");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=presalesView&pid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_PRESALES","查看售前跟踪","icon-page-view")}};CNOA_user_customers_zglinkmanAddEditClass=CNOA.Class.create();CNOA_user_customers_zglinkmanAddEditClass.prototype={init:function(b,a,d){var c=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.title=b=="edit"?"联系人信息":"添加联系人";this.action=b=="edit"?"edit":"add";this.lid=a;this.cid=d;this.cidStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getComboDataCustomers",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"cid"},{name:"name"}]}),listeners:{load:function(){if(c.action=="add"){c.formPanel.getForm().findField("cid").setValue(c.cid)}}}});this.cidStore.load();this.baseField=[{xtype:"fieldset",title:"联系人信息",width:647,items:[{xtype:"combo",fieldLabel:"所属客户",name:"cid",store:this.cidStore,hiddenName:"cid",valueField:"cid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false,value:""},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,allowBlank:false,name:"name",fieldLabel:lang("truename")}]},{xtype:"panel",layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("sex"),name:"sex",store:new Ext.data.SimpleStore({fields:["value","sex"],data:[["3","未知"],["1",lang("male")],["2",lang("female")]]}),width:230,hiddenName:"sex",valueField:"value",displayField:"sex",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"datefield",format:"Y-m-d",width:230,name:"birthday",fieldLabel:"出生日期"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"years",fieldLabel:"年龄"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[new Ext.form.ComboBox({fieldLabel:"婚否",name:"marry",store:new Ext.data.SimpleStore({fields:["value","marry"],data:[["1","已婚"],["0","未婚"]]}),width:230,hiddenName:"marry",valueField:"value",displayField:"marry",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"department",fieldLabel:"部门"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"position",fieldLabel:"职务"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"professional",fieldLabel:"职称"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"phone_com",fieldLabel:"单位电话"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"mobile",fieldLabel:lang("mobile")}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"fax",fieldLabel:"传真"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"email",fieldLabel:"Email"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"phone_home",fieldLabel:"住宅电话"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"phone_other",fieldLabel:"其它电话"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"qq",fieldLabel:"QQ"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"msn",fieldLabel:"MSN"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"zipcode",fieldLabel:"邮政编码"}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"address_home",fieldLabel:"家庭住址"}]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:320,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:230,name:"idcard",fieldLabel:"身份证号"}]},{xtype:"panel",layout:"form",items:[new Ext.form.ComboBox({fieldLabel:"血型",name:"bloodtype",store:new Ext.data.SimpleStore({fields:["value","bloodtype"],data:[["A","A"],["B","B"],["AB","AB"],["O","O"]]}),width:230,hiddenName:"bloodtype",valueField:"value",displayField:"bloodtype",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{width:650,xtype:"textfield",border:false},items:[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:550,name:"interest",fieldLabel:"个人爱好"}]}]},{xtype:"textarea",width:550,height:100,name:"other",fieldLabel:lang("remark")}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:70,labelAlign:"right",height:462,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px;",items:this.baseField,listeners:{render:function(){}}});this.mainPanel=new Ext.Window({width:675,height:makeWindowHeight(535),layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,title:this.title,buttonAlign:"right",buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){var a=this;a.mainPanel.show();if(a.action=="edit"){a.loadFormData()}},close:function(){this.mainPanel.close()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editLoadFormDataLM",params:{lid:a.lid},method:"POST",waitMsg:lang("waiting"),success:function(b,c){}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.close()})}.createDelegate(this)})}};CNOA_user_customers_zglinkmanListClass=CNOA.Class.create();CNOA_user_customers_zglinkmanListClass.prototype={init:function(b){var a=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.cid=b;this.fields=[{name:"lid"},{name:"name"},{name:"sex"},{name:"department"},{name:"position"},{name:"professional"},{name:"mobile"},{name:"addname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLinkManList&cid="+this.cid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("truename"),dataIndex:"name",width:100,sortable:true,menuDisabled:true},{header:lang("sex"),dataIndex:"sex",width:50,sortable:false,menuDisabled:true},{header:"部门",dataIndex:"department",width:100,sortable:false,menuDisabled:true},{header:"职务",dataIndex:"position",width:100,sortable:false,menuDisabled:true},{header:"职称",dataIndex:"professional",width:100,sortable:false,menuDisabled:true},{header:lang("mobile"),dataIndex:"mobile",width:100,sortable:false,menuDisabled:true},{header:"添加人",dataIndex:"addname",width:100,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"lid",width:50,sortable:false,menuDisabled:true,renderer:function(c){return"<a href='javascript:void(0);' onclick='try{CNOA_user_customers_zglinkmanList.editPanelLM("+c+");}catch(e){CNOA_user_customers_zglinkmanList2.editPanelLM("+c+");}'>查看</a>"}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,autoWidth:true,border:false,viewConfig:{forceFit:true},listeners:{rowdblclick:function(c,d){},cellclick:function(c,g,d,f){}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){a.store.reload()},iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[this.grid]})},editPanelLM:function(a){var b=this;CNOA_user_customers_zglinkmanAddEdit=new CNOA_user_customers_zglinkmanAddEditClass("edit",a,b.cid);CNOA_user_customers_zglinkmanAddEdit.show()}};CNOA_user_customers_zgcustomerViewClass=CNOA.Class.create();CNOA_user_customers_zgcustomerViewClass.prototype={init:function(b){var a=this;this.cid=b;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";this.ID_coustomers_comment_htmleditor=Ext.id();this.tpl=new Ext.XTemplate('<table width="100%" border="0" cellpadding="0" cellspacing="1" class="cnoa_main_update_index_tbg">','<tr><td height="28" colspan="2" valign="middle" bgcolor="#FFFFFF" class="cnoa_f_18 cnoa_f_b" style="background-color:#E9E9E9">客户信息</td></tr><tr class="cnoa_f_14">','<td width="20%" height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;客户名称</td><td width="80%" valign="middle" bgcolor="#FFFFFF">&nbsp;{name}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;客户类别</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{sort}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;客户简称</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{abbr}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;大地区</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{region}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;地区</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{region2}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;公司缩写</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{spell}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;所属行业</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{sort}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;法人代表</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{faren}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;客户编号</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{number}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;客户地址</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{address}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;公司Email</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{email}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;邮编</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{zipcode}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;联系电话</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{phone}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;联系人手机</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{mobile}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;传真</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{fax}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;公司网址</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{url}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;联系人姓名</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{linkman}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;联系人QQ</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{qq}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;跟进人</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{flowmanname}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;备注</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{other}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;开户银行</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{bank1}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;银行账户</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{bank_account_1}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;开户人姓名</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{bank_name_1}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;收件公司</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{mailcom}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;收件联系人</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{maillinkman}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;收件联系手机</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{mailmobile}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;收件联系电话</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{mailphone}</td></tr>','<tr class="cnoa_f_14"><td height="28" valign="middle" bgcolor="#F4F4F4">&nbsp;收件地址</td><td valign="middle" bgcolor="#FFFFFF">&nbsp;{mailaddress}</td></tr>',"</table>");this.commentTpl=new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}条)',"		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:160px;width:120px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" onerror="this.src=\'./resources/images/empty_photo.png\'" style="background-color:#FFF;"></div>','				<div style="float:left;width:590px;"><div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">#{[xindex]} {pname}:<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;所在部门:<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;{ptime}:{posttime}</div>','				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>");this.commentPanelPost=new Ext.Panel({border:false,items:[{xtype:"htmleditor",id:a.ID_coustomers_comment_htmleditor,width:748,height:140},{xtype:"button",text:"发表评论",cls:"cnoa-margin-top-5",handler:function(){a.postCommentReport()}}]});this.commentPanel=new Ext.Panel({border:false,html:"评论加载中..."});this.plancommentField=[{xtype:"fieldset",title:"关于对此跟进人的评阅",style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.commentPanel,this.commentPanelPost]}];this.infoPanel=new Ext.Panel({border:false,bodyStyle:"padding:5px",listeners:{render:function(){a.loadCustomerInfo();a.loadComment()}}});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,border:false,items:[this.infoPanel,this.plancommentField],tbar:new Ext.Toolbar({items:[{handler:function(c,d){a.loadCustomerInfo();a.loadComment()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},"-",{handler:function(c,d){a.moveCustomer()}.createDelegate(this),iconCls:"icon-customes-change",text:"转移"}]})});this.mainPanel=new Ext.Panel({border:false,autoScroll:true,layout:"border",items:[this.centerPanel]})},moveCustomer:function(){var d=this;var a=new Ext.form.FormPanel({border:false,labelWidth:80,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:10px;padding-top:30px",items:[{xtype:"panel",border:false,layout:"table",bodyStyle:"margin-top:10px",layoutConfig:{columns:3},defaults:{xtype:"textfield",border:false},items:[{xtype:"hidden",name:"toUid"},{xtype:"panel",layout:"form",items:[{xtype:"textfield",readOnly:true,width:223,allowBlank:false,name:"toNames",fieldLabel:"转移给谁"}]},{xtype:"btnForPoepleSelectorSingle",text:"选择",dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:5px;margin-bottom:3px;",listeners:{selected:function(g,h){var j=new Array();var f=new Array();if(h.length>0){for(var e=0;e<h.length;e++){j.push(h[e].uname);f.push(h[e].uid)}}a.getForm().findField("toNames").setValue(j.join(","));a.getForm().findField("toUid").setValue(f.join(","))},onrender:function(e){e.setSelectedUids(a.getForm().findField("toUid").getValue().split(","))}}}]},{xtype:"panel",border:false,bodyStyle:"margin-top:50px;color:#666",html:"<b>注意：</b><br> 转移客户，将会把该客户/客户联系人/售前跟踪/售后回访记录/成交记录等资料一并转移给新的销售人员，请谨慎操作！"}]});var b=function(e){if(a.getForm().isValid()){CNOA.msg.cf("确定继续吗？",function(f){if(f=="yes"){a.getForm().submit({url:d.baseUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:"move",cid:d.cid},success:function(g,h){CNOA.msg.notice(h.result.msg,"客户管理");c.close();d.loadCustomerInfo();d.loadComment()},failure:function(g,h){CNOA.msg.alert(h.result.msg,function(){})}.createDelegate(this)})}})}else{CNOA.miniMsg.alertShowAt(e,"请选择要转移给谁")}};var c=new Ext.Window({title:"转移客户",layout:"fit",width:400,height:260,modal:true,maximizable:false,resizable:false,items:[a],buttons:[{xtype:"cnoa_helpBtn",helpid:97},{text:"确定转移",iconCls:"icon-order-s-accept",handler:function(e){b(e)}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}],listeners:{}}).show()},loadCustomerInfo:function(){var a=this;a.mainPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:a.baseUrl+"&task=loadCustomerInfo",params:{cid:a.cid},method:"POST",success:function(c){a.mainPanel.getEl().unmask();var b=Ext.decode(c.responseText);a.tpl.overwrite(a.infoPanel.body,b.data)}.createDelegate(this),failure:function(c){a.mainPanel.getEl().unmask();var b=Ext.decode(c.responseText);CNOA.msg.alert(b.msg)}})},loadComment:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"loadCusComment",cid:this.cid},success:function(c){var b=Ext.decode(c.responseText);b.data.title="本计划的相关评阅";a.commentTpl.overwrite(a.commentPanel.body,b.data)}})},postCommentReport:function(){var c=this;var b=Ext.getCmp(c.ID_coustomers_comment_htmleditor);var a=b.getValue();Ext.Ajax.request({url:c.baseUrl,method:"POST",params:{task:"postCusComment",cid:c.cid,content:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){c.loadComment();b.setValue("");CNOA.msg.notice(d.msg,"上级查看")}else{CNOA.msg.alert(d.msg)}}})}};CNOA_user_customers_zgcustomerClass=CNOA.Class.create();CNOA_user_customers_zgcustomerClass.prototype={init:function(b){var a=this;this.edit_id=0;this.cid=b;this.baseUrl="index.php?app=user&func=customers&action=zhuguan";CNOA_user_customers_zgcustomerView=new CNOA_user_customers_zgcustomerViewClass(this.cid);CNOA_user_customers_zglinkmanList=new CNOA_user_customers_zglinkmanListClass(this.cid);CNOA_user_customers_zgpresalesList=new CNOA_user_customers_zgpresalesListClass(this.cid);CNOA_user_customers_zgpostsalesList=new CNOA_user_customers_zgpostsalesListClass(this.cid);CNOA_user_customers_zgrecordList=new CNOA_user_customers_zgrecordListClass(this.cid);this.tabs=new Ext.TabPanel({activeTab:0,region:"center",minTabWidth:120,tabWidth:120,enableTabScroll:true,listeners:{afterrender:function(c){}},items:[new Ext.Panel({title:"客户信息",layout:"fit",iconCls:"icon-cnoa-communication",items:CNOA_user_customers_zgcustomerView.mainPanel}),new Ext.Panel({title:"联系人列表",layout:"fit",items:CNOA_user_customers_zglinkmanList.mainPanel}),new Ext.Panel({title:"售前跟踪",layout:"fit",items:CNOA_user_customers_zgpresalesList.mainPanel}),new Ext.Panel({title:"售后回访",layout:"fit",items:CNOA_user_customers_zgpostsalesList.mainPanel}),new Ext.Panel({title:"销售记录",layout:"fit",items:CNOA_user_customers_zgrecordList.mainPanel})]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.tabs]})}};var CNOA_user_customers_zhuguanClass,CNOA_user_customers_zhuguan;CNOA_user_customers_zhuguanClass=CNOA.Class.create();CNOA_user_customers_zhuguanClass.prototype={init:function(){var f=this;this.edit_id=0;this.baseUrl="index.php?app=user&func=customers&action=zhuguan&agnetuid="+CNOA.user.customers.zhuguan.agentuid;this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.search={title:"",flowmanuid:0,stime:0,etime:0,sort:0};var e=Ext.id();var c=Ext.id();var a=Ext.id();var d=Ext.id();var b=Ext.id();this.fields=[{name:"cid"},{name:"name"},{name:"abbr"},{name:"cltSort"},{name:"phone"},{name:"flowmanname"},{name:"kaifaname"},{name:"sort"},{name:"linkman"},{name:"notice"},{name:"time"},{name:"posttime"},{name:"readtime"},{name:"lock"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"cid",dataIndex:"cid",hidden:true},{header:lang("opt"),dataIndex:"notice",width:70,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"客户名称",dataIndex:"name",width:120,sortable:true,menuDisabled:true,renderer:this.makeName.createDelegate(this)},{header:"客户简称",dataIndex:"abbr",width:100,sortable:false,menuDisabled:true},{header:"客户类别",dataIndex:"cltSort",width:70,sortable:false,menuDisabled:true},{header:"电话",dataIndex:"phone",width:80,sortable:false,menuDisabled:true},{header:"联系人",dataIndex:"linkman",width:76,sortable:false,menuDisabled:true},{header:"跟进人/渠道商",dataIndex:"flowmanname",width:120,sortable:false,menuDisabled:true},{header:"开发人",dataIndex:"kaifaname",width:70,sortable:false,menuDisabled:true},{header:"跟进时间",dataIndex:"time",width:80,sortable:false,menuDisabled:true},{header:"行业",dataIndex:"sort",width:100,sortable:false,menuDisabled:true},{header:"建立时间",dataIndex:"posttime",width:85,sortable:false,menuDisabled:true},{header:"最近评阅时间",dataIndex:"readtime",width:112,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(g,h){Ext.apply(h,f.search)}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,viewConfig:{},listeners:{rowdblclick:function(g,h){},rowclick:function(g,h){},cellclick:function(g,j,h,i){}},bbar:this.pagingBar});this.cltSort=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCltSort",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]}),listeners:{load:function(h,g){}}});this.centerPanel=new Ext.Panel({plain:false,region:"center",hideBorders:true,layout:"fit",border:false,items:[this.grid],tbar:new Ext.Toolbar({items:[{handler:function(g,h){f.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},"客户名称:",{xtype:"textfield",id:e,width:128},"&nbsp;跟进人:",{xtype:"hidden",id:c},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:c+"Tr",listeners:{selected:function(i,h,g){Ext.getCmp(c).setValue(h)}}},"起始时间",{xtype:"datefield",width:130,name:"stime",format:"Y-m-d",id:a},"截止时间",{xtype:"datefield",width:130,name:"etime",format:"Y-m-d",id:d},"客户类别：",{xtype:"combo",width:130,name:"cltSort",valueField:"id",hiddenName:"cltSort",displayField:"name",triggerAction:"all",mode:"local",editable:false,store:this.cltSort,fieldLabel:"排班类型",listeners:{select:function(i,g,h){}},id:b},{xtype:"button",text:lang("search"),style:"margin-left:5px",cls:"x-btn-over",listeners:{mouseout:function(g){g.addClass("x-btn-over")}},handler:function(){var h=Ext.getCmp(a).getRawValue();var k=Ext.getCmp(d).getRawValue();var g=Ext.getCmp(b).getValue();var j=Ext.getCmp(e).getValue();var i=Ext.getCmp(c).getValue();f.search.stime=h;f.search.etime=k;f.search.sort=g;f.search.title=j;f.search.flowmanuid=i;f.store.load({params:f.search})}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",listeners:{mouseout:function(g){}},handler:function(){Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(c).setValue("");f.search.stime=0;f.search.etime=0;f.search.sort=0;f.search.title="";f.search.flowmanuid=0;Ext.getCmp(c+"Tr").setValue("");f.store.load()}},"->",{xtype:"cnoa_helpBtn",helpid:53}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeName:function(g,e,a,i,c,f){var d=a.data;var b=g;if(d.lock=="1"){b="<span class='cnoa_color_red'>[已锁定]</span>&nbsp;"+b}return b},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' onclick='CNOA_user_customers_zhuguan.viewCustomer("+d.cid+");'>查看</a>";if(d.lock=="1"){b+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_user_customers_zhuguan.lockCustomer("+d.cid+", false);'>解锁</a>"}else{b+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_user_customers_zhuguan.lockCustomer("+d.cid+", true);'>锁定</a>"}return b},lockCustomer:function(e,a){var d=this;var b=function(){Ext.Ajax.request({url:d.baseUrl+"&task=lock",method:"POST",params:{cid:e},success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){CNOA.msg.notice(f.msg,"客户管理");d.store.reload()}else{CNOA.msg.alert(f.msg)}}})};var c=a?"锁定":"解锁";CNOA.msg.cf("确定要"+c+"此客户吗？(锁定后此客户基本信息不能被修改以及删除)",function(f){if(f=="yes"){b()}})},viewCustomer:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_ZG_VIEW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=customer&cid="+a,"CNOA_MENU_USER_CUSTOMERS_ZG_VIEW","查看客户","icon-page-view")}};var sm_user_customersT=1;
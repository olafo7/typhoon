var CNOA_user_customers_agentClass,CNOA_user_customers_agent;CNOA_user_customers_agentClass=CNOA.Class.create();CNOA_user_customers_agentClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=agent";Ext.Ajax.request({url:a.baseUrl+"&task=loadColumn",method:"POST",success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){a.layoutPanel(b)}else{CNOA.msg.alert(b.msg,function(){})}}})},layoutPanel:function(b){var d=this;this.sm=new Ext.grid.CheckboxSelectionModel({});this.cm=[new Ext.grid.RowNumberer(),this.sm,{header:lang("opt"),sortable:true,dataIndex:"id",width:175,menuDisabled:true,renderer:function(g,j,f){var h=f.data;var e="";if(h.status==2){e+='<a href="javascript:void(0)" class="gridview" onclick="CNOA_user_customers_agent.viewFlow('+h.uFlowId+')">'+lang("viewProcess")+"</a>"}else{if(h.status==0){e+='<a href="javascript:void(0)" class="gridview" onclick="CNOA_user_customers_agent.operate('+g+')">'+lang("launchApproval")+"</a>"}else{if(h.status==1){e+=lang("beingModerate")}}}if(h.activeAccount==0&&h.status==2){e+='<a href="javascript:void(0)" class="gridview2 jianju" onclick="CNOA_user_customers_agent.activeAccount('+g+')">'+lang("avtivateAccount")+"</a>"}return e}},{header:lang("addTime"),sortable:true,dataIndex:"posttime",width:100,menuDisabled:true},{header:lang("status"),sortable:true,dataIndex:"status",width:100,menuDisabled:true,renderer:function(e){if(e==1){return lang("beingModerate")}else{if(e==2){return lang("endApp")}else{return lang("notSubmitApp")}}}}];var a=[{name:"id"},{name:"posttime"},{name:"status"},{name:"uFlowId"},{name:"activeAccount"}];Ext.each(b.column,function(e,f){a.push({name:"field_"+e.field});d.cm.push({header:e.title,sortable:true,dataIndex:"field_"+e.field,width:e.width,menuDisabled:true})});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});this.sortStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerIndustry",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"sort"},{name:"industryName"}]})});this.sortStore.load();this.typeStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerSort",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"sid"},{name:"sortName"}]})});this.typeStore.load();this.regionStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRegionData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"rid"},{name:"name"}]})});this.regionStore.load();this.regionStore2=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRegionData2",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"pid"},{name:"name"}]}),listeners:{load:function(){}}});this.grid=new Ext.grid.GridPanel({store:this.store,width:600,plain:false,stripeRows:true,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,sm:this.sm,columns:this.cm,tbar:[{handler:function(e,f){d.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(e,f){d.addWin("add",0)}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{handler:function(e,f){var g=d.grid.getSelectionModel().getSelections();if(g.length==0){CNOA.miniMsg.alertShowAt(e,lang("haveNotChosenEdit"))}else{id=g[0].get("id");d.addWin("edit",id)}},iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(e,f){var g=d.grid.getSelectionModel().getSelections();if(g.length==0){CNOA.miniMsg.alertShowAt(e,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(e,lang("confirmToDelete"),function(){if(g){var j="";for(var h=0;h<g.length;h++){j+=g[h].get("id")+","}Ext.Ajax.request({url:d.baseUrl+"&task=deleteData",method:"POST",params:{ids:j},success:function(l){var k=Ext.decode(l.responseText);if(k.success===true){d.store.reload()}else{CNOA.msg.alert(k.msg,function(){})}}})}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>"],bbar:new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:30,listeners:{beforechange:function(e,f){}}})});this.treeStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSearchList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"field"},{name:"title"}]})});this.searchPanel=new Ext.form.FormPanel({region:"north",height:100,border:false,hidden:true,defaults:{border:false},padding:5,items:[{xtype:"panel",defaults:{border:false},items:[{xtype:"hidden",name:"id"},{xtype:"panel",layout:"table",layoutConfig:{columns:6},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong1",hiddenName:"kong1",valueField:"field",displayField:"title",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["equal",lang("equal")],["noEqual",lang("notEqual")],["contain",lang("contains")],["dayu",lang("greaterThan")],["xiaoyu",lang("lessThan")],["dayuEqual",lang("greaterOrEqual")],["xiaoyuEqual",lang("lessOrEqual")]]}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition1",hiddenName:"condition1",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value1"},{xtype:"button",text:lang("reset"),handler:function(){c.findField("kong1").setValue("");c.findField("condition1").setValue("equal");c.findField("value1").setValue("")}}]},{xtype:"panel",layout:"table",layoutConfig:{columns:4},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong2",hiddenName:"kong2",valueField:"field",displayField:"title",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["equal",lang("equal")],["noEqual",lang("notEqual")],["contain",lang("contains")],["dayu",lang("greaterThan")],["xiaoyu",lang("lessThan")],["dayuEqual",lang("greaterOrEqual")],["xiaoyuEqual",lang("lessOrEqual")]]}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition2",hiddenName:"condition2",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value2"},{xtype:"button",text:lang("reset"),handler:function(){c.findField("kong2").setValue("");c.findField("condition2").setValue("equal");c.findField("value2").setValue("")}}]},{xtype:"panel",layout:"table",layoutConfig:{columns:4},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong3",hiddenName:"kong3",valueField:"field",displayField:"title",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["equal",lang("equal")],["noEqual",lang("notEqual")],["contain",lang("contains")],["dayu",lang("greaterThan")],["xiaoyu",lang("lessThan")],["dayuEqual",lang("greaterOrEqual")],["xiaoyuEqual",lang("lessOrEqual")]]}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition3",hiddenName:"condition3",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value3"},{xtype:"button",text:lang("reset"),handler:function(){c.findField("kong3").setValue("");c.findField("condition3").setValue("equal");c.findField("value3").setValue("")}}]}]}]});var c=d.searchPanel.getForm();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.searchPanel,this.grid]});Ext.getCmp(CNOA.user.customers.agent.parentID).add(this.mainPanel);Ext.getCmp(CNOA.user.customers.agent.parentID).doLayout()},addWin:function(e,a){var d=this;var b=[{xtype:"panel",border:false,layout:"form",width:660,defaults:{},id:"ID_DEFINDE_FIELDS"}];this.addFormPanel=new Ext.form.FormPanel({border:false,labelWidth:90,width:640,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-left:5px;",items:b,autoScroll:true,listeners:{render:function(f){}}});var c=new Ext.Window({title:lang("add"),width:700,height:makeWindowHeight(500),modal:true,layout:"fit",resizable:false,border:false,items:this.addFormPanel,buttons:[{text:lang("save"),handler:function(){d.addFormPanel.getForm().submit({url:d.baseUrl+"&task=submitData",method:"POST",waitMsg:lang("waiting"),params:{id:a},success:function(f,g){if(g.result.success==true){CNOA.msg.alert(g.result.msg,function(){c.close();d.store.reload()})}}.createDelegate(this),failure:function(f,g){}.createDelegate(this)})}},{text:lang("close"),handler:function(f){c.close()}}]}).show();this.superField=Ext.getCmp("ID_DEFINDE_FIELDS");d.loadLayout(e,a)},loadLayout:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=loadLayout",method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){Ext.each(d.fieldset,function(f,g){b.addFieldSet(f.name,f.fieldset)});Ext.each(d.field,function(f,g){Ext.getCmp("ID_FIELD_SET_"+f.fieldset).add(b.addField(f.fstfield,f.secfield,f.fstname,f.secname,f.type))});b.superField.doLayout();if(c=="edit"){b.addFormPanel.getForm().load({url:b.baseUrl+"&task=loadFormData",method:"POST",params:{id:a},success:function(g,h){var f=h.result.data},failure:function(f,g){CNOA.msg.alert(g.result.msg,function(){})}})}}else{CNOA.msg.alert(d.msg,function(){})}}})},addFieldSet:function(b,a){var c=this;c.superField.add({xtype:"fieldset",title:b,anchor:"99%",autoHeight:true,id:"ID_FIELD_SET_"+a})},addField:function(a,b,e,g,c){var d=this;if(c=="textarea"){var f={xtype:"panel",layout:"form",items:[{xtype:"textarea",width:464,fieldLabel:e,name:"field_"+a}]}}else{if(c=="sort"){var f={xtype:"panel",layout:"form",items:[{xtype:"combo",fieldLabel:e,name:"field_"+a,store:this.sortStore,hiddenName:"field_"+a,valueField:"sort",displayField:"industryName",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false}]}}else{if(c=="type"){var f={xtype:"panel",layout:"form",items:[{xtype:"combo",fieldLabel:e,name:"field_"+a,store:this.typeStore,hiddenName:"field_"+a,valueField:"id",displayField:"sid",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false}]}}else{if(c=="region"){var f=[{xtype:"panel",layout:"form",items:[{xtype:"combo",fieldLabel:e,name:"field_"+a,store:this.regionStore,name:"field_"+a,secondId:b,valueField:"rid",displayField:"name",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false,listeners:{change:function(l,m,k){d.region2="";d.addFormPanel.getForm().findField("field_"+l.secondId).setValue("");d.regionStore2.load({params:{rid:m}})}}}]},{xtype:"panel",layout:"form",items:[{xtype:"combo",fieldLabel:g,name:"field_"+b,store:this.regionStore2,name:"field_"+b,valueField:"pid",displayField:"name",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false}]}]}else{var f=[];if(e==""||g==""){var h=e==""?b:a;f=[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:464,fieldLabel:e==""?g:e,name:"field_"+h}]}]}else{f=[{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:180,fieldLabel:e,name:"field_"+a}]},{xtype:"panel",layout:"form",items:[{xtype:"textfield",width:180,fieldLabel:g,name:"field_"+b}]}]}}}}}var j={xtype:"panel",layout:"table",layoutConfig:{columns:2},style:"margin-top:10px",border:false,defaults:{border:false},items:f};return j},operate:function(a){var b=this;CNOA.msg.cf("输入您要发起的流程的名称",function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=getFaqiFlow",method:"POST",params:{id:a},success:function(h){var d=Ext.decode(h.responseText);if(d.success===true){var g=d.flowType;var f=d.flowId;var k=d.nameRuleId;var l=d.tplSort;var j=0;var e=d.otherApp;if(g==0){mainPanel.closeTab("CNOA_MENU_WF_USE_OPENFLOW");mainPanel.loadClass("index.php?app=wf&func=flow&action=use&modul=new&task=loadPage&from=newflow&flowId="+f+"&nameRuleId="+k+"&flowType="+g+"&tplSort="+l+"&childId="+j+"&otherApp="+e,"CNOA_MENU_WF_USE_OPENFLOW",lang("FqNewFixedFlow"),"icon-flow-new")}else{mainPanel.closeTab("CNOA_USE_FLOW_NEWFREE_FLOWDESIGN");mainPanel.loadClass("index.php?app=wf&func=flow&action=use&modul=newfree&task=loadPage&from=flowdesign&flowId="+f+"&flowType="+g+"&tplSort="+l+"&childId="+j+"&otherApp="+e,"CNOA_USE_FLOW_NEWFREE_FLOWDESIGN",lang("designFlow1"),"icon-flow-new")}}else{CNOA.msg.alert(d.msg,function(){})}}})}})},viewFlow:function(a){mainPanel.closeTab("CNOA_MENU_WF_USE_OPENFLOW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=viewflow&uFlowId="+a,"CNOA_MENU_WF_USE_OPENFLOW",lang("viewFlow"),"icon-flow")},activeAccount:function(b){var a=this;Ext.MessageBox.prompt("",lang("addPassword"),function(d,c){if(d=="ok"){Ext.Ajax.request({url:a.baseUrl+"&task=activeAccount",method:"POST",params:{id:b,password:c},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.alert(e.msg,function(){a.store.reload()})}else{CNOA.msg.alert(e.msg,function(){})}}})}})}};var CNOA_user_customers_agentsetClass,CNOA_user_customers_agentset;CNOA_user_customers_agentsetClass=CNOA.Class.create();CNOA_user_customers_agentsetClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=agentset";Ext.Ajax.request({url:a.baseUrl+"&task=loadColumn",method:"POST",success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){a.layoutPanel(b)}else{CNOA.msg.alert(b.msg,function(){})}}})},layoutPanel:function(b){var c=this;this.sm=new Ext.grid.CheckboxSelectionModel({});this.cm=[new Ext.grid.RowNumberer(),this.sm,{header:lang("opt"),sortable:true,dataIndex:"id",width:100,menuDisabled:true,renderer:function(e,g,d){var f=d.data;return'<a href="javascript:void(0)" class="gridview" onclick="CNOA_user_customers_agentset.viewAgentList('+f.agentuid+')">'+lang("viewCustomer")+"</a>"}},{header:lang("clientNum"),sortable:true,dataIndex:"number",width:100,menuDisabled:true},{header:lang("addTime"),sortable:true,dataIndex:"posttime",width:100,menuDisabled:true},{header:lang("addPeople"),sortable:true,dataIndex:"postname",width:100,menuDisabled:true},{header:lang("status"),sortable:true,dataIndex:"status",width:100,menuDisabled:true,renderer:function(d){if(d==1){return lang("beingModerate")}else{if(d==2){return lang("endApp")}else{return lang("notSubmitApp")}}}}];var a=[{name:"id"},{name:"posttime"},{name:"status"},{name:"postname"},{name:"agentuid"},{name:"number"}];Ext.each(b.column,function(d,e){a.push({name:"field_"+d.field});c.cm.push({header:d.title,sortable:true,dataIndex:"field_"+d.field,width:d.width,menuDisabled:true})});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{}});this.grid=new Ext.grid.GridPanel({store:this.store,plain:false,stripeRows:true,loadMask:{msg:lang("waiting")},region:"center",layout:"fit",border:false,autoScroll:true,columns:this.cm,sm:this.sm,tbar:[{handler:function(d,e){c.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(d,e){c.setAddWIn()}.createDelegate(this),iconCls:"icon-channel-add",cls:"btn-blue3",text:lang("quDaoSet")},{handler:function(d,e){c.setWinList()},iconCls:"icon-channel-list",cls:"btn-blue3",text:lang("channelListJM")},{handler:function(d,e){c.bingFlow()},iconCls:"icon-channel-bangding",cls:"btn-blue3",text:lang("quDaoAddBinding")},{handler:function(d,e){c.accountSet()},iconCls:"icon-channel-loginSet",cls:"btn-blue3",text:lang("qiDaoLoginSet")},{handler:function(d,e){c.removeAgent(d)},iconCls:"icon-customes-change",cls:"btn-yellow1",text:lang("transferChannel")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(d,e){var f=c.grid.getSelectionModel().getSelections();if(f.length==0){CNOA.miniMsg.alertShowAt(d,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(d,lang("confirmToDelete"),function(){if(f){var h="";for(var g=0;g<f.length;g++){h+=f[g].get("id")+","}Ext.Ajax.request({url:c.baseUrl+"&task=deleteData",method:"POST",params:{ids:h},success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){c.store.reload()}else{CNOA.msg.alert(j.msg,function(){})}}})}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>"]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]});Ext.getCmp(CNOA.user.customers.agentset.parentID).add(this.mainPanel);Ext.getCmp(CNOA.user.customers.agentset.parentID).doLayout()},setBindFlow:function(){var g=this;var e=[{name:"flowId"},{name:"flowId"},{name:"name"},{name:"sort"},{name:"status"},{name:"tplSort"},{name:"flowType"}];var k=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFlowJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:true});k.load();var j=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"flowId",dataIndex:"flowId",hidden:true},{header:lang("flowName"),dataIndex:"name",id:"flowName",width:140,sortable:true,menuDisabled:true},{header:lang("sort2"),dataIndex:"sort",width:140,sortable:false,menuDisabled:true},{header:lang("processState"),dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:function(o,q,n){var p=this;if(o==1){return"<span class=cnoa_color_green>"+lang("enable")+"</span>"}else{return"<span class=cnoa_color_red>"+lang("disable")+"</span>"}}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var d=new Ext.PagingToolbar({displayInfo:true,store:k,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(n,o){Ext.apply(o,g.storeBar)}}});this.ID_SEARCH_TEXT_NAME=Ext.id();var l=new Ext.grid.GridPanel({store:k,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:j,hideBorders:true,border:false,region:"center",layout:"fit",autoExpandColumn:"flowName",stripeRows:true,bbar:d,tbar:["->",(lang("flowName")+":"),{xtype:"textfield",width:200,id:this.ID_SEARCH_TEXT_NAME,listeners:{specialkey:function(o,n){if(n.getKey()==n.ENTER){g.storeBar.sname=Ext.getCmp(g.ID_SEARCH_TEXT_NAME).getValue();g.store.load({params:g.storeBar})}}}},{xtype:"button",text:lang("search"),style:"margin-left:5px",iconCls:"icon-search",handler:function(){g.storeBar.sname=Ext.getCmp(g.ID_SEARCH_TEXT_NAME).getValue();k.load({params:g.storeBar})}},"-",{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(g.ID_SEARCH_TEXT_NAME).setValue("");g.storeBar.sname="";k.load({params:g.storeBar})}}]});var c=new Ext.tree.AsyncTreeNode({text:lang("allSort"),sortId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var h=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getFlowSortTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(n){}.createDelegate(this)}});var m=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:h,root:c,autoScroll:true,listeners:{click:function(n){g.storeBar.sortId=n.attributes.sortId;g.storeBar.sort=n.attributes.from;k.load({params:g.storeBar})}}});var a=new Ext.Panel({region:"west",layout:"fit",split:true,width:180,minWidth:80,maxWidth:380,border:false,bodyStyle:"border-right-width:1px;",items:[m],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("launchFlow"),"->",{handler:function(n,o){g.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});var f=new Ext.Window({width:800,height:550,modal:true,title:lang("chooseBindingFlow"),layout:"border",items:[a,l],buttons:[{text:lang("add"),handler:function(n){var o=l.getSelectionModel().getSelections();if(o.length==0){CNOA.miniMsg.alertShowAt(n,lang("haveNotChosen"))}else{if(o){Ext.Ajax.request({url:g.baseUrl+"&task=addBindFlowId",method:"POST",params:{flowId:o[0].get("flowId")},success:function(q){var p=Ext.decode(q.responseText);if(p.success===true){g.bingFlowStore.reload();g.flowFieldStore.reload()}else{CNOA.msg.alert(p.msg,function(){})}}})}f.close()}}},{text:lang("close"),handler:function(){f.close()}}]}).show()},accountSet:function(){var g=this;var f=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"index.php?app=main&func=user&action=list&task=getStationList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"stationid"},{name:"name"}]})});var b=new Ext.form.ComboBox({fieldLabel:lang("atStation"),name:"stationid",store:f,hiddenName:"stationid",valueField:"stationid",displayField:"name",mode:"local",width:160,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(k,h,j){}.createDelegate(this),change:function(){}.createDelegate(this)}});var d=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"index.php?app=main&func=user&action=add&task=getJobListByDeptId"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"jobId",mapping:"id"},{name:"value",mapping:"name"},{name:"jobType"}]}),listeners:{load:function(){c.getForm().findField("jobId").setValue(c.getForm().findField("jobId").getValue())}}});var a=new Ext.form.ComboBox({fieldLabel:lang("atJob"),name:"jobId",store:d,hiddenName:"jobId",valueField:"jobId",displayField:"value",mode:"local",width:160,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(k,h,j){if(h.data.jobType=="user"){}else{}}.createDelegate(this),change:function(){}.createDelegate(this)}});var c=new Ext.form.FormPanel({border:false,labelWidth:120,labelAlign:"left",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",autoScroll:true,defaults:{border:false},items:[{layout:"form",labelAlign:"right",width:245,labelWidth:60,items:[b]},{layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{layout:"form",labelAlign:"right",width:245,labelWidth:60,items:[{xtype:"departmentselectorfield",fieldLabel:lang("inDepartment"),width:160,allowBlank:false,name:"deptId",multiSelect:false,listeners:{confirm:function(h){c.getForm().findField("jobId").setValue("");d.load({params:{deptId:h.getValue()}})}}}]},{layout:"form",labelAlign:"right",width:245,labelWidth:60,items:[a]},{xtype:"hidden",name:"parttimeList"}]},{xtype:"displayfield",value:'<span class="cnoa_color_red">'+lang("thisFunctionAdmin")+"</span>"},{xtype:"fieldset",title:lang("oaClientSet"),width:506,defaults:{border:false},labelWidth:120,labelAlign:"right",items:[{xtype:"checkbox",name:"usemessager",fieldLabel:lang("allowUseClient"),checked:true,boxLabel:lang("allowOrNotAllow"),listeners:{check:function(j,h){if(h){c.getForm().findField("usesend").enable();c.getForm().findField("usereceive").enable()}else{c.getForm().findField("usesend").disable();c.getForm().findField("usereceive").disable()}}}},{xtype:"checkbox",name:"usesend",fieldLabel:lang("allowSendFile"),checked:true,boxLabel:lang("allowOrNotAllow")},{xtype:"checkbox",name:"usereceive",fieldLabel:lang("jSfile"),checked:true,boxLabel:lang("allowOrNotAllow")}]}],listeners:{render:function(h){}}});var e=new Ext.Window({title:lang("setAddWindow"),width:560,height:300,resizable:false,modal:true,layout:"fit",items:c,buttons:[{text:lang("save"),handler:function(h){c.getForm().submit({url:g.baseUrl+"&task=submitDept",method:"POST",success:function(j,k){if(k.result.success==true){CNOA.msg.alert(k.result.msg,function(){e.close()}.createDelegate(this))}else{CNOA.msg.alert(result.msg,function(){})}}})}},{text:lang("close"),handler:function(h){e.close()}}]}).show();c.getForm().load({url:g.baseUrl+"&task=loadPermitFormData",method:"POST",params:{id:g.id},waitTitle:lang("notice"),success:function(j,k){var h=k.result.data;d.load({params:{deptId:h.deptId}})},failure:function(h,j){CNOA.msg.alert(j.result.msg,function(){})}})},bingFlow:function(){var g=this;var b=[{name:"field"},{name:"kongjian"},{name:"name"}];this.flowFieldStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFlowFieldList",method:"POST"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]}),listeners:{load:function(k,h,j){g.bingFlowStore.load()}}});this.bingFlowStore=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getBindFlowList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b}),listeners:{load:function(k,h,j){if(h.length==0){g.setBindFlow()}}}});var d=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.sortCombo=new Ext.form.ComboBox({width:150,autoLoad:true,triggerAction:"all",selectOnFocus:true,editable:false,store:this.flowFieldStore,valueField:"id",displayField:"name",mode:"local",forceSelection:true});var a=[new Ext.grid.RowNumberer(),{header:"",hidden:true,dataIndex:"field"},{header:lang("inputBox"),sortable:true,dataIndex:"name",width:200,menuDisabled:true},{header:lang("flowControls"),sortable:true,dataIndex:"kongjian",width:200,menuDisabled:true,editor:this.sortCombo,renderer:function(h){var j;g.flowFieldStore.each(function(k){if(k.get("id")==h){j=k;return}});return j==null?"":j.get("name")}}];var c=new Ext.grid.GridPanel({store:this.bingFlowStore,plain:false,stripeRows:true,loadMask:{msg:lang("waiting")},region:"center",layout:"fit",border:false,autoScroll:true,columns:a,plugins:d,view:new Ext.grid.GroupingView({markDirty:false}),tbar:[{text:lang("removeBindingFlow"),iconCls:"icon-utils-s-delete",cls:"btn-gray1",handler:function(h){CNOA.msg.cf(lang("sureWantRemoveFlow"),function(j){if(j=="yes"){Ext.Ajax.request({url:g.baseUrl+"&task=removebindflow",method:"POST",success:function(l){var k=Ext.decode(l.responseText);if(k.success===true){e.close();CNOA.msg.alert(lang("pleaseOpenAgain"))}else{CNOA.msg.alert(k.msg,function(){})}}})}})}}]});var e=new Ext.Window({title:lang("setAddWindow"),width:700,height:makeWindowHeight(550),resizable:false,modal:true,layout:"fit",items:c,buttons:[{text:lang("save"),handler:function(h){var j=[];Ext.each(g.bingFlowStore.data.items,function(k,l){j.push(k.data)});Ext.Ajax.request({url:g.baseUrl+"&task=submitBindFlowField",method:"POST",params:{data:Ext.encode(j)},success:function(l){var k=Ext.decode(l.responseText);if(k.success===true){CNOA.msg.alert(k.msg,function(){e.close()})}else{CNOA.msg.alert(k.msg,function(){})}}})}},{text:lang("close"),handler:function(){e.close()}}]}).show()},setAddWIn:function(){var c=this;var a=[{xtype:"panel",border:false,layout:"form",defaults:{},id:"ID_DEFINDE_FIELDS"}];this.form=new Ext.form.FormPanel({border:false,labelWidth:60,labelAlign:"left",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:a,autoScroll:true,hideLabel:true,listeners:{render:function(d){}}});this.fieldStore=new Ext.data.SimpleStore({fields:["value","name"],data:[]});this.superField=Ext.getCmp("ID_DEFINDE_FIELDS");this.fieldsetid=1;this.fieldStoreData=[];this.childFieldid=1;this.childFieldArr=[];var b=new Ext.Window({title:lang("setAddWindow"),width:700,height:makeWindowHeight(550),resizable:false,modal:true,layout:"fit",items:this.form,tbar:[{text:lang("addSort"),handler:function(d){Ext.MessageBox.prompt("",lang("youNeesAddCategory"),function(e,f){if(e=="ok"){if(f!=""){c.addFieldSet(f,c.fieldsetid);c.fieldsetid++}else{CNOA.msg.alert(lang("youNotAddName"))}}})}},{text:lang("addInputBoxes"),handler:function(d){c.addChildField("add","","","","")}}],buttons:[{text:lang("save"),handler:function(e){var d=[];Ext.each(c.fieldStore.data.items,function(g,h){d.push(g.data)});var f=Ext.encode(d);c.form.getForm().submit({url:c.baseUrl+"&task=submitAddWinLayout",method:"POST",waitMsg:lang("waiting"),params:{tempStoreData:f},success:function(g,h){CNOA.msg.alert(lang("successopt"),function(){b.close()})}.createDelegate(this),failure:function(g,h){CNOA.msg.alert(h.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}},{text:lang("close"),handler:function(d){b.close()}}]}).show();c.loadData()},formatNote:function(b){var a={};switch(b){case"text":a.note_one="{["+lang("singleLineOfText")+"]}";a.note_two="{["+lang("singleLineOfText")+"]}";break;case"textarea":a.note_one="{["+lang("multipleLine")+"]}";a.note_two="{["+lang("multipleLine")+"]}";break;case"type":a.note_one="{["+lang("customCategory")+"]}";a.note_two="";break;case"sort":a.note_one="{["+lang("industryInformation")+"]}";a.note_two="";break;case"region":a.note_one="{["+lang("region")+"]}";a.note_two="{["+lang("twoRegion")+"]}";break;case"account":a.note_one="{["+lang("loginUserName")+"]}";a.note_two="{["+lang("realName")+"]}";break}return a},childFormat:function(j,l,m,f,d){var e=this;var a=this.childFieldid++;var b=this.childFieldid++;var h=this.formatNote(d);if(d=="textarea"){var g=[{xtype:"textarea",width:378,readOnly:true,name:"field_"+a+"_"+f+"_"+d,hideValue:l.fstname,value:h.note_one+l.fstname},{xtype:"hidden",readOnly:true,name:"field_"+b+"_"+f+"_"+d+"_hide",hideValue:l.secname,value:h.note_two+l.secname}]}else{if(d=="sort"){var g=[{xtype:"textfield",width:180,readOnly:true,name:"field_"+a+"_"+f+"_"+d,hideValue:l.fstname,value:h.note_one+l.fstname},{xtype:"hidden",width:180,readOnly:true,name:"field_"+b+"_"+f+"_"+d+"_hide",style:"margin-left:20px",hideValue:l.secname,value:h.note_two+l.secname}]}else{if(d=="type"){var g=[{xtype:"textfield",width:180,readOnly:true,name:"field_"+a+"_"+f+"_"+d,hideValue:l.fstname,value:h.note_one+l.fstname},{xtype:"hidden",width:180,readOnly:true,name:"field_"+b+"_"+f+"_"+d+"_hide",style:"margin-left:20px",hideValue:l.secname,value:h.note_two+l.secname}]}else{var c="";var k="";if(l.fstname==""){c="_hide"}if(l.secname==""){k="_hide"}var g=[{xtype:"textfield",width:180,readOnly:true,name:"field_"+a+"_"+f+"_"+d+c,hideValue:l.fstname,value:h.note_one+l.fstname},{xtype:"textfield",width:180,readOnly:true,name:"field_"+b+"_"+f+"_"+d+k,style:"margin-left:20px",hideValue:l.secname,value:h.note_two+l.secname}]}}}g.push({xtype:"button",text:lang("edit"),firstId:a,style:"margin-left:10px",secondId:b,sortFrom:f,typeFrom:d,handler:function(o){e.addChildField("edit",e.form.getForm().findField("field_"+o.firstId+"_"+o.sortFrom+"_"+o.typeFrom),e.form.getForm().findField("field_"+o.secondId+"_"+o.sortFrom+"_"+o.typeFrom),o.sortFrom,o.typeFrom)}},{xtype:"button",text:lang("del"),tableId:a,style:"margin-left:10px",handler:function(o){m.remove(Ext.getCmp("ID_GROUP_CHILD_FIELD"+o.tableId))}});var n={xtype:"panel",layout:"table",layoutConfig:{columns:5},style:"margin-top:10px",border:false,id:"ID_GROUP_CHILD_FIELD"+a,defaults:{border:false},items:g};return n},addChildField:function(k,m,l,h,c){var g=this;var d=function(){var o=a.getForm().getValues();var p=o.sortFrom;var r=o.typeFrom;if(p==0){g.superField.add(g.childFormat(k,o,g.superField,p,r));g.superField.doLayout()}else{var q=Ext.getCmp("ID_FIELD_SET_"+p);q.add(g.childFormat(k,o,q,p,r));q.doLayout()}};var n=[{xtype:"combo",fieldLabel:lang("type"),name:"typeFrom",hiddenName:"typeFrom",store:new Ext.data.SimpleStore({fields:["value","name"],data:[["text",lang("singleLineOfText")],["textarea",lang("multipleLine")],["type",lang("customCategory")],["sort",lang("industrySector")],["region",lang("channelRegion")],["account",lang("loginOAZHXM")]]}),valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,width:200,value:"text",listeners:{change:function(p,q,o){if(q=="textarea"||q=="type"||q=="sort"){a.getForm().findField("secname").setValue("");a.getForm().findField("secname").hide()}else{a.getForm().findField("secname").show()}}}},{xtype:"combo",fieldLabel:lang("categoryList"),name:"sortFrom",hiddenName:"sortFrom",store:this.fieldStore,valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,width:200,allowBlank:false,listeners:{select:function(q,o,p){}}},{xtype:"textfield",name:"fstname",width:200,fieldLabel:lang("firstName")},{xtype:"textfield",name:"secname",width:200,fieldLabel:lang("secondName")}];var a=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:n,autoScroll:true});var f=new Ext.Window({title:lang("add"),modal:true,resizable:false,width:400,height:220,layout:"fit",items:a,buttons:[{text:lang("ok"),hidden:k=="add"?false:true,handler:function(p){if(!a.getForm().isValid()){CNOA.msg.alert(lang("notSetFL"));return false}var o=a.getForm().getValues();g.childFieldArr.push(o.fstname);g.childFieldArr.push(o.secname);d();f.close()}},{text:lang("modify"),hidden:k=="edit"?false:true,handler:function(p){if(!a.getForm().isValid()){CNOA.msg.alert(lang("notSetFL"));return false}var r=[];Ext.each(g.childFieldArr,function(s,t){if(s!=m.hideValue&&s!=l.hideValue){r.push(s)}});var o=a.getForm().getValues();m.hideValue=o.fstname;l.hideValue=o.secname;var q=g.formatNote(c);m.setValue(q.note_one+o.fstname);l.setValue(q.note_two+o.secname);g.childFieldArr=r;g.childFieldArr.push(o.fstname);g.childFieldArr.push(o.secname);f.close()}},{text:lang("close"),handler:function(o){f.close()}}]}).show();if(k=="edit"){var b={};var e="";var j="";b.data={typeFrom:c,sortFrom:h,fstname:m.hideValue,secname:l.hideValue};a.getForm().loadRecord(b);a.getForm().findField("sortFrom").setDisabled(true);a.getForm().findField("typeFrom").setDisabled(true);if(c=="textarea"){a.getForm().findField("secname").hide()}}},checkChildField:function(b,d){var c=this;var a=false;if(b.fstname!=""||b.secname!=""){if(b.fstname==b.secname){CNOA.msg.alert(lang("nameRepeatAgain"));return false}if(b.fstname!=""){Ext.each(d,function(e,f){if(e==b.fstname){a=true}});if(a){CNOA.msg.alert(lang("firstNameCF"));return false}}if(b.secname!=""){Ext.each(d,function(e,f){if(e==b.secname){a=true}});if(a){CNOA.msg.alert(lang("secondNameCF"));return false}}return true}},loadData:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=loadFormData",method:"POST",success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){Ext.each(b.fieldset,function(d,e){a.addFieldSet(d.name,d.fieldset)});Ext.each(b.field,function(e,f){var d={};d.fstname=e.fstname;d.secname=e.secname;a.childFieldArr.push(e.fstname);a.childFieldArr.push(e.secname);a.addField(e.name,e.fieldset,e.type,d);a.fieldsetid++})}else{CNOA.msg.alert(b.msg,function(){})}}})},addFieldSet:function(b,a){var c=this;c.superField.add({xtype:"fieldset",title:b,anchor:"99%",autoHeight:true,id:"ID_FIELD_SET_"+a,items:[{xtype:"button",text:lang("delCategories"),fieldsetid:a,handler:function(d){CNOA.msg.cf(lang("removeClassification"),function(e){if(e=="yes"){c.superField.remove(Ext.getCmp("ID_FIELD_SET_"+d.fieldsetid));var f=[];Ext.each(c.fieldStoreData,function(g,h){if(g[0]!=d.fieldsetid){f.push(g)}});c.fieldStore.loadData(f)}})}}]});c.superField.doLayout();c.fieldStoreData.push([a,b]);c.fieldStore.loadData(c.fieldStoreData)},addField:function(c,b,e,a){var f=this;var d=Ext.getCmp("ID_FIELD_SET_"+b);d.add(f.childFormat("add",a,d,b,e));d.doLayout()},setWinList:function(){var e=this;var c=["field","name","title","width"];var g=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFieldList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c}),listeners:{load:function(m,k,l){}}});var j=new Ext.grid.ColumnModel([{id:"name",header:lang("inoutBoxName"),sortable:true,dataIndex:"name",menuDisabled:true}]);var h=new Ext.grid.GridPanel({region:"west",width:200,ddGroup:"wordDDGroup",layout:"fit",enableDragDrop:true,store:g,cm:j,autoExpandColumn:"name",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),dropConfig:{appendOnly:true},border:true,listeners:{afterrender:function(k){setTimeout(function(){new Ext.dd.DropTarget(f.getView().scroller.dom,{ddGroup:"wordDDGroup",notifyDrop:function(p,o,n){var l=p.dragData.selections;Ext.each(l,p.grid.store.remove,p.grid.store);var m=p.getDragData(o).rowIndex;if(typeof(m)=="undefined"){f.store.add(l)}else{b.insert(m,l)}}})},1000)}},tbar:new Ext.Toolbar({height:27,items:[lang("canDragToRight")]})});var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c})});var a=new Ext.grid.ColumnModel([{header:"",hidden:true,dataIndex:"fieldid"},{header:lang("inoutBoxName"),width:150,sortable:true,dataIndex:"name",menuDisabled:true},{id:"title",header:lang("customName"),sortable:true,dataIndex:"title",menuDisabled:true,editor:{xtype:"textfield",allowBlank:true}},{header:lang("width"),width:80,sortable:true,dataIndex:"width",menuDisabled:true,editor:{xtype:"textfield",allowBlank:true}}]);var f=new Ext.grid.EditorGridPanel({region:"center",ddGroup:"wordDDGroup",layout:"fit",enableDragDrop:true,store:b,cm:a,autoExpandColumn:"title",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),clicksToEdit:1,border:true,listeners:{afterrender:function(k){setTimeout(function(){new Ext.dd.DropTarget(h.getView().scroller.dom,{ddGroup:"wordDDGroup",notifyEnter:function(n,m,l){},notifyDrop:function(p,o,n){var l=p.dragData.selections;Ext.each(l,p.grid.store.remove,p.grid.store);var m=p.getDragData(o).rowIndex;if(typeof(m)=="undefined"){h.store.add(l)}else{g.insert(m,l)}}})},1000)}},tbar:new Ext.Toolbar({height:27,items:[lang("canDragToRight")]})});var d=new Ext.Window({title:lang("setAddWindow"),width:700,height:makeWindowHeight(550),resizable:false,modal:true,layout:"border",items:[h,f],buttons:[{text:lang("save"),handler:function(k){var l=[];Ext.each(b.data.items,function(m,n){l.push(m.data)});Ext.Ajax.request({url:e.baseUrl+"&task=submitList",method:"POST",params:{data:Ext.encode(l)},success:function(n){var m=Ext.decode(n.responseText);if(m.success===true){CNOA.msg.alert(m.msg,function(){d.close()})}else{CNOA.msg.alert(m.msg,function(){})}}})}},{text:lang("close"),handler:function(k){d.close()}}]}).show()},removeAgent:function(b){var g=this;var c="";var e=g.grid.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alertShowAt(b,lang("notChooseZYQD"));return false}else{if(e){for(var a=0;a<e.length;a++){c+=e[a].get("id")+","}}}var d=new Ext.form.FormPanel({region:"center",border:false,labelWidth:80,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",autoScroll:true,defaults:{border:false},items:[{xtype:"hidden",name:"removeToUid"},{xtype:"triggerForPeople",allowBlank:false,dataUrl:g.baseUrl+"&task=getAllUserListsInPermitDeptTree",fieldLabel:lang("transferTo"),width:230,listeners:{selected:function(k,j,h){d.getForm().findField("removeToUid").setValue(j)},opened:function(){},closed:function(){}}}]});var f=new Ext.Window({width:400,height:140,modal:true,title:lang("chooseBindingFlow"),layout:"border",items:d,buttons:[{text:lang("save"),handler:function(h){d.getForm().submit({url:g.baseUrl+"&task=removeAgent",method:"POST",waitMsg:lang("waiting"),params:{ids:c},success:function(j,k){CNOA.msg.alert(k.result.msg,function(){f.close();g.store.reload()})},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}},{text:lang("close"),handler:function(h){f.close()}}]}).show()},viewAgentList:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_ZHUGUAN");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=agentcustomer&agentuid="+a,"CNOA_MENU_USER_CUSTOMERS_ZHUGUAN",lang("superiorView"),"icon-cnoa-communication")}};var CNOA_user_customers_recycleClass,CNOA_user_customers_recycle;CNOA_user_customers_recycleClass=CNOA.Class.create();CNOA_user_customers_recycleClass.prototype={init:function(){var e=this;this.baseUrl="index.php?app=user&func=customers&action=recycle";this.statusFields={status:-1};var a=[{name:"cid"},{name:"name"},{name:"phone"},{name:"linkman"},{name:"industry"},{name:"posttime"},{name:"flowmanname"},{name:"sortName"}];var c={client:"",mobile:""};this.store=new Ext.data.Store({autoLoad:true,baseParams:c,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"num",dataIndex:"cid",hidden:true},{header:lang("clientName"),dataIndex:"name",width:130,sortable:false,menuDisabled:true},{header:lang("tel")+"/"+lang("mobile"),dataIndex:"phone",width:130,sortable:false,menuDisabled:true},{header:lang("linkMan"),dataIndex:"linkman",width:100,sortable:false,menuDisabled:true},{header:lang("trade"),dataIndex:"industry",width:150,sortable:false,menuDisabled:true},{header:lang("builtTime"),dataIndex:"posttime",width:111,sortable:false,menuDisabled:true},{header:lang("keHuleibie"),dataIndex:"sortName",width:130,sortable:false,menuDisabled:true},{header:lang("followUpPeople"),dataIndex:"flowmanname",width:111,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"cid",width:80,sortable:false,menuDisabled:true,renderer:e.renOpera.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false,hidden:true}]);var b=new Ext.form.TextField({width:80}),d=new Ext.form.TextField({width:80});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(f,g){g.status=e.statusFields.status}}});this.grid=new Ext.grid.GridPanel({border:false,layout:"fit",region:"center",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,bbar:this.pagingBar});this.mainPanel=new Ext.form.FormPanel({border:false,layout:"border",title:"",items:[e.grid],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{text:lang("recover"),iconCls:"icon-arrow-redo",cls:"btn-yellow1",handler:function(f){e.recoverList()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(f){e.deleteList(f)}},lang("clientName")+":",b,lang("mobile")+":",d,{text:lang("search"),handler:function(f){c.client=b.getValue();c.mobile=d.getValue();e.store.load()}},{text:lang("clear"),handler:function(f){b.setValue();d.setValue();c.mobile="";c.client="";e.store.load()}},{text:lang("cleanrecycle"),cls:"btn-gray1",iconCls:"icon-utils-s-delete",handler:function(){e.doClear()}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:3006}]})});e.statusFields.status=-1},renOpera:function(d,b,a){var c=a.json;var e=c.cid;return'<a href="javascript:void(0);"  class="gridview" onclick="CNOA_user_customers_recycle.viewCustomer('+e+');">'+lang("view")+"</a>"},viewCustomer:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW");mainPanel.loadClass(this.baseUrl+"&task=loadpage&from=customer&cid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW",lang("viewCustomer"),"icon-page-view")},recoverList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("sureWantRestoreXX"),function(e){if(e=="yes"){if(b){var f="";var g="";for(var d=0;d<b.length;d++){var g=b[d];var h=parseInt(g.get("cid"));f+=h+","}c.recoverData(f)}}})}},recoverData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=recover",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},doClear:function(){var a=this;CNOA.msg.cf("您确定要清空回收站? 不可恢复的操作.",function(b){if(b=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=clear",method:"POST",success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,"客户管理");a.store.reload()}else{CNOA.msg.alert(c.msg)}}})}})},deleteList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf("您确定要删除?",function(e){if(e=="yes"){if(b){var f="";var g="";for(var d=0;d<b.length;d++){var g=b[d];var h=parseInt(g.get("cid"));f+=h+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,"客户管理");b.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_user_customers_statisticClass,CNOA_user_customers_statistic;CNOA_user_customers_statisticClass=CNOA.Class.create();CNOA_user_customers_statisticClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=statistic";this.followStatsPanel;this.customerStatsPanel=this.getCustomerStatsPanel();this.notFollowPanel=this.chartPanel("到期未跟进客户","&task=getFollowData","CNOA_ID_NOFLLOW");this.myCustomersPanel=this.chartPanel2("我的客户数量","&task=myCustomers","CNOA_ID_MY_CUSTOMERS");this.followNumberPanel=this.chartPanel2("跟进客户数量","&task=followUp","CNOA_ID_FOLLOW_UP");this.receiveHighSeasPanel=this.chartPanel2("客户公海领用数","&task=receiveHighSeas","CNOA_ID_REC_HS");this.releasePanel=this.chartPanel2("客户释放公海数","&task=releaseHighSeas","CNOA_ID_REL_HS");this.newCustomersPanel=this.chartPanel2("新增客户数","&task=newCustomers","CNOA_ID_NEW_CUSTOMERS");this.preSalePanel=this.chartPanel2("售前跟踪","&task=preSale","CNOA_ID_PRE_SALE");this.saleTotalPanel=this.chartPanel2("销售总额","&task=saleTotal","CNOA_ID_SALE_TOTAL");this.myCustomersTypePanel=this.funnelChart("我的客户类别","&task=myCustomersType","CNOA_ID_FUNNEL");this.customersDegreePanel=this.funnelChart("客户程度","&task=customersDegree","CNOA_ID_FUNNEL2");this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.customerStatsPanel]});Ext.Ajax.request({url:this.baseUrl+"&task=getDegreeHeader",success:function(c){var f=Ext.decode(c.responseText),d=[],b=[],e,g;Ext.each(f,function(j,h){e="degree"+j.id;g={header:j.name,dataIndex:e};d.push(g);b.push({name:e})});a.followStatsPanel=a.getFollowStatsPanel(d,b);a.mainPanel.add(a.followStatsPanel);a.mainPanel.add(a.notFollowPanel);a.mainPanel.add(a.myCustomersPanel);a.mainPanel.add(a.followNumberPanel);a.mainPanel.add(a.receiveHighSeasPanel);a.mainPanel.add(a.releasePanel);a.mainPanel.add(a.newCustomersPanel);a.mainPanel.add(a.preSalePanel);a.mainPanel.add(a.saleTotalPanel);a.mainPanel.add(a.myCustomersTypePanel);a.mainPanel.add(a.customersDegreePanel)}})},getFollowStatsPanel:function(b,d){var f=this,d=[{name:"name"},{name:"addTotal"},{name:"preSaleTotal"},{name:"postSaleTotal"},{name:"successTotal"},{name:"moneyTotal"}].concat(d),a=new Ext.TimeInterval({showMode:"month"}),h={stime:a.getSTime(),etime:a.getETime()},j=new Ext.data.Store({autoLoad:true,baseParams:h,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFollowStats",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})}),c=function(k){if(!k){k=0}return'<label style="color:#FF3344; font-weight:bold;">'+k+"</label>"},e=function(k){return'<label style="color:#EE88EE; font-weight:bold;">'+k+"</label>"},g=new Ext.grid.ColumnModel({defaults:{width:100,sortable:true,menuDisabled:true,renderer:c},columns:[new Ext.grid.RowNumberer(),{header:lang("salesStaff"),dataIndex:"name",renderer:null}].concat(b,[{header:lang("newKHge"),dataIndex:"addTotal"},{header:lang("presalesTimes"),dataIndex:"preSaleTotal"},{header:lang("afterReviewTimes"),dataIndex:"postSaleTotal"},{header:lang("salesSuccessTimes"),dataIndex:"successTotal"},{header:lang("totalSalesYuan"),dataIndex:"moneyTotal",renderer:e}])});return new Ext.grid.GridPanel({title:lang("statisticalGJR"),border:false,loadMask:{msg:lang("loading")},store:j,cm:g,viewConfig:{rowOverCls:"x-grid3-row-over2"},tbar:new Ext.Toolbar({items:[lang("statisticalRange")+"：",a,{text:lang("statistics"),cls:"btn-red1",style:"margin: 3px 10px;",handler:function(){h.stime=a.getSTime();h.etime=a.getETime();j.reload()}},{text:lang("selectStatis"),handler:function(){f.selectPeople()}}]})})},getCustomerStatsPanel:function(){var h=this,e=[{name:"cname"},{name:"fname"},{name:"preSaleTotal"},{name:"postSaleTotal"},{name:"successTotal"},{name:"moneyTotal"}],b=new Ext.TimeInterval({showMode:"null"}),k={stime:b.getSTime(),etime:b.getETime(),sort:"moneyTotal",fid:0},l=new Ext.data.Store({autoLoad:true,baseParams:k,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerStats",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})}),c=function(m){if(!m){m=0}return'<label style="color:#FF3344; font-weight:bold;">'+m+"</label>"},g=function(m){return'<label style="color:#EE88EE; font-weight:bold;">'+m+"</label>"},j=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true,renderer:c},columns:[new Ext.grid.RowNumberer(),{header:lang("clientName"),dataIndex:"cname",width:180,renderer:null},{header:lang("followUpPeople"),dataIndex:"fname",width:100,renderer:null},{header:lang("presalesTimes"),dataIndex:"preSaleTotal"},{header:lang("afterReviewTimes"),dataIndex:"postSaleTotal"},{header:lang("salesSuccessTimes"),dataIndex:"successTotal"},{header:lang("totalSalesYuan"),dataIndex:"moneyTotal",renderer:g}]});var d=new Ext.form.ComboBox({width:80,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({fields:["val","text"],data:[["preSaleTotal",lang("perSaleGZ")],["postSaleTotal",lang("afterReview")],["successTotal",lang("salesSuccess")],["moneyTotal",lang("totalSales")]]}),valueField:"val",displayField:"text",value:"moneyTotal",listeners:{select:function(n,m){k.sort=n.getValue();l.reload({params:k})}}});var a=Ext.id(),f=new Ext.form.Hidden({id:a});return new Ext.grid.PageGridPanel({title:lang("KHTJ"),store:l,cm:j,viewConfig:{rowOverCls:"x-grid3-row-over2"},tbar:new Ext.Toolbar({items:[d,lang("followUpPeople")+"：",{xtype:"textfield",width:80,readOnly:true,listeners:{render:function(m){m.to=a},focus:function(m){people_selector("user",m,false,false)}}},f,lang("statisticalRange")+"：",b,{text:lang("statistics"),cls:"btn-red1",style:"margin: 3px 10px;",handler:function(){k.stime=b.getSTime();k.etime=b.getETime();k.sort=d.getValue();k.fid=f.getValue();l.reload({params:k})}}]})})},selectPeople:function(){var c=this;var e=function(){b.getForm().load({url:c.baseUrl+"&task=loadStatisticUser",method:"POST",waitTitle:lang("notice"),failure:function(f,g){CNOA.msg.alert(g.result.msg)}})};var a=[{xtype:"selectorform",width:340,height:100,readOnly:true,fieldLabel:lang("user"),blankText:lang("selectUser"),name:"tonames",hiddenName:"touids"}];var b=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,bodyStyle:"padding:10px",labelWidth:30,labelAlign:"right",items:[a]});var d=new Ext.Window({title:lang("selectPeople"),width:420,height:220,modal:true,layout:"fit",resizable:false,border:false,items:b,buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){b.getForm().submit({url:c.baseUrl+"&task=updateStatisticUser",method:"POST",success:function(f,g){CNOA.msg.notice2(g.result.msg);d.close()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]}).show();e()},chartPanel:function(d,b,f){var e=this;var c=new Ext.Panel({border:false,html:"<div style='width: 100%; height: 100%;' id='"+f+"'>",listeners:{afterrender:function(){Ext.Ajax.request({url:e.baseUrl+b,success:function(k){var j=Ext.decode(k.responseText);var g=new FusionCharts("scripts/fusioncharts/Column3D.swf","myChartId","100%","100%","0","1");g.setJSONData({chart:{caption:d},bgColor:"#FFFFFF",canvasBgColor:"#FFFFFF",canvasBgAlpha:0,baseFontSize:14,data:j.data});g.render(f)}})}}});var a=new Ext.Panel({border:false,title:d,layout:"fit",items:[c]});return a},chartPanel2:function(e,c,g){var f=this;var b=new Ext.TimeInterval({showMode:"month"}),d={stime:b.getSTime(),etime:b.getETime()};var a=new Ext.Panel({border:false,title:e,layout:"fit",html:"<div style='width: 100%; height: 100%;' id='"+g+"'>",tbar:new Ext.Toolbar({items:[lang("statisticalRange")+"：",b,{text:lang("statistics"),cls:"x-btn-over",style:"margin: 3px 10px;",listeners:{mouseout:function(h){h.addClass("x-btn-over")}},handler:function(){d.stime=b.getSTime();d.etime=b.getETime();$("#"+g).html();Ext.Ajax.request({url:f.baseUrl+c,params:{stime:d.stime,etime:d.etime},success:function(l){var k=Ext.decode(l.responseText);var j=new FusionCharts("scripts/fusioncharts/Column3D.swf","myChartId"+Math.floor(Math.random()*1000+1),"100%","100%","0","1");j.setJSONData({chart:{caption:e},bgColor:"#FFFFFF",canvasBgColor:"#FFFFFF",canvasBorderThickness:0,canvasBgAlpha:0,baseFontSize:12,formatNumberScale:0,decimalPrecision:2,data:k.data});j.render(g)}})}}]}),listeners:{afterrender:function(){Ext.Ajax.request({url:f.baseUrl+c,params:{stime:d.stime,etime:d.etime},success:function(l){var k=Ext.decode(l.responseText);var j=new FusionCharts("scripts/fusioncharts/Column3D.swf","myChartId"+Math.floor(Math.random()*1000+1),"100%","100%","0","1");j.setJSONData({chart:{caption:e},bgColor:"#FFFFFF",canvasBgColor:"#FFFFFF",canvasBorderThickness:0,canvasBgAlpha:0,baseFontSize:12,formatNumberScale:0,decimalPrecision:2,data:k.data});j.render(g)}})}}});return a},funnelChart:function(d,b,f){var e=this;var a=$(window).height()*0.9;var c=new Ext.Panel({title:d,layout:"fit",html:"<div style='width: 100%; height: "+a+"px;' id='"+f+"'>",listeners:{afterrender:function(){Ext.Ajax.request({url:e.baseUrl+b,success:function(k){var j=Ext.decode(k.responseText);var g=new FusionCharts("scripts/fusioncharts/Funnel.swf","myChartId"+Math.floor(Math.random()*1000+1),"100%","100%","0","1");g.setJSONData({chart:{caption:d},bgColor:"#FFFFFF",canvasBgColor:"#FFFFFF",canvasBgAlpha:0,baseFontSize:12,data:j.data});g.render(f)}})}}});return c}};var CNOA_user_customers_regionClass,CNOA_user_customers_region;CNOA_user_customers_regionClass=CNOA.Class.create();CNOA_user_customers_regionClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=region";this.dsc=Ext.data.Record.create([{name:"name",type:"string"}]);this.fields=[{name:"rid"},{name:"name"},{name:"order"},{name:"count"}];this.store=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{update:function(e,b,d){var c=b.data;if(d==Ext.data.Record.EDIT){a.submit(c)}}}});this.editor=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});this.sm=new Ext.grid.CheckboxSelectionModel({});this.cm=[new Ext.grid.RowNumberer(),this.sm,{header:"",dataIndex:"rid",hidden:true},{header:lang("largeArea"),dataIndex:"name",width:300,sortable:false,editor:{xtype:"textfield",allowBlank:false}},{header:lang("numRegional"),dataIndex:"count",width:80,sortable:false},{header:lang("order"),dataIndex:"order",width:100,sortable:false,editor:{xtype:"textfield",allowBlank:true,regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt")}},{header:lang("opt"),dataIndex:"rid",width:100,sortable:false,renderer:this.addRegion.createDelegate(this)}];this.grid=new Ext.grid.GridPanel({store:this.store,width:600,plain:false,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,stripeRows:true,plugins:[this.editor],columns:this.cm,sm:a.sm,view:new Ext.grid.GroupingView({markDirty:false}),listeners:{cellclick:function(b,f,d,c){if(d==6){return false}}},tbar:[{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){var d=new a.dsc({name:""});a.editor.stopEditing();a.store.insert(0,d);a.grid.getView().refresh();a.grid.getSelectionModel().selectRow(0);a.editor.startEditing(0)}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){var d=a.grid.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(b,lang("confirmToDelete"),function(){if(d){var f="";for(var e=0;e<d.length;e++){f+=d[e].get("rid")+","}a.deleteList(f)}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:5002}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},addRegion:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_user_customers_region.addRegionWin("+e+")'>"+lang("addPlace")+"</a>"},addRegionWin:function(h){var f=this;this.baseUrl2="index.php?app=user&func=customers&action=region&rid="+h;var d=[{name:"pid"},{name:"name"},{name:"order"}];this.store2=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl2+"&task=getJsonData"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d}),listeners:{update:function(n,k,m){var l=k.data;if(m==Ext.data.Record.EDIT){f.submit2(l)}}}});var b=new Ext.grid.CheckboxSelectionModel({});var j=[new Ext.grid.RowNumberer(),b,{header:"",dataIndex:"pid",hidden:true},{header:lang("areaName"),dataIndex:"name",width:300,sortable:true,editor:{xtype:"textfield",allowBlank:false}},{header:lang("order"),dataIndex:"order",width:100,sortable:true,editor:{xtype:"textfield",allowBlank:true,regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt")}}];var c=Ext.data.Record.create([{name:"name",type:"string"}]);var g=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});var a=new Ext.grid.GridPanel({store:f.store2,width:600,plain:false,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,plugins:[g],columns:j,sm:b,stripeRows:true,view:new Ext.grid.GroupingView({markDirty:false}),listeners:{cellclick:function(k,n,m,l){if(m==5){return false}}},tbar:[{handler:function(k,l){f.store2.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(k,l){var m=new c({name:""});g.stopEditing();f.store2.insert(0,m);a.getView().refresh();a.getSelectionModel().selectRow(0);g.startEditing(0)}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(k,l){var m=a.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(k,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(k,lang("confirmToDelete"),function(){if(m){var o="";for(var n=0;n<m.length;n++){o+=m[n].get("pid")+","}f.deleteList2(o)}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:5002}]});var e=new Ext.Window({title:lang("addPlace"),width:800,height:makeWindowHeight(500),modal:true,resizable:false,layout:"border",items:[a],buttons:[{text:lang("close"),handler:function(){e.close()}}]}).show()},deleteList:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delete",method:"POST",params:{lids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},deleteList2:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl2+"&task=delete2",method:"POST",params:{pids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store2.reload()}else{CNOA.msg.alert(c.msg)}}})},submit:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=update",params:a,method:"POST",success:function(e,d){var c=Ext.decode(e.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg,function(){b.store.reload()})}},failure:function(c,d){CNOA.msg.alert(result.msg,function(){b.store.reload()})}})},submit2:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl2+"&task=update2",params:a,method:"POST",success:function(e,d){var c=Ext.decode(e.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store2.reload()}else{CNOA.msg.alert(c.msg,function(){b.store2.reload()})}},failure:function(c,d){CNOA.msg.alert(result.msg,function(){b.store2.reload()})}})}};var CNOA_user_customers_share_recordClass,CNOA_user_customers_share_record;CNOA_user_customers_share_recordClass=CNOA.Class.create();CNOA_user_customers_share_recordClass.prototype={init:function(){this.baseUrl="index.php?app=user&func=customers&action=shareRecord";var c=this,a=[{name:"id"},{name:"customer"},{name:"shareNames"},{name:"time"},{name:"type"},{name:"name"}];store=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),sm=new Ext.grid.CheckboxSelectionModel(),shareName=function(e,f,d){return'<font color="#0000ff">'+e+"</font>"},colModel=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("clientName"),dataIndex:"customer",width:150},{header:lang("sharePeopleNmae"),dataIndex:"shareNames",width:220,renderer:shareName},{header:lang("time"),dataIndex:"time",width:140},{header:lang("optType"),dataIndex:"type",width:100},{header:lang("operator"),dataIndex:"name",width:80}]});var b=new Ext.grid.PageGridPanel({cm:colModel,sm:sm,store:store,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){store.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(e){var f=b.getSelectionModel().getSelections(),d=f.length;if(d==0){CNOA.miniMsg.alertShowAt(e,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(h){if(h=="yes"){var j=[];for(var g=0;g<d;g++){j.push(f[g].get("id"))}j=j.join(",");c.deleteData(j)}})}}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:100}]});this.mainPanel=b},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteShareRecord",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.mainPanel.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_user_customers_commonClass=CNOA.Class.create();CNOA_user_customers_commonClass.prototype={init:function(){this.baseUrl="index.php?app=user&func=customers&action=index"},goCustomer:function(b,a){a=a||"customer";switch(a){case"customer":mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW");mainPanel.loadClass("index.php?app=user&func=customers&action=index&module=info&task=loadPage&from=customer&cid="+b,"CNOA_MENU_USER_CUSTOMERS_VIEW",lang("viewCustomer"),"icon-page-view");break;case"zhuguan":mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_ZG_VIEW");mainPanel.loadClass("index.php?app=user&func=customers&action=zhuguan&module=info&task=loadPage&cid="+b,"CNOA_MENU_USER_CUSTOMERS_ZG_VIEW",lang("viewCustomer"),"icon-page-view");break}},goLinkMan:function(b){try{a.viewLM(b)}catch(c){var a=new CNOA_user_customers_linkmanListClass();a.viewLM(b)}}};var CNOA_user_customers_common=new CNOA_user_customers_commonClass();var CNOA_user_customers_info_viewClass=CNOA.Class.create();CNOA_user_customers_info_viewClass.prototype={init:function(){},view:function(b){var a=Ext.id();new Ext.Window({width:700,height:makeWindowHeight(550),modal:true,maximizable:true,title:lang("preSalesTrackRecord"),html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+a+'"></iframe></div>',listeners:{show:function(c){Ext.getDom(a).contentWindow.location.href=b+"&r="+Math.random()},close:function(){try{Ext.getDom(a).src=""}catch(c){}}}}).show()}};var CNOA_user_customers_info_recordClass=CNOA.Class.create();CNOA_user_customers_info_recordClass.prototype={init:function(h,g){var e=this;this.baseUrl="index.php?app=user&func=customers&action="+g;var b=[{name:"rid"},{name:"lname"},{name:"gname"},{name:"gdname"},{name:"price"},{name:"dealprice"},{name:"num"},{name:"amount"},{name:"date"},{name:"status"},{name:"checkdate"},{name:"checkname"},{name:"addname"}];var c=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRecordPanelList&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var a=function(n,l,j,p,k,m){var o=e.baseUrl+"&task=viewSaleRecord&rid="+j.data.rid;return'<a href="javascript:void(0);" class="gridview" onclick="new CNOA_user_customers_info_viewClass().view(\''+o+"')\">"+lang("view")+"</a>"};var d=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"rid",dataIndex:"rid",hidden:true},{header:lang("productName1"),dataIndex:"gdname"},{header:lang("linkMan"),dataIndex:"lname"},{header:lang("productType"),dataIndex:"gname"},{header:lang("unitPrice"),dataIndex:"price"},{header:lang("cJPrice"),dataIndex:"dealprice"},{header:lang("quantity"),dataIndex:"num"},{header:lang("totalSales"),dataIndex:"amount"},{header:lang("saleDate"),dataIndex:"date"},{header:lang("auditStatus"),dataIndex:"status"},{header:lang("auditor"),dataIndex:"checkname"},{header:lang("appDate1"),dataIndex:"checkdate"},{header:lang("addPeople"),dataIndex:"addname"},{header:lang("opt"),dataIndex:"noIndex",width:37,renderer:a}]});this.mainPanel=new Ext.grid.GridPanel({title:lang("salesRecord"),store:c,loadMask:{msg:lang("loading")},cm:d,sm:f,border:false,tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(j,k){c.reload()}}]})})}};var CNOA_user_customers_info_postsalesClass=CNOA.Class.create();CNOA_user_customers_info_postsalesClass.prototype={init:function(h,g){var e=this;this.baseUrl="index.php?app=user&func=customers&action="+g;var b=[{name:"pid"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"addname"}],c=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPostSalesPanelList&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})}),f=new Ext.grid.CheckboxSelectionModel(),a=function(l,k,j){var m=e.baseUrl+"&task=viewPostSale&pid="+j.data.pid;return'<a href="javascript:void(0);" onclick="new CNOA_user_customers_info_viewClass().view(\''+m+"')\">查看</a>"},d=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"pid",dataIndex:"pid",hidden:true},{header:lang("linkMan"),dataIndex:"linkman"},{header:lang("returnWay"),dataIndex:"type"},{header:lang("returnVisitTime"),dataIndex:"time"},{header:lang("nextTimeVisit"),dataIndex:"nexttime"},{header:lang("hFresult"),dataIndex:"content"},{header:lang("addPeople1"),dataIndex:"addname"},{header:lang("opt"),dataIndex:"pid",renderer:a}]});this.mainPanel=new Ext.grid.GridPanel({title:lang("afterReview"),store:c,loadMask:{msg:lang("loading")},cm:d,sm:f,border:false,tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(j,k){c.reload()}}]})})}};var CNOA_user_customers_info_presalesClass=CNOA.Class.create();CNOA_user_customers_info_presalesClass.prototype={init:function(c,h){var e=this;this.baseUrl="index.php?app=user&func=customers&action="+h;var b=[{name:"pid"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"result"},{name:"addname"}],j=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPreSalesPanelList&cid="+c,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})}),a=new Ext.grid.CheckboxSelectionModel(),f=function(l,k){k.attr='style="white-space:pre-wrap;"';return l},d=function(m,l,k){var n=e.baseUrl+"&task=viewPreSale&pid="+k.data.pid;return'<a href="javascript:void(0);" class="gridview" onclick="new CNOA_user_customers_info_viewClass().view(\''+n+"')\">"+lang("view")+"</a>"},g=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),a,{header:"pid",dataIndex:"pid",hidden:true},{header:lang("traceContent"),dataIndex:"content",renderer:f,id:"content"},{header:lang("trackResult"),dataIndex:"result"},{header:lang("linkMan"),dataIndex:"linkman"},{header:lang("trackType"),dataIndex:"type"},{header:lang("trackTime"),dataIndex:"time"},{header:lang("nextTrack"),dataIndex:"nexttime"},{header:lang("addPeople1"),dataIndex:"addname"},{header:lang("opt"),dataIndex:"pid",renderer:d},{header:"",dataIndex:"noIndex"}]});this.mainPanel=new Ext.grid.GridPanel({title:lang("perSaleGZ"),store:j,loadMask:{msg:lang("loading")},cm:g,sm:a,border:false,autoExpandColumn:"content",tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(k,l){j.reload()}}]})})}};var CNOA_user_customers_InfoClass=CNOA.Class.create();CNOA_user_customers_InfoClass.prototype={init:function(h,g){this.ID_coustomers_comment_htmleditor=Ext.id();this.baseUrl="index.php?app=user&func=customers&action="+g+"&module=info";var f=this,d,b,c;if(g=="zhuguan"||g=="highSeas"){b=lang("aboutFollowPeople");c=lang("addComment");d=new Ext.Button({iconCls:"icon-customes-change",text:lang("transfer1"),cls:"btn-yellow1",handler:function(j,k){f.moveCustomer(h)}})}else{if(g=="index"){b=lang("aboutCustomerRevirew");c=lang("reviewReply");d=new Ext.Button({iconCls:"icon-utils-s-edit",cls:"btn-red1",text:lang("editXinxi"),handler:function(j,k){f.editCustomerInfo(h)}})}}this.commentTpl=new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}'+lang("tiao")+")","		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:130px;width:120px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" style="background-color:#FFF;"></div>','				<div style="float:left;width:590px;"><div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">#{[xindex]} {pname}:<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;'+lang("inDepartment")+':<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;{ptime}:{posttime}</div>','				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>");var a=new Ext.Panel({border:false,items:[{xtype:"htmleditor",id:f.ID_coustomers_comment_htmleditor,width:748,height:140},{xtype:"button",text:c,cls:"cnoa-margin-top-5",handler:function(){f.postCommentReport(h)}}]});this.commentPanel=new Ext.Panel({border:false,html:lang("commentLoad")+"..."});var e=[{xtype:"fieldset",title:b,style:"margin:10px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.commentPanel,a]}];this.customerInfoPanel=new Ext.Panel({border:false,autoScroll:true,bodyStyle:"padding: 10px",listeners:{afterrender:function(){f.loadCustomerInfo(h);f.loadComment(h)}}});this.mainPanel=new Ext.Panel({border:false,autoScroll:true,items:[this.customerInfoPanel,e],tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(j){f.loadCustomerInfo(h);f.loadComment(h)}},d,"->",{xtype:"cnoa_helpBtn",helpid:95}]})})},loadCustomerInfo:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=loadCustomerInfo&from=view",params:{cid:b},method:"POST",success:function(d){var c=Ext.decode(d.responseText);makeListView(c,a.customerInfoPanel.body)}})},loadComment:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=loadCustomerComment",method:"POST",params:{cid:b},success:function(d){var c=Ext.decode(d.responseText);c.data.title=lang("thisPlanReview");a.commentTpl.overwrite(a.commentPanel.body,c.data)}})},postCommentReport:function(d){var c=this;var b=Ext.getCmp(c.ID_coustomers_comment_htmleditor);var a=b.getValue();Ext.Ajax.request({url:c.baseUrl+"&task=postCusComment",method:"POST",params:{cid:d,content:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){c.loadComment(d);b.setValue("");CNOA.msg.notice(e.msg,lang("followUpReply"))}else{CNOA.msg.alert(e.msg)}}})},editCustomerInfo:function(e){var b=this,d;Ext.Ajax.request({url:b.baseUrl+"&task=getCustomerCustomField",method:"POST",success:function(g){var f=Ext.decode(g.responseText);d=new Ext.CustomWindow({title:lang("modifyKeHuXinxi"),baseUrl:b.baseUrl,customColumns:f,submit:c}).show();a()}});var c=function(f){if(f.getForm().isValid()){f.getForm().submit({url:b.baseUrl+"&task=editCustomerInfo",method:"POST",params:{cid:e},waitMsg:lang("notice"),success:function(g,h){CNOA.msg.notice2(h.result.msg);b.loadCustomerInfo(e);d.close()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}},a=function(){Ext.Ajax.request({url:b.baseUrl+"&task=loadCustomerInfo&from=edit",params:{cid:e},method:"POST",success:function(g){var f=Ext.decode(g.responseText);d.get(0).getForm().setValues(f)}})}},moveCustomer:function(f){var d=this;var c=Ext.id();var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:80,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:10px;padding-top:30px",items:[{xtype:"hidden",name:"toUid",id:c},{xtype:"textfield",readOnly:true,width:223,allowBlank:false,fieldLabel:lang("transferTo"),listeners:{render:function(g){g.to=c},focus:function(g){people_selector("user",g,false,false)}}},{xtype:"box",border:false,style:"margin-top:50px;color:#666",html:lang("noteZhuanYiKeHu")}]});var b=function(g){if(a.getForm().isValid()){CNOA.msg.cf(lang("areYouDelete"),function(h){if(h=="yes"){a.getForm().submit({url:d.baseUrl+"&task=moveCustomer",waitTitle:lang("waiting"),method:"POST",waitMsg:lang("loading"),params:{cids:f},success:function(j,k){CNOA.msg.notice(k.result.msg,lang("customerMgr"));e.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}})}};var e=new Ext.Window({title:lang("transferCustomer"),layout:"fit",width:400,height:260,modal:true,maximizable:false,resizable:false,items:[a],buttons:[{xtype:"cnoa_helpBtn",helpid:97},{text:lang("qDZY"),iconCls:"icon-order-s-accept",handler:function(g){b(g)}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}],listeners:{}}).show()}};var CNOA_user_customers_linkmanListClass=CNOA.Class.create();CNOA_user_customers_linkmanListClass.prototype={init:function(h,c,g){var b=this,c=!!c,e=g;if(g=="customer"||g=="collect"){e="index"}this.baseUrl="index.php?app=user&func=customers&action="+e+"&module=linkman";this.cid=h;this.SMSReciever={};this.selLinkman={};var d=function(l,k,j){var m=b.baseUrl+"&task=viewLinkman&lid="+j.json.lid;return'<a href="javascript:void(0);" class="gridview" onclick="new CNOA_user_customers_info_viewClass().view(\''+m+"')\">"+lang("view")+"</a>"};var f=[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){a.store.reload()}}];if(g!="zhuguan"&&g!="highSeas"){f=f.concat([{text:lang("add"),tooltip:lang("addLinkMan"),iconCls:"icon-utils-s-add",handler:function(j,k){b.editLinkman()}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(k){var l=a.getSelectionModel().getSelections(),j=l.length;if(j==0){CNOA.miniMsg.alertShowAt(k,lang("mustSelectOneRow"))}else{if(j!=1){CNOA.miniMsg.alertShowAt(k,lang("selectItemOnly"))}else{b.editLinkman(l[0].json)}}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(k){var l=a.getSelectionModel().getSelections(),j=l.length;if(j==0){CNOA.miniMsg.alertShowAt(k,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(k,lang("sureDel"),function(){var m=[];for(var n=0;n<j;n++){m.push(l[n].json.lid)}m=m.join(",");b.delLinkman(m)})}}},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){Ext.Ajax.request({url:b.baseUrl+"&task=exportLinkmanToExcel&step=1",method:"POST",success:function(j,k){var l=Ext.decode(j.responseText);ajaxDownload(b.baseUrl+"&task=exportLinkmanToExcel&file="+l.msg+"&step=2")}})}},{text:lang("sendSms"),iconCls:"icon-phone-sound",cls:"btn-yellow1",handler:function(j,k){b.sendSMS()}}])}var a=new Ext.grid.CustomGridPanel({page:c,customFiledUrl:b.baseUrl+"&task=getLinkmanCustomField",storeUrl:b.baseUrl+"&task=getLinkmanList&pagging="+c+"&cid="+h,otherField:[{header:lang("opt"),dataIndex:"",width:80,renderer:d}],tbar:new Ext.Toolbar({items:f})});if(g!="zhuguan"&&g!="highSeas"){a.on("afterrender",function(j){j.pagingBar.on("change",function(m,k){var n=k.activePage,l=b.selLinkman[n];if(l){a.selModel.selectRows(l)}});j.selModel.on("rowdeselect",function(o,q,l){var p=j.pagingBar.getPageData().activePage,n=b.selLinkman[p];if(n){var k=n.length,m=0;for(;m<k;m++){if(n[m]==q){b.selLinkman[p]=n.del(m)}}delete (b.SMSReciever[l.json.lid])}});j.selModel.on("rowselect",function(p,r,l){var q=j.pagingBar.getPageData().activePage,n=b.selLinkman[q],o=l.json;if(!n){b.selLinkman[q]=[]}var k=b.selLinkman[q].length,m=0;for(;m<k;m++){if(n[m]==r){return}}b.selLinkman[q].push(r);b.SMSReciever[o.lid]={name:o.name,mobile:o.mobile}})})}this.mainPanel=a},editLinkman:function(b){var c=this,g=lang("addLinkMan"),a=c.mainPanel.store,f={};if(b){g=lang("editLinkMan");f={lid:b.lid}}var d=function(h){if(h.getForm().isValid()){h.getForm().submit({url:c.baseUrl+"&task=editLinkman",method:"POST",params:f,waitMsg:lang("notice"),success:function(j,k){CNOA.msg.notice2(k.result.msg);a.reload();e.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var e=new Ext.CustomWindow({title:g,width:600,height:600,baseUrl:c.baseUrl+"&cid="+c.cid,customColumns:c.mainPanel.customColumns,submit:d}).show();if(b){e.get(0).getForm().setValues(b)}},delLinkman:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delLinkman",method:"POST",params:{lids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){b.mainPanel.store.reload();CNOA.msg.notice2(c.msg)}else{CNOA.msg.alert(c.msg)}}})},sendSMS:function(){var f=this;var e=new Ext.form.DisplayField({xtype:"displayfield",value:lang("currentInput0")}),b=function(h){var g=h.getValue().length;e.setValue(lang("nowInput")+"<span class='cnoa_color_red'>"+g+"</span>"+lang("word"))},c=function(){a.getForm().submit({url:f.baseUrl+"&task=sendSMS2Linkman",waitTitle:lang("waiting"),method:"POST",waitMsg:lang("loading"),success:function(g,h){CNOA.msg.notice(h.result.msg,lang("customerMgr"));d.close()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,autoScroll:true,labelWidth:60,labelAlign:"right",padding:5,items:[{xtype:"textarea",name:"names",grow:true,growMin:120,width:670,height:110,fieldLabel:lang("receiveMan"),allowBlank:false,readOnly:true,listeners:{afterrender:function(k){var j=[];var g=[];for(var h in f.SMSReciever){g.push(f.SMSReciever[h].name+"("+f.SMSReciever[h].mobile+")");j.push(f.SMSReciever[h].mobile)}k.setValue(g.join(", "));a.getForm().findField("mobiles").setValue(j.join(","))}}},{xtype:"hidden",name:"mobiles"},{xtype:"datetimefield",width:177,minValue:new Date(),fieldLabel:lang("posttime"),name:"time"},{xtype:"displayfield",value:lang("emptyTimeIsSend")},{xtype:"textarea",width:670,height:110,allowBlank:false,enableKeyEvents:true,fieldLabel:lang("smsContent"),name:"text",listeners:{keyup:function(g,h){b(g)},change:function(g,h){b(g)}}},e]});var d=new Ext.Window({width:800,height:makeWindowHeight(600),modal:true,layout:"fit",autoScroll:false,title:lang("sendSms"),items:[a],buttons:[{text:lang("send"),handler:function(){c()}},{text:lang("close"),handler:function(){d.close()}}]}).show()}};var CNOA_user_customers_presalesListClass,CNOA_user_customers_presalesAddEditClass,CNOA_user_customers_presalesViewClass,CNOA_user_customers_presalesAddEdit,CNOA_user_customers_presalesView,CNOA_user_customers_customerPresalesList,CNOA_user_customers_collectPresalesList;CNOA_user_customers_presalesListClass=CNOA.Class.create();CNOA_user_customers_presalesListClass.prototype={init:function(h,m,j){var f=this,j=j?1:0;this.baseUrl="index.php?app=user&func=customers&action=index&module=presales&pagging="+j;this.cid=h;this.from=m;this.searchStore={linkman:"",content:"",uname:0};var e=[{name:"pid"},{name:"cname"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"result"},{name:"addname"},{name:"mobile"}],n=new Ext.data.Store({autoLoad:!h,baseParams:this.searchStore,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPreSalesList&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})}),c=new Ext.grid.CheckboxSelectionModel(),k=function(r,q){q.attr='style="white-space:pre-wrap;"';return r},g=function(t,s,q){var r=q.data;return"<a href='javascript:void(0);' onclick='CNOA_user_customers_"+m+"PresalesList.viewPresalse("+r.pid+")'  class='gridview'>"+lang("view")+"</a>"},l=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),c,{header:"pid",dataIndex:"pid",hidden:true},{header:lang("opt"),dataIndex:"pid",width:80,renderer:g},{header:lang("traceContent"),dataIndex:"content",width:200,renderer:k,id:"content"},{header:lang("trackResult"),dataIndex:"result",width:200},{header:lang("belongCustomer"),dataIndex:"cname",width:200},{header:lang("linkMan"),dataIndex:"linkman",width:200,sortable:true},{header:lang("mobile"),dataIndex:"mobile",sortable:true},{header:lang("trackType"),dataIndex:"type"},{header:lang("trackTime"),dataIndex:"time",width:108},{header:lang("nextTrack"),dataIndex:"nexttime",width:108},{header:lang("addPeople1"),dataIndex:"addname"}]}),b=new Ext.Button({text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){CNOA.msg.cf("导出选择跟踪内容,否则将导出全部内容",function(s){if(s=="yes"){var u=a.getSelectionModel().getSelections(),q=u.length;var t=[];for(var r=0;r<q;r++){t.push(u[r].get("pid"))}t=t.join(",");f.exportExcel(t)}})}}),a=new Ext.grid.PageGridPanel({page:j,cm:l,sm:c,store:n,searchStore:this.searchStore,listeners:{rowdblclick:function(r,s){var q=r.store.getAt(s).get("pid");f.editPanel("edit",q,h)}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(q,r){n.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(q,r){f.editPanel("add",0,h)}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(r,s){var t=a.getSelectionModel().getSelections();if(t.length==0){CNOA.miniMsg.alertShowAt(r,lang("mustSelectOneRow"))}else{var q=t[0].get("pid"),u=t[0].json.cid;f.editPanel("edit",q,u)}}},b,{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(s,u){var v=a.getSelectionModel().getSelections(),q=v.length;if(q==0){CNOA.miniMsg.alertShowAt(s,lang("mustSelectOneRow"))}else{var t=[];for(var r=0;r<q;r++){t.push(v[r].get("pid"))}t=t.join(",");CNOA.miniMsg.cfShowAt(s,lang("sureDel"),function(){f.deleteList(t)})}}}]})});Ext.Ajax.request({url:f.baseUrl+"&task=getExportPermit",method:"POST",success:function(s){var q=Ext.decode(s.responseText);if(q.success){b.show()}else{b.hide()}}});var p=new Ext.form.TextField(),o=new Ext.form.TextField(),d=new Ext.form.SelectorForm({multiselect:false,selectorType:"user",hiddenName:"addUid"});searchBar=new Ext.Toolbar({items:[lang("addPeople1"),d,"&nbsp;"+lang("linkMan"),p,"&nbsp;"+lang("content"),o,{text:lang("search"),style:"margin-left:5px",handler:function(){f.searchStore.linkman=p.getValue();f.searchStore.uname=d.getValue();f.searchStore.content=o.getValue();f.store.load()}},{text:lang("clear"),style:"margin-left:5px",handler:function(){f.searchStore.uname=0;f.searchStore.linkman="";f.searchStore.content="";p.setValue("");d.setValue("");o.setValue("");f.store.load()}}]});this.store=n;this.mainPanel=new Ext.Panel({plain:false,hideBorders:true,layout:"fit",border:false,items:a,tbar:searchBar})},viewPresalse:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_PRESALES");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=presalesView&pid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_PRESALES",lang("viewPreSale"),"icon-page-view")},deleteList:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=deletePresales",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},editPanel:function(b,a,c){CNOA_user_customers_presalesAddEdit=new CNOA_user_customers_presalesAddEditClass(b,a,c);CNOA_user_customers_presalesAddEdit.show()},exportExcel:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=exportExcel",method:"POST",params:{ids:a},success:function(c,d){ajaxDownload(c.responseText)}})}};CNOA_user_customers_presalesAddEditClass=CNOA.Class.create();CNOA_user_customers_presalesAddEditClass.prototype={init:function(h,a,f){var c=this,j=h=="edit"?lang("editPresale"):lang("addPresale");this.baseUrl="index.php?app=user&func=customers&action=index&module=presales";this.action=h=="edit"?"edit":"add";this.pid=a;this.smsSender=new Ext.form.SMSSender({from:"customers",fieldLabel:lang("smsNotice")});var e=Ext.id();var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerName&cid="+f,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"cid"},{name:"name"}]}),listeners:{load:function(o,n){if(f){var p=n[0].get("cid");if(p){Ext.getCmp(e).setValue(p)}if(!a){c.loadCustomerInfo(f)}}}}}),b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFollowType",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"},{name:"name"}]})}),k=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getDegree",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"degree"},{name:"degreeId"}]})}),g=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerSort",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"sid"},{name:"sortName"}]})}),m=new Ext.data.Store({autoLoad:!!parseInt(f),baseParams:{cid:f},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLinkman",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"lid"},{name:"name"}]})});var l=[{xtype:"fieldset",title:lang("thisTrackInformation"),width:555,items:[{xtype:"combo",id:e,fieldLabel:lang("belongCustomer"),store:d,name:"cid",hiddenName:"cid",valueField:"cid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false,value:"",listeners:{change:function(o,n,p){m.load({params:{cid:n}});c.loadCustomerInfo(n)},select:function(p,n,o){c.formPanel.getForm().findField("linkmanid").setValue("")}}},{xtype:"combo",fieldLabel:lang("keHuleibie"),store:g,hiddenName:"sid",valueField:"sid",displayField:"sortName",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,value:""},{xtype:"combo",fieldLabel:lang("extent"),store:k,hiddenName:"degreeId",valueField:"degreeId",displayField:"degree",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,value:0,listeners:{beforeselect:function(r){var p=0,o=r.store,q=o.getCount(),n;for(;p<q;p++){n=o.getAt(p);n.data.degree=n.json.degree}},expand:function(s){var p=0,o=s.store,r=o.getCount(),n,q;for(;p<r;p++){n=o.getAt(p);q=n.get("degree");if(n.json.num){q=n.get("degree")+' <span class="cnoa_color_red">('+n.json.num+")<span>"}n.set("degree",q)}}}},{xtype:"combo",fieldLabel:lang("linkMan"),store:m,name:"linkmanid",hiddenName:"linkmanid",valueField:"lid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false},{xtype:"combo",fieldLabel:lang("trackWay"),store:b,hiddenName:"type",valueField:"id",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false},{xtype:"compositefield",fieldLabel:lang("trackTime"),items:[{xtype:"datefield",width:143,format:"Y-m-d",name:"time_d",allowBlank:false,value:new Date().format("Y-m-d")},{xtype:"timefield",width:80,format:"H:i",allowBlank:false,name:"time_t",value:new Date().format("H:i")}]},{xtype:"textarea",width:380,height:110,allowBlank:false,name:"content",fieldLabel:lang("traceContent")},{xtype:"textarea",width:380,height:110,name:"result",fieldLabel:lang("trackResult")},{xtype:"flashfile",fieldLabel:lang("addAttach"),name:"attach",style:"margin-top:5px;",inputPre:"filesUpload"}]},{xtype:"fieldset",title:lang("nextGZXX"),width:555,items:[{xtype:"compositefield",fieldLabel:lang("nextGZtime"),items:[{xtype:"datefield",width:143,format:"Y-m-d",name:"nexttime_d",value:"09:00"},{xtype:"timefield",width:80,format:"H:i",name:"nexttime_t"}]},{xtype:"checkbox",width:230,style:"margin-top:5px",name:"alarm",fieldLabel:lang("whetherToNotice")},this.smsSender]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoScroll:true,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px;",items:l});this.mainPanel=new Ext.Window({width:600,height:makeWindowHeight(690),layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,title:j,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){this.submitForm({close:true})}.createDelegate(this)},{text:lang("apply"),hidden:this.action=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:false})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){this.mainPanel.show();if(this.action=="edit"){this.loadFormData(this.pid)}},close:function(){this.mainPanel.close()},loadCustomerInfo:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=getCustomerInfo",params:{cid:b},success:function(d){var c=Ext.decode(d.responseText);form=a.formPanel.getForm();form.findField("sid").setValue(c.sid);form.findField("degreeId").setValue(c.degreeId)}})},loadFormData:function(a){var b=this;this.formPanel.getForm().load({url:b.baseUrl+"&task=loadEditFormData",params:{pid:a},method:"POST",waitMsg:lang("waiting"),success:function(c,d){b.pid=a}.createDelegate(this),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){b.close()})}.createDelegate(this)})},submitForm:function(a){var b=this;if(b.formPanel.getForm().isValid()){b.formPanel.getForm().submit({url:b.baseUrl+"&task="+b.action+"Presales",waitTitle:lang("notice"),method:"POST",waitMsg:lang("notice"),params:{pid:b.pid},success:function(c,d){CNOA.msg.notice(d.result.msg,lang("customerMgr"));try{b.smsSender.submit()}catch(f){}if(a.close){b.close()}try{CNOA_user_customers_customerPresalesList.store.reload()}catch(f){}try{CNOA_user_customers_collectPresalesList.store.reload()}catch(f){}try{CNOA_user_customers_presalesView.refresh()}catch(f){}},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})}}};CNOA_user_customers_presalesViewClass=CNOA.Class.create();CNOA_user_customers_presalesViewClass.prototype={init:function(a){var b=this;this.pid=a;this.cid=0;this.baseUrl="index.php?app=user&func=customers&action=index&module=presales";this.mainPanel=new Ext.Panel({layout:"fit",border:false,bodyStyle:"padding: 10px",autoScroll:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(c){b.refresh()}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(c){CNOA_user_customers_presalesAddEdit=new CNOA_user_customers_presalesAddEditClass("edit",b.pid,b.cid);CNOA_user_customers_presalesAddEdit.show()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c){CNOA.miniMsg.cfShowAt(c,lang("sureDel"),function(){b.deletePRE()})}},"->",{xtype:"cnoa_helpBtn",helpid:92}]}),listeners:{afterrender:function(c){b.refresh()}}})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=viewPresales",params:{pid:a.pid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.mainPanel.body)},failure:function(c){var b=Ext.decode(c.responseText)}})},deletePRE:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deletePresales",method:"POST",params:{ids:a.pid},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice(b.msg,lang("customerMgr"));a.closeTab();try{CNOA_user_customers_customerPresalesList.store.reload()}catch(d){}try{CNOA_user_customers_collectPresalesList.store.reload()}catch(d){}}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.presalesView.parentID.replace("docs-",""))}};var CNOA_user_customers_postsalesListClass,CNOA_user_customers_postsalesAddEditClass,CNOA_user_customers_postsalesViewClass,CNOA_user_customers_postsalesAddEdit,CNOA_user_customers_postsalesView,CNOA_user_customers_customerPostsalesList,CNOA_user_customers_collectPostsalesList;CNOA_user_customers_postsalesListClass=CNOA.Class.create();CNOA_user_customers_postsalesListClass.prototype={init:function(h,g,d){var f=this,d=d?1:0;this.baseUrl="index.php?app=user&func=customers&action=index&module=postsales&pagging="+d;var a=[{name:"pid"},{name:"cname"},{name:"linkman"},{name:"type"},{name:"time"},{name:"nexttime"},{name:"content"},{name:"addname"},{name:"mobile"}];store=new Ext.data.Store({autoLoad:!h,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPostSalesList&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),sm=new Ext.grid.CheckboxSelectionModel(),makeOperate=function(m,l,j){var k=j.data;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_customers_"+g+"PostsalesList.view("+k.pid+")'>查看</a>"},colModel=new Ext.grid.ColumnModel({defaults:{width:90,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),sm,{header:"pid",dataIndex:"pid",hidden:true},{header:lang("belongCustomer"),dataIndex:"cname"},{header:lang("linkMan"),dataIndex:"linkman",sortable:true},{header:lang("mobile"),dataIndex:"mobile",sortable:true},{header:lang("returnWay"),dataIndex:"type"},{header:lang("returnVisitTime"),dataIndex:"time",width:120},{header:lang("nextTimeVisit"),dataIndex:"nexttime",width:120},{header:lang("hFresult"),dataIndex:"content"},{header:lang("addPeople1"),dataIndex:"addname"},{header:lang("opt"),dataIndex:"pid",renderer:makeOperate}]}),grid=new Ext.grid.PageGridPanel({store:store,page:d,loadMask:{msg:lang("waiting")},cm:colModel,sm:sm,border:false,listeners:{rowdblclick:function(k,l){var j=k.store.getAt(l).get("pid");f.editPanel("edit",j,h)}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(j,k){f.editPanel("add",0,h)}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(k,l){var m=grid.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(k,lang("mustSelectOneRow"))}else{var j=m[0].get("pid"),n=m[0].json.cid;f.editPanel("edit",j,n)}}},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){f.exportExcel()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(l,n){var o=grid.getSelectionModel().getSelections(),j=o.length;if(j==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{var m=[];for(var k=0;k<j;k++){m.push(o[k].get("pid"))}m=m.join(",");CNOA.miniMsg.cfShowAt(l,lang("sureDel"),function(){f.deleteList(m)})}}}]})});var c={},b=new Ext.form.TextField(),e=new Ext.Toolbar({items:[lang("linkMan")+":",b,{text:lang("search"),style:"margin-left:5px",handler:function(){c.linkman=b.getValue();store.load({params:c});grid.searchStore=c}},{text:lang("clear"),style:"margin-left:5px",handler:function(){b.setValue("");store.load();grid.searchStore={}}}]});this.store=store;this.mainPanel=new Ext.Panel({plain:false,hideBorders:true,layout:"fit",border:false,items:grid,tbar:e})},view:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_POSTSALES");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=postsalesView&pid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_POSTSALES",lang("viewSHHF"),"icon-page-view")},deleteList:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=deletePostsales",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},editPanel:function(b,a,c){CNOA_user_customers_postsalesAddEdit=new CNOA_user_customers_postsalesAddEditClass(b,a,c);CNOA_user_customers_postsalesAddEdit.show()},exportExcel:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=exportExcel",method:"POST",success:function(b,c){ajaxDownload(b.responseText)}})}};CNOA_user_customers_postsalesAddEditClass=CNOA.Class.create();CNOA_user_customers_postsalesAddEditClass.prototype={init:function(g,a,e){var c=this,h=g=="edit"?"售后回访":"添加售后回访";this.baseUrl="index.php?app=user&func=customers&action=index&module=postsales";this.action=g=="edit"?"edit":"add";this.pid=a;this.smsSender=new Ext.form.SMSSender({from:"customers",fieldLabel:lang("smsNotice")});var d=Ext.id();var f=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerName&cid="+e,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"cid"},{name:"name"}]}),listeners:{load:function(m,l){if(e){var n=l[0].get("cid");if(n){Ext.getCmp(d).setValue(n)}}}}}),b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFollowType",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"},{name:"name"}]})}),k=new Ext.data.Store({autoLoad:!!parseInt(e),baseParams:{cid:e},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLinkman",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"lid"},{name:"name"}]})}),j=[{xtype:"fieldset",title:lang("thisHFXX"),width:528,items:[{xtype:"combo",id:d,fieldLabel:lang("belongCustomer"),store:f,hiddenName:"cid",valueField:"cid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false,listeners:{change:function(m,l,n){k.load({params:{cid:l}})},select:function(n,l,m){c.formPanel.getForm().findField("linkmanid").setValue("")}}},{xtype:"combo",fieldLabel:lang("linkMan"),store:k,hiddenName:"linkmanid",valueField:"lid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false},{xtype:"combo",fieldLabel:lang("returnWay"),store:b,hiddenName:"type",valueField:"id",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false},{xtype:"compositefield",fieldLabel:lang("returnVisitTime"),items:[{xtype:"datefield",width:143,format:"Y-m-d",name:"time_d",allowBlank:false,value:new Date().format("Y-m-d")},{xtype:"timefield",width:80,format:"H:i",allowBlank:false,name:"time_t",value:new Date().format("H:i")}]},{xtype:"textarea",width:380,height:110,allowBlank:false,name:"content",fieldLabel:lang("traceContent")},{xtype:"flashfile",fieldLabel:lang("addAttach"),name:"attach",style:"margin-top:5px;",inputPre:"filesUpload"}]},{xtype:"fieldset",title:lang("nextHFXX"),width:528,items:[{xtype:"compositefield",fieldLabel:lang("nextHFtime"),items:[{xtype:"datefield",width:143,format:"Y-m-d",name:"nexttime_d",value:"09:00"},{xtype:"timefield",width:80,format:"H:i",name:"nexttime_t"}]},{xtype:"checkbox",width:230,name:"alarm",fieldLabel:lang("whetherToNotice")},c.smsSender]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px;",autoScroll:true,items:j});this.mainPanel=new Ext.Window({width:600,height:makeWindowHeight(530),layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,title:h,buttonAlign:"right",buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){c.submitForm({close:true})}},{text:lang("apply"),id:this.ID_btn_apply,hidden:this.action=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){c.submitForm({close:false})}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]})},show:function(){this.mainPanel.show();if(this.action=="edit"){this.loadFormData(this.pid)}},close:function(){this.mainPanel.close()},loadFormData:function(a){var b=this;this.formPanel.getForm().load({url:b.baseUrl+"&task=loadEditFormData",params:{pid:a},method:"POST",waitMsg:lang("waiting"),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){b.close()})}})},submitForm:function(a){var b=this;if(b.formPanel.getForm().isValid()){b.formPanel.getForm().submit({url:b.baseUrl+"&task="+b.action+"Postsales",waitTitle:lang("notice"),method:"POST",waitMsg:lang("notice"),params:{pid:b.pid},success:function(c,d){CNOA.msg.notice(d.result.msg,lang("customerMgr"));try{b.smsSender.submit()}catch(f){}if(a.close){b.close()}try{CNOA_user_customers_customerPostsalesList.store.reload()}catch(f){}try{CNOA_user_customers_collectPostsalesList.store.reload()}catch(f){}try{CNOA_user_customers_postsalesView.refresh()}catch(f){}},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})}}};CNOA_user_customers_postsalesViewClass=CNOA.Class.create();CNOA_user_customers_postsalesViewClass.prototype={init:function(a){var b=this;this.pid=a;this.cid=0;this.baseUrl="index.php?app=user&func=customers&action=index&module=postsales";this.mainPanel=new Ext.Panel({layout:"fit",border:false,bodyStyle:"padding: 10px",autoScroll:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(c){b.refresh()}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(c){CNOA_user_customers_postsalesAddEdit=new CNOA_user_customers_postsalesAddEditClass("edit",b.pid,b.cid);CNOA_user_customers_postsalesAddEdit.show()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c){CNOA.miniMsg.cfShowAt(c,lang("sureDel"),function(){b.deletePRE()})}}]}),listeners:{afterrender:function(c){b.refresh()}}})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=viewPostsales",params:{pid:a.pid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.mainPanel.body)},failure:function(c){var b=Ext.decode(c.responseText)}})},deletePRE:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deletePostsales",method:"POST",params:{ids:a.pid},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice(b.msg,lang("customerMgr"));a.closeTab();try{CNOA_user_customers_customerPostsalesList.store.reload()}catch(d){}try{CNOA_user_customers_collectPostsalesList.store.reload()}catch(d){}}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.postsalesView.parentID.replace("docs-",""))}};var CNOA_user_customers_recordListClass,CNOA_user_customers_recordAddEditClass,CNOA_user_customers_recordViewClass;var CNOA_user_customers_recordAddEdit,CNOA_user_customers_recordView;CNOA_user_customers_recordListClass=CNOA.Class.create();CNOA_user_customers_recordListClass.prototype={init:function(g,r){var s=this,j={};var l=Ext.id();this.baseUrl="index.php?app=user&func=customers&action=index&module=salesRecord";var n=[{name:"rid"},{name:"cname"},{name:"lname"},{name:"gname"},{name:"gdname"},{name:"price"},{name:"dealprice"},{name:"num"},{name:"amount"},{name:"date"},{name:"status"},{name:"checkdate"},{name:"checkname"},{name:"addname"},{name:"fahuocheckman"},{name:"fahuocheckdate"},{name:"fahuocontent"}],e=new Ext.data.Store({autoLoad:!g,proxy:new Ext.data.HttpProxy({url:s.baseUrl+"&task=getSalesRecordList&cid="+g,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:n}),listeners:{load:function(A,z){var y=A.reader.jsonData.saleroom;q.update('<b style="color:red">'+lang("totalSales")+"："+y+"</b>")}}});var w=new Ext.grid.CheckboxSelectionModel({}),t=function(z,y){if(!y){y="----"}if(!z){z="----"}return"<span>"+z+"</span><br /><span>"+y+"</span>"},d=function(B,A,y){var z=y.data.gname=="gd"?"<span style='color:red;'>"+lang("goods")+"</span>":"<span style='color:#800000;'>"+lang("server")+"</span>";return t(B,z)},p=function(y){return y=="yes"?"<span style='color:red;'>"+lang("confirmed")+"</span>":"<span style='color:green;'>"+lang("WQR")+"</span>"},u=function(A,z,y){return t(A,y.data.dealprice)},f=function(A,z,y){return t(A,y.data.date)},c=function(A,z,y){return t(A,y.data.checkdate)},o=function(A,z,y){return t(A,y.data.fahuocheckdate)},h=function(B,A,y){var z=y.data;return"<a href='javascript:void(0);' onclick='CNOA_user_customers_"+r+"RecordList.viewRecord("+z.rid+");'  class='gridview'>"+lang("view")+"</a>"},k=new Ext.grid.ColumnModel({defaults:{width:100,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),w,{header:"rid",dataIndex:"rid",hidden:true},{header:lang("productName1")+"/"+lang("goodsType"),dataIndex:"gdname",width:120,renderer:d},{header:lang("belongCustomer"),dataIndex:"cname"},{header:lang("linkMan"),dataIndex:"lname"},{header:lang("unitPrice")+"/"+lang("cJdiscount"),dataIndex:"price",renderer:u},{header:lang("quantity"),dataIndex:"num"},{header:lang("totalSales")+"/"+lang("saleDate"),dataIndex:"amount",width:120,renderer:f},{header:lang("auditStatus"),dataIndex:"status",renderer:p},{header:lang("cWAuditPeople"),dataIndex:"checkname",renderer:c},{header:lang("fahuoReviewer"),dataIndex:"fahuocheckman",renderer:o},{header:lang("addPeople1"),dataIndex:"addname"},{header:lang("opt"),dataIndex:"noIndex",width:120,renderer:h}]}),v=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],style:"border-left-width:1px;",displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:e,pageSize:15}),b=new Ext.TimeInterval({style:"margin-left:20px;",showMode:"null"}),q=new Ext.form.DisplayField({style:"margin-left:20px;",html:""});this.grid=new Ext.grid.GridPanel({store:e,loadMask:{msg:lang("waiting")},cm:k,sm:w,bbar:v,border:false,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(y,z){e.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",id:l,handler:function(y,z){CNOA_user_customers_recordAddEdit=new CNOA_user_customers_recordAddEditClass("add",0,g);CNOA_user_customers_recordAddEdit.show()}},{text:lang("modify"),iconCls:"icon-utils-s-edit",id:this.ID_btn_edit_RD,handler:function(y,A){var B=s.grid.getSelectionModel().getSelections();if(B.length==0){CNOA.miniMsg.alertShowAt(y,lang("mustSelectOneRow"))}else{var z=B[0].get("rid");s.editRecord(z)}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(y,z){var A=s.grid.getSelectionModel().getSelections();if(A.length==0){CNOA.miniMsg.alertShowAt(y,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(B){if(B=="yes"){s.deleteRecord(A[0].get("rid"))}})}}},q]}),listeners:{render:function(){getFlowId4Engine("saleRecord",function(z,y){Ext.getCmp(l).setHandler(function(){z()})})}}});var j={},m=new Ext.form.TextField({width:100}),x=new Ext.form.TextField({width:100}),a=new Ext.form.TextField({width:100});searchBar=new Ext.Toolbar({items:[lang("productName1")+":",x,lang("belongCustomer")+":",a,lang("linkMan")+":",m,b,{text:lang("search"),style:"margin: 3px 5px;",handler:function(){j={linkman:m.getValue(),gdname:x.getValue(),cname:a.getValue(),stime:b.getSTime(),etime:b.getETime()};e.reload({params:j})}},{text:lang("clear"),handler:function(){m.setValue("");x.setValue("");a.setValue("");j={};b.clearValue();e.reload({params:j})}}]});this.mainPanel=new Ext.Panel({plain:false,hideBorders:true,layout:"fit",border:false,items:s.grid,tbar:searchBar})},viewExcel:function(b){var d=this;var a="";var c=new Ext.Window({width:800,height:300,autoScroll:false,modal:true,resizable:true,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="CNOA_USER_CUSTOMERS_FAHUO"></iframe></div>',title:lang("importQHXX"),listeners:{show:function(e){var g=Ext.getDom("CNOA_USER_CUSTOMERS_FAHUO");var f=g.contentWindow.document;f.open();f.write("<BODY>");f.write(urldecode(a));f.write("</BODY>");f.close()}},buttons:[{text:lang("close"),handler:function(){c.close()}}]});Ext.Ajax.request({url:this.baseUrl+"&task=getFahuoContent",method:"POST",params:{rid:b},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){a=e.msg;if(a==""){a=lang("notAddQHXX")}c.show()}else{CNOA.msg.alert(e.msg)}}})},editRecord:function(a){CNOA_user_customers_recordAddEdit=new CNOA_user_customers_recordAddEditClass("edit",a,this.cid);CNOA_user_customers_recordAddEdit.show()},deleteRecord:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteSalesRecord",method:"POST",params:{rid:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.grid.store.reload()}else{CNOA.msg.alert(c.msg)}}})},viewRecord:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=recordView&rid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD",lang("viewSalesRecord"),"icon-page-view")}};CNOA_user_customers_recordAddEditClass=CNOA.Class.create();CNOA_user_customers_recordAddEditClass.prototype={init:function(l,n,h){var f=this,m=l=="edit"?"销售记录":"添加销售记录";this.baseUrl="index.php?app=user&func=customers&action=index&module=salesRecord";this.action=l=="edit"?"edit":"add";this.rid=n;this.smsSender=new Ext.form.SMSSender({from:"customers",fieldLabel:lang("smsNotice")});this.cid=h;this.ID_formPanel_goods=Ext.id();this.ID_formPanel_service=Ext.id();this.ID_FAHUOCONTENT_VALUE=Ext.id();this.ID_STOCKOUT_VIEWER=Ext.id();var g=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCustomerName&cid="+this.cid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"cid"},{name:"name"}]})}),c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFahuoType",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"},{name:"name"}]})});linkmanStore=new Ext.data.Store({autoLoad:!!parseInt(h),baseParams:{cid:h},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLinkman",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"lid"},{name:"linkman",mapping:"name"}]})});var j=Ext.id(),e={width:143,reacOnly:true,allowBlank:false,enableKeyEvents:true,listeners:{keyup:function(t,u){var q=parseFloat(b.getValue()),s=parseFloat(a.getValue()),p=parseFloat(d.getValue());if(q&&s&&p){var r=q*s*p;if(parseFloat(r)==r){r=Math.round(r*1000000)/1000000}k.setValue(r)}}}},b=new Ext.form.NumberField(Ext.apply({name:"num",fieldLabel:lang("quantity")},e)),a=new Ext.form.NumberField(Ext.apply({name:"price",fieldLabel:lang("unitPrice")},e)),d=new Ext.form.NumberField(Ext.apply({name:"dealprice",fieldLabel:lang("cJdiscount")},e)),k=new Ext.form.TextField({width:143,name:"amount",fieldLabel:lang("totalTurnover"),regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,enableKeyEvents:true,listeners:{keyup:function(s,t){var p=parseFloat(b.getValue()),r=parseFloat(a.getValue());if(p&&r){var q=s.getValue();q=parseFloat(q.split(",").join(""));dealprice=parseFloat(q/(p*r));d.setValue(dealprice)}}}});var o=[{xtype:"fieldset",title:lang("clientXinxi"),width:528,items:[{xtype:"combo",fieldLabel:lang("belongCustomer"),name:"cid",store:g,hiddenName:"cid",valueField:"cid",displayField:"name",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false,value:"",listeners:{change:function(q,p,r){linkmanStore.load({params:{cid:p}})},select:function(r,p,q){f.formPanel.getForm().findField("lid").setValue("")}}},{xtype:"combo",fieldLabel:lang("linkMan"),name:"lid",store:linkmanStore,hiddenName:"lid",valueField:"lid",displayField:"linkman",mode:"local",allowBlank:false,width:230,triggerAction:"all",forceSelection:true,editable:false}]},{xtype:"fieldset",title:lang("goodsXinxi"),width:528,items:[{xtype:"radiogroup",fieldLabel:lang("goodsType"),width:170,items:[{boxLabel:lang("goods"),name:"gname",inputValue:"gd",checked:true},{boxLabel:lang("server"),name:"gname",inputValue:"sv"}],listeners:{change:function(t,p){var r=Ext.getCmp(f.ID_formPanel_goods);var q=Ext.getCmp(f.ID_formPanel_service);if(t.getValue()=="gd"){r.show();q.hide();b.allowBlank=false;b.validationEvent=true;a.allowBlank=false;a.validationEvent=true;d.allowBlank=false;d.validationEvent=true}else{q.show();r.hide();b.allowBlank=true;b.validationEvent=false;b.clearInvalid();a.allowBlank=true;a.validationEvent=false;a.clearInvalid();d.allowBlank=true;d.validationEvent=false;d.clearInvalid()}}}},{xtype:"cnoa_textfield",name:"gdname",fieldLabel:lang("productName1"),width:355},{xtype:"panel",border:false,id:this.ID_formPanel_goods,layout:"form",items:[b,{border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false,width:255,layout:"form"},items:[{items:[a]},{items:[d]}]}]},{xtype:"textarea",id:this.ID_formPanel_service,width:398,reacOnly:true,hidden:true,name:"about",fieldLabel:lang("serviceItem")},{border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false,width:255,layout:"form"},items:[{items:[{xtype:"datefield",width:143,name:"date",allowBlank:false,format:"Y-m-d",fieldLabel:lang("saleDate"),value:new Date().format("Y-m-d")}]},{items:[k]}]},{xtype:"flashfile",fieldLabel:lang("addAttach"),name:"attach",style:"margin-top:5px;",inputPre:"filesUpload"}]},{xtype:"fieldset",title:lang("queHuanXX"),width:528,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:lang("import2")+"Excel",handler:function(){f.showImportWindow()}},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:lang("view"),disabled:true,id:f.ID_STOCKOUT_VIEWER,handler:function(){f.showImportToDbWindow(f.formatHtml,"add")}},{xtype:"hidden",name:"fahuocontent",id:f.ID_FAHUOCONTENT_VALUE}]},{xtype:"fieldset",title:lang("fahuoXX"),width:528,items:[{xtype:"datefield",name:"fahuonotice",fieldLabel:lang("daoHuoTX"),format:"Y-m-d",width:145},{xtype:"textfield",name:"transport",fieldLabel:lang("tuoYunDept"),width:145},{xtype:"combo",fieldLabel:lang("yunShuWay"),name:"fahuotype",store:c,hiddenName:"fahuotype",valueField:"id",displayField:"name",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false},{xtype:"textarea",name:"fahuonotes",fieldLabel:lang("remark"),width:380,height:110}]},{xtype:"fieldset",title:lang("auditXinxi"),width:528,items:[{xtype:"hidden",name:"checkuid",id:j},{xtype:"textfield",width:143,readOnly:true,name:"checkname",fieldLabel:lang("cWAuditPeople"),listeners:{render:function(p){p.to=j},focus:function(p){people_selector("user",p,false,false)}}},f.smsSender]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoWidth:true,waitMsgTarget:true,fileUpload:true,autoScroll:true,bodyStyle:"padding:5px;",items:o});this.mainPanel=new Ext.Window({layout:"fit",width:575,height:makeWindowHeight(468),resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,title:m,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f.submitForm({close:true})}},{text:lang("apply"),hidden:this.action=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){f.submitForm({close:false})}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]})},showImportWindow:function(){var a=this;this.UPLOAD_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"face",allowBlank:false,buttonCfg:{text:lang("browseQHXX")+"(Excel)"},hideLabel:true,width:370},{xtype:"displayfield",hideLabel:true,value:lang("must0307Excel")+"[<a href='resources/customers_import_demo.jpg' target='_blank'>"+lang("model")+"</a>]"},{xtype:"displayfield",hideLabel:true,value:lang("attention")+"<span class='cnoa_color_red'>"+lang("recommendedUse")+"<a href='http://cnoa.cn/download/s/messager' target='_blank' ext:qtip='"+lang("clickToDownload")+"' style='font-weight:bold;'>["+lang("oaClient")+"]</a>"+lang("enterTheOA")+"</span>"}],buttons:[{text:lang("import2"),cls:"btn-blue4",iconCls:"document-excel-import",handler:function(){if(this.UPLOAD_WINDOW_FORMPANEL.getForm().isValid()){this.UPLOAD_WINDOW_FORMPANEL.getForm().submit({url:a.baseUrl+"&other=stockout&task=getStockoutExcel",waitMsg:lang("waiting"),params:{},success:function(b,c){CNOA.msg.notice(c.result.msg,lang("customerMgr"));a.formatHtml=c.result.msg;a.showImportToDbWindow(a.formatHtml,"add");Ext.getCmp(a.ID_STOCKOUT_VIEWER).enable();Ext.getCmp(a.ID_FAHUOCONTENT_VALUE).setValue(a.formatHtml);a.UPLOAD_WINDOW.close()},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})}}},{text:lang("close"),handler:function(){a.UPLOAD_WINDOW.close()}}]});this.UPLOAD_WINDOW=new Ext.Window({width:398,height:190,autoScroll:false,modal:true,resizable:false,title:lang("importQHXX"),items:[this.UPLOAD_WINDOW_FORMPANEL],listeners:{close:function(){a.html=""}}}).show()},showImportToDbWindow:function(a,b){var d=this;if(a==""){a=lang("notUploadEXCELdoc")}var c=new Ext.Window({width:800,height:300,autoScroll:false,modal:true,resizable:true,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="CNOA_USER_CUSTOMERS_FAHUO"></iframe></div>',title:lang("importQHXX"),maximizable:true,listeners:{show:function(e){var g=Ext.getDom("CNOA_USER_CUSTOMERS_FAHUO");var f=g.contentWindow.document;f.open();f.write("<BODY>");f.write(urldecode(a));f.write("</BODY>");f.close()}},buttons:[{text:lang("close"),handler:function(){c.close()}}]});if(b=="add"){c.show()}},show:function(){var a=this;a.mainPanel.show();if(a.action=="edit"){a.loadFormData(a.rid)}},close:function(){this.mainPanel.close()},loadFormData:function(b){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=loadEditFormData",params:{rid:b},method:"POST",waitMsg:lang("waiting"),success:function(c,e){var f=e.result.data.lid;a.cid=e.result.data.cid;a.formatHtml=e.result.data.fahuocontent;a.showImportToDbWindow(a.formatHtml,"edit");Ext.getCmp(a.ID_STOCKOUT_VIEWER).enable();if(a.action=="edit"){var d=a.formPanel.getForm().findField("lid");d.store.load({params:{cid:a.cid},callback:function(){d.setValue(f)}})}},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}})},submitForm:function(a){var b=this;if(b.formPanel.getForm().isValid()){b.formPanel.getForm().submit({url:b.baseUrl+"&task="+b.action+"SalesRecord",waitTitle:lang("notice"),method:"POST",waitMsg:lang("notice"),params:{rid:b.rid},success:function(c,d){if(a.close){b.close()}try{b.smsSender.submit()}catch(f){}try{CNOA_user_customers_customerRecordList.grid.store.reload()}catch(f){}try{CNOA_user_customers_collectRecordList.grid.store.reload()}catch(f){}try{CNOA_user_customers_recordView.refresh()}catch(f){}CNOA.msg.notice(d.result.msg,lang("customerMgr"))},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})}else{CNOA.msg.alert(lang("xinxiNotComplete"))}}};CNOA_user_customers_recordViewClass=CNOA.Class.create();CNOA_user_customers_recordViewClass.prototype={init:function(a){var b=this;this.rid=a;this.cid=0;this.ID_BTN_EDIT=Ext.id();this.baseUrl="index.php?app=user&func=customers&action=index&module=salesRecord";this.mainPanel=new Ext.Panel({layout:"fit",border:false,bodyStyle:"padding: 10px",autoScroll:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(c,d){b.refresh()}},{text:lang("modify"),id:this.ID_BTN_EDIT,iconCls:"icon-utils-s-edit",handler:function(c,d){CNOA_user_customers_recordAddEdit=new CNOA_user_customers_recordAddEditClass("edit",b.rid,b.cid);CNOA_user_customers_recordAddEdit.show()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c,d){CNOA.miniMsg.cfShowAt(c,lang("sureDel"),function(){b.deleteRecord()})}}]}),listeners:{afterrender:function(c){b.refresh()}}})},refresh:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=viewSalesRecord",params:{rid:a.rid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);a.cid=b.cid;makeListView(b,a.mainPanel.body);if(b.status=="yes"){Ext.getCmp(a.ID_BTN_EDIT).hide()}}})},deleteRecord:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deleteSalesRecord",method:"POST",params:{rid:a.rid},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice(b.msg,lang("customerMgr"));a.closeTab();try{CNOA_user_customers_customerRecordList.grid.store.reload()}catch(d){}try{CNOA_user_customers_collectRecordList.grid.store.reload()}catch(d){}}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.user.customers.recordView.parentID.replace("docs-",""))}};var CNOA_user_customers_bindingClass,CNOA_user_customers_binding;CNOA_user_customers_bindingClass=CNOA.Class.create();CNOA_user_customers_bindingClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=binding";this.bindingGrid=this.getBindingPanel();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.bindingGrid]})},getBindingPanel:function(){var e=this;var a=[{name:"id"},{name:"name"},{name:"flowName"},{name:"isShow"}];var f=function(g){switch(g){case"1":return"<input type='checkbox' checked=true>";break;case"0":return"<input type='checkbox'>";break}};var c=function(k,h,g){var j=g.data,l=j.id;k="<a javascript:void(0); class='gridview' onclick=CNOA_user_customers_binding.bindingFlow("+l+")>绑定流程</a>";k+="<a javascript:void(0); class='gridview2 jianju' onclick=CNOA_user_customers_binding.bindingField("+l+")>绑定字段</a>";k+="<a javascript:void(0); class='gridview3 jianju' onclick=CNOA_user_customers_binding.bindingShowField("+l+")>数据对接</a>";return k};var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[{header:"id",dataIndex:"id",hidden:true},{header:"名称",dataIndex:"name",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:"流程名称",dataIndex:"flowName",width:300},{header:"是否显示",dataIndex:"isShow",width:80,renderer:f,align:"center"},{header:"操作",dataIndex:"opt",width:260,renderer:c}]});this.bindingStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getBindingData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var d=new Ext.grid.EditorGridPanel({region:"center",border:false,store:e.bindingStore,cm:b,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.bindingStore.reload()}}]}),listeners:{afteredit:function(j){var h=j.field,k=j.record.get("id"),g=j.value;e.updateData(k,h,g)},cellclick:function(h,m,j){var k=h.getColumnModel().getDataIndex(j);if(k=="isShow"){var g=h.getStore().getAt(m),l=g.get("id");oldValue=g.get("isShow");value=$(h.getView().getCell(m,j)).find("input").attr("checked");if(value==undefined||value==oldValue){return}value=value?1:0;e.updateData(l,k,value)}}}});return d},updateData:function(d,c,b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=updateData",params:{id:d,field:c,value:b},success:function(e){var f=Ext.decode(e.responseText);if(f.success){CNOA.msg.notice2(f.msg)}else{CNOA.msg.alert(f.msg)}a.bindingStore.reload()}})},getSortDropStore:function(){var b=this;var a=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=getSortDrop"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"sortId"},{name:"name"}]})});return a},bindingFlow:function(h){var d=this;var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getFlowDrop"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"flowId"},{name:"name"}]})}),c=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"流程分类",store:d.getSortDropStore(),width:300,hiddenName:"sortId",valueField:"sortId",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(m,k,l){var j=k.data.sortId;b.load({params:{sid:j}})}}}),a=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"流程名称",store:b,width:300,hiddenName:"flowId",valueField:"flowId",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false});var f=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,region:"center",items:[c,a]});var e=function(){if(f.getForm().isValid()){f.getForm().submit({url:d.baseUrl+"&task=submitBindingFlow",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{id:h},success:function(j,l){var k=Ext.decode(l.response.responseText);d.bindingStore.reload();if(k.success){CNOA.msg.notice2(k.msg)}g.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var g=new Ext.Window({title:"绑定流程",width:450,height:160,layout:"border",resizable:true,autoDistory:true,modal:true,maskDisabled:true,items:[f],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){e()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}}]});g.show()},bindingField:function(b){var g=this,k=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getFlowField&id="+b}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})}),d=new Ext.form.Label({fieldLabel:"流程名称",name:"flowName"}),j=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"选择审批字段",store:k,width:250,hiddenName:"checkId",valueField:"id",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),c=new Ext.form.FieldSet({labelWidth:150,width:580,title:"流程信息",border:true,items:[d,j]}),h=new Ext.form.FieldSet({labelWidth:150,width:580,title:"流程控件",border:true}),a=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",padding:10,items:[c,h]});var f=function(){var l=j.getValue();if(l==""){CNOA.msg.alert("审批字段不能为空");return}if(a.getForm().isValid()){a.getForm().submit({url:g.baseUrl+"&task=submitBindingFleld",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{id:b},success:function(m,o){var n=Ext.decode(o.response.responseText);if(n.success){CNOA.msg.notice2(n.msg)}g.bindingStore.reload();e.close()},failure:function(m,n){CNOA.msg.alert(n.result.msg)}})}};var e=new Ext.Window({title:"绑定控件",width:630,height:660,modal:true,items:[a],resizable:true,autoScroll:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}],listeners:{beforerender:function(l){Ext.Ajax.request({url:g.baseUrl+"&task=getFlowField",params:{id:b},success:function(m,r){var q=Ext.decode(m.responseText),p=q.data,o={xtype:"checkbox",fieldLabel:"",boxLabel:"是否显示",name:""};if(q.failure){CNOA.msg.alert(q.msg);e.close();return}for(var n=0;n<p.length;n++){o.fieldLabel=p[n].name;o.name="T_"+p[n].id;h.add(o)}h.doLayout();if(a.getHeight()<595){a.setHeight(595)}a.doLayout()}})}}});e.show();a.getForm().load({url:g.baseUrl+"&task=loadFormData",method:"POST",params:{id:b},success:function(l,n){var m=n.result.data;name=m.flowName;d.setText(name)}})},bindingShowField:function(b){var l=this,k=Ext.id(),a=Ext.id(),f=Ext.id(),j=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:l.baseUrl+"&task=getFlowFieldStore&id="+b}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"flowFieldId"},{name:"name"}]})}),m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:l.baseUrl+"&task=getCustomersField"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"fieldId"},{name:"fieldname"}]})}),g=new Ext.form.Label({fieldLabel:"流程名称",name:"flowName"}),e=new Ext.form.FormPanel({bodyStyle:"padding:10px",autoScroll:true,labelAlign:"right",items:[{xtype:"fieldset",labelWidth:80,width:500,title:"流程信息",border:true,items:[g]},{xtype:"fieldset",labelWidth:80,width:500,title:"数据对接",border:true,items:[{xtype:"compositefield",items:[{xtype:"multiselect",id:a,height:250,width:150,valueField:"fieldId",displayField:"fieldname",mode:"local",typeAhead:true,triggerAction:"all",store:m,tbar:[{text:"客户字段"}]},{xtype:"multiselect",id:k,height:250,width:150,valueField:"flowFieldId",displayField:"name",mode:"local",typeAhead:true,triggerAction:"all",store:j,tbar:[{text:"流程字段"}]},{xtype:"button",text:lang("add"),style:{marginTop:"228px"},handler:function(){var q=Ext.getCmp(k).getRawValue();var n=Ext.getCmp(a).getRawValue();if(q.length==0||n.length==0){CNOA.msg.alert("没有选中对接字段")}else{if(q.length>1||n.length>1){CNOA.msg.alert("对接字段不能多选")}else{var r=true;$("input[name=bindMap]").each(function(u,w){var v=$(w).val().split("|");if(q==v[1]||n==v[0]){r=false;CNOA.msg.alert("对接字段不能多次绑定")}});if(r){var s=$("#"+k+" dl.ux-mselect-selected").text();var o=$("#"+a+" dl.ux-mselect-selected").text();var t=n+"|"+q+"|"+o+"|"+s;var p=c("bind",o+"=>"+s,t);$("#"+f).append(p)}}}}}]},{xtype:"displayfield",fieldLabel:"对接绑定步骤",id:f,style:{marginBottom:"10px"}}]}]}),d=new Ext.Window({title:lang("flowBind"),width:550,height:makeWindowHeight(550),layout:"fit",hideBorders:true,items:e,modal:true,buttons:[{text:lang("ok"),handler:function(){h()}},{text:lang("cancel"),handler:function(){d.close()}}]}).show();e.getForm().load({url:l.baseUrl+"&task=loadBindFieldData",params:{id:b},method:"POST",success:function(n,q){var t=q.result.data;name=t.flowName,item=t.data;g.setText(name);if(typeof item!="undefined"){var p=item.length,u="",v="",s="",o=[];for(var r=0;r<p;r++){v=item[r].text;s=item[r].inputText;var u=["<span>",v,'<a style="margin-left:5px;" onclick="$(this).parent().remove();">'+lang("del")+'</a><input type="hidden" name="bindMap" value="',s,'"/><br/></span>'];o.push(u.join(""))}$("#"+f).append(o.join(""))}}});var c=function(o,q,p){var n=["<span>",q,'<a style="margin-left:5px;" onclick="$(this).parent().remove();">'+lang("del")+'</a><input type="hidden" name="',o,'Map" value="',p,'"/><br/></span>'];return n.join("")};var h=function(){var n=[];$("input[name$=Map]").each(function(o,p){n.push($(p).val())});Ext.Ajax.request({url:l.baseUrl+"&task=saveMap",params:{bindData:n.join(","),id:b},success:function(o,q){var p=Ext.decode(o.responseText);if(p.failure){CNOA.msg.alert(p.msg)}else{CNOA.msg.notice2(p.msg);d.close()}}})}}};var CNOA_user_customers_shareListClass,CNOA_user_customers_shareList;CNOA_user_customers_shareListClass=CNOA.Class.create();CNOA_user_customers_shareListClass.prototype={init:function(g){var f=this;this.baseUrl="index.php?app=user&func=customers&action=index&module=shareUser";var a=[{name:"id"},{name:"truename"}],b=new Ext.data.Store({autoLoad:!g,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareUserList&cid="+g,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),e=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),c=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),e,{header:"id",dataIndex:"id",hidden:true},{header:lang("shareUser"),dataIndex:"truename",width:200,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]),d=new Ext.grid.GridPanel({store:b,cm:c,sm:e,border:false,hideBorders:true,loadMask:{msg:lang("loading")},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.mainPanel.store.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=d.getSelectionModel().getSelections(),h=k.length;if(h==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(m){if(m=="yes"){var n=[];for(var l=0;l<k.length;l++){n.push(k[l].get("id"))}n=n.join(",");Ext.Ajax.request({url:f.baseUrl+"&task=deleteShareUser",method:"POST",params:{cid:g,ids:n},success:function(q,p){var o=Ext.decode(q.responseText);if(o.success===true){CNOA.msg.notice(o.msg,lang("customerMgr"));f.mainPanel.store.reload()}else{CNOA.msg.alert(o.msg,function(){b.reload()})}},failure:function(o,p){CNOA.msg.alert(result.msg,function(){f.mainPanel.store.reload()})}})}})}}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:135}]});this.mainPanel=d}};var CNOA_user_customers_shareRecordListClass,CNOA_user_customers_shareRecordList;CNOA_user_customers_shareRecordListClass=CNOA.Class.create();CNOA_user_customers_shareRecordListClass.prototype={init:function(h){this.baseUrl="index.php?app=user&func=customers&action=index&module=shareRecord";var f=this,n={},e=[{name:"id"},{name:"position"},{name:"where"},{name:"original"},{name:"change"},{name:"time"},{name:"truename"}],k=new Ext.data.Store({autoLoad:!h,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareRecordList&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})}),d=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),j=new Ext.grid.ColumnModel({defaults:{width:100,sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("labelType"),dataIndex:"position"},{header:lang("editLocal"),dataIndex:"where"},{header:lang("editBeforeXX"),dataIndex:"original",width:200},{header:lang("revisedXX"),dataIndex:"change",width:200},{header:lang("editTime"),dataIndex:"time",width:150},{header:lang("editByName"),dataIndex:"truename",width:100}]}),c={width:100,style:"margin-right:5px"},m=new Ext.form.TextField(c),b=new Ext.form.TextField(c),l=new Ext.form.TextField(c),a=new Ext.form.TextField(c),g=new Ext.grid.PageGridPanel({store:k,cm:j,sm:d,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(o,p){f.mainPanel.store.reload()}},lang("labelType")+":",m,lang("editLocal")+":",b,lang("editBeforeXX")+":",l,lang("revisedXX")+":",a,{text:lang("search"),style:"margin-left:5px",handler:function(){n.position=m.getValue();n.where=b.getValue();n.original=l.getValue();n.change=a.getValue();f.mainPanel.store.load({params:n})}},{text:lang("clear"),style:"margin-left:5px",handler:function(){n={};m.setValue("");b.setValue("");l.setValue("");a.setValue("");f.mainPanel.store.load({params:n})}}]});this.mainPanel=g}};var CNOA_user_customers_mySendRecordClass,CNOA_user_customers_mySendRecord;CNOA_user_customers_mySendRecordClass=CNOA.Class.create();CNOA_user_customers_mySendRecordClass.prototype={init:function(h){var g=this;this.baseUrl="index.php?app=user&func=customers&action=index&module=fahuo&cid="+h;var a=[{name:"rid"},{name:"gdname"},{name:"fahuotype"},{name:"fahuocheckman"},{name:"fahuocheckdate"},{name:"fahuonotice"}],c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),f=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),b=function(m,l,j){var k=j.data;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_customers_recordList.viewExcel("+k.rid+");'>缺货信息</a>"},d=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"rid",dataIndex:"rid",hidden:true},{header:lang("productName1"),dataIndex:"gdname",width:180},{header:lang("yunShuWay"),dataIndex:"fahuotype"},{header:lang("fahuoReviewer"),dataIndex:"fahuocheckman"},{header:lang("shipmentAuditTime"),dataIndex:"fahuocheckdate"},{header:lang("noticeTime"),dataIndex:"fahuonotice"},{header:lang("opt"),dataIndex:"rid",width:80,sortable:false,renderer:b},{header:"",dataIndex:"noIndex",width:1}]}),e=new Ext.grid.GridPanel({store:c,cm:d,sm:f,border:false,hideBorders:true,loadMask:{msg:lang("loading")},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){g.mainPanel.store.reload()}},"->",{xtype:"cnoa_helpBtn",helpid:135}]});this.mainPanel=e}};var CNOA_user_customers_binding_readlyClass,CNOA_user_customers_binding_readly;CNOA_user_customers_binding_readlyClass=CNOA.Class.create();CNOA_user_customers_binding_readlyClass.prototype={init:function(d){var a=this;var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.baseUrl="index.php?app=user&func=customers&action=index&module=bindingReadly&cid="+d;var b=new Ext.grid.GridPanel({sm:c,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){a.mainPanel.store.reload()}}]});this.mainPanel=b;a.getColumn()},getColumn:function(){var b=this;var a=[new Ext.grid.RowNumberer(),{header:"cid",dataIndex:"cid",hidden:true},{header:"流程名称",dataIndex:"flowName",width:150}];Ext.Ajax.request({url:b.baseUrl+"&task=getColumn",success:function(c,e){var k=Ext.decode(c.responseText),h,l,d={},g=k.data;var j=[{name:"cid"},{name:"flowName"}];for(var f=0;f<g.length;f++){h=g[f].header;l=g[f].dataIndex;j.push({name:l});d={header:h,dataIndex:l,sortable:false,width:150};a.push(new Ext.grid.Column(d))}var m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:j})});b.mainPanel.reconfigure(m,new Ext.grid.ColumnModel(a))}})},viewDetailTable:function(b,c,e){var d=this;var a=d.baseUrl+"&task=viewDetailTable&uFlowId="+b+"&flowId="+c+"&tableId="+e;window.open(a,"noticept","width=1000, height="+(screen.availHeight-500)+",left="+((screen.availWidth-1000)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")}};var CNOA_user_customers_binding_submitClass,CNOA_user_customers_binding_submit;CNOA_user_customers_binding_submitClass=CNOA.Class.create();CNOA_user_customers_binding_submitClass.prototype={init:function(d){var a=this;var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.baseUrl="index.php?app=user&func=customers&action=index&module=bindingSubmit&cid="+d;var b=new Ext.grid.GridPanel({sm:c,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){a.mainPanel.store.reload()}}]});this.mainPanel=b;a.getColumn()},getColumn:function(){var b=this;var a=[new Ext.grid.RowNumberer(),{header:"cid",dataIndex:"cid",hidden:true},{header:"流程名称",dataIndex:"flowName",width:150}];Ext.Ajax.request({url:b.baseUrl+"&task=getColumn",success:function(c,e){var k=Ext.decode(c.responseText),h,l,d={},g=k.data;var j=[{name:"cid"},{name:"flowName"}];for(var f=0;f<g.length;f++){h=g[f].header;l=g[f].dataIndex;j.push({name:l});d={header:h,dataIndex:l,sortable:false,width:150};a.push(new Ext.grid.Column(d))}var m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:j})});b.mainPanel.reconfigure(m,new Ext.grid.ColumnModel(a))}})},viewDetailTable:function(b,c,e){var d=this;var a=d.baseUrl+"&task=viewDetailTable&uFlowId="+b+"&flowId="+c+"&tableId="+e;window.open(a,"noticept","width=1000, height="+(screen.availHeight-500)+",left="+((screen.availWidth-1000)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")}};var CNOA_user_customers_info_myClass,CNOA_user_customers_info_my,CNOA_user_customers_customerLinkmanList,CNOA_user_customers_customerRecordList;CNOA_user_customers_info_myClass=CNOA.Class.create();CNOA_user_customers_info_myClass.prototype={init:function(c){this.baseUrl="index.php?app=user&func=customers&action=index";var a=this,b=[];CNOA_user_customers_customerView=new CNOA_user_customers_InfoClass(c,"index");CNOA_user_customers_customerLinkmanList=new CNOA_user_customers_linkmanListClass(c,false,"customer");CNOA_user_customers_customerPresalesList=new CNOA_user_customers_presalesListClass(c,"customer",false);CNOA_user_customers_customerPostsalesList=new CNOA_user_customers_postsalesListClass(c,"customer",false);CNOA_user_customers_customerRecordList=new CNOA_user_customers_recordListClass(c,"customer");CNOA_user_customers_shareList=new CNOA_user_customers_shareListClass(c);CNOA_user_customers_shareRecordList=new CNOA_user_customers_shareRecordListClass(c);CNOA_user_customers_mySendRecord=new CNOA_user_customers_mySendRecordClass(c);CNOA_user_customers_customerView.mainPanel.title=lang("clientXinxi");CNOA_user_customers_customerView.mainPanel.iconCls="icon-cnoa-communication";CNOA_user_customers_customerLinkmanList.mainPanel.title=lang("linkMan");CNOA_user_customers_customerPresalesList.mainPanel.title=lang("perSaleGZ");CNOA_user_customers_customerPostsalesList.mainPanel.title=lang("afterReview");CNOA_user_customers_customerRecordList.mainPanel.title=lang("salesRecord");CNOA_user_customers_shareList.mainPanel.title=lang("sharUserList");CNOA_user_customers_shareRecordList.mainPanel.title=lang("shareRecord");CNOA_user_customers_mySendRecord.mainPanel.title=lang("fahuoRecord");this.mainPanel=new Ext.TabPanel({activeTab:0,border:false,minTabWidth:120,tabWidth:120,enableTabScroll:true,listeners:{tabchange:function(h,g){var j=g.getId(),e=b.length,f;for(f=0;f<e;f++){if(b[f]==j){return false}}var d=g.get(0)||g;if(d.store){d.store.reload();b.push(g.getId())}},afterrender:function(d){if(location.host=="i.cnoa.cn"||location.host=="t1.cnoa.cn"){loadJs("app/user/scripts/customers_common_myDelayRecord.js",true,function(){CNOA_user_customers_myDelayRecord=new CNOA_user_customers_myDelayRecordClass(c);d.add(CNOA_user_customers_myDelayRecord.mainPanel)})}}},items:[CNOA_user_customers_customerView.mainPanel,CNOA_user_customers_customerLinkmanList.mainPanel,CNOA_user_customers_customerPresalesList.mainPanel,CNOA_user_customers_customerPostsalesList.mainPanel,CNOA_user_customers_customerRecordList.mainPanel,CNOA_user_customers_mySendRecord.mainPanel,CNOA_user_customers_shareList.mainPanel,CNOA_user_customers_shareRecordList.mainPanel]});if(CNOA.user.customers.info.my.readlyIsShow==1){CNOA_user_customers_binging_readly=new CNOA_user_customers_binding_readlyClass(c);CNOA_user_customers_binging_readly.mainPanel.title=CNOA.user.customers.info.my.readlyName;this.mainPanel.add(CNOA_user_customers_binging_readly.mainPanel)}if(CNOA.user.customers.info.my.submitIsShow==1){CNOA_user_customers_binging_submit=new CNOA_user_customers_binding_submitClass(c);CNOA_user_customers_binging_submit.mainPanel.title=CNOA.user.customers.info.my.submitName;this.mainPanel.add(CNOA_user_customers_binging_submit.mainPanel)}}};var CNOA_user_customers_info_zhuguanClass=CNOA.Class.create();CNOA_user_customers_info_zhuguanClass.prototype={init:function(h,g){var d=[];var c=new CNOA_user_customers_InfoClass(h,g),e=new CNOA_user_customers_linkmanListClass(h,false,g),f=new CNOA_user_customers_info_presalesClass(h,g),b=new CNOA_user_customers_info_postsalesClass(h,g),a=new CNOA_user_customers_info_recordClass(h,g);c.mainPanel.title=lang("clientXinxi");c.mainPanel.iconCls="icon-cnoa-communication";e.mainPanel.title=lang("linkMan");this.mainPanel=new Ext.TabPanel({activeTab:0,border:false,minTabWidth:120,tabWidth:120,enableTabScroll:true,listeners:{tabchange:function(n,m){var o=m.getId(),k=d.length,l;for(l=0;l<k;l++){if(d[l]==o){return false}}var j=m.get(0)||m;if(j.getXType()=="grid"){j.getStore().reload();d.push(m.getId())}}},items:[c.mainPanel,e.mainPanel,f.mainPanel,b.mainPanel,a.mainPanel]})}};var CNOA_user_customers_info_highSeasClass=CNOA.Class.create();CNOA_user_customers_info_highSeasClass.prototype={init:function(h,g){var d=[];var c=new CNOA_user_customers_InfoClass(h,g),e=new CNOA_user_customers_linkmanListClass(h,false,g),f=new CNOA_user_customers_info_presalesClass(h,g),b=new CNOA_user_customers_info_postsalesClass(h,g),a=new CNOA_user_customers_info_recordClass(h,g);c.mainPanel.title=lang("clientXinxi");c.mainPanel.iconCls="icon-cnoa-communication";e.mainPanel.title=lang("linkMan");this.mainPanel=new Ext.TabPanel({activeTab:0,border:false,minTabWidth:120,tabWidth:120,enableTabScroll:true,listeners:{tabchange:function(n,m){var o=m.getId(),k=d.length,l;for(l=0;l<k;l++){if(d[l]==o){return false}}var j=m.get(0)||m;if(j.getXType()=="grid"){j.getStore().reload();d.push(m.getId())}}},items:[c.mainPanel,e.mainPanel,f.mainPanel,b.mainPanel,a.mainPanel]})}};var CNOA_user_customers_list_my;var CNOA_user_customers_list_myClass=CNOA.Class.create();CNOA_user_customers_list_myClass.prototype={init:function(){var d=this;this.ACTION_DELETE=0;this.ACTION_CANCEL_SHARE=1;this.ACTION_RELEASE=2;this.ACTION_DEAL=3;this.ACTION_DELCOLOR=4;this.baseUrl="index.php?app=user&func=customers&action=index&module=info";this.searchParams={};this.showType="list";this.curConditionId=0;this.customerGridPanel=this.getCustomerGridPanel();this.searchPanel=this.getSearchPanel();var c=new Ext.Button({text:lang("addNewQuery"),iconCls:"icon-utils-s-add",cls:"btn-blue4",hidden:true,handler:function(){Ext.MessageBox.prompt("",lang("enterNewNameAdd"),function(f,g){if(f=="ok"){d.saveCondition("add",g)}})}}),b=new Ext.Button({text:lang("save"),iconCls:"icon-win-save",cls:"btn-blue4",hidden:true,handler:function(){if(!d.curConditionId){CNOA.msg.alert(lang("chooseEditTJ"));return}Ext.MessageBox.confirm("",lang("sureSaveQuery"),function(f){if(f=="yes"){d.saveCondition("update")}})}}),a=new Ext.Button({text:lang("del"),iconCls:"icon-utils-s-delete",hidden:true,handler:function(){if(!d.curConditionId){CNOA.msg.alert(lang("chooseDelQuery"));return}Ext.MessageBox.confirm("",lang("wantDelQuery"),function(f){if(f=="yes"){Ext.Ajax.request({url:d.baseUrl+"&task=delCondition",method:"POST",params:{id:d.curConditionId||0},success:function(j){var g=Ext.decode(j.responseText);if(g.success==true){var h=Ext.getCmp("condition_"+d.curConditionId);h&&h.destroy();d.curConditionId=0}}})}})}}),e=new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(g){if(d.searchPanel.isVisible()){g.setText(lang("expandSearch"));d.searchPanel.hide();c.hide();b.hide();a.hide()}else{g.setText(lang("foldSearch"));if(d.searchPanel.items.length<=0){var f=Ext.CustomSearchPanel.getCustomColumns(d.customerGridPanel.customColumns,d.baseUrl,d.searchPanel);d.searchPanel.add(f)}d.searchPanel.show();c.show();b.show();a.show()}d.mainPanel.doLayout()}},{text:lang("search"),handler:function(f){d.searchParams=d.searchPanel.getForm().getValues();d.searchParams.type=d.showType;d.customerGridPanel.store.reload({params:d.searchParams});d.customerGridPanel.searchStore=d.searchParams}},{text:lang("clear"),style:"margin-left:5px",handler:function(f){d.searchParams={};d.searchParams.type=d.showType;Ext.each(d.searchPanel.getForm().items.items,function(h,g){var j=h.getXType();if(j=="compositefield"||j=="checkboxgroup"){Ext.each(h.items.items,function(k){k.setValue("")})}else{h.setValue("")}});d.customerGridPanel.store.reload({params:d.searchParams});d.customerGridPanel.searchStore=d.searchParams}},c,b,a]});Ext.Ajax.request({url:this.baseUrl+"&task=getCondition",method:"POST",success:function(j){var m=Ext.decode(j.responseText),f=m.length,g=0,l,h,k;for(g=0;g<f;g++){h=m[g];k=Ext.decode(h.condition);l=d.getBtnCondition(h.name,k,h.id);e.add(l)}e.doLayout()}});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.searchPanel,this.customerGridPanel],tbar:e})},getCustomerGridPanel:function(){var l=this;this.ID_Moblie=Ext.id();this.ID_QQ=Ext.id();var j=new Ext.Button({text:lang("add"),iconCls:"icon-utils-s-add",handler:function(r,s){l.editCustomerInfo()}}),f=new Ext.Button({text:lang("share"),iconCls:"icon-user-share",cls:"btn-blue3",handler:function(r){var s=l.getSelections(r);if(s){Ext.Ajax.request({url:l.baseUrl+"&task=shareOwn",method:"POST",params:{cids:s},success:function(u){var t=Ext.decode(u.responseText);if(t.success===true){var v=t.msg;l.addShareWindow(s,v)}else{CNOA.msg.alert(t.msg)}}})}}}),a=new Ext.Button({text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(s,t){var u=grid2.getSelectionModel().getSelections(),r=u.length;if(r==0){CNOA.miniMsg.alertShowAt(s,lang("mustSelectOneRow"))}else{if(r!=1){CNOA.miniMsg.alertShowAt(s,lang("selectItemOnly"))}else{u[0].json.name=u[0].json.name.replace("<span style='color:red;'>[已成交]</span>","");u[0].json.name=u[0].json.name.replace("<span style='color:red;'>","");u[0].json.name=u[0].json.name.replace("</span>","");l.editCustomerInfo(u[0].json)}}}}),h=new Ext.Button({text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(r){var s=l.getSelections(r);if(s){CNOA.miniMsg.cfShowAt(r,lang("confirmToDelete"),function(){l.executeAction(l.ACTION_DELETE,{ids:s})})}}}),e=new Ext.importButton({tooltip:lang("importFromExcel"),browseTitle:lang("customerMgr"),cls:"btn-blue3",url:this.baseUrl+"&task=importCustomersInfo"}),b=new Ext.Button({text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){var r=l.searchPanel.getForm().getValues();Ext.Ajax.request({url:l.baseUrl+"&task=exportExcel&step=1&from=42",method:"POST",params:r,success:function(s,t){var u=Ext.decode(s.responseText);ajaxDownload(l.baseUrl+"&task=exportExcel&file="+u.msg+"&step=2")}})}}),d=new Ext.Button({hidden:true,cls:"btn-blue3",text:lang("unshared"),iconCls:"icon-utils-s-delete",handler:function(r){var s=l.getSelections(r);if(s){CNOA.miniMsg.cfShowAt(r,lang("wantToCancelShare"),function(){l.executeAction(l.ACTION_CANCEL_SHARE,{cids:s})})}}}),p=new Ext.Button({text:lang("transfer1"),cls:"btn-blue3",iconCls:"icon-customes-change",handler:function(r){var s=l.getSelections(r);if(s){l.moveCustomer(s)}}}),g=new Ext.Button({text:lang("release"),cls:"btn-blue3",iconCls:"icon-customes-release",handler:function(r){var s=l.getSelections(r);if(s){CNOA.miniMsg.cfShowAt(r,lang("wantToTurnCustomer"),function(){l.executeAction(l.ACTION_RELEASE,{cids:s})})}}}),c=new Ext.Button({text:lang("setDeal"),cls:"btn-blue3",handler:function(t){var v=grid2.getSelectionModel().getSelections(),r=0;if(v){for(var s=0;s<v.length;s++){if(v[s].json.deal==1){r=1;break}}}if(r){CNOA.miniMsg.alertShowAt(t,lang("customerHasDeal"));return}var u=l.getSelections(t);if(u){CNOA.miniMsg.cfShowAt(t,lang("setToDeal"),function(){l.executeAction(l.ACTION_DEAL,{ids:u})})}}}),k=new Ext.form.TextField({width:120,id:l.ID_Moblie}),o=new Ext.form.TextField({width:120,id:l.ID_QQ}),n=new Ext.Button({text:lang("clearCustomerColor"),handler:function(r){var s=l.getSelections(r);if(s){CNOA.miniMsg.cfShowAt(r,lang("areYouClearColor"),function(){l.executeAction(l.ACTION_DELCOLOR,{ids:s})})}}}),q=function(r){if(r=="list"){j.show();f.show();p.show();e.show();b.show();h.show();g.show();d.hide()}else{if(r=="share"){j.hide();Ext.Ajax.request({url:l.baseUrl+"&task=getShareAgain",method:"POST",success:function(t){var s=Ext.decode(t.responseText);if(s.success===true){f.show()}else{f.hide()}}});p.hide();e.hide();b.hide();h.hide();g.hide();d.hide()}else{if(r=="myshare"){j.hide();f.hide();p.hide();e.hide();b.hide();h.hide();g.hide();d.show()}else{return}}}l.showType=r;l.searchParams.type=r;l.searchParams.linkmanMobile=Ext.getCmp(l.ID_Moblie).setValue("");l.searchParams.linkmanQQ=Ext.getCmp(l.ID_QQ).setValue("");grid2.store.load({params:l.searchParams})},m=new Ext.Toolbar({defaults:{style:"margin-left:5px;"},items:[{text:lang("myClientList"),iconCls:"icon-cnoa-communication",enableToggle:true,toggleGroup:"user_customers_index_share",cls:"btn-blue4",pressed:true,allowDepress:false,handler:function(){q("list")}},{text:lang("shareClientList"),iconCls:"icon-cnoa-communication",cls:"btn-blue3",enableToggle:true,pressed:false,allowDepress:false,toggleGroup:"user_customers_index_share",handler:function(){q("share")}},{text:lang("sharedCustomer"),iconCls:"icon-communication-share",enableToggle:true,cls:"btn-blue3",pressed:false,allowDepress:false,toggleGroup:"user_customers_index_share",handler:function(){q("myshare")}},{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(r,s){l.searchParams.linkmanMobile=Ext.getCmp(l.ID_Moblie).setValue("");l.searchParams.linkmanQQ=Ext.getCmp(l.ID_QQ).setValue("");grid2.store.reload()}},j,a,f,p,g,e,b,h,d,c,"联系人手机号码:",k,"QQ:",o,{text:lang("search"),handler:function(r){l.searchParams.linkmanMobile=Ext.getCmp(l.ID_Moblie).getValue();l.searchParams.linkmanQQ=Ext.getCmp(l.ID_QQ).getValue();l.customerGridPanel.store.reload({params:l.searchParams});l.customerGridPanel.searchStore=l.searchParams}},{text:lang("clear"),style:"margin-left:5px",handler:function(r){l.searchParams.linkmanMobile=Ext.getCmp(l.ID_Moblie).setValue("");l.searchParams.linkmanQQ=Ext.getCmp(l.ID_QQ).setValue("");l.customerGridPanel.store.reload({params:l.searchParams.linkmanMobile});l.customerGridPanel.searchStore=l.searchParams}},n,("<span style='color:#999'>"+lang("clearColorDoesNotHaveImpact")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:50}]});Ext.Ajax.request({url:"index.php?app=user&func=customers&action=index&module=info&task=loadOperatePermit",method:"POST",success:function(t){var s=Ext.decode(t.responseText);if(s.del==false){h.hide()}if(s.daochu==false){b.hide()}}});makeOperate=function(z,s,v,y,B,A){var x=v.json.cid,u=A.reader.jsonData.bindResult,w=u[0],t=u[1];z="<a href='javascript:void(0);'  class='gridview' onclick='CNOA_user_customers_list_my.viewCustomer("+x+");'>"+lang("view")+"</a>";if(w.isShow=="1"){var r=w.name;z+="<a href='javascript:void(0);' class='jianju' onclick='CNOA_user_customers_list_my.userReadlySubmit("+x+");'>"+r+"</a>"}if(t.isShow=="1"){var r=t.name;z+="<a href='javascript:void(0);' class='jianju' onclick='CNOA_user_customers_list_my.userSubmit("+x+");'>"+r+"</a>"}return z},grid2=new Ext.grid.CustomGridPanel({searchStore:l.searchParams,region:"center",customFiledUrl:l.baseUrl+"&task=getCustomerCustomField",storeUrl:l.baseUrl+"&task=getCustomerList",otherField:[{header:lang("opt"),dataIndex:"",width:200,renderer:makeOperate}],columnConfig:{name:{width:150,renderer:function(s,t,r){if(r.json.gap){return s+' <span class="cnoa_color_red">['+r.json.gap+"]</span>"}else{return s}}},fcontent:{width:200,sortable:false,renderer:function(s,t,r){Ext.QuickTips.init();t.attr=' ext:qtip="'+s+'"';if(s.length>30){t.attr+=" ext:qwidth=300"}return s}}},tbar:m});return grid2},getSearchPanel:function(){return new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}})},editCustomerInfo:function(a){var b=this,f=lang("addKHXX"),e={};if(a){f=lang("modifyKeHuXinxi");e={cid:a.cid}}else{a={flowmanuid:CNOA_USER_UID,flowman:CNOA_USER_TRUENAME}}var c=function(g){if(g.getForm().isValid()){g.getForm().submit({url:b.baseUrl+"&task=editCustomerInfo",method:"POST",params:e,waitMsg:lang("notice"),success:function(h,j){CNOA.msg.notice2(j.result.msg);b.customerGridPanel.store.reload();d.close()},failure:function(h,j){CNOA.msg.alert(j.result.msg)}})}};var d=new Ext.CustomWindow({title:f,width:600,height:600,baseUrl:b.baseUrl,customColumns:b.customerGridPanel.customColumns,submit:c}).show();if(a){d.get(0).getForm().setValues(a)}},viewCustomer:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&cid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW",lang("viewCustomer"),"icon-page-view")},userReadlySubmit:function(a){getFlowId4Engine("userReadlySubmit",function(e,b,d,c){c(a,1)})},userSubmit:function(a){getFlowId4Engine("userSubmit",function(e,b,d,c){c(a,2)})},getSelections:function(c){var e=this.customerGridPanel.getSelectionModel().getSelections(),a=e.length;if(a==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{var d=[];for(var b=0;b<a;b++){d.push(e[b].json.cid)}d=d.join(",");return d}return false},executeAction:function(c,d){var b=this,a;switch(c){case this.ACTION_DELETE:a="deleteCustomer";break;case this.ACTION_CANCEL_SHARE:a="cancelShareCustomer";break;case this.ACTION_RELEASE:a="releaseCustomer";break;case this.ACTION_DEAL:a="setCustomersDeal";break;case this.ACTION_DELCOLOR:a="delCustomerColor";break;default:return}Ext.Ajax.request({url:b.baseUrl+"&task="+a,method:"POST",params:d,success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice(e.msg,lang("customerMgr"));b.customerGridPanel.store.reload()}else{CNOA.msg.alert(e.msg)}}})},addShareWindow:function(c,g){var d=this,b=Ext.id();var e=function(){var h=a.getForm();if(h.isValid()){h.submit({url:d.baseUrl+"&task=shareCustomer",waitMsg:lang("waiting"),method:"POST",params:{cids:c,tids:g},success:function(j,k){CNOA.msg.notice(k.result.msg,lang("customerMgr"));f.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px;",items:[{xtype:"textarea",height:50,width:400,readOnly:true,fieldLabel:lang("shareUser"),allowBlank:false,blankText:lang("selectShareUser"),name:"shareUnames",listeners:{render:function(h){h.to=b},focus:function(h){people_selector("user",h,true,false)}}},{xtype:"hidden",name:"cids",value:c},{xtype:"hidden",name:"shareUids",id:b}]});var f=new Ext.Window({title:lang("setShareUser"),width:560,height:180,modal:true,layout:"fit",resizable:false,border:false,items:a,buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){e()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]}).show();if(c&&c.split(",").length==1){a.getForm().load({url:d.baseUrl+"&task=loadCustomerShareInfo",params:{cid:c},method:"POST",waitMsg:lang("waiting"),failure:function(h,j){CNOA.msg.alert(j.result.msg)}})}},moveCustomer:function(b){var c=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:80,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:30px 10px 10px 10px;",items:[{xtype:"selectorform",fieldLabel:lang("transferTo"),width:223,hiddenName:"toUid",allowBlank:false,multiselect:false,selectorType:"user"},{xtype:"box",border:false,style:"margin-top:50px;color:#666",html:lang("noteZhuanYiKeHu")}]});var d=function(){if(a.getForm().isValid()){CNOA.msg.cf(lang("sureContinue"),function(f){if(f=="yes"){a.getForm().submit({url:c.baseUrl+"&task=moveCustomer",method:"POST",waitTitle:lang("waiting"),waitMsg:lang("loading"),params:{cids:b},success:function(g,h){CNOA.msg.notice(h.result.msg,lang("customerMgr"));e.close();c.customerGridPanel.store.reload()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}})}};var e=new Ext.Window({title:lang("transferCustomer"),layout:"fit",width:400,height:260,modal:true,maximizable:false,resizable:false,items:a,buttons:[{xtype:"cnoa_helpBtn",helpid:97},{text:lang("qDZY"),iconCls:"icon-order-s-accept",cls:"btn-blue4",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()},getBtnCondition:function(c,e,f){var b=["btn-blue2"];var a=b[this.btnConditionNum];if(this.btnConditionNum>=b.length){a=b[0]}this.btnConditionNum++;var d=this;f=f||0;return btnCondition={text:c,data:e,id:"condition_"+f,cls:a,style:"margin-left:0px;margin-right:1px;",enableToggle:true,allowDepress:false,toggleGroup:"btn_group_contidion",handler:function(g){var h=g.data;d.curConditionId=g.id.replace("condition_","");d.searchPanel.getForm().setValues(h);d.customerGridPanel.store.reload({params:h});d.customerGridPanel.searchStore=h}}},saveCondition:function(d,a){var b=this,c=b.searchPanel.getForm().getValues();params=d=="update"?({id:b.curConditionId||0}):{conditionName:a};b.searchPanel.getForm().submit({url:b.baseUrl+"&task=saveCondition",method:"POST",waitMsg:lang("waiting"),params:params,success:function(f,g){if(d=="add"){var h=b.getBtnCondition(a,c);b.mainPanel.getTopToolbar().addItem(h);b.mainPanel.getTopToolbar().doLayout()}else{var e=Ext.getCmp("condition_"+b.curConditionId);e&&(e.data=c)}CNOA.msg.notice2(g.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg)}})}};var CNOA_user_customers_list_zhuguan;var CNOA_user_customers_list_zhuguanClass=CNOA.Class.create();CNOA_user_customers_list_zhuguanClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=zhuguan&module=info";this.searchParams={};this.customerGridPanel=this.getCustomerGridPanel();this.searchPanel=this.getSearchPanel();this.loadMask=new Ext.LoadMask(Ext.getBody(),{msg:"导出中..."});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.searchPanel,this.customerGridPanel],tbar:new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(c){if(a.searchPanel.isVisible()){c.setText(lang("expandSearch"));a.searchPanel.hide()}else{c.setText(lang("foldSearch"));if(a.searchPanel.items.length<=0){var b=Ext.CustomSearchPanel.getCustomColumns(a.customerGridPanel.customColumns,a.baseUrl,a.searchPanel);a.searchPanel.add(b)}a.searchPanel.show()}a.mainPanel.doLayout()}},{text:lang("search"),handler:function(b){a.searchParams=a.searchPanel.getForm().getValues();a.searchParams.type=a.showType;a.customerGridPanel.store.reload({params:a.searchParams});a.customerGridPanel.searchStore=a.searchParams}},{text:lang("clear"),style:"margin-left:5px",handler:function(b){a.searchParams={};a.searchParams.type=a.showType;Ext.each(a.searchPanel.getForm().items.items,function(d,c){var e=d.getXType();if(e=="compositefield"){Ext.each(d.items.items,function(f){f.setValue("")})}else{d.setValue("")}});a.customerGridPanel.store.reload({params:a.searchParams});a.customerGridPanel.searchStore=a.searchParams}}]})})},getCustomerGridPanel:function(){var c=this;var b=new Ext.Button({text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){CNOA.msg.cf("导出选择跟踪内容,否则将导出全部内容",function(f){if(f=="yes"){var h=grid.getSelectionModel().getSelections(),d=h.length;if(d==0){CNOA.msg.alert(lang("mustSelectOneRow"))}else{var g=[];for(var e=0;e<d;e++){g.push(h[e].json.cid)}g=g.join(",");c.loadMask.show();Ext.Ajax.request({url:c.baseUrl+"&task=exportExcel&step=1&from=50",method:"POST",params:{ids:g},success:function(j,k){c.loadMask.hide();var l=Ext.decode(j.responseText);ajaxDownload(c.baseUrl+"&task=exportExcel&file="+l.msg+"&step=2")}})}}else{c.loadMask.show();Ext.Ajax.request({url:c.baseUrl+"&task=exportExcel&step=1&from=50",method:"POST",success:function(j,k){c.loadMask.hide();var l=Ext.decode(j.responseText);ajaxDownload(c.baseUrl+"&task=exportExcel&file="+l.msg+"&step=2")}})}})}});var a=new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(d,e){grid.store.reload()}},{text:lang("transfer1"),cls:"btn-yellow1",iconCls:"icon-customes-change",handler:function(f){var h=grid.getSelectionModel().getSelections(),d=h.length;if(d==0){CNOA.miniMsg.alertShowAt(f,lang("mustSelectOneRow"))}else{var g=[];for(var e=0;e<d;e++){g.push(h[e].json.cid)}g=g.join(",");c.moveCustomer(g)}}}]});Ext.Ajax.request({url:"index.php?app=user&func=customers&action=zhuguan&task=loadOperatePermit",method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.daochu){a.add(b)}}});makeOperate=function(j,g,d){var f=d.json;var e="<a href='javascript:void(0);'  class='gridview'  onclick='CNOA_user_customers_list_zhuguan.viewCustomer("+f.cid+");'>"+lang("view")+"</a>";if(f.lock=="1"){e+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_user_customers_list_zhuguan.lockCustomer("+f.cid+", false);'>"+lang("unlock")+"</a>"}else{e+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_user_customers_list_zhuguan.lockCustomer("+f.cid+", true);'>"+lang("lock")+"</a>"}return e},makeName=function(g,f,d){var e=d.json;return e.lock=="1"?g+'&nbsp;<span class="cnoa_color_red">['+lang("isLock")+"]</span>":g},grid=new Ext.grid.CustomGridPanel({searchStore:c.searchParams,region:"center",customFiledUrl:c.baseUrl+"&task=getCustomerCustomField",storeUrl:c.baseUrl+"&task=getCustomerList",otherField:[{header:lang("opt"),dataIndex:"",width:130,renderer:makeOperate}],columnConfig:{name:{renderer:makeName,width:150}},tbar:a});return grid},getSearchPanel:function(){return new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}})},lockCustomer:function(e,a){var b=this;var c=function(){Ext.Ajax.request({url:b.baseUrl+"&task=lockCustomer",method:"POST",params:{cid:e,lock:a?1:0},success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){CNOA.msg.notice(f.msg,lang("customerMgr"));b.customerGridPanel.store.reload()}else{CNOA.msg.alert(f.msg)}}})};var d=a?lang("lock"):lang("lock");CNOA.msg.cf(lang("sureWantTo")+d+lang("thisClientLock"),function(f){if(f=="yes"){c()}})},viewCustomer:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_ZG_VIEW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&cid="+a,"CNOA_MENU_USER_CUSTOMERS_ZG_VIEW",lang("viewCustomer"),"icon-page-view")},moveCustomer:function(b){var c=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:80,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:30px 10px 10px 10px;",items:[{xtype:"selectorform",fieldLabel:lang("transferTo"),width:223,hiddenName:"toUid",allowBlank:false,multiselect:false,selectorType:"user"},{xtype:"box",border:false,style:"margin-top:50px;color:#666",html:lang("noteZhuanYiKeHu")}]});var d=function(){if(a.getForm().isValid()){CNOA.msg.cf(lang("sureContinue"),function(f){if(f=="yes"){a.getForm().submit({url:c.baseUrl+"&task=moveCustomer",method:"POST",waitTitle:lang("waiting"),waitMsg:lang("loading"),params:{cids:b},success:function(g,h){CNOA.msg.notice(h.result.msg,lang("customerMgr"));e.close();c.customerGridPanel.store.reload()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}})}};var e=new Ext.Window({title:lang("transferCustomer"),layout:"fit",width:400,height:260,modal:true,maximizable:false,resizable:false,items:a,buttons:[{xtype:"cnoa_helpBtn",helpid:97},{text:lang("qDZY"),iconCls:"icon-order-s-accept",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()}};var CNOA_user_customers_list_highSeas;var CNOA_user_customers_list_highSeasClass=CNOA.Class.create();CNOA_user_customers_list_highSeasClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=highSeas&module=info";this.searchParams={};this.customerGridPanel=this.getCustomerGridPanel();this.searchPanel=this.getSearchPanel();var b=new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(d){if(a.searchPanel.isVisible()){d.setText(lang("expandSearch"));a.searchPanel.hide()}else{d.setText(lang("foldSearch"));if(a.searchPanel.items.length<=0){var c=Ext.CustomSearchPanel.getCustomColumns(a.customerGridPanel.customColumns,a.baseUrl,a.searchPanel);a.searchPanel.add(c)}a.searchPanel.show()}a.mainPanel.doLayout()}},{text:lang("search"),handler:function(c){a.searchParams=a.searchPanel.getForm().getValues();a.customerGridPanel.store.reload({params:a.searchParams});a.customerGridPanel.searchStore=a.searchParams}},{text:lang("clear"),style:"margin-left:5px",handler:function(c){a.searchParams={};Ext.each(a.searchPanel.getForm().items.items,function(e,d){var f=e.getXType();if(f=="compositefield"||f=="checkboxgroup"){Ext.each(e.items.items,function(g){g.setValue("")})}else{e.setValue("")}});a.customerGridPanel.store.reload({params:a.searchParams});a.customerGridPanel.searchStore=a.searchParams}},"　　进入公海时间：",{xtype:"radio",name:"dateRadio",id:"dateRadio1",inputValue:"today",boxLabel:"今天",checked:true},{xtype:"radio",name:"dateRadio",id:"dateRadio2",inputValue:"thisWeek",boxLabel:"本周"},{xtype:"radio",name:"dateRadio",id:"dateRadio3",inputValue:"thisMonth",boxLabel:"本月"},{xtype:"radio",name:"dateRadio",id:"dateRadio4",inputValue:"thisYear",boxLabel:"今年"},{text:lang("quickSearch"),style:"margin-left:5px",handler:function(c){a.searchParams=a.searchPanel.getForm().getValues();for(i=1;i<5;i++){if(Ext.getCmp("dateRadio"+i).checked){a.searchParams.dateRadio=Ext.getCmp("dateRadio"+i).inputValue}}a.customerGridPanel.store.reload({params:a.searchParams});a.customerGridPanel.searchStore=a.searchParams}}]});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.searchPanel,this.customerGridPanel],tbar:b})},getCustomerGridPanel:function(){var g=this,e=new Ext.Button({text:lang("add"),iconCls:"icon-utils-s-add",handler:function(l,m){g.editCustomerInfo()}}),b=new Ext.Button({text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(m,n){var o=a.getSelectionModel().getSelections(),l=o.length;if(l==0){CNOA.miniMsg.alertShowAt(m,lang("mustSelectOneRow"))}else{if(l!=1){CNOA.miniMsg.alertShowAt(m,lang("selectItemOnly"))}else{o[0].json.name=o[0].json.name.replace("<span style='color:red;'>[已成交]</span>","");o[0].json.name=o[0].json.name.replace("<span style='color:red;'>","");o[0].json.name=o[0].json.name.replace("</span>","");g.editCustomerInfo(o[0].json)}}}}),d=new Ext.Button({text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(m){var n=a.getSelectionModel().getSelections(),l=n.length;if(l==0){CNOA.miniMsg.alertShowAt(m,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(m,lang("confirmToDelete"),function(){var p=[];for(var o=0;o<l;o++){p.push(n[o].json.cid)}p=p.join(",");g.deleteCustomer(p)})}}}),c=new Ext.importButton({tooltip:lang("importFromExcel"),cls:"btn-blue3",browseTitle:lang("customerMgr"),url:this.baseUrl+"&task=importCustomersInfo"}),k=new Ext.Button({text:lang("transferTo"),iconCls:"icon-customes-change",cls:"btn-yellow1",handler:function(n){var p=a.getSelectionModel().getSelections(),l=p.length;if(l==0){CNOA.miniMsg.alertShowAt(n,lang("mustSelectOneRow"))}else{var o=[];for(var m=0;m<l;m++){o.push(p[m].json.cid)}o=o.join(",");g.moveCustomer(o)}}}),j=new Ext.Button({text:lang("ledAway"),iconCls:"icon-customes-task",cls:"btn-blue2",handler:function(n){var p=a.getSelectionModel().getSelections(),l=p.length;if(l==0){CNOA.miniMsg.alertShowAt(n,lang("mustSelectOneRow"))}else{var o=[];for(var m=0;m<l;m++){o.push(p[m].json.cid)}o=o.join(",");g.takeCustomer(o)}}});var h=new Ext.Toolbar({defaults:{style:"margin-left:5px;"},items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(l,m){a.store.reload()}},j]});Ext.Ajax.request({url:"index.php?app=user&func=customers&action=highSeas&task=loadOperatePermit",method:"POST",success:function(m){var l=Ext.decode(m.responseText);if(l.add){h.add(e)}if(l.update){h.add(b)}if(l.move){h.add(k)}if(l.imports){h.add(c)}if(l.del){h.add(d)}h.doLayout()}});var f=function(n,m,l){var o=l.json.cid;return"<a href='javascript:void(0);'  class='gridview'  onclick='CNOA_user_customers_list_highSeas.viewCustomer("+o+");'>"+lang("view")+"</a>"},a=new Ext.grid.CustomGridPanel({searchStore:g.searchParams,region:"center",customFiledUrl:g.baseUrl+"&task=getCustomerCustomField",storeUrl:g.baseUrl+"&task=getCustomerList",otherField:[{header:lang("opt"),dataIndex:"",width:80,renderer:f}],tbar:h,columnConfig:{fcontent:{width:200,renderer:function(m,n,l){Ext.QuickTips.init();n.attr=' ext:qtip="'+m+'"';if(m.length>30){n.attr+=" ext:qwidth=300"}return m}}}});return a},getSearchPanel:function(){return new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}})},editCustomerInfo:function(b){var c=this,g=lang("addKHXX"),f={};if(b){g=lang("modifyKeHuXinxi");f={cid:b.cid}}else{b={flowmanuid:CNOA_USER_UID,flowman:CNOA_USER_TRUENAME}}var d=function(h){if(h.getForm().isValid()){h.getForm().submit({url:c.baseUrl+"&task=editCustomerInfo",method:"POST",params:f,waitMsg:lang("notice"),success:function(j,k){CNOA.msg.notice2(k.result.msg);c.customerGridPanel.store.reload();e.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var a=[];Ext.each(c.customerGridPanel.customColumns,function(j,h){if(j.field!="flowman"){j.must=0;a.push(j)}});var e=new Ext.CustomWindow({title:g,width:600,height:600,baseUrl:c.baseUrl,customColumns:a,submit:d}).show();if(b){e.get(0).getForm().setValues(b)}},deleteCustomer:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteCustomer",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.customerGridPanel.store.reload()}else{CNOA.msg.alert(c.msg)}}})},viewCustomer:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&cid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW",lang("viewCustomer"),"icon-page-view")},moveCustomer:function(b){var c=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:80,labelAlign:"right",autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:30px 10px 10px 10px;",items:[{xtype:"selectorform",fieldLabel:lang("viewCustomer"),width:223,hiddenName:"toUid",allowBlank:false,multiselect:false,selectorType:"user"},{xtype:"box",border:false,style:"margin-top:50px;color:#666",html:lang("noteZhuanYiKeHu")}]});var d=function(){if(a.getForm().isValid()){CNOA.msg.cf(lang("sureContinue"),function(f){if(f=="yes"){a.getForm().submit({url:c.baseUrl+"&task=moveCustomer",method:"POST",waitTitle:lang("waiting"),waitMsg:lang("loading"),params:{cids:b},success:function(g,h){CNOA.msg.notice(h.result.msg,lang("customerMgr"));e.close();c.customerGridPanel.store.reload()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}})}};var e=new Ext.Window({title:lang("transferCustomer"),layout:"fit",width:400,height:260,modal:true,maximizable:false,resizable:false,items:a,buttons:[{xtype:"cnoa_helpBtn",helpid:97},{text:lang("qDZY"),iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()},takeCustomer:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=taskCustomer",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.customerGridPanel.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_user_customers_collectClass,CNOA_user_customers_collect;CNOA_user_customers_collectClass=CNOA.Class.create();CNOA_user_customers_collectClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=index&module=collect";this.mainPanel=this.getCollectPanel()},getCollectPanel:function(){var e=this,j={};var d=[{name:"name"},{name:"flowmanname"}],g=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getCustomerCollect",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})}),f=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:lang("clientName"),dataIndex:"name",width:220},{header:lang("followUpPeople"),dataIndex:"flowmanname"}]}),a=new Ext.form.TextField(),b=new Ext.form.TextField(),c=new Ext.form.TextField(),h=new Ext.form.TextField();return new Ext.grid.GridPanel({store:g,cm:f,searchStore:j,border:false,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",style:{marginRight:"5px"},handler:function(){g.reload({params:j})}},lang("clientName")+":",a,lang("mobile")+":",c,"QQ:",b,"Email:",h,{text:lang("search"),style:"margin-left:5px;",handler:function(){j={name:a.getValue(),mobile:c.getValue(),qq:b.getValue(),email:h.getValue()};g.reload({params:j})}},{text:lang("clear"),style:"margin-left:5px;",handler:function(){j={};a.setValue("");c.setValue("");b.setValue("");h.setValue("");g.removeAll()}}]})})}};var CNOA_user_customers_linkmanClass,CNOA_user_customers_linkman,CNOA_user_customers_collectLinkmanList;CNOA_user_customers_linkmanClass=CNOA.Class.create();CNOA_user_customers_linkmanClass.prototype={init:function(){var a=this;CNOA_user_customers_collectLinkmanList=new CNOA_user_customers_linkmanListClass(0,true,"collect");this.baseUrl="index.php?app=user&func=customers&action=index&module=linkman";this.linkmanPanel=CNOA_user_customers_collectLinkmanList.mainPanel;this.linkmanPanel.region="center";this.searchPanel=this.getSearchPanel();this.searchParams={};var b=new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(d){if(a.searchPanel.isVisible()){d.setText(lang("expandSearch"));a.searchPanel.hide()}else{d.setText(lang("foldSearch"));if(a.searchPanel.items.length<=0){var c=Ext.CustomSearchPanel.getCustomColumns(a.linkmanPanel.customColumns,a.baseUrl,a.searchPanel);a.searchPanel.add(c)}a.searchPanel.show()}a.mainPanel.doLayout()}},{text:lang("search"),handler:function(c){a.searchParams=a.searchPanel.getForm().getValues();a.linkmanPanel.store.reload({params:a.searchParams});a.linkmanPanel.searchStore=a.searchParams}},{text:lang("clear"),style:"margin-left:5px",handler:function(c){a.searchParams={};a.searchParams.type=a.showType;Ext.each(a.searchPanel.getForm().items.items,function(e,d){var f=e.getXType();if(f=="compositefield"||f=="checkboxgroup"){Ext.each(e.items.items,function(g){g.setValue("")})}else{e.setValue("")}});a.linkmanPanel.store.reload({params:a.searchParams});a.linkmanPanel.searchStore=a.searchParams}}]});this.mainPanel=new Ext.Panel({plain:false,hideBorders:true,layout:"border",border:false,items:[this.searchPanel,this.linkmanPanel],tbar:b})},getSearchPanel:function(){return new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}})}};var CNOA_user_customers_recordCheckClass,CNOA_user_customers_recordCheck;CNOA_user_customers_recordCheckClass=CNOA.Class.create();CNOA_user_customers_recordCheckClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=user&func=customers&action=recordCheck";var a=[{name:"rid"},{name:"gname"},{name:"gdname"},{name:"price"},{name:"dealprice"},{name:"num"},{name:"amount"},{name:"date"},{name:"status"},{name:"checkdate"}],b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),c=new Ext.grid.ColumnModel({defaults:{width:90,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"rid",dataIndex:"rid",hidden:true},{header:lang("productName1"),dataIndex:"gdname"},{header:lang("productType"),dataIndex:"gname"},{header:lang("unitPrice"),dataIndex:"price"},{header:lang("cJPrice"),dataIndex:"dealprice"},{header:lang("quantity"),dataIndex:"num"},{header:lang("totalSales"),dataIndex:"amount"},{header:lang("saleDate"),dataIndex:"date"},{header:lang("auditStatus"),dataIndex:"status"},{header:lang("appDate1"),dataIndex:"checkdate"}]});this.mainPanel=new Ext.grid.PageGridPanel({store:b,cm:c,viewConfig:{forceFit:true},listeners:{cellclick:function(g,k,h,j){if(h!=9){var f=g.getStore().getAt(k);d.view(f.data.rid)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){b.reload()}},"<span style='color:#999'>"+lang("clickToView")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:51}]})})},view:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=recordView&rid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD",lang("viewSalesRecord"),"icon-page-view")}};var CNOA_user_customers_recordSendClass,CNOA_user_customers_recordSend;CNOA_user_customers_recordSendClass=CNOA.Class.create();CNOA_user_customers_recordSendClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=user&func=customers&action=recordSend";var a=[{name:"rid"},{name:"gname"},{name:"gdname"},{name:"price"},{name:"dealprice"},{name:"num"},{name:"amount"},{name:"date"},{name:"fahuostatusname"},{name:"fahuocheckdate"}],b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),c=new Ext.grid.ColumnModel({defaults:{width:90,sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"rid",dataIndex:"rid",hidden:true},{header:lang("productName1"),dataIndex:"gdname"},{header:lang("productType"),dataIndex:"gname"},{header:lang("unitPrice"),dataIndex:"price"},{header:lang("cJPrice"),dataIndex:"dealprice"},{header:lang("quantity"),dataIndex:"num"},{header:lang("totalSales"),dataIndex:"amount"},{header:lang("saleDate"),dataIndex:"date"},{header:lang("auditStatus"),dataIndex:"fahuostatusname"},{header:lang("appDate1"),dataIndex:"fahuocheckdate"}]});this.mainPanel=new Ext.grid.PageGridPanel({store:b,cm:c,viewConfig:{forceFit:true},listeners:{cellclick:function(g,k,h,j){if(h!=9){var f=g.getStore().getAt(k);d.view(f.data.rid)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){b.reload()}},"<span style='color:#999'>"+lang("clickToView")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:5001}]})})},view:function(a){mainPanel.closeTab("CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD_SEND");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=recordView&rid="+a,"CNOA_MENU_USER_CUSTOMERS_VIEW_RECORD_SEND",lang("viewFaHuoRecord"),"icon-page-view")}};var CNOA_user_customers_viewClass,CNOA_user_customers_view;CNOA_user_customers_viewClass=CNOA.Class.create();CNOA_user_customers_viewClass.prototype={init:function(){var a=this;this.rid=CNOA.user.customers.view.rid;this.status=null;this.baseUrl="index.php?app=user&func=customers&action="+CNOA.user.customers.view.from+"&rid="+this.rid;this.ID_formPanel_goods=Ext.id();this.ID_formPanel_service=Ext.id();this.ID_formPanel_goodInfo=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("clientXinxi"),width:528,items:[{xtype:"displayfield",width:280,name:"cname",fieldLabel:lang("clientName")},{xtype:"displayfield",fieldLabel:lang("clientName"),name:"lname"}]},{xtype:"fieldset",title:lang("goodsXinxi"),width:528,items:[{xtype:"displayfield",fieldLabel:lang("goodsType"),name:"gnameName",width:170},{xtype:"panel",border:false,layout:"form",items:[{xtype:"displayfield",width:280,name:"gdname",fieldLabel:lang("productName1")},{xtype:"panel",border:false,id:this.ID_formPanel_goods,layout:"form",items:[{xtype:"displayfield",width:143,name:"num",fieldLabel:lang("quantity")},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"price",fieldLabel:lang("unitPrice")}]},{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"dealprice",fieldLabel:lang("cJPrice")}]}]}]},{xtype:"panel",border:false,id:this.ID_formPanel_service,layout:"form",items:[{xtype:"displayfield",name:"about",fieldLabel:lang("serviceItem"),grow:true,growMin:100}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"date",format:"Y-m-d",fieldLabel:lang("saleDate")}]},{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"amount",fieldLabel:lang("totalTurnover")}]}]}]}]},{xtype:"fieldset",title:lang("auditXinxi"),width:528,items:[{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"checkname",fieldLabel:lang("auditor")}]}]}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoWidth:true,waitMsgTarget:true,autoScroll:true,bodyStyle:"padding:5px;",items:this.baseField,listeners:{afterrender:function(){a.loadFormData()}}});this.centerPanel=new Ext.Panel({plain:false,region:"center",hideBorders:true,layout:"fit",border:false,items:[this.formPanel],tbar:new Ext.Toolbar({hidden:CNOA.user.customers.view.from=="recordCheck"?false:true,items:[a.statusCmp=new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-right:10px;font-weight:bold;",html:""}}),a.statusBtn=new Ext.Button({handler:function(b,c){a.setStatus()}.createDelegate(this),autoWidth:true,cls:"btn-yellow1",iconCls:"icon-customes-change",text:lang("setToConfirmed")})]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=loadFormDataRecord",params:{rid:a.rid},method:"POST",waitMsg:lang("waiting"),success:function(b,c){a.status=c.result.data.status;a.change(c.result.data.gname);a.setStatusBtn()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.close()})}.createDelegate(this)})},change:function(b){var c=Ext.getCmp(this.ID_formPanel_goods);var a=Ext.getCmp(this.ID_formPanel_service);if(b=="gd"){c.show();a.hide()}else{a.show();c.hide()}},setStatusBtn:function(){var e=this.statusCmp;var a=this.statusBtn;var d=this.status;if(d=="yes"){e.getEl().update(lang("nowStatus")+": "+lang("setToConfirmed"));a.setText(lang("setAsWQR"))}else{e.getEl().update(lang("nowStatus")+": "+lang("WQR"));a.setText(lang("setToConfirmed"))}},setStatus:function(){var b=this;this.mainPanel.getEl().mask(lang("waiting"));var a=this.status=="yes"?"no":"yes";Ext.Ajax.request({url:this.baseUrl+"&task=setStatus",method:"POST",params:{status:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){b.status=a;b.setStatusBtn();try{CNOA_user_customers_record.store.reload()}catch(f){}}else{CNOA.msg.alert(c.msg)}b.mainPanel.getEl().unmask()}})}};var CNOA_user_customers_checkRecordViewClass,CNOA_user_customers_checkRecordView;CNOA_user_customers_checkRecordViewClass=CNOA.Class.create();CNOA_user_customers_checkRecordViewClass.prototype={init:function(){var a=this;this.rid=CNOA.user.customers.checkRecordView.rid;this.status=null;this.baseUrl="index.php?app=user&func=customers&action=recordCheck&rid="+this.rid;this.ID_formPanel_goods=Ext.id();this.ID_formPanel_service=Ext.id();this.ID_formPanel_attach=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("clientXinxi"),width:528,items:[{xtype:"displayfield",width:280,name:"name",fieldLabel:lang("clientName")},{xtype:"displayfield",fieldLabel:lang("linkMan"),name:"lname"}]},{xtype:"fieldset",title:lang("auditXinxi"),width:528,items:[{xtype:"selectorform",fieldLabel:lang("fahuoReviewer"),name:"fahuocheckman",hiddenName:"fahuocheckuid",selectorType:"user",multiselect:false}]},{xtype:"fieldset",title:lang("goodsXinxi"),width:528,items:[{xtype:"displayfield",fieldLabel:lang("goodsType"),name:"gnameName",width:170},{xtype:"panel",border:false,layout:"form",items:[{xtype:"displayfield",width:280,name:"gdname",fieldLabel:lang("productName1")},{xtype:"panel",border:false,id:this.ID_formPanel_goods,layout:"form",items:[{xtype:"displayfield",width:143,name:"num",fieldLabel:lang("quantity")},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"price",fieldLabel:lang("unitPrice")}]},{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"dealprice",readOnly:true,fieldLabel:lang("cJdiscount")}]}]}]},{xtype:"panel",border:false,id:this.ID_formPanel_service,layout:"form",items:[{xtype:"displayfield",name:"about",fieldLabel:lang("serviceItem"),grow:true,growMin:100}]},{xtype:"panel",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"date",format:"Y-m-d",fieldLabel:lang("saleDate")}]},{xtype:"panel",width:255,layout:"form",items:[{xtype:"displayfield",width:143,name:"amount",fieldLabel:lang("totalTurnover")}]}]}]}]},{xtype:"fieldset",title:lang("attach"),width:528,html:'<div id="'+this.ID_formPanel_attach+'"></div>'}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoWidth:true,waitMsgTarget:true,autoScroll:true,bodyStyle:"padding:5px;",items:this.baseField,tbar:new Ext.Toolbar({items:[a.statusCmp=new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-right:10px;font-weight:bold;",html:""}}),a.statusBtn=new Ext.Button({handler:function(b,c){a.setStatus()}.createDelegate(this),autoWidth:true,cls:"btn-yellow1",iconCls:"icon-customes-change",text:lang("setToConfirmed")})]}),listeners:{afterrender:function(){a.loadFormData()}}});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,autoScroll:false,items:[this.formPanel]})},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=loadFormDataRecord",params:{rid:a.rid},method:"POST",waitMsg:lang("waiting"),success:function(b,c){a.status=c.result.data.status;if(c.result.data.attach){$("#"+a.ID_formPanel_attach)[0].innerHTML=c.result.data.attach}a.change(c.result.data.gname);a.setStatusBtn()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.close()})}.createDelegate(this)})},change:function(b){var c=Ext.getCmp(this.ID_formPanel_goods);var a=Ext.getCmp(this.ID_formPanel_service);if(b=="gd"){c.show();a.hide()}else{a.show();c.hide()}},setStatusBtn:function(){var e=this.statusCmp;var a=this.statusBtn;var d=this.status;if(d=="yes"){e.getEl().update(lang("nowStatus")+": "+lang("confirmed"));a.setText(lang("setAsWQR"))}else{e.getEl().update(lang("nowStatus")+": "+lang("WQR"));a.setText(lang("setToConfirmed"))}},setStatus:function(){var b=this;var a=this.status=="yes"?"no":"yes";CNOA.msg.cf(lang("editMarketStatus")+"[ "+(this.status=="yes"?lang("WQR"):lang("confirmed"))+" ]？",function(c){if(c!="yes"){b.mainPanel.getEl().unmask();return}else{var d=b.formPanel.getForm().findField("fahuocheckuid").getValue();if(a=="yes"){if(d==""){CNOA.msg.alert(lang("notFillInFHSHR"))}else{b.setStatusAjax(a,d)}}else{b.setStatusAjax(a,d)}}})},setStatusAjax:function(a,b){var c=this;this.mainPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:this.baseUrl+"&task=setStatus",method:"POST",params:{status:a,fahuocheckuid:b},success:function(f){var d=Ext.decode(f.responseText);if(d.success===true){c.status=a;c.setStatusBtn();try{CNOA_user_customers_recordCheck.store.reload()}catch(g){}CNOA.msg.notice(d.msg,lang("salesChecking"))}else{CNOA.msg.alert(d.msg)}c.mainPanel.getEl().unmask()}})}};var CNOA_user_customers_sendRecordViewClass,CNOA_user_customers_sendRecordView;CNOA_user_customers_sendRecordViewClass=CNOA.Class.create();CNOA_user_customers_sendRecordViewClass.prototype={init:function(){var b=this;this.rid=CNOA.user.customers.sendRecordView.rid;this.status=null;this.baseUrl="index.php?app=user&func=customers&action=recordSend&rid="+this.rid;this.ID_formPanel_goods=Ext.id();this.ID_formPanel_service=Ext.id();this.ID_FAHUOCONTENT_VALUE=Ext.id();this.ID_formPanel_attach=Ext.id();var a=[{xtype:"fieldset",title:lang("customerMgr"),width:528,items:[{xtype:"displayfield",width:280,name:"cname",fieldLabel:lang("clientName")},{xtype:"displayfield",fieldLabel:lang("linkMan"),name:"lname"}]},{xtype:"fieldset",title:lang("goodsXinxi"),width:528,items:[{xtype:"displayfield",fieldLabel:lang("goodsType"),name:"gnameName",width:170},{xtype:"container",border:false,layout:"form",items:[{xtype:"displayfield",width:280,name:"gdname",fieldLabel:lang("productName1")},{xtype:"container",border:false,id:this.ID_formPanel_goods,layout:"form",items:[{xtype:"displayfield",width:143,name:"num",fieldLabel:lang("quantity")},{xtype:"container",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false,xtype:"container",width:255,layout:"form"},items:[{items:[{xtype:"displayfield",width:143,name:"price",fieldLabel:lang("unitPrice")}]},{items:[{xtype:"displayfield",width:143,name:"dealprice",fieldLabel:lang("cJdiscount")}]}]}]},{xtype:"container",border:false,id:this.ID_formPanel_service,layout:"form",items:[{xtype:"displayfield",name:"about",fieldLabel:lang("serviceItem"),grow:true,growMin:100}]}]},{xtype:"container",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false,xtype:"container",width:255,layout:"form"},items:[{items:[{xtype:"displayfield",width:143,name:"date",format:"Y-m-d",fieldLabel:lang("saleDate")}]},{items:[{xtype:"displayfield",width:143,name:"amount",fieldLabel:lang("totalTurnover")}]}]}]},{xtype:"fieldset",title:lang("fahuoXX"),width:528,defaults:{xtype:"displayfield",width:400},items:[{name:"fahuotype",fieldLabel:lang("pickupType")},{name:"transport",fieldLabel:lang("tuoYunDept")},{name:"maillinkman",fieldLabel:lang("receiver")},{name:"mailmobile",fieldLabel:lang("sJPhone")},{name:"fahuonotes",fieldLabel:lang("fahuoNote")}]},{xtype:"fieldset",title:lang("qHXX"),width:528,layout:"table",layoutConfig:{columns:3},items:[{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:lang("import2")+"Excel",handler:function(){b.showImportWindow()}},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:lang("view"),handler:function(){b.showImportToDbWindow(b.formatHtml,"add")}},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:lang("submit"),handler:function(){if(b.formatHtml!=""){Ext.Ajax.request({url:b.baseUrl+"&task=setFahuocontent",method:"POST",params:{rid:b.rid,fahuocontent:b.formatHtml},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"))}else{CNOA.msg.alert(c.msg)}}})}else{CNOA.msg.alert(lang("notSubmitExcel"))}}},{xtype:"hidden",name:"fahuocontent",id:b.ID_FAHUOCONTENT_VALUE}]},{xtype:"fieldset",title:lang("auditXinxi"),width:528,items:[{xtype:"displayfield",width:143,name:"checkname",fieldLabel:lang("auditor")}]},{xtype:"fieldset",title:lang("attach"),width:528,html:'<div id="'+this.ID_formPanel_attach+'"></div>'}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",autoWidth:true,waitMsgTarget:true,autoScroll:true,bodyStyle:"padding:5px;",items:a,tbar:new Ext.Toolbar({items:[b.statusCmp=new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-right:10px;font-weight:bold;",html:""}}),b.statusBtn=new Ext.Button({handler:function(c,d){b.setStatus()}.createDelegate(this),autoWidth:true,iconCls:"icon-system-refresh",text:lang("setToConfirmed")})]}),listeners:{afterrender:function(){b.loadFormData()}}});this.mainPanel=this.formPanel},showImportWindow:function(){var a=this;this.UPLOAD_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"face",allowBlank:false,buttonCfg:{text:lang("browseQHXX")+"(Excel)"},hideLabel:true,width:370,listeners:{fileselected:function(c,b){}}},{xtype:"displayfield",hideLabel:true,value:lang("must0307Excel")+"[<a href='resources/customers_import_demo.jpg' target='_blank'>"+lang("model")+"</a>]"},{xtype:"displayfield",hideLabel:true,value:lang("attention")+"<span class='cnoa_color_red'>"+lang("recommendedUse")+"<a href='http://cnoa.cn/download/s/messager' target='_blank' ext:qtip='"+lang("clickToDownload")+"' style='font-weight:bold;'>["+lang("oaClient")+"]</a>"+lang("enterTheOA")+"</span>"}],buttons:[{text:lang("import2"),iconCls:"document-excel-import",handler:function(){if(this.UPLOAD_WINDOW_FORMPANEL.getForm().isValid()){this.UPLOAD_WINDOW_FORMPANEL.getForm().submit({url:a.baseUrl+"&task=getStockoutExcel",waitMsg:lang("waiting"),params:{},success:function(b,c){a.formatHtml=c.result.msg;a.showImportToDbWindow(a.formatHtml,"add");Ext.getCmp(a.ID_FAHUOCONTENT_VALUE).setValue(a.formatHtml);a.UPLOAD_WINDOW.close()},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}})}}.createDelegate(this)},{text:lang("close"),handler:function(){a.UPLOAD_WINDOW.close()}}]});this.UPLOAD_WINDOW=new Ext.Window({width:398,height:163,autoScroll:false,modal:true,resizable:false,title:lang("importQHXX"),items:[this.UPLOAD_WINDOW_FORMPANEL],listeners:{close:function(){a.html=""}}}).show()},showImportToDbWindow:function(a,b){var d=this;if(a==""){a=lang("notUploadEXCELdoc")}if(a==undefined){a=lang("notUploadEXCELdoc")}var c=new Ext.Window({width:800,height:300,autoScroll:false,modal:true,resizable:true,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="CNOA_USER_CUSTOMERS_FAHUO"></iframe></div>',title:lang("importQHXX"),listeners:{show:function(e){var g=Ext.getDom("CNOA_USER_CUSTOMERS_FAHUO");var f=g.contentWindow.document;f.open();f.write("<BODY>");f.write(urldecode(a));f.write("</BODY>");f.close()}},buttons:[{text:lang("close"),handler:function(){c.close()}}]});if(b=="add"){c.show()}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=loadFormDataRecord",params:{rid:a.rid},method:"POST",waitMsg:lang("waiting"),success:function(b,c){a.status=c.result.data.fahuostatus;a.change(c.result.data.gname);if(c.result.data.attach){$("#"+a.ID_formPanel_attach)[0].innerHTML=c.result.data.attach}a.setStatusBtn()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.close()})}.createDelegate(this)})},change:function(b){var c=Ext.getCmp(this.ID_formPanel_goods);var a=Ext.getCmp(this.ID_formPanel_service);if(b=="gd"){c.show();a.hide()}else{a.show();c.hide()}},setStatusBtn:function(){var e=this.statusCmp;var a=this.statusBtn;var d=this.status;if(d=="yes"){e.getEl().update(lang("nowStatus")+": "+lang("confirmed"));a.setText(lang("setAsWQR"))}else{e.getEl().update(lang("nowStatus")+": "+lang("WQR"));a.setText(lang("setToConfirmed"))}},setStatus:function(){var b=this;var a=this.status=="yes"?"no":"yes";CNOA.msg.cf(lang("editShipStatus")+"[ "+(this.status=="yes"?lang("WQR"):lang("confirmed"))+" ]？",function(c){if(c!="yes"){return}else{b.mainPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=setStatus",method:"POST",params:{status:a},success:function(f){var d=Ext.decode(f.responseText);if(d.success===true){b.status=a;b.setStatusBtn();try{CNOA_user_customers_recordCheck.store.reload()}catch(g){}CNOA.msg.notice(d.msg,lang("fHApproval"))}else{CNOA.msg.alert(d.msg)}b.mainPanel.getEl().unmask()}})}})}};var CNOA_user_customers_settingClass,CNOA_user_customers_setting;CNOA_user_customers_settingClass=CNOA.Class.create();CNOA_user_customers_settingClass.prototype={init:function(){this.baseUrl="index.php?app=user&func=customers&action=setting";this.showType="sort";this.dropDownPanel=this.getDropDownPanel();this.settingPanel=this.getSettingPanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.dropDownPanel,this.settingPanel]})},getSettingPanel:function(){var l=this;var f=new Ext.data.ArrayStore({data:[],fields:["value","text"]}),p=new Ext.data.ArrayStore({data:[],fields:["value","text"]}),h=new Ext.data.ArrayStore({data:[],fields:["value","text"]}),n=new Ext.data.ArrayStore({data:[],fields:["value","text"]}),o=new Ext.data.ArrayStore({data:[],fields:["value","text"]}),m=new Ext.data.ArrayStore({data:[],fields:["value","text"]});Ext.Ajax.request({url:this.baseUrl+"&task=loadSetting",success:function(y){var z=Ext.decode(y.responseText),E=z.allFields,u=z.uniqueFields,A=0,C=E.length,x=[],B=[],t=[],s=[],D,F;for(;A<C;A++){D=E[A];F=[D.value,D.text];if(D.lock){B.push(F)}else{x.push(F)}if(D.unique){s.push(F)}else{t.push(F)}}var w=z.degree,G=[],v=[];for(A=0;A<w.length;++A){D=w[A];F=[D.value,D.text];if(D.immune){v.push(F)}else{G.push(F)}}f.loadData(x);p.loadData(B);h.loadData(t);n.loadData(s);o.loadData(G);m.loadData(v);delete (z.allFields);c.getForm().setValues(z)}});var b={xtype:"fieldset",title:lang("lockSetup"),style:"margin: 10px;",items:[{xtype:"checkbox",fieldLabel:lang("enablingKHZDSD"),name:"autoLock"},{xtype:"compositefield",fieldLabel:lang("autoLockTime"),items:[{xtype:"numberfield",name:"lockHour",width:50},{xtype:"displayfield",value:lang("hour")}]},{xtype:"itemselector",fieldLabel:lang("lockField"),name:"lockFields",width:700,imagePath:"extjs/3.4.0/ux/images",multiselects:[{width:250,height:200,store:f,displayField:"text",valueField:"value"},{width:250,height:200,store:p,displayField:"text",valueField:"value",tbar:[{text:lang("clear2"),cls:"btn-red1",handler:function(){c.getForm().findField("lockFields").reset()}}]}]}]};var k={xtype:"fieldset",title:lang("weiyiField"),style:"margin: 10px;",items:[{xtype:"itemselector",fieldLabel:lang("uniqueField"),name:"uniqueFields",width:700,imagePath:"extjs/3.4.0/ux/images",multiselects:[{width:250,height:200,store:h,displayField:"text",valueField:"value"},{width:250,height:200,store:n,displayField:"text",valueField:"value",tbar:[{text:lang("clear2"),cls:"btn-red1",handler:function(){c.getForm().findField("uniqueFields").reset()}}]}]}]};var e={xtype:"fieldset",title:lang("setHighSea"),style:"margin: 10px;",items:[{xtype:"checkbox",fieldLabel:lang("enableHighSeas"),name:"startHighSeas"},{xtype:"compositefield",fieldLabel:lang("timeIntoHighSea"),items:[{xtype:"numberfield",name:"highSeasTime",width:50},{xtype:"displayfield",value:lang("qDhighSea")}]},{xtype:"itemselector",fieldLabel:lang("gHMYKH"),name:"immuneDegree",width:700,imagePath:"extjs/3.4.0/ux/images",multiselects:[{width:250,height:150,store:o,displayField:"text",valueField:"value"},{width:250,height:150,store:m,displayField:"text",valueField:"value",tbar:[{text:lang("clear2"),cls:"btn-red1",handler:function(){c.getForm().findField("immuneDegree").reset()}}]}]},{xtype:"compositefield",fieldLabel:lang("addHighSea"),items:[{xtype:"selectorform",name:"highSeasAName",hiddenName:"highSeasAdd",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]},{xtype:"compositefield",fieldLabel:lang("editGHKH"),items:[{xtype:"selectorform",name:"highSeasUName",hiddenName:"highSeasUpdate",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]},{xtype:"compositefield",fieldLabel:lang("delGHKH"),items:[{xtype:"selectorform",name:"highSeasDName",hiddenName:"highSeasDelete",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]},{xtype:"compositefield",fieldLabel:lang("importGHKH"),items:[{xtype:"selectorform",name:"highSeasIName",hiddenName:"highSeasImport",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]},{xtype:"compositefield",fieldLabel:lang("transferGHKH"),items:[{xtype:"selectorform",name:"highSeasMName",hiddenName:"highSeasMove",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]}]};var q={xtype:"fieldset",title:lang("myCustomersSetting"),style:"margin: 10px;",items:[{xtype:"compositefield",fieldLabel:lang("del")+lang("myCustomers"),items:[{xtype:"selectorform",name:"myCustomersDName",hiddenName:"myCustomersDelete",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]},{xtype:"compositefield",fieldLabel:lang("export2")+lang("myCustomers"),items:[{xtype:"selectorform",name:"myCustomersEName",hiddenName:"myCustomersExport",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]}]};var a={xtype:"fieldset",title:lang("secondShare"),style:"margin: 10px;",items:[{xtype:"checkbox",fieldLabel:lang("enablingSS"),name:"secondShare"}]};var d={xtype:"fieldset",title:"售前跟踪汇总设置",style:"margin: 10px;",items:[{xtype:"compositefield",fieldLabel:"导出权限",items:[{xtype:"selectorform",name:"expermit",hiddenName:"expermitId",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]}]};var g={xtype:"fieldset",title:lang("superiorViewSetting"),style:"margin: 10px;",items:[{xtype:"compositefield",fieldLabel:lang("exportSJCK"),items:[{xtype:"selectorform",name:"superiorViewEName",hiddenName:"superiorViewExport",selectorType:"user",multiselect:true,width:250},{xtype:"displayfield",value:lang("isEmptyAllUser")}]}]};var r=[b,k,e,q,a,d,g];var j=function(s){var t=c.getForm();if(t.isValid()){t.submit({url:l.baseUrl+"&task=saveSetting",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),success:function(u,v){CNOA.msg.notice2(v.result.msg)},failure:function(u,v){CNOA.msg.alert(v.result.msg)}})}else{CNOA.miniMsg.alertShowAt(s,lang("formValid"))}};var c=new Ext.form.FormPanel({title:lang("useSet"),labelAlign:"right",labelWidth:150,items:r,autoScroll:true,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("save"),iconCls:"icon-win-save",cls:"btn-blue4",handler:function(s){j(s)}}]})});return c},getDropDownPanel:function(){var c=this,a=[{name:"id"},{name:"name"},{name:"order"},{name:"limitNum"}],b=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getListData"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),d=new Ext.grid.CheckboxSelectionModel();cm=[new Ext.grid.RowNumberer(),d,{header:"",dataIndex:"id",hidden:true},{header:lang("cetegoryName"),dataIndex:"name",width:400,sortable:true,editor:{xtype:"textfield",allowBlank:false}},{header:lang("order"),dataIndex:"order",width:80,sortable:true,editor:{xtype:"textfield",allowBlank:true,regex:/^\+?[0-9][0-9]*$/i,regexText:lang("mustBeInt")}},{header:lang("limitNum"),dataIndex:"limitNum",sortable:true,hidden:true,editor:{xtype:"textfield",allowBlank:true,regex:/^\+?[0-9][0-9]*$/i,regexText:lang("mustBeInt")}}],editor=Ext.data.Record.create([{name:"id",type:"int"},{name:"name",type:"string"},{name:"order",type:"int"}]);grid=new Ext.grid.EditorGridPanel({title:lang("optionSet"),border:false,loadMask:{msg:lang("waiting")},store:b,columns:cm,sm:d,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",style:"margin: 3px 0",handler:function(){b.reload()}},{iconCls:"icon-utils-s-add",text:lang("add"),handler:function(){var f=new editor({id:0},{name:""},{order:10});b.insert(0,f);grid.getView().refresh();grid.getSelectionModel().selectRow(0)}},{iconCls:"icon-utils-s-delete",text:lang("del"),tooltip:lang("delRecord"),handler:function(f){var g=grid.getSelectionModel().getSelections(),e=g.length;if(e==0){CNOA.miniMsg.alertShowAt(f,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(j){if(j=="yes"){var k=[];for(var h=0;h<e;h++){k.push(g[h].get("id"))}k=k.join(",");c.deleteData(k)}})}}},{text:lang("keHuleibie"),enableToggle:true,toggleGroup:"user_customers_index_share",cls:"btn-blue4",pressed:true,allowDepress:false,handler:function(){c.reloadData("sort")}},{text:lang("KHGZWay"),enableToggle:true,cls:"btn-blue3",toggleGroup:"user_customers_index_share",allowDepress:false,handler:function(){c.reloadData("follow")}},{text:lang("yunShuWay"),enableToggle:true,cls:"btn-blue3",toggleGroup:"user_customers_index_share",allowDepress:false,handler:function(){c.reloadData("transport")}},{text:lang("KHHY"),enableToggle:true,cls:"btn-blue3",toggleGroup:"user_customers_index_share",allowDepress:false,handler:function(){c.reloadData("industry")}},{text:lang("customerExtent"),cls:"btn-blue3",enableToggle:true,toggleGroup:"user_customers_index_share",allowDepress:false,handler:function(){c.reloadData("degree")}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:127}],listeners:{afteredit:function(f){var g={field:f.field,id:f.record.get("id"),value:f.value,showType:c.showType};if(c.showType=="degree"){g.limitNum=f.record.get("limitNum")}c.updateData(g)}}});return grid},reloadData:function(c){var b,a=true;switch(c){case"sort":b=lang("keHuleibie");break;case"follow":b=lang("KHGZWay");break;case"transport":b=lang("customer")+lang("yunShuWay");break;case"industry":b=lang("KHHY");break;case"degree":b=lang("customerExtent");a=false;break}this.showType=c;this.dropDownPanel.getColumnModel().setColumnHeader(3,b);this.dropDownPanel.getColumnModel().setHidden(5,a);this.dropDownPanel.store.load({params:{showType:c}})},updateData:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=updateData",params:b,method:"POST",success:function(f,e){var c=Ext.decode(f.responseText);if(c.success===true){var g=Ext.decode(c.msg);CNOA.msg.notice(g.text,lang("customerMgr"));var d=grid.store.getAt(0);if(d.get("name")){d.set("id",g.id)}else{grid.store.getAt(1).set("id",g.id)}}else{CNOA.msg.alert(c.msg)}}})},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteData",method:"POST",params:{ids:a,showType:b.showType},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("customerMgr"));b.dropDownPanel.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_user_customers_fixFieldClass,CNOA_user_customers_fixField;CNOA_user_customers_fixFieldClass=new CNOA.Class.create();CNOA_user_customers_fixFieldClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=customers&action=fixField";this.fix=this.fix();this.mainPanel=new Ext.Panel({border:false,layout:"fit",items:[this.fix]})},fix:function(){var f=this;var b=[{name:"fieldId"},{name:"fieldname"},{name:"add"},{name:"show"},{name:"view"},{name:"must"},{name:"order"}];var c=Ext.id();var d=function(h){if(h==" "){return""}checked=h==1?"checked":"";return'<input type="checkbox" '+checked+"  />"};var a=new Ext.grid.ColumnModel({border:false,defaults:{sortable:true,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),{header:"fieldId",dataIndex:"fieldId",hidden:true,width:80},{header:lang("fieldName"),dataIndex:"fieldname",width:190},{header:lang("areListDisplay"),dataIndex:"show",renderer:d},{header:lang("areEditDisplay"),dataIndex:"add",renderer:d},{header:lang("areViewDisplay"),dataIndex:"view",renderer:d},{header:lang("ifRequired"),dataIndex:"must",renderer:d},{header:lang("order"),dataIndex:"order",editor:true}]});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getFix",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b}),listeners:{exception:function(n,m,o,l,j){var k=j.responseText;if(k!=""){var h=Ext.decode(k);if(h.failure){CNOA.msg.alert(h.msg)}}}}});var g=new Ext.PagingToolbar({displayInfo:true,store:f.store,pageSize:20});var e=new Ext.grid.EditorGridPanel({border:false,region:"center",store:f.store,cm:a,bbar:g,tbar:new Ext.Toolbar({items:[{xtype:"button",text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}}]}),listeners:{cellclick:function(k,n,l){var m=k.getColumnModel().getDataIndex(l);if(m=="add"||"show"||"must"){var j=k.getStore().getAt(n),h=j.get("fieldId");oldValue=j.get(m);value=$(k.getView().getCell(n,l)).find("input").attr("checked");if(value==undefined||value==oldValue){return}value=value?1:0;f.editFix(h,m,value)}},afteredit:function(j){var k=j.record.get("fieldId"),h=j.record.get("order");Ext.Ajax.request({url:f.baseUrl+"&task=order",method:"POST",params:{fieldId:k,value:h},success:function(l){var m=Ext.decode(l.responseText);if(m.success){CNOA.msg.notice2(m.msg)}else{CNOA.msg.alert(m.msg)}f.store.reload()}})}}});return e},editFix:function(a,d,c){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=editFix",method:"POST",params:{fieldId:a,fieldname:d,value:c},success:function(e){var f=Ext.decode(e.responseText);if(f.success){CNOA.msg.notice2(f.msg)}else{CNOA.msg.alert(f.msg)}b.store.reload()}})}};var CNOA_user_customers_outingClass,CNOA_user_customers_outing;CNOA_user_customers_outingClass=new CNOA.Class.create();CNOA_user_customers_outingClass.prototype={init:function(){this.baseUrl="index.php?app=user&func=customers&action=outing";this.outingView=this.createOutingView();this.outingStore=this.outingView.getStore();this.mainPanel=this.outingView},createOutingView:function(){var e=this;var a=[{name:"id"},{name:"uname"},{name:"customer"},{name:"linkman"},{name:"type"},{name:"posttime"},{name:"customerAddr"},{name:"address"},{name:"content"},{name:"photo"}];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getOutingRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var g=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"id",hidden:true},{header:lang("user"),dataIndex:"uname"},{header:lang("customer"),dataIndex:"customer"},{header:lang("linkMan"),dataIndex:"linkman"},{header:lang("type"),dataIndex:"type",width:60},{header:lang("customer_signTime"),dataIndex:"posttime",width:120},{header:lang("customer_customerAddr"),dataIndex:"customerAddr",width:250},{header:lang("signAddr"),dataIndex:"address",width:250},{header:lang("traceContent"),dataIndex:"content",width:200,renderer:function(j,k,h){Ext.QuickTips.init();k.attr=' ext:qtip="'+j+'"';if(j.length>30){k.attr+=" ext:qwidth=300"}return j}},{header:"图片",dataIndex:"photo",width:250}]});var f=new Ext.PagingToolbar({displayInfo:true,store:b,pageSize:20,listeners:{beforechange:function(k,m){var j={};var h=Ext.getCmp("uid").getValue(),l=Ext.getCmp("customer").getValue();if(h){j.uid=h}if(l){j.customer=l}if(j){Ext.apply(m,j)}}}});var d=new Ext.grid.GridPanel({border:false,cm:c,sm:g,store:b,tbar:this.createTab(),bbar:f});return d},createTab:function(){var a=this;return new CNOA.toolbar.SearchToolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){a.outingStore.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){var c=a.mainPanel.getSelectionModel().getSelections();if(c.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否删除?",function(d){if(d=="yes"){var e=[];Ext.each(c,function(g,f){e.push(g.json.id)});a.delOuting(e.join(","))}})}}},"用户",{xtype:"selectorform",width:100,id:"uid",multiselect:false,hiddenName:"uid"},"客户",{xtype:"textfield",width:100,id:"customer",name:"customer"}],listeners:{search:function(c,b){a.outingStore.reload({params:b})},clearSearch:function(b){a.outingStore.load()}}})},delOuting:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=delOuting",params:{id:b},success:function(c,e){a.outingStore.reload();var d=Ext.decode(c.responseText);CNOA.msg.notice2(d.msg)}})}};var sm_user_customers=1;
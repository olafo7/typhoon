var CNOA_user_addressbook_deptClass,CNOA_user_addressbook_dept;var CNOA_user_addressbook_viewDeptDetailClass,CNOA_user_addressbook_viewDeptDetail;CNOA_user_addressbook_viewDeptDetailClass=CNOA.Class.create();CNOA_user_addressbook_viewDeptDetailClass.prototype={init:function(a){var b=this;this.baseField=[{xtype:"fieldset",title:lang("baseInfo"),width:447,defaults:{width:325,xtype:"textfield",inputType:"text"},items:[{readOnly:true,name:"truename",fieldLabel:lang("truename")},{readOnly:true,name:"sex",fieldLabel:lang("sex")},{readOnly:true,name:"birthday",fieldLabel:lang("birthday")}]},{xtype:"fieldset",title:lang("linkInfo"),width:447,defaults:{width:325,xtype:"textfield",inputType:"text"},items:[{name:"phone",fieldLabel:lang("lifePhone"),readOnly:true},{name:"mobile",readOnly:true,fieldLabel:lang("mobile")},{name:"email",readOnly:true,fieldLabel:lang("email")},{name:"address",readOnly:true,fieldLabel:lang("homeAddress")},{name:"deptName",readOnly:true,fieldLabel:lang("department")},{name:"jobName",readOnly:true,fieldLabel:lang("job")},{name:"workphone",readOnly:true,fieldLabel:lang("workPhone")}]}];this.form=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",height:422,autoScroll:true,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:this.baseField});this.mainPanel=new Ext.Window({width:500,height:makeWindowHeight(500),resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.form],plain:true,title:lang("viewCardInfo"),buttonAlign:"right",autoScroll:true,buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.mainPanel.close()}}]})},show:function(b){var a=this;a.mainPanel.show();this.form.getForm().load({url:"index.php?app=user&func=addressbook&action=default",params:{id:b,task:"showDeptAddressBookDetail"},method:"POST",waitMsg:lang("waiting"),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}})},close:function(){this.mainPanel.close()}};CNOA_user_addressbook_deptClass=CNOA.Class.create();CNOA_user_addressbook_deptClass.prototype={init:function(){var f=this;this.ID_export=Ext.id();this.edit_id=0;this.baseUrl="index.php?app=user&func=addressbook&action=default";var c={truename:"",mobile:"",phone:"",qq:"",email:"",deptId:""};var a=[{name:"uid"},{name:"truename"},{name:"deptName"},{name:"sex"},{name:"jobName"},{name:"jobAbout"},{name:"mobile"},{name:"workphone"},{name:"fax"},{name:"email"},{name:"qq"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:c,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPublicList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:120,sortable:true,menuDisabled:true},{header:lang("sex"),dataIndex:"sex",width:60,sortable:false,menuDisabled:true},{header:lang("inDepartment"),dataIndex:"deptName",width:200,sortable:true,menuDisabled:true},{header:lang("job"),dataIndex:"jobName",width:180,sortable:false,menuDisabled:true},{header:"QQ",dataIndex:"qq",width:160,sortable:false,menuDisabled:true,renderer:function(h,j,g){return'<a href="javascript:void(0);" onclick="CNOA_user_addressbook_dept.sendEmail(\''+h+"@qq.com;')\">"+h+"</a>"}},{header:lang("mobile"),dataIndex:"mobile",width:160,sortable:false,menuDisabled:true},{header:lang("workPhone"),dataIndex:"workphone",width:220,sortable:false,menuDisabled:true},{header:lang("email"),dataIndex:"email",width:220,sortable:false,menuDisabled:true,renderer:function(h,j,g){return'<a href="javascript:void(0);" onclick="CNOA_user_addressbook_dept.sendEmail(\''+h+";')\">"+h+"</a>"}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.search_truename=new Ext.form.TextField({width:80});this.search_mobile=new Ext.form.TextField({width:80});this.search_tel=new Ext.form.TextField({width:80});this.search_qq=new Ext.form.TextField({width:80});this.search_email=new Ext.form.TextField({width:80});this.search_dept=new Ext.form.SelectorForm({width:80,hiddenName:"deptId",multiselect:false,selectorType:"dept"});var d=new Ext.PagingToolbar({displayInfo:true,store:f.store,pageSize:15});this.grid=new Ext.grid.PageGridPanel({stripeRows:true,store:this.store,cm:b,sm:e,region:"center",hideBorders:true,border:false,bbar:d,viewConfig:{forceFit:true},listeners:{rowdblclick:function(g){var h=g.getSelectionModel().getSelections();CNOA_user_addressbook_viewDeptDetail=new CNOA_user_addressbook_viewDeptDetailClass();CNOA_user_addressbook_viewDeptDetail.show(h[0].get("uid"))}},tbar:new Ext.Toolbar({items:[{handler:function(g,h){f.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:f.ID_export,text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){f.openExportExcelWindow()}.createDelegate(this)},{text:lang("order"),tooltip:lang("order"),cls:"btn-yellow1",iconCls:"icon-order",handler:function(g,h){f.showOrderWin()}},"->",{xtype:"cnoa_helpBtn",helpid:47}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid],tbar:[lang("truename")+":",f.search_truename,lang("mobile")+":",f.search_mobile,lang("tel")+":",f.search_tel,"QQ:",f.search_qq,lang("department")+":",f.search_dept,lang("email")+":",f.search_email,{text:lang("search"),handler:function(g){c.truename=f.search_truename.getValue();c.mobile=f.search_mobile.getValue();c.phone=f.search_tel.getValue();c.qq=f.search_qq.getValue();c.email=f.search_email.getValue();c.deptId=f.search_dept.getValue();f.store.load({params:c})}},{text:lang("clear"),handler:function(g){c.truename=f.search_truename.setValue();c.mobile=f.search_mobile.setValue();c.phone=f.search_tel.setValue();c.qq=f.search_qq.setValue();c.email=f.search_email.setValue();c.deptId=f.search_dept.setValue();f.search_dept.clearValue("");c.truename="";c.mobile="";c.phone="";c.qq="";c.email="";c.deptId="";f.store.load({params:c})}}]});Ext.Ajax.request({url:f.baseUrl+"&task=getExportPermit",method:"POST",success:function(h){var g=Ext.decode(h.responseText);if(g.data.status==1){Ext.getCmp(f.ID_export).setVisible(true)}else{Ext.getCmp(f.ID_export).setVisible(false)}}})},showOrderWin:function(){var g=this;var a=[{name:"uid"},{name:"truename"},{name:"deptName"},{name:"sex"},{name:"jobName"}];var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getOrderList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var b=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:120,sortable:true,menuDisabled:true},{header:lang("sex"),dataIndex:"sex",width:60,sortable:false,menuDisabled:true},{header:lang("inDepartment"),dataIndex:"deptName",width:200,sortable:true,menuDisabled:true},{header:lang("job"),dataIndex:"jobName",width:180,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]});var d=new Ext.grid.GridPanel({stripeRows:true,loadMask:{msg:lang("waiting")},cm:b,store:c,hideBorders:true,border:false,enableDragDrop:true,dropConfig:{appendOnly:true},ddGroup:"GridDD",listeners:{afterrender:function(j){var h=new Ext.dd.DropTarget(j.getEl(),{ddGroup:"GridDD",copy:false,notifyDrop:function(k,p,o){var n=o.selections;var l=k.getDragData(p).rowIndex;if(typeof(l)=="undefined"){return}for(i=0;i<n.length;i++){var m=n[i];if(!this.copy){c.remove(m)}if(l==0){m.data.orderNum-=1}else{if(l==c.data.items.length){m.data.id=c.data.items[l-1].data.id+1}else{m.data.id=(c.data.items[l-1].data.id+c.data.items[l].data.id)/2}}c.insert(l,m)}}})}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),tooltip:lang("refresh"),iconCls:"icon-system-refresh",handler:function(h,j){c.reload()}}]})});var e=function(){var h=new Array();Ext.each(c.data.items,function(j){h.push(j.data.uid)});Ext.Ajax.request({method:"POST",url:g.baseUrl+"&task=getOrderForm",params:{order:h.join(",")},success:function(l,k){var j=Ext.decode(l.responseText);if(j.success===true){CNOA.msg.notice2(j.msg);g.store.load();f.hide()}else{CNOA.msg.alert(j.msg)}}})};var f=new Ext.Window({width:620,height:makeWindowHeight(500),border:false,modal:true,layout:"fit",maximizable:true,closeAction:"hide",items:d,buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){e()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.hide()}}]});f.show();f.getStore=function(){return c};return f},sendEmail:function(a){new Ext.SendEmail({email:a})},openExportExcelWindow:function(){var f=this;var b=f.search_truename.getValue(),a=f.search_mobile.getValue(),g=f.search_tel.getValue(),j=f.search_qq.getValue(),h=f.search_email.getValue(),c=f.search_dept.getValue();var k=new Ext.form.SelectorForm({multiselect:true,selectorType:"dept",hiddenName:"deptID",fieldLabel:lang("selectDept")});var d=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:110,items:[k,{xtype:"displayfield",hideLabel:true,value:"<span style='color: red'>说明:可选择多个部门导出，当选择查询导出后请先清空查询条件再进行其他操作。</span>"}]});var e=new Ext.Window({width:320,height:210,title:"导出通讯录",resizable:false,modal:true,layout:"fit",items:d,buttons:[{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(m){var l=k.getValue();if(l&&c){CNOA.msg.alert("部门查询与选择部门不能一起选择！如需多部门导出请选择部门即可！");return}if(b||a||g||j||h||c){CNOA.msg.cf("查询条件未清空，是否按条件导出数据？",function(n){if(n=="yes"){Ext.Ajax.request({url:f.baseUrl+"&task=exportDeptExcel&step=1",method:"POST",params:{pDeptID:l,truename:b,mobile:a,phone:g,qq:j,email:h,deptId:c},success:function(o,p){var q=Ext.decode(o.responseText);ajaxDownload(f.baseUrl+"&task=exportDeptExcel&file="+q.msg+"&step=2");e.hide()}})}})}else{Ext.Ajax.request({url:f.baseUrl+"&task=exportDeptExcel&step=1",method:"POST",params:{pDeptID:l},success:function(n,o){var p=Ext.decode(n.responseText);ajaxDownload(f.baseUrl+"&task=exportDeptExcel&file="+p.msg+"&step=2");e.hide()}})}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}.createDelegate(this)}]}).show()}};var CNOA_user_addressbook_myClass,CNOA_user_addressbook_my,CNOA_user_addressbook_add_editClass,CNOA_user_addressbook_add_edit;var CNOA_user_addressbook_groupClass,CNOA_user_addressbook_group;CNOA_user_addressbook_groupClass=CNOA.Class.create();CNOA_user_addressbook_groupClass.prototype={init:function(a){var c=this;this.tp=a;this.title=lang("myGroup");this.action=a=="edit"?"edit":"add";this.edit_id=0;this.ID_btn_delete=Ext.id();this.ID_btn_edit=Ext.id();this.ID_groupComboBox=Ext.id();this.fields=[{name:"id",mapping:"id"},{name:"name",mapping:"name"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"index.php?app=user&func=addressbook&action=default&task=getGroupList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});var b=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:c.store,pageSize:5});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.colum=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",sortable:true,hidden:true},{header:lang("groupName"),width:440,editor:new Ext.form.TextField({allowBlank:false}),sortable:true,dataIndex:"name"}]);this.grid=new Ext.grid.EditorGridPanel({store:this.store,sm:this.sm,hideBorders:true,border:false,height:237,allowDomMove:true,bbar:b,colModel:this.colum,viewConfig:{forceFit:true},clicksToEdit:1,listeners:{afteredit:function(f){var g=f.record;var d=f.field;var h=g.get("id");var e=g.get("name");Ext.Ajax.request({url:"index.php?app=user&func=addressbook&action=default&task=updateGroup",params:"id="+h+"&name="+e,success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){CNOA.msg.notice(j.msg,lang("personalMgr"));c.store.reload()}else{CNOA.msg.alert(j.msg)}}})}.createDelegate(this)}});this.mainPanel=new Ext.Window({width:500,height:360,resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.grid],plain:true,title:this.title,buttonAlign:"right",autoScroll:true,tbar:[{text:lang("addGroup"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){var d=this.grid.getStore().recordType;var e=new d({name:""});this.grid.stopEditing();this.store.insert(0,e);this.grid.startEditing(0,3)}.createDelegate(this)},{text:lang("del"),iconCls:"icon-utils-s-delete",id:this.ID_btn_delete,handler:function(e,f){var g=this.grid.getSelectionModel().getSelections();if(g.length==0){var d=Ext.getCmp(this.ID_btn_delete).getEl().getBox();d=[d.x+12,d.y+26];CNOA.miniMsg.alert(lang("selectItemToDel"),d)}else{CNOA.msg.cf(lang("confirmToDelete"),function(h){if(h=="yes"){if(g){var j=[];j.push(g[0].get("id"));c.deleteList(Ext.encode(j))}}})}}.createDelegate(this)}],buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){this.close();CNOA_user_addressbook_my.store.reload()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close();CNOA_user_addressbook_my.store.reload()}.createDelegate(this)}]})},show:function(b){var a=this;a.mainPanel.show()},close:function(){this.mainPanel.close()},deleteList:function(a){var b=this;Ext.Ajax.request({url:"index.php?app=user&func=addressbook&action=default&task=deleteGroup",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("personalMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};CNOA_user_addressbook_add_editClass=CNOA.Class.create();CNOA_user_addressbook_add_editClass.prototype={init:function(a){var b=this;this.tp=a;this.actionUrl=a=="edit"?"index.php?app=user&func=addressbook&action=default&task=editSubmitFormData":"index.php?app=user&func=addressbook&action=default&task=addSubmitFormData";this.title=a=="edit"?lang("editCard"):lang("addCard");this.action=a=="edit"?"edit":"add";this.edit_id=0;this.ID_btn_edit=Ext.id();this.ID_groupComboBox=Ext.id();this.groupComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"index.php?app=user&func=addressbook&action=default&task=loadGroupInfo"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"gid",mapping:"gid"},{name:"gname",mapping:"gname"}]})});this.groupComboBoxDataStore.load();this.groupComboBox=new Ext.form.ComboBox({id:this.ID_groupComboBox,fieldLabel:lang("atGroup"),name:"gid",store:this.groupComboBoxDataStore,hiddenName:"gid",valueField:"gid",displayField:"gname",mode:"local",width:160,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(e,c,d){}.createDelegate(this)}});this.baseField=[{xtype:"fieldset",title:lang("baseInfo"),width:447,defaults:{width:325,xtype:"textfield"},items:[{xtype:"hidden",name:"id"},{name:"name",fieldLabel:lang("truename"),inputType:"text",allowBlank:false,maxLength:20,maxLengthText:lang("maxLengthText")+20},new Ext.form.ComboBox({fieldLabel:lang("sex"),name:"sex",store:new Ext.data.SimpleStore({fields:["value","sex"],data:[["1",lang("male")],["2",lang("female")]]}),hiddenName:"sex",valueField:"value",displayField:"sex",mode:"local",triggerAction:"all",forceSelection:true,editable:false,value:lang("male")}),{xtype:"datefield",name:"birthday",width:140,fieldLabel:lang("birthday"),format:"Y-m-d",maxLength:10,maxLengthText:lang("maxLengthText")+10},this.groupComboBox,{xtype:"checkbox",checked:true,boxLabel:lang("shareToOtherUser"),name:"share",checked:false}]},{xtype:"fieldset",title:lang("linkInfo"),width:447,defaults:{width:325,xtype:"textfield"},items:[{name:"phone",fieldLabel:lang("lifePhone"),inputType:"text",maxLength:20,maxLengthText:lang("maxLengthText")+20},{name:"qq",fieldLabel:"QQ",inputType:"text"},{name:"mobile",fieldLabel:lang("mobile"),inputType:"text",maxLength:20,maxLengthText:lang("maxLengthText")+20},{name:"fax",fieldLabel:lang("fox"),inputType:"text",maxLength:20,maxLengthText:lang("maxLengthText")+20},{name:"email",fieldLabel:lang("email"),inputType:"text",maxLength:50,maxLengthText:lang("maxLengthText")+50},{name:"houseaddr",fieldLabel:lang("homeAddress"),inputType:"text",maxLength:150,maxLengthText:lang("maxLengthText")+150},{name:"company",fieldLabel:lang("workUnit"),inputType:"text",maxLength:150,maxLengthText:lang("maxLengthText")+150},{name:"profession",fieldLabel:lang("job"),inputType:"text",maxLength:30,maxLengthText:lang("maxLengthText")+30},{name:"comphone",fieldLabel:lang("workPhone"),inputType:"text",maxLength:20,maxLengthText:lang("maxLengthText")+20},{name:"comzipcode",fieldLabel:lang("workZip"),inputType:"text",maxLength:10,maxLengthText:lang("maxLengthText")+10},{name:"comaddr",fieldLabel:lang("workAddr"),inputType:"text",maxLength:150,maxLengthText:lang("maxLengthText")+150},{xtype:"textarea",name:"other",fieldLabel:lang("remark"),inputType:"text"}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",height:422,autoScroll:true,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:this.baseField});this.mainPanel=new Ext.Window({width:500,height:makeWindowHeight(500),resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,title:this.title,buttonAlign:"right",autoScroll:true,buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:true})}.createDelegate(this)},{text:lang("apply"),id:this.ID_btn_apply,hidden:this.action=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:false})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(b){var a=this;a.mainPanel.show();if(a.action=="edit"){this.loadFormData(b)}},close:function(){this.mainPanel.close()},loadFormData:function(b){var a=this;this.formPanel.getForm().load({url:"index.php?app=user&func=addressbook&action=default",params:{id:b,task:"editLoadFormData"},method:"POST",waitMsg:lang("waiting"),success:function(c,d){a.edit_id=b;Ext.getCmp(this.ID_groupComboBox).setValue(d.result.data.groupid)}.createDelegate(this),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}.createDelegate(this)})},submitForm:function(a){var b=this;if(b.formPanel.getForm().isValid()){b.formPanel.getForm().submit({url:this.actionUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("notice"),params:{id:b.edit_id},success:function(c,d){CNOA.msg.notice2(d.result.msg);CNOA_user_addressbook_add_edit.mainPanel.enable();CNOA_user_addressbook_my.store.reload();if(a.close){CNOA_user_addressbook_add_edit.close()}},failure:function(c,d){CNOA_user_addressbook_add_edit.mainPanel.enable();CNOA.msg.alert(d.result.msg)}})}}};CNOA_user_addressbook_myClass=CNOA.Class.create();CNOA_user_addressbook_myClass.prototype={init:function(){var b=this;this.ID_export=Ext.id();this.edit_id=0;this.baseUrl="index.php?app=user&func=addressbook&action=default";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();var a={truename:"",mobile:"",phone:"",qq:"",email:"",company:"",gid:0};this.fields=[{name:"id"},{name:"name"},{name:"gname"},{name:"sex"},{name:"profession"},{name:"company"},{name:"mobile"},{name:"phone"},{name:"fax"},{name:"email"},{name:"qq"},{name:"houseaddr"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:a,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("truename"),dataIndex:"name",width:100,renderer:function(e,g,d){var f=d.data;return'<a href="javascript:void(0)" onclick="CNOA_user_addressbook_my.view('+f.id+')">'+e+"</a>"}},{header:lang("sex"),dataIndex:"sex",width:50},{header:lang("job"),dataIndex:"profession",width:100},{header:lang("workUnit"),dataIndex:"company",width:120},{header:lang("homeAddress"),dataIndex:"houseaddr",width:120},{header:"QQ",dataIndex:"qq",width:100,renderer:function(e,f,d){return'<a href="javascript:void(0)" onclick="CNOA_user_addressbook_my.sendEmail(\''+e+"@qq.com;')\">"+e+"</a>"}},{header:lang("mobile"),dataIndex:"mobile",width:110},{header:lang("tel"),dataIndex:"phone",width:100},{header:lang("email"),dataIndex:"email",width:200,renderer:function(e,f,d){return'<a href="javascript:void(0)" onclick="CNOA_user_addressbook_my.sendEmail(\''+e+";')\">"+e+"</a>"}},{header:lang("fox"),dataIndex:"fax",width:120},{header:lang("atGroup"),dataIndex:"gname",width:120},{header:"",dataIndex:"noIndex",width:1}]});this.grid=new Ext.grid.PageGridPanel({stripeRows:true,searchStore:a,store:this.store,cm:this.colModel,sm:this.sm,region:"center",listeners:{rowdblclick:function(c,d){CNOA_user_addressbook_my.editPanel()}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(c,d){CNOA_user_addressbook_add_edit=new CNOA_user_addressbook_add_editClass("add");CNOA_user_addressbook_add_edit.show()}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:lang("addLinkMan"),text:lang("add")},{id:this.ID_btn_edit,handler:function(c,d){this.editPanel()}.createDelegate(this),iconCls:"icon-utils-s-edit",tooltip:lang("editLinkMan"),text:lang("modify")},{text:lang("del"),iconCls:"icon-utils-s-delete",id:this.ID_btn_delete,handler:function(d,e){var f=this.grid.getSelectionModel().getSelections();if(f.length==0){var c=Ext.getCmp(this.ID_btn_delete).getEl().getBox();c=[c.x+12,c.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),c)}else{CNOA.msg.cf(lang("confirmToDelete"),function(h){if(h=="yes"){if(f){var j="";for(var g=0;g<f.length;g++){j+=f[g].get("id")+","}CNOA_user_addressbook_my.deleteList(j)}}})}}.createDelegate(this)},{id:b.ID_export,text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(j){var e=b.search_truename.getValue(),h=b.search_mobile.getValue(),g=b.search_tel.getValue(),d=b.search_qq.getValue(),f=b.search_email.getValue(),c=b.search_company.getValue(),k=b.search_group.getValue();if(e||h||g||d||f||c||k){CNOA.msg.cf("查询条件未清空，是否按条件导出数据？",function(l){if(l=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=exportExcel&step=1",method:"POST",params:{truename:e,mobile:h,tel:g,qq:d,email:f,company:c,group:k},success:function(m,n){var o=Ext.decode(m.responseText);ajaxDownload(b.baseUrl+"&task=exportExcel&file="+o.msg+"&step=2")}})}})}else{Ext.Ajax.request({url:b.baseUrl+"&task=exportExcel&step=1",method:"POST",success:function(l,m){var n=Ext.decode(l.responseText);ajaxDownload(b.baseUrl+"&task=exportExcel&file="+n.msg+"&step=2")}})}}},new Ext.importButton({tooltip:lang("fromExcelAddress"),browseTitle:lang("inportDirectory"),cls:"btn-blue3",url:this.baseUrl+"&task=import_linkman_upload"}),("<span style='color:#676767'>"+lang("groupOpt")+"：</span>"),{text:lang("groupMgr"),iconCls:"icon-group-mgr",cls:"btn-yellow1",handler:function(c,d){CNOA_user_addressbook_group=new CNOA_user_addressbook_groupClass();CNOA_user_addressbook_group.show()}.createDelegate(this)},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:48}]})});this.search_truename=new Ext.form.TextField({width:80});this.search_mobile=new Ext.form.TextField({width:80});this.search_tel=new Ext.form.TextField({width:80});this.search_qq=new Ext.form.TextField({width:80});this.search_email=new Ext.form.TextField({width:80});this.search_company=new Ext.form.TextField({width:80});this.search_group=new Ext.form.ComboBox({width:90,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",valueField:"id",displayField:"name",store:new Ext.data.Store({autoLoad:true,baseParams:a,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getGroupList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"},{name:"name"}]})})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid],tbar:[lang("truename")+":",b.search_truename,lang("mobile")+":",b.search_mobile,lang("tel")+":",b.search_tel,"QQ:",b.search_qq,lang("email")+":",b.search_email,lang("workUnit")+":",b.search_company,lang("group")+":",b.search_group,{text:lang("search"),handler:function(c){a.truename=b.search_truename.getValue();a.mobile=b.search_mobile.getValue();a.phone=b.search_tel.getValue();a.qq=b.search_qq.getValue();a.email=b.search_email.getValue();a.company=b.search_company.getValue();a.gid=b.search_group.getValue();b.store.load()}},{text:lang("clear"),handler:function(c){b.search_truename.setValue();b.search_mobile.setValue();b.search_tel.setValue();b.search_qq.setValue();b.search_email.setValue();b.search_company.setValue();b.search_group.setValue();a.truename="";a.mobile="";a.phone="";a.qq="";a.email="";a.company="";a.gid=0;b.store.load()}}]});Ext.Ajax.request({url:b.baseUrl+"&task=getExportPermit",method:"POST",success:function(d){var c=Ext.decode(d.responseText);if(c.data.status==1){Ext.getCmp(b.ID_export).setVisible(true)}else{Ext.getCmp(b.ID_export).setVisible(false)}}})},sendEmail:function(a){new Ext.SendEmail({email:a})},editPanel:function(){var c=this;var b=c.grid.getSelectionModel().getSelections();if(b.length!=1){var a=Ext.getCmp(c.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];if(b.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{CNOA.miniMsg.alert(lang("notAllowEditMoreOneRecord"),a)}}else{CNOA_user_addressbook_add_edit=new CNOA_user_addressbook_add_editClass("edit");CNOA_user_addressbook_add_edit.show(b[0].get("id"))}},deleteList:function(a){Ext.Ajax.request({url:this.baseUrl+"&task=deleteList",method:"POST",params:{ids:a},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice2(b.msg);CNOA_user_addressbook_my.store.reload()}else{CNOA.msg.alert(b.msg)}}})},view:function(b){var a=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(a.baseUrl+"&task=loadPage&from=viewDetails&id="+b,"personView","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};var CNOA_user_addressbook_shareClass,CNOA_user_addressbook_share;var CNOA_user_addressbook_viewShareDetailClass,CNOA_user_addressbook_viewShareDetail;CNOA_user_addressbook_viewShareDetailClass=CNOA.Class.create();CNOA_user_addressbook_viewShareDetailClass.prototype={init:function(a){var b=this;this.baseField=[{xtype:"fieldset",title:lang("baseInfo"),width:447,defaults:{width:325,xtype:"textfield",inputType:"text"},items:[{readOnly:true,name:"name",fieldLabel:lang("truename")},{readOnly:true,name:"sex",fieldLabel:lang("sex")},{readOnly:true,name:"birthday",fieldLabel:lang("birthday")}]},{xtype:"fieldset",title:lang("linkInfo"),width:447,defaults:{width:325,xtype:"textfield",inputType:"text"},items:[{name:"phone",fieldLabel:lang("lifePhone"),readOnly:true},{name:"mobile",readOnly:true,fieldLabel:lang("mobile")},{name:"fax",readOnly:true,fieldLabel:lang("fox")},{name:"email",readOnly:true,fieldLabel:lang("email")},{name:"houseaddr",readOnly:true,fieldLabel:lang("homeAddress")},{name:"company",readOnly:true,fieldLabel:lang("workUnit")},{name:"profession",readOnly:true,fieldLabel:lang("job")},{name:"comphone",readOnly:true,fieldLabel:lang("workPhone")},{name:"comzipcode",readOnly:true,fieldLabel:lang("workZip")},{name:"comaddr",readOnly:true,fieldLabel:lang("workAddr")},{xtype:"textarea",name:"other",readOnly:true,fieldLabel:lang("remark"),inputType:"text"}]}];this.form=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",height:422,autoScroll:true,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:this.baseField});this.mainPanel=new Ext.Window({width:500,height:makeWindowHeight(500),resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.form],plain:true,title:lang("viewCardInfo"),buttonAlign:"right",autoScroll:true,buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.mainPanel.close()}}]})},show:function(b){var a=this;a.mainPanel.show();this.form.getForm().load({url:"index.php?app=user&func=addressbook&action=default",params:{id:b,task:"showShareAddressBookDetail"},method:"POST",waitMsg:lang("waiting"),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}})},close:function(){_this.mainPanel.close()}};CNOA_user_addressbook_shareClass=CNOA.Class.create();CNOA_user_addressbook_shareClass.prototype={init:function(){var c=this;this.ID_export=Ext.id();this.edit_id=0;this.baseUrl="index.php?app=user&func=addressbook&action=default";var a={truename:"",mobile:"",phone:"",qq:"",email:""};this.fields=[{name:"id"},{name:"name"},{name:"sex"},{name:"profession"},{name:"company"},{name:"mobile"},{name:"phone"},{name:"fax"},{name:"email"},{name:"shareer"},{name:"qq"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:a,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});var b=new Ext.PagingToolbar({displayInfo:true,store:c.store,pageSize:15});this.smAddressShare=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("truename"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("sex"),dataIndex:"sex",width:60,sortable:false,menuDisabled:true},{header:lang("job"),dataIndex:"profession",width:180,sortable:false,menuDisabled:true},{header:lang("workUnit"),dataIndex:"company",width:180,sortable:false,menuDisabled:true},{header:"QQ",dataIndex:"qq",width:220,sortable:false,menuDisabled:true,renderer:function(e,f,d){return'<a href="javascript:void(0);" onclick="CNOA_user_addressbook_share.sendEmail(\''+e+"@qq.com;')\">"+e+"</a>"}},{header:lang("mobile"),dataIndex:"mobile",width:220,sortable:false,menuDisabled:true},{header:lang("tel"),dataIndex:"phone",width:220,sortable:false,menuDisabled:true},{header:lang("fox"),dataIndex:"fax",width:220,sortable:false,menuDisabled:true},{header:lang("email"),dataIndex:"email",width:220,sortable:false,menuDisabled:true,renderer:function(e,f,d){return'<a href="javascript:void(0);" onclick="CNOA_user_addressbook_share.sendEmail(\''+e+";')\">"+e+"</a>"}},{header:lang("sharePeopleNmae"),dataIndex:"shareer",width:120,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.search_truename=new Ext.form.TextField({width:80});this.search_mobile=new Ext.form.TextField({width:80});this.search_tel=new Ext.form.TextField({width:80});this.search_qq=new Ext.form.TextField({width:80});this.search_email=new Ext.form.TextField({width:80});this.grid=new Ext.grid.PageGridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.smAddressShare,region:"center",hideBorders:true,border:false,bbar:b,viewConfig:{forceFit:true},listeners:{rowdblclick:function(d){var e=d.getSelectionModel().getSelections();CNOA_user_addressbook_viewShareDetail=new CNOA_user_addressbook_viewShareDetailClass();CNOA_user_addressbook_viewShareDetail.show(e[0].get("id"))}},tbar:new Ext.Toolbar({items:[{handler:function(d,e){c.store.reload()},iconCls:"icon-system-refresh",text:lang("refresh")},{id:c.ID_export,text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(j){var e=c.search_truename.getValue(),h=c.search_mobile.getValue(),g=c.search_tel.getValue(),d=c.search_qq.getValue(),f=c.search_email.getValue();if(e||h||g||d||f){CNOA.msg.cf("查询条件未清空，是否按条件导出数据？",function(k){if(k=="yes"){Ext.Ajax.request({url:c.baseUrl+"&task=exportShareExcel&step=1",method:"POST",params:{truename:e,mobile:h,tel:g,qq:d,email:f},success:function(l,m){var n=Ext.decode(l.responseText);ajaxDownload(c.baseUrl+"&task=exportShareExcel&file="+n.msg+"&step=2")}})}})}else{Ext.Ajax.request({url:c.baseUrl+"&task=exportShareExcel&step=1",method:"POST",success:function(k,l){var m=Ext.decode(k.responseText);ajaxDownload(c.baseUrl+"&task=exportShareExcel&file="+m.msg+"&step=2")}})}}},"<span style='color:#999'>"+lang("dblClickToView")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:49}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid],tbar:[lang("truename")+":",c.search_truename,lang("mobile")+":",c.search_mobile,lang("tel")+":",c.search_tel,"QQ:",c.search_qq,lang("email")+":",c.search_email,{text:lang("search"),handler:function(d){a.truename=c.search_truename.getValue();a.mobile=c.search_mobile.getValue();a.phone=c.search_tel.getValue();a.qq=c.search_qq.getValue();a.email=c.search_email.getValue();c.store.load({params:a})}},{text:lang("clear"),handler:function(d){a.truename=c.search_truename.setValue();a.mobile=c.search_mobile.setValue();a.phone=c.search_tel.setValue();a.qq=c.search_qq.setValue();a.email=c.search_email.setValue();a.truename="";a.mobile="";a.phone="";a.qq="";a.email="";c.store.load({params:a})}}]});Ext.Ajax.request({url:c.baseUrl+"&task=getExportPermit",method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.data.status==1){Ext.getCmp(c.ID_export).setVisible(true)}else{Ext.getCmp(c.ID_export).setVisible(false)}}})},sendEmail:function(a){new Ext.SendEmail({email:a})}};var CNOA_user_addressbook_settingClass,CNOA_user_addressbook_setting;CNOA_user_addressbook_settingClass=CNOA.Class.create();CNOA_user_addressbook_settingClass.prototype={init:function(){var a=this;this.ID_man=Ext.id();this.hide_exportIDs=Ext.id();this.baseUrl="index.php?app=user&func=addressbook&action=setting";this.mainPanel=new Ext.form.FormPanel({border:false,title:"设置",tbar:[{xtype:"button",text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",style:"margin: 0 0 0 10px",listeners:{click:function(b){a.submitForm()}}}],defaults:{xtype:"fieldset",autoWidth:true,style:"margin: 10px",autoHeight:true},items:[{title:"通讯录导出设置",items:[{xtype:"hidden",listeners:{beforerender:function(){a.formLoad()}}},{xtype:"radiogroup",fieldLabel:"是否开启导出通讯录功能",width:200,style:"padding: 0 0 0 20px",items:[{boxLabel:"是",name:"status",inputValue:1,listeners:{check:function(c,b){if(b){Ext.getCmp(a.ID_man).setVisible(true)}else{Ext.getCmp(a.ID_man).setVisible(false)}}}},{boxLabel:"否",inputValue:0,name:"status"}]}]},{title:"通讯录导出人员(若不选择导出人员,所有人员将都能导出通讯录)",id:this.ID_man,hidden:true,labelAlign:"right",items:[{xtype:"textarea",height:45,width:580,readOnly:true,fieldLabel:"导出人员",name:"exportNames",emptyText:lang("clickSelectPerson"),style:{marginBottom:"3px"},listeners:{render:function(b){b.to=a.hide_exportIDs},focus:function(b){people_selector("user",b,true,false)}}},{xtype:"hidden",name:"exportIDs",id:this.hide_exportIDs}]}]})},formLoad:function(){var a=this;a.mainPanel.getForm().load({url:a.baseUrl+"&task=getStatus",method:"POST",success:function(b,c){if(c.result.data.status==1){Ext.getCmp(a.ID_man).setVisible(true)}},failure:function(b,c){if(c.result.data.status==0){Ext.getCmp(a.ID_man).setVisible(false)}}})},submitForm:function(){var a=this;if(a.mainPanel.getForm().isValid()){a.mainPanel.getForm().submit({url:a.baseUrl+"&task=exportSetting",method:"POST",success:function(b,c){CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})}}};var sm_user_addressbook=1;
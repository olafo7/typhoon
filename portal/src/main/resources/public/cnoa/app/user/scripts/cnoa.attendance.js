var CNOA_user_attendance_agent,CNOA_user_attendance_agentClass;CNOA_user_attendance_agent_Class=CNOA.Class.create();CNOA_user_attendance_agent_Class.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=attendance&action=agent";this.type="add";this.edit_id=0;this.fields=[{name:"key"},{name:"truename"},{name:"time"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"识别字符",dataIndex:"key",width:200,sortable:true,menuDisabled:true},{header:"用户名",dataIndex:"truename",width:123,sortable:true,menuDisabled:true},{header:"登记时间",dataIndex:"time",width:180,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){}}});this.grid=new Ext.grid.GridPanel({border:false,stripeRows:true,layout:"fit",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,listeners:{rowdblclick:function(b,c){var d=a.grid.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{a.type="edit";a.edit_id=d[0].get("id");a.showAddWindow()}}},tbar:[{text:"设置关键字",iconCls:"icon-system-refresh",handler:function(b,c){}.createDelegate(this),hidden:true},{text:"导入考勤数据",iconCls:"document-excel-import",cls:"btn-blue4",handler:function(b,c){a.showAddWindow()}.createDelegate(this)},{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){this.store.reload()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:3003}]});this.mainPanel=new Ext.Panel({border:false,layout:"fit",items:[a.grid]})},deleteList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否确定要删除?",function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("id")+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=vacation_del",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},showAddWindow:function(){var f=this;var a=Ext.id();var e="";var d="";if(f.type=="add"){d=f.baseUrl+"&task=upload_excel"}else{d=f.baseUrl+"&task=vacation_edit"}var b=function(g){var h=f.formPanel.getForm();if(h.isValid()){h.submit({url:d,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:f.edit_id},success:function(i,j){CNOA.msg.notice(j.result.msg,"个人管理");f.addEditWindow.close();f.store.reload()}.createDelegate(this),failure:function(i,j){CNOA.msg.alert(j.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(a,lang("formValid"))}}.createDelegate(this);var c=function(){f.formPanel.getForm().load({url:f.baseUrl+"&task=vacation_info",params:{id:f.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(g,h){},failure:function(g,h){CNOA.msg.alert(h.result.msg,function(){f.close()})}.createDelegate(this)})};this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,fileUpload:true,waitMsgTarget:true,labelWidth:90,labelAlign:"right",bodyStyle:"padding: 15px",items:[{xtype:"label",text:"请选择您要导入考勤数据的EXCEL文件"},{xtype:"fileuploadfield",name:"importExcel",allowBlank:false,blankText:"请选择您要导入考勤数据的EXCEL文件",buttonCfg:{text:"选择文件"},hideLabel:true,width:370,listeners:{fileselected:function(h,g){}}}]});this.addEditWindow=new Ext.Window({width:480,height:200,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:"导入考勤数据",layout:"fit",items:[this.formPanel],listeners:{},buttons:[{text:lang("save"),id:a,iconCls:"icon-btn-save",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){this.addEditWindow.close()}.createDelegate(this)}]});this.addEditWindow.show();if(f.type=="edit"){}}};CNOA_user_attendance_agentClass=CNOA.Class.create();CNOA_user_attendance_agentClass.prototype={init:function(){var b=this;this.baseUrl="index.php?app=user&func=attendance&action=agent";var a=new CNOA_user_attendance_agent_Class();this.panel=new Ext.Panel({region:"center",layout:"fit",border:false,items:[a.mainPanel]});this.treeRoot=new Ext.tree.AsyncTreeNode({text:"公司人员",expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getUsersTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){this.deptTree.expandAll();this.deptTree.getEl().unmask()}.createDelegate(this)}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(g){var c=g.attributes;var e=c.uid;var d=c.text;if(e!=undefined){var f=new CNOA_user_attendance_agent_Class();b.panel.removeAll(true);b.panel.add(f.show(e,d));b.panel.doLayout()}}}});this.deptPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:180,minWidth:150,maxWidth:300,border:false,bodyStyle:"border-right-width:1px;",items:[this.deptTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(c,d){b.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("collapse"),iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(c,d){if(d){c.setIconClass("icon-expand-all");c.setText(lang("expand"));c.setTooltip(lang("expandMenuTip"));b.treeRoot.collapse(true);b.treeRoot.firstChild.expand()}else{c.setIconClass("icon-collapse-all");c.setText(lang("collapse"));c.setTooltip(lang("collapseMenuTip"));b.treeRoot.expand(true)}}}]})});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.panel]})}};var CNOA_user_attendance_checktime,CNOA_user_attendance_checktimeClass;CNOA_user_attendance_checktimeClass=CNOA.Class.create();CNOA_user_attendance_checktimeClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=attendance&action=checktime";this.type="add";this.edit_id=0;this.toolbarTip=Ext.id();this.checktimeFields={id:0,onbeforetime:0,onaftertime:0,offbeforetime:0,offaftertime:0};this.fields=[{name:"num"},{name:"check"},{name:"time"},{name:"explain"},{name:"type"},{name:"time"},{name:"recTime"},{name:"operation"},{name:"checked"},{name:"recType"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getChecktime",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(e,f,b){var d=e.reader.jsonData;a.checktimeFields={id:d.id,onbeforetime:d.onbeforetime,onaftertime:d.onaftertime,offbeforetime:d.offbeforetime,offaftertime:d.offaftertime};var c='<div style="font-size: 15px; margin: 15px 0 0 15px; color: #EE3333;">规定时间之前 <b>'+a.checktimeFields.onbeforetime+"</b> 分钟到之后 <b>"+a.checktimeFields.onaftertime+"</b> 分钟这段时间可进行上班登记，规定时间之前 <b>"+a.checktimeFields.offbeforetime+"</b> 分钟到之后 <b>"+a.checktimeFields.offaftertime+"</b> 分钟这段时间可进行下班登记</div>";Ext.getCmp(a.toolbarTip).getEl().update(c)},exception:function(h,g,i,f,d,c){var e=d.responseText;if(e!=""){var b=Ext.decode(e);if(b.failure){CNOA.msg.alert(b.msg)}}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"num",dataIndex:"num",hidden:true},{header:"登记次序",dataIndex:"num",width:130,sortable:false,menuDisabled:true,renderer:a.numTip.createDelegate(this)},{header:"登记类型",dataIndex:"num",width:130,sortable:false,menuDisabled:true,renderer:a.checktimeType.createDelegate(this)},{header:"规定时间",dataIndex:"time",width:130,sortable:false,menuDisabled:true},{header:"登记时间",dataIndex:"num",width:130,sortable:false,menuDisabled:true,renderer:a.recordtime.createDelegate(this)},{header:lang("opt"),dataIndex:"num",width:150,sortable:false,menuDisabled:true,renderer:a.operation.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){}}});this.noticePanel=new Ext.Toolbar({region:"north",height:60,border:false,style:"border-bottom-width:1px;",items:[{xtype:"box",id:a.toolbarTip,autoEl:{tag:"div"}}]});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,layout:"fit",region:"center",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,bbar:this.pagingBar});this.mainPanel=new Ext.form.FormPanel({border:false,layout:"border",title:"",items:[this.noticePanel,a.grid],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){this.store.reload()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:3004}]})})},checktimeType:function(f,a,c,e,h,g){var d=this;var b=c.data;var i=b.type==0?"上班":"下班";return i},numTip:function(a){return"第"+a+"次登记"},recordtime:function(f,a,c,e,h,g){var d=this;var i="";var b=c.data;i=b.recTime+" ";switch(b.recType){case 1:i+="迟到";break;case 2:i+="早退";break}if(b.recTime==""){i="未登记"}return i},operation:function(o,q,c,i,n,f){var p=this;var t=c.data;var b=t.recTime;var g=t.checked;var d=t.type==0?"上班":"下班";var k='<a href="javascript:void(0);" class="gridview" onclick="CNOA_user_attendance_checktime.doExplain('+o+');">说明情况</a>';var m="";var e=new Date();e.setTime(differentMillisec+e.getTime());var a=e.getFullYear()+"/"+parseInt(e.getMonth()+1)+"/"+e.getDate();var l=Date.parse(a+" "+t.time);var h=Date.parse(new Date());if(b==""){if(g){m='<a href="javascript:void(0);" class="gridview" onclick="CNOA_user_attendance_checktime.doRecord('+o+');">'+d+"登记</a>"}else{m="不在登记时间段";if(t.type==0){if(h>l){m=k}}else{if(h>l){m=k}}}}else{if(t.type==0){if(h>l){m=k}}}var r=c.json;var j=r.recExplain;if(j!=""){j=j.replace(/\n/g,"<BR>");m='<span ext:qtip="'+j+'">已说明情况</span>'}return m},doRecord:function(c){var e=this;var d=e.checktimeFields.id;var a=c;var b=e.mainPanel.getForm();if(b.isValid()){b.submit({url:e.baseUrl+"&task=addChecktime",method:"POST",params:{cid:d,num:a},success:function(f,g){CNOA.msg.notice(g.result.msg,"个人管理");e.store.reload()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}else{CNOA.miniMsg.alertShowAt(ID_btn_save,lang("formValid"))}},doExplain:function(i){var d=this;var f=d.checktimeFields.id;var h=i;var b=d.store.reader.jsonData.data[i-1];var a=Ext.id();var e=d.baseUrl+"&task=editChecktimeExplain";var g=function(j){var k=d.formPanel.getForm();if(k.isValid()){k.submit({url:e,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{cnum:h,cid:f},success:function(l,m){d.addEditWindow.close();d.store.reload()},failure:function(l,m){CNOA.msg.alert(m.result.msg)}})}else{CNOA.miniMsg.alertShowAt(a,lang("formValid"))}};var c=function(){var j=d.formPanel.getForm().findField("explain");j.setValue(b.recExplain)};this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:10,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"label",text:"请说明有关情况（如迟到或早退原因）："},{xtype:"textarea",width:330,height:160,maxLength:255,name:"explain",style:"margin: 20px 0 0 0;"}]});this.addEditWindow=new Ext.Window({width:400,height:300,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:"说明情况",layout:"fit",items:[this.formPanel],listeners:{},buttons:[{text:lang("save"),id:a,iconCls:"icon-btn-save",handler:function(){g()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){d.addEditWindow.close()}}]});this.addEditWindow.show();c()}};var CNOA_user_attendance_egression,CNOA_user_attendance_egressionClass;CNOA_user_attendance_egressionClass=CNOA.Class.create();CNOA_user_attendance_egressionClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=attendance&action=egression";this.type="add";this.edit_id=0;this.toolbarTip=Ext.id();this.statusFields={status:-1};this.fields=[{name:"id"},{name:"uid"},{name:"vid"},{name:"stime"},{name:"etime"},{name:"otime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"verifier"},{name:"oreason"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEgressionList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(c,d,b){}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:"check",dataIndex:"uid",hidden:true},{header:"申请时间",dataIndex:"posttime",width:111,sortable:false,menuDisabled:true,renderer:a.renPosttime.createDelegate(this)},{header:"状态",dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:a.egressionStatus.createDelegate(this)},{header:"审批人",dataIndex:"verifier",width:111,sortable:false,menuDisabled:true},{header:"外出原因",dataIndex:"reason",width:330,sortable:false,menuDisabled:true,renderer:a.egressReason.createDelegate(this)},{header:lang("startTime"),dataIndex:"stime",width:111,sortable:false,menuDisabled:true,renderer:a.renStartTime.createDelegate(this)},{header:lang("endTime"),dataIndex:"etime",width:111,sortable:false,menuDisabled:true,renderer:a.renEndTime.createDelegate(this)},{header:lang("opt"),dataIndex:"num",width:150,sortable:false,menuDisabled:true,renderer:a.operation.createDelegate(this)},{header:"实际归来时间",dataIndex:"otime",width:111,sortable:false,menuDisabled:true,renderer:a.renStartTime.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false,hidden:true}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){c.status=a.statusFields.status}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,layout:"fit",region:"center",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,bbar:this.pagingBar,listeners:{rowclick:function(b,d,c){},rowdblclick:function(b,f,d){var c=a.store.reader.jsonData.data[f];if(c.status==0||c.status==2){a.type="edit";a.edit_id=c.id;a.doExplain()}},cellclick:function(c,f,b,d){if(b==9){}}}});this.mainPanel=new Ext.form.FormPanel({border:false,layout:"border",title:"",items:[a.grid],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{text:"外出登记",iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){a.type="add";a.doExplain()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){a.deleteList(b)}},{xtype:"label"},"状态：",{xtype:"combo",editable:false,valueField:"statusValue",displayField:"statusDisplay",triggerAction:"all",mode:"local",editable:false,width:160,store:new Ext.data.SimpleStore({fields:["statusValue","statusDisplay"],data:[[-1,"所有"],[0,"待批"],[1,"已批准"],[2,"不批准"],[3,"归来审核"],[4,"已归来"]]}),name:"cbStatus",hiddenName:"cbStatus",allowBlank:false,value:-1,listeners:{select:function(d,b,c){a.statusFields.status=c-1;a.store.load({params:{status:c-1}})}}},"<span class='cnoa_color_gray'>双击可查看/修改信息，按住ctrl或shift键可选择多个</span>","->",{xtype:"cnoa_helpBtn",helpid:3005}]})});a.statusFields.status=-1},renEndTime:function(f,b,a,g,d,c){var e="";e='<span style="color:#115544">'+f+"</span>";return e},renStartTime:function(f,b,a,g,d,c){var e="";e='<span style="color:#115544">'+f+"</span>";return e},renPosttime:function(f,b,a,g,d,c){var e="";e='<span style="color:#116677">'+f+"</span>";return e},egressReason:function(e,a,c,d,g,f){var b=c.data;var i="";i='<span style="color:#555">'+e+"</span>";if((parseInt(b.status)==2||parseInt(b.status)==7||parseInt(b.status)||8)&&b.oreason!=""){var h="未准原因："+b.oreason;h=h.replace(/\n/g,"<BR>");i+='<div style="color:#DD6666;" ext:qtip="'+h+'">'+h+"</div>"}return i},egressionStatus:function(g,b,a,h,d,c){var f=a.data;var e="";switch(parseInt(f.status)){case 0:e='<label style="color:#668833;">待批</label>';break;case 1:e='<label style="color:#228822">已批准</label>';break;case 2:e='<label style="color:#EE2222">不批准</label>';break;case 3:e='<label style="color:#567812">归来审核</label>';break;case 4:e='<label style="color:#2222AA">已归来</label>';break;case 5:e='<label style="color:#2288AA">注销申请</label>';break;case 6:e='<label style="color:#8822AA">已注销</label>';break;case 7:e='<label style="color:#6666AA">注销申请不通过</label>';break;case 8:e='<label style="color:#2299AA">归来审核不通过</label>';break}return e},operation:function(g,b,a,h,d,c){var f=a.data;var e="";if(f.status==0||f.status==2){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_egression.doModify('+f.id+')">修改</a>';e+='<a href="javascript:void(0);" class="gridview2 jianju" onclick="CNOA_user_attendance_egression.doDelete('+f.id+')" >删除</a>'}else{if(f.status==1){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_egression.doUpdateStatus('+f.id+', 1)">外出归来</a>';e+='<a href="javascript:void(0);"  class="gridview jianju"onclick="CNOA_user_attendance_egression.doUpdateStatus('+f.id+', 2)">申请注销</a>'}}return e},doModify:function(b){var a=this;a.type="edit";a.edit_id=b;a.doExplain()},doUpdateStatus:function(c,a){var b=this;CNOA.msg.cf("您确定要提交吗？",function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=updateEgression",method:"POST",params:{id:c,status:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice(e.msg,"个人管理");CNOA_user_attendance_egression.store.reload()}else{CNOA.msg.alert(e.msg)}}})}})},doDelete:function(b){var a=this;CNOA.msg.cf("是否确定要删除?",function(c){if(c=="yes"){a.deleteData(b+",")}})},deleteList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否确定要删除?",function(f){if(f=="yes"){if(b){var g="";var h="";var d=0;for(var e=0;e<b.length;e++){h=b[e];id=parseInt(h.get("id"));d=parseInt(h.get("status"));if(d==0||d==2){g+=id+","}else{CNOA.msg.alert("申请时间为 <span style='color:red'>"+h.get("posttime")+"</span> 的登记,已经批准不能删除，请重新操作");return}}c.deleteData(g)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delEgression",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},doExplain:function(c){var f=this;var a=Ext.id();var d="";if(f.type=="add"){f.edit_id=0;d=f.baseUrl+"&task=addEgression"}else{d=f.baseUrl+"&task=editEgression"}var b=function(g){var h=f.formPanel.getForm();if(h.isValid()){h.submit({url:d,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:f.edit_id},success:function(i,j){f.store.reload();f.addEditWindow.close()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}else{CNOA.miniMsg.alertShowAt(a,lang("formValid"))}};var e=function(g){f.formPanel.getForm().load({url:f.baseUrl+"&task=getEgression",params:{id:f.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(h,i){},failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){});f.addEditWindow.close()}})};this.verifierStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getVerifier",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"uid"},{name:"truename"}]}),listeners:{exception:function(g){}}});f.verifierStore.load();this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:60,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"combo",fieldLabel:"审批人",editable:false,valueField:"uid",displayField:"truename",triggerAction:"all",mode:"local",editable:false,store:f.verifierStore,name:"verifier",hiddenName:"verifier",allowBlank:false,listeners:{focus:function(){try{var g=f.verifierStore.reader.jsonData;if(g.failure==true){CNOA.msg.alert(g.msg)}}catch(h){}}}},{xtype:"panel",layout:"table",fieldLabel:"外出时间",items:[{xtype:"label",text:" 日期 ",width:30},{xtype:"datefield",width:123,format:"Y-m-d",allowBlank:false,name:"date",minValue:new Date()},{xtype:"label",text:" 由 ",width:30},{xtype:"timefield",width:80,format:"H:i",increment:15,allowBlank:false,name:"stime"},{xtype:"label",text:" 到 ",width:30},{xtype:"timefield",width:80,format:"H:i",increment:15,allowBlank:false,name:"etime"}]},{xtype:"textarea",fieldLabel:"外出原因",width:380,height:160,name:"reason",allowBlank:false}]});this.addEditWindow=new Ext.Window({width:500,height:330,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:"外出登记",layout:"fit",items:[this.formPanel],listeners:{},buttons:[{text:lang("save"),id:a,iconCls:"icon-btn-save",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){f.addEditWindow.close()}}]});f.addEditWindow.show();if(f.type=="edit"){e()}}};var CNOA_user_attendance_evection,CNOA_user_attendance_evectionClass;CNOA_user_attendance_evectionClass=CNOA.Class.create();CNOA_user_attendance_evectionClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=user&func=attendance&action=evection";this.statusFields={status:-1};fields=[{name:"id"},{name:"uid"},{name:"vid"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"verifier"},{name:"oreason"},{name:"address"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEvectionList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),a=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),c,{header:"num",dataIndex:"id",hidden:true},{header:"check",dataIndex:"uid",hidden:true},{header:"状态",dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:d.renStatus},{header:"申请时间",dataIndex:"posttime",width:121,sortable:false,menuDisabled:true,renderer:d.renPosttime},{header:"审批人",dataIndex:"verifier",width:150,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:121,sortable:false,menuDisabled:true,renderer:d.renStartTime},{header:lang("endTime"),dataIndex:"etime",width:121,sortable:false,menuDisabled:true,renderer:d.renEndTime},{header:"出差地点",dataIndex:"address",width:100,sortable:false,menuDisabled:true},{header:"外出原因",dataIndex:"reason",width:230,sortable:false,menuDisabled:true,renderer:d.renReason},{header:lang("opt"),dataIndex:"num",width:150,sortable:false,menuDisabled:true,renderer:d.operation},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false,hidden:true}]);var b=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(e,f){f.status=d.statusFields.status}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:a,sm:c,hideBorders:true,bbar:b,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){d.store.reload()}},{text:"出差登记",iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){d.editApply()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(h){var k=d.grid.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(h,lang("mustSelectOneRow"))}else{var j=[],f;for(var g=0,e=k.length;g<e;g++){f=parseInt(k[g].get("status"));if(f==0||f==2){j.push(parseInt(k[g].get("id")))}else{CNOA.msg.alert("申请时间为 <span style='color:red'>"+k[g].get("posttime")+"</span> 的登记,已经批准不能删除，请重新操作");return}}d.deleteApply(j.join(","))}}},{xtype:"label"},"状态：",{xtype:"combo",editable:false,valueField:"statusValue",displayField:"statusDisplay",triggerAction:"all",mode:"local",editable:false,width:160,store:new Ext.data.SimpleStore({fields:["statusValue","statusDisplay"],data:[[-1,"所有"],[0,"待批"],[1,"已批准"],[2,"不批准"],[3,"归来审核"],[4,"已归来"]]}),name:"cbStatus",hiddenName:"cbStatus",allowBlank:false,value:-1,listeners:{select:function(g,e,f){d.statusFields.status=f-1;d.store.load({params:{status:f-1}})}}},"<span class='cnoa_color_gray'>双击可查看/修改信息，按住ctrl或shift键可选择多个</span>","->",{xtype:"cnoa_helpBtn",helpid:3006}]}),listeners:{rowdblclick:function(f,i,h){var g=d.store.reader.jsonData.data[i];if(g.status==0||g.status==2){d.editApply(g.id)}}}});this.mainPanel=this.grid;d.statusFields.status=-1},renEndTime:function(a){return'<span style="color:#999; font-weight:bold;">'+a+"</span>"},renStartTime:function(a){return'<span style="color:#999; font-weight:bold;">'+a+"</span>"},renPosttime:function(a){return'<span style="color:#999; font-weight:bold;">'+a+"</span>"},renReason:function(e,a,c,d,g,f){var b=c.data;var i="";i='<span style="color:#555">'+e+"</span>";if((parseInt(b.status)==2||parseInt(b.status)==7||parseInt(b.status)||8)&&b.oreason!=""){var h="未准原因："+b.oreason;h=h.replace(/\n/g,"<BR>");i+='<div style="color:#DD6666;" ext:qtip="'+h+'">'+h+"</div>"}return i},renStatus:function(g,b,a,h,d,c){var f=a.data;var e="";switch(parseInt(f.status)){case 0:e='<label style="color:#668833;">待批</label>';break;case 1:e='<label style="color:#228822">已批准</label>';break;case 2:e='<label style="color:#EE2222">不批准</label>';break;case 3:e='<label style="color:#567812">归来审核</label>';break;case 4:e='<label style="color:#2222AA">已归来</label>';break;case 5:e='<label style="color:#2288AA">注销申请</label>';break;case 6:e='<label style="color:#8822AA">已注销</label>';break;case 7:e='<label style="color:#6666AA">注销申请不通过</label>';break;case 8:e='<label style="color:#2299AA">归来审核不通过</label>';break}return e},operation:function(g,b,a,h,d,c){var f=a.data;var e="";if(f.status==0||f.status==2){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_evection.editApply('+f.id+')">修改</a>';e+='<a href="javascript:void(0);" class="gridview2 jianju" onclick="CNOA_user_attendance_evection.deleteApply('+f.id+')" >删除</a>'}else{if(f.status==1){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_evection.doUpdateStatus('+f.id+', 3)">出差归来</a>';e+='<a href="javascript:void(0);" class="gridview jianju" onclick="CNOA_user_attendance_evection.doUpdateStatus('+f.id+', 5)">申请注销</a>'}}return e},doUpdateStatus:function(c,a){var b=this;CNOA.msg.cf("您确定要提交吗？",function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=updateEvection",method:"POST",params:{id:c,status:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice(e.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(e.msg)}}})}})},deleteApply:function(a){var b=this;CNOA.msg.cf("是否确定要删除?",function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=delEvection",method:"POST",params:{ids:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},editApply:function(g){var c=this,g=parseInt(g),e={};if(g){e.id=g}var d=function(){var h=a.getForm();if(h.isValid()){h.submit({url:c.baseUrl+"&task=editEvection",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:e,success:function(i,j){c.store.reload();b.close()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};var f=function(){a.getForm().load({url:c.baseUrl+"&task=getEvection",params:{id:g},method:"POST",waitMsg:lang("waiting"),failure:function(h,i){CNOA.msg.alert(i.result.msg);b.close()}})};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"selectorform",fieldLabel:"审批人",name:"verifier",hiddenName:"vid",selectorType:"user",dataUrl:this.baseUrl+"&task=getVerifier"},{xtype:"panel",layout:"table",fieldLabel:"出差时间",items:[{xtype:"datetimefield",width:160,allowBlank:false,name:"stime",format:"Y-m-d H:i",minValue:new Date()},{xtype:"label",text:"到 ",width:30},{xtype:"datetimefield",width:138,allowBlank:false,name:"etime",format:"Y-m-d H:i",minValue:new Date()}]},{xtype:"textfield",fieldLabel:"出差地点",width:330,allowBlank:false,name:"address"},{xtype:"textarea",fieldLabel:"出差事由",width:350,height:160,name:"reason",allowBlank:false}]});var b=new Ext.Window({width:500,height:390,modal:true,resizable:false,title:"出差登记",layout:"fit",items:[a],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}}]});b.show();if(g){f()}}};var CNOA_user_attendance_leave,CNOA_user_attendance_leaveClass;CNOA_user_attendance_leaveClass=CNOA.Class.create();CNOA_user_attendance_leaveClass.prototype={init:function(){var g=this;this.baseUrl="index.php?app=user&func=attendance&action=leave";this.statusFields={status:-1};fields=[{name:"id"},{name:"uid"},{name:"vid"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"verifier"},{name:"oreason"},{name:"otime"},{name:"leaveDay"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLeaveList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),d=function(h){return'<span style="color:#288209; font-weight:bold;">'+h+"</span>"},c=function(h){return'<span style="color:#999; font-weight:bold;">'+h+"</span>"},a=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"num",dataIndex:"id",hidden:true},{header:"check",dataIndex:"uid",hidden:true},{header:"申请时间",dataIndex:"posttime",width:121,renderer:c},{header:"状态",dataIndex:"status",width:100,renderer:g.renStatus},{header:lang("startTime"),dataIndex:"stime",width:121,renderer:c},{header:lang("endTime"),dataIndex:"etime",width:121,renderer:c},{header:"审批人",dataIndex:"verifier",width:150},{header:"请假原因",dataIndex:"reason",width:230,renderer:g.renReason},{header:"销假时间",dataIndex:"otime",width:121,renderer:d},{header:lang("opt"),dataIndex:"num",width:150,renderer:g.operation}]});var e=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(h,i){i.status=g.statusFields.status}}});var b=Ext.id();this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:a,sm:f,hideBorders:true,bbar:e,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.store.reload()}},{text:"请假登记",id:b,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){g.editApply()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(l){var n=g.grid.getSelectionModel().getSelections();if(n.length==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{var m=[],j;for(var k=0,h=n.length;k<h;k++){j=parseInt(n[k].get("status"));if(j==0||j==2){m.push(parseInt(n[k].get("id")))}else{CNOA.msg.alert("申请时间为 <span style='color:red'>"+n[k].get("posttime")+"</span> 的登记,已经批准不能删除，请重新操作");return}}g.deleteApply(m.join(","))}}},{xtype:"label"},"状态：",{xtype:"combo",editable:false,valueField:"statusValue",displayField:"statusDisplay",triggerAction:"all",mode:"local",editable:false,width:160,store:new Ext.data.SimpleStore({fields:["statusValue","statusDisplay"],data:[[-1,"所有"],[0,"待批"],[1,"已批准"],[2,"不批准"],[3,"申请销假"],[4,"已销假"]]}),name:"cbStatus",hiddenName:"cbStatus",allowBlank:false,value:-1,listeners:{select:function(j,h,i){g.statusFields.status=i-1;g.store.load({params:{status:i-1}})}}},"<span class='cnoa_color_gray'>双击可查看/修改信息，按住ctrl或shift键可选择多个</span>","->",{xtype:"cnoa_helpBtn",helpid:3007}]}),listeners:{rowdblclick:function(h,k,j){var i=g.store.reader.jsonData.data[k];if(i.status==0||i.status==2){g.editApply(i.id)}},render:function(){getFlowId4Engine("leave",function(i,h){Ext.getCmp(b).setHandler(function(){i()})})}}});this.mainPanel=this.grid;g.statusFields.status=-1},renReason:function(e,a,c,d,g,f){var b=c.data,i="";i='<span style="color:#555">'+e+"</span>";if((parseInt(b.status)==2||parseInt(b.status)==7||parseInt(b.status)||8)&&b.oreason!=""){var h="未准原因："+b.oreason;h=h.replace(/\n/g,"<BR>");i+='<div style="color:#DD6666;" ext:qtip="'+h+'">'+h+"</div>"}return i},renStatus:function(g,b,a,h,d,c){var f=a.data,e="";switch(parseInt(f.status)){case 0:e='<label style="color:#668833;">待批</label>';break;case 1:e='<label style="color:#228822">已批准</label>';break;case 2:e='<label style="color:#EE2222">不批准</label>';break;case 3:e='<label style="color:#334488">申请销假</label>';break;case 4:e='<label style="color:#2222bb">已销假</label>';break;case 5:e='<label style="color:#2288AA">注销申请</label>';break;case 6:e='<label style="color:#8822AA">已注销</label>';break;case 7:e='<label style="color:#6666AA">注销申请不通过</label>';break;case 8:e='<label style="color:#2299AA">销假审核不通过</label>';break}return e},operation:function(g,b,a,h,d,c){var f=a.data,e="";if(f.status==0||f.status==2){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_leave.editApply('+f.id+')">修改</a>';e+='<a href="javascript:void(0);" class="gridview2 jianju" onclick="CNOA_user_attendance_leave.deleteApply('+f.id+')" >删除</a>'}else{if(f.status==1){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_leave.doUpdateStatus('+f.id+', 3)">申请销假</a>';e+='<a href="javascript:void(0);" class="gridview jianju" onclick="CNOA_user_attendance_leave.doUpdateStatus('+f.id+', 5)">申请注销</a>'}}return e},doUpdateStatus:function(c,a){var b=this;CNOA.msg.cf("您确定要提交吗？",function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=updateLeave",method:"POST",params:{id:c,status:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice(e.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(e.msg)}}})}})},deleteApply:function(a){var b=this;CNOA.msg.cf("是否确定要删除?",function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=delLeave",method:"POST",params:{ids:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},editApply:function(g){var c=this,g=parseInt(g),e={};if(g){e.id=g}var d=function(h){var i=a.getForm();if(i.isValid()){i.submit({url:c.baseUrl+"&task=editLeave",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:g},success:function(j,k){c.store.reload();b.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var f=function(h){a.getForm().load({url:c.baseUrl+"&task=getLeave",params:{id:g},method:"POST",waitMsg:lang("waiting"),success:function(i,k){var l=a.getForm().findField("leaveDays").getValue();var j=Ext.getCmp("tip_leaveDay");j.setText("天，年休假剩余 "+l+" 天")},failure:function(i,j){CNOA.msg.alert(j.result.msg);b.close()}})};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"selectorform",fieldLabel:"审批人",name:"verifier",hiddenName:"vid",selectorType:"user",dataUrl:this.baseUrl+"&task=getVerifier"},{xtype:"panel",layout:"table",fieldLabel:"请假时间",items:[{xtype:"datetimefield",width:160,allowBlank:false,name:"stime",minValue:new Date},{xtype:"label",text:"到 ",width:30},{xtype:"datetimefield",width:160,allowBlank:false,name:"etime",minValue:new Date}]},{xtype:"panel",layout:"table",fieldLabel:"使用年休假",items:[{xtype:"textfield",width:160,name:"leaveDay",regex:/^[0-9]{1,4}(\.5)?$/,regexText:"必须小于366,半天以0.5表示"},{xtype:"hidden",name:"leaveDays"},{xtype:"label",width:140,id:"tip_leaveDay"}]},{xtype:"textarea",fieldLabel:"请假原因",width:350,height:160,name:"reason",allowBlank:false}]});var b=new Ext.Window({width:500,height:390,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:"请假登记",layout:"fit",items:a,buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){d()}},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){b.close()}}]});b.show();f()}};var CNOA_user_attendance_overtime,CNOA_user_attendance_overtimeClass;CNOA_user_attendance_overtimeClass=CNOA.Class.create();CNOA_user_attendance_overtimeClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=attendance&action=overtime";this.type="add";this.edit_id=0;this.toolbarTip=Ext.id();this.statusFields={status:-1};this.fields=[{name:"id"},{name:"uid"},{name:"vid"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"verifier"},{name:"oreason"},{name:"hour"},{name:"minute"},{name:"oetime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getOvertimeList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(c,d,b){}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:"check",dataIndex:"uid",hidden:true},{header:"状态",dataIndex:"status",width:118,sortable:false,menuDisabled:true,renderer:a.renStatus.createDelegate(this)},{header:"申请时间",dataIndex:"posttime",width:111,sortable:false,menuDisabled:true,renderer:a.renPosttime.createDelegate(this)},{header:"审批人",dataIndex:"verifier",width:100,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:111,sortable:false,menuDisabled:true,renderer:a.renStartTime.createDelegate(this)},{header:"预计结束时间",dataIndex:"etime",width:111,sortable:false,menuDisabled:true,renderer:a.renEndTime.createDelegate(this)},{header:"加班原因",dataIndex:"reason",width:230,sortable:false,menuDisabled:true,renderer:a.renReason.createDelegate(this)},{header:"加班时长",dataIndex:"otime",width:100,sortable:false,menuDisabled:true,renderer:a.renTime.createDelegate(this)},{header:"实际结束时间",dataIndex:"oetime",width:111,sortable:false,menuDisabled:true,renderer:a.renEndTime.createDelegate(this)},{header:lang("opt"),dataIndex:"num",width:150,sortable:false,menuDisabled:true,renderer:a.operation.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false,hidden:true}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){c.status=a.statusFields.status}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,layout:"fit",region:"center",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,bbar:this.pagingBar,listeners:{rowclick:function(b,d,c){},rowdblclick:function(b,f,d){var c=a.store.reader.jsonData.data[f];if(c.status==0||c.status==2){a.type="edit";a.edit_id=c.id;a.doExplain()}},cellclick:function(c,f,b,d){if(b==9){}}}});this.mainPanel=new Ext.form.FormPanel({border:false,layout:"border",title:"",items:[a.grid],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{text:"加班登记",iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){a.type="add";a.doExplain()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){a.deleteList(b)}},{xtype:"label"},"状态：",{xtype:"combo",editable:false,valueField:"statusValue",displayField:"statusDisplay",triggerAction:"all",mode:"local",editable:false,width:160,store:new Ext.data.SimpleStore({fields:["statusValue","statusDisplay"],data:[[-1,"所有"],[0,"待批"],[1,"已批准"],[2,"不批准"]]}),name:"cbStatus",hiddenName:"cbStatus",allowBlank:false,value:-1,listeners:{select:function(d,b,c){a.statusFields.status=c-1;a.store.load({params:{status:c-1}})}}},"<span class='cnoa_color_gray'>双击可查看/修改信息，按住ctrl或shift键可选择多个</span>","->",{xtype:"cnoa_helpBtn",helpid:75}]})});a.statusFields.status=-1},renTime:function(g,b,a,h,d,c){var f=a.data;var e="";e=f.hour+"小时"+f.minute+"分钟";return e},renEndTime:function(f,b,a,g,d,c){var e="";e='<span style="color:#999; font-weight:bold;">'+f+"</span>";return e},renStartTime:function(f,b,a,g,d,c){var e="";e='<span style="color:#999; font-weight:bold;">'+f+"</span>";return e},renPosttime:function(f,b,a,g,d,c){var e="";e='<span style="color:#999; font-weight:bold;">'+f+"</span>";return e},renReason:function(e,a,c,d,g,f){var b=c.data;var i="";i='<span style="color:#555">'+e+"</span>";if((parseInt(b.status)==2||parseInt(b.status)==7||parseInt(b.status)||8)&&b.oreason!=""){var h="未准原因："+b.oreason;h=h.replace(/\n/g,"<BR>");i+='<div style="color:#DD6666;" ext:qtip="'+h+'">'+h+"</div>"}return i},renStatus:function(g,b,a,h,d,c){var f=a.data;var e="";switch(parseInt(f.status)){case 0:e='<label style="color:#668833;">待批</label>';break;case 1:e='<label style="color:#228822">已批准</label>';break;case 2:e='<label style="color:#EE2222">不批准</label>';break;case 3:e='<label style="color:#2222AA">加班结束审批</label>';break;case 4:e='<label style="color:#2222AA">加班结束</label>';break;case 5:e='<label style="color:#6622AA">申请注销</label>';break;case 6:e='<label style="color:#AA22AA">已注销</label>';break;case 7:e='<label style="color:#6666AA">注销申请不通过</label>';break;case 8:e='<label style="color:#2299AA">加班结束审核不通过</label>';break}return e},operation:function(g,b,a,h,d,c){var f=a.data;var e="";if(f.status==0||f.status==2){e+='<a href="javascript:void(0);" class="gridview4" onclick="CNOA_user_attendance_overtime.doModify('+f.id+')">修改</a>';e+='<a href="javascript:void(0);" class="gridview2 jianju" onclick="CNOA_user_attendance_overtime.doDelete('+f.id+')" >删除</a>'}else{if(f.status==1){e+='<a href="javascript:void(0);" class="gridview4 onclick="CNOA_user_attendance_overtime.doUpdateStatus('+f.id+', 1)">加班结束</a>';e+='<a href="javascript:void(0);" class="gridview jianju onclick="CNOA_user_attendance_overtime.doUpdateStatus('+f.id+', 2)">申请注销</a>'}else{if(f.status==3){}}}return e},doModify:function(b){var a=this;a.type="edit";a.edit_id=b;a.doExplain()},doUpdateStatus:function(c,a){var b=this;CNOA.msg.cf("您确定要提交吗？",function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=updateOvertime",method:"POST",params:{id:c,status:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice(e.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(e.msg)}}})}})},doDelete:function(b){var a=this;CNOA.msg.cf("是否确定要删除?",function(c){if(c=="yes"){a.deleteData(b+",")}})},deleteList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否确定要删除?",function(f){if(f=="yes"){if(b){var g="";var h="";var d=0;for(var e=0;e<b.length;e++){h=b[e];id=parseInt(h.get("id"));d=parseInt(h.get("status"));if(d==0||d==2){g+=id+","}else{CNOA.msg.alert("申请时间为 <span style='color:red'>"+h.get("posttime")+"</span> 的登记,已经批准不能删除，请重新操作");return}}c.deleteData(g)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delOvertime",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,"个人管理");b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},doExplain:function(c){var f=this;var a=Ext.id();var d="";if(f.type=="add"){f.edit_id=0;d=f.baseUrl+"&task=addOvertime"}else{d=f.baseUrl+"&task=editOvertime"}var b=function(g){var h=f.formPanel.getForm();if(h.isValid()){h.submit({url:d,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:f.edit_id},success:function(i,j){f.store.reload();f.addEditWindow.close()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}else{CNOA.miniMsg.alertShowAt(a,lang("formValid"))}};var e=function(g){f.formPanel.getForm().load({url:f.baseUrl+"&task=getOvertime",params:{id:f.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(h,i){},failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){});f.addEditWindow.close()}})};this.verifierStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getVerifier",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"uid"},{name:"truename"}]})});f.verifierStore.load();this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:90,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"combo",fieldLabel:"审批人",editable:false,valueField:"uid",displayField:"truename",triggerAction:"all",mode:"local",editable:false,store:f.verifierStore,name:"verifier",hiddenName:"verifier",allowBlank:false,listeners:{focus:function(){try{var g=f.verifierStore.reader.jsonData;if(g.failure==true){CNOA.msg.alert(g.msg)}}catch(h){}}}},{xtype:"datetimefield",width:170,allowBlank:false,name:"stime",format:"Y-m-d H:i",minValue:new Date(),fieldLabel:"加班开始时间"},{xtype:"datetimefield",width:170,allowBlank:false,name:"etime",format:"Y-m-d H:i",fieldLabel:"预计加班结束时间",minValue:new Date()},{xtype:"textarea",fieldLabel:"加班原因",width:360,height:160,name:"reason",allowBlank:false}]});this.addEditWindow=new Ext.Window({width:500,height:370,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:"加班登记",layout:"fit",items:[this.formPanel],listeners:{},buttons:[{text:lang("save"),id:a,iconCls:"icon-btn-save",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){f.addEditWindow.close()}}]});f.addEditWindow.show();e()}};var CNOA_user_attendance_setting,CNOA_user_attendance_settingClass;CNOA_user_attendance_settingClass=CNOA.Class.create();CNOA_user_attendance_settingClass.prototype={init:function(){this.baseUrl="index.php?app=user&func=attendance&action=setting";this.mainPanel=this.getSettingPanel()},getSettingPanel:function(){var c=this;var a=[{xtype:"fieldset",title:"审批人设置",style:"margin: 10px;",items:[{xtype:"selectorform",fieldLabel:"审批人",name:"uname",hiddenName:"uids",width:300}]}];var d=function(e){var g=b.getForm();if(g.isValid()){g.submit({url:c.baseUrl+"&task=saveSetting",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),success:function(f,h){CNOA.msg.notice2(h.result.msg)},failure:function(f,h){CNOA.msg.alert(h.result.msg)}})}else{CNOA.miniMsg.alertShowAt(e,lang("formValid"))}};var b=new Ext.form.FormPanel({labelAlign:"right",labelWidth:110,items:a,border:false,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(e){d(e)}}]})});b.getForm().load({url:c.baseUrl+"&task=loadSetting",waitMsg:lang("loading")});return b}};var sm_user_attendance=1;
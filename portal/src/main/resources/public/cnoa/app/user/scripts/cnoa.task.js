var CNOA_user_task_child_addeditClass,CNOA_user_task_child_addedit;CNOA_user_task_child_addeditClass=CNOA.Class.create();CNOA_user_task_child_addeditClass.prototype={init:function(){var a=this;this.edit_id=CNOA.user.task_child.addedit.tid;this.loadCount=0;this.baseUrl="index.php?app=user&func=task&action=default";this.action="add";this.actionTitle=this.action=="add"?lang("addTask"):lang("editTask");this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_checkbox_needexamapp=Ext.id();this.ID_from_panel=Ext.id();this.ID_from_combobox=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});this.baseField=[{xtype:"fieldset",title:lang("taskBaseInfo"),anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{name:"title",fieldLabel:lang("taskTitle"),inputType:"text",allowBlank:false,maxLength:200,width:480,maxLengthText:lang("maxLengthText")+200},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"textfield",fieldLabel:lang("taskComeFrom"),name:"fromName",width:480,readOnly:true,value:"["+lang("parentTask")+":]"+CNOA_user_task_view.title}]},{xtype:"hidden",name:"from",value:"mothertask"},{xtype:"hidden",name:"fromid",value:CNOA.user.task_child.addedit.tid}]},{xtype:"datetimefield",name:"stime",minValue:new Date(),allowBlank:false,editable:false,fieldLabel:lang("addTime"),width:150,value:new Date().format("Y-m-d H:i:s")},{xtype:"textfield",name:"worktime1",fieldLabel:lang("workTimePG"),width:150},{xtype:"datetimefield",name:"etime",minValue:new Date(),allowBlank:false,editable:false,fieldLabel:lang("finishTime"),width:150},{xtype:"compositefield",fieldLabel:lang("approvalor"),items:[{xtype:"userselectorfield",disabled:true,width:250,name:"examappUid",multiSelect:false},{xtype:"checkbox",boxLabel:lang("xysprsp"),name:"needexamapp",id:this.ID_checkbox_needexamapp,style:"margin-left:5px;margin-top:3px;",listeners:{check:function(d,b){var c=a.formPanel.getForm().findField("examappUid");if(b){if(a.loadCount!==0||a.action!=="edit"){CNOA.msg.alert(lang("taskNeedSpNotice"))}c.allowBlank=false;c.validationEvent=true;c.clearInvalid();c.enable()}else{c.allowBlank=true;c.validationEvent=false;c.clearInvalid();c.disable();c.setValue("")}}}}]},{xtype:"userselectorfield",fieldLabel:lang("principal"),width:250,allowBlank:false,name:"execmanUid",multiSelect:false},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("participant"),emptyText:lang("pstp"),height:35,width:438,readOnly:true,name:"participant"}]},{xtype:"hidden",name:"participantUids"},{xtype:"btnForPoepleSelector",text:lang("select"),dataUrl:a.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:6px",listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("participant").setValue(f.join(","));a.formPanel.getForm().findField("participantUids").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("participantUids").getValue().split(","))}}}]},{xtype:"textarea",fieldLabel:lang("taskContent"),width:480,height:140,name:"content",value:""},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",inputPre:"filesUpload"},this.smsSender,{xtype:"textarea",fieldLabel:lang("jfbz"),width:480,height:80,name:"prizepunish",value:""},{xtype:"textarea",fieldLabel:lang("leaderInstruction"),width:480,height:80,name:"leadersay",value:""}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.baseField],listeners:{render:function(b){if(a.action=="edit"){a.loadFormData(b)}}}});this.addEditPanelTitle=new Ext.BoxComponent({autoEl:{tag:"div",html:"<span style='font-weight:bold;margin-right:20px;'>"+lang("task2")+" - "+this.actionTitle+"</span>"}});this.addEditPanel=new Ext.Panel({hideBorders:true,autoScroll:true,border:false,items:[this.formPanel],buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){a.submitForm()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.closeWindow()}.createDelegate(this)}]});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.addEditPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},closeWindow:function(){Ext.getCmp(CNOA.user.task_child.addedit.parentID).close()},submitForm:function(){var a=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:a.baseUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:a.action,tid:a.edit_id},success:function(b,c){try{a.smsSender.submit()}catch(d){}CNOA.msg.alert(c.result.msg+"",function(f){try{CNOA_user_task_view.refreshChildTaskList()}catch(g){}a.closeWindow()})},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}.createDelegate(this)})}}};var CNOA_user_task_discuss_viewClass,CNOA_user_task_discuss_view;CNOA_user_task_discuss_viewClass=CNOA.Class.create();CNOA_user_task_discuss_viewClass.prototype={init:function(){var a=this;this.ID_task_discuss_htmleditor=Ext.id();this.ttitle=CNOA.user.task.discuss_view.ttitle;this.tid=CNOA.user.task.discuss_view.tid;this.did=CNOA.user.task.discuss_view.did;this.baseUrl="index.php?app=user&func=task&action=default&tid="+this.tid+"&did="+this.did;this.tpl=new Ext.XTemplate('<div class="user_task_discuss_view">','  <div class="user_task_discuss_view_header">','    <div class="user_task_discuss_view_header_title">['+lang("discuss")+"]{title}</div>",'    <div class="user_task_discuss_view_header_from">'+lang("comeFrom")+": ["+lang("task")+"]{ttitle}</div>","  </div>",'  <tpl for="list">','  <div class="user_task_discuss_view_body">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_top">{user}[{dept}]</div>','      <div class="user_task_discuss_view_body_left_body">','        <span><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{user}</a>&nbsp;&nbsp;'+lang("postAt")+"&nbsp;{posttime}</div>",'      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>","  </tpl>",'  <div style="border:0px solid #FFF;margin:0 auto;margin-bottom:10px;margin-top:5px;width:680px;" id="CNOA_USER_TASK_DISSCUSS_VIEW_POST">',"  </div>","</div>");this.infoPanel=new Ext.Panel({border:false,listeners:{render:function(){a.readInfo()}}});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,items:[this.infoPanel],buttons:[{handler:function(b,c){a.readInfo()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.close()}.createDelegate(this)}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},readInfo:function(){var a=this;a.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:this.baseUrl+"&task=getDiscussInfo",method:"GET",success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){var c=b.data;c.ttitle=a.ttitle;a.tpl.overwrite(a.infoPanel.body,c);a.makePostPanel();a.centerPanel.getEl().unmask()}else{CNOA.msg.alert(b.msg,function(){a.close()})}}})},makePostPanel:function(){var a=this;this.postPanel=new Ext.Panel({border:false,renderTo:"CNOA_USER_TASK_DISSCUSS_VIEW_POST",items:[{xtype:"htmleditor",id:a.ID_task_discuss_htmleditor,width:680,name:"content",height:140},{xtype:"button",text:lang("publishPost"),cls:"cnoa-margin-top-5",handler:function(){a.postComment("comment")}}]})},close:function(){Ext.getCmp(CNOA.user.task.discuss_view.parentID).close()},postComment:function(){var b=this;var a=Ext.getCmp(b.ID_task_discuss_htmleditor);b.postPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:this.baseUrl+"&task=addDiscussComment",method:"POST",params:{content:a.getValue()},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice2(c.msg);b.readInfo();a.setValue("")}else{CNOA.msg.alert(c.msg)}b.postPanel.getEl().unmask()}})}};var CNOA_user_task_addeditClass,CNOA_user_task_addedit;CNOA_user_task_addeditClass=CNOA.Class.create();CNOA_user_task_addeditClass.prototype={init:function(){var e=this;this.edit_id=CNOA.user.task.addedit.tid;this.loadCount=0;this.baseUrl="index.php?app=user&func=task&action=default";this.action=CNOA.user.task.addedit.job;this.actionTitle=this.action=="add"?lang("addTask"):lang("editTask");this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_from_panel=Ext.id();this.ID_from_combobox=Ext.id();this.ID_from_panel2=Ext.id();this.ID_from_panel3=Ext.id();this.ID_from_combobox2=Ext.id();this.ID_from_combobox3=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var d=Ext.id();var b=Ext.id();this.approvalor1=new Ext.form.SelectorForm({fieldLabel:lang("approvalor"),hiddenName:"approveUid",name:"approveName",width:250,multiselect:false,readOnly:true,selectorType:"user",disabled:true});var c=new Ext.form.Checkbox({boxLabel:lang("xysprsp"),name:"needexamapp",style:"margin-left:5px;margin-top:3px;",listeners:{check:function(h,f){var g=e.formPanel.getForm().findField("approveName");if(f){if(e.loadCount==0&&e.action=="edit"){}else{CNOA.msg.alert(lang("taskNeedSpNotice"))}g.allowBlank=false;g.validationEvent=true;g.clearInvalid();g.enable()}else{g.allowBlank=true;g.validationEvent=false;g.clearInvalid();g.disable();g.setValue("")}}}});var a=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",editable:false,mode:"local",allowBlank:false,fieldLabel:lang("approvalor"),hiddenName:"examappUid",valueField:"examappUid",displayField:"examapp",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getApprovalor"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"examappUid"},{name:"examapp"}]})})});this.baseField=[{xtype:"fieldset",title:lang("taskBaseInfo"),anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{name:"title",fieldLabel:lang("taskTitle"),inputType:"text",allowBlank:false,maxLength:200,width:480,maxLengthText:lang("maxLengthText")+200},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("taskComeFrom"),name:"from",store:new Ext.data.SimpleStore({fields:["value","from"],data:[["task",lang("custom")],["plan",lang("deptPlan")],["mothertask",lang("parentTask")]]}),hiddenName:"from",valueField:"value",displayField:"from",mode:"local",allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,width:110,listeners:{select:function(i,f,g){var h=f.get("value");if(h=="task"){e.hideFromSelector()}if(h=="plan"){e.loadPlanSelector();e.hideFromPlan()}if(h=="mothertask"){e.loadMotherTaskSelector();e.hideFromMotherTask()}}}})]},{xtype:"panel",border:false,layout:"form",id:e.ID_from_panel,items:[]},{xtype:"panel",border:false,layout:"form",id:e.ID_from_panel2,items:[]}]},{xtype:"panel",border:false,layout:"form",id:e.ID_from_panel3,items:[]},{xtype:"textfield",name:"worktime1",fieldLabel:lang("workTimePG"),width:150},{xtype:"datetimefield",name:"stime",minValue:new Date(),allowBlank:false,editable:false,fieldLabel:lang("addTime"),width:150,value:new Date().format("Y-m-d H:i:s")},{xtype:"datetimefield",name:"etime",minValue:new Date(),allowBlank:false,editable:false,fieldLabel:lang("finishTime"),width:150},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",width:350,items:[{xtype:"hidden",listeners:{afterrender:function(){Ext.Ajax.request({url:e.baseUrl+"&task=getStatus",method:"POST",success:function(g){var h=Ext.decode(g.responseText);var f=h.data.status;if(f==1){a.setVisible(true);e.approvalor1.setVisible(false);c.setVisible(false)}else{a.setVisible(false);a.allowBlank=true;e.approvalor1.setVisible(true);c.setVisible(true)}}})}}},a,e.approvalor1]},c]},{xtype:"textfield",readOnly:true,width:250,allowBlank:false,fieldLabel:lang("principal"),emptyText:lang("pstpr"),blankText:lang("pstpr"),name:"execman",listeners:{render:function(f){f.to=d},focus:function(f){people_selector("user",f,false,false)}}},{xtype:"hidden",name:"execmanUid",id:d},{xtype:"textarea",fieldLabel:lang("participant"),emptyText:lang("pstp"),height:35,width:438,readOnly:true,name:"participant",listeners:{render:function(f){f.to=b},focus:function(f){people_selector("user",f,true,false)}}},{xtype:"hidden",name:"participantUids",id:b},{xtype:"textarea",fieldLabel:lang("taskContent"),width:480,height:140,name:"content",value:""},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",inputPre:"filesUpload"},this.smsSender,{xtype:"textarea",fieldLabel:lang("jfbz"),width:480,height:80,name:"prizepunish",value:""},{xtype:"textarea",fieldLabel:lang("leaderInstruction"),width:480,height:80,name:"leadersay",value:""}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.baseField],listeners:{render:function(f){if(e.action=="edit"){e.loadFormData(f)}}}});this.addEditPanelTitle=new Ext.BoxComponent({autoEl:{tag:"div",html:"<span style='font-weight:bold;margin-right:20px;'>"+lang("task2")+" - "+this.actionTitle+"</span>"}});this.addEditPanel=new Ext.Panel({hideBorders:true,autoScroll:true,border:false,items:[this.formPanel],tbar:new Ext.Toolbar({items:[this.addEditPanelTitle,{handler:function(f,g){e.goToList()}.createDelegate(this),iconCls:"icon-applications-stack",cls:"btn-yellow1",text:lang("backToList")},{text:lang("save"),id:this.ID_btn_save,cls:"btn-blue4",iconCls:"icon-btn-save",handler:function(){e.submitForm()}},{text:lang("reset"),iconCls:"icon-system-reset",hidden:e.action=="edit"?true:false,cls:"btn-red1",handler:function(){e.resetForm()}.createDelegate(this)},{text:lang("close"),cls:"btn-gray1",iconCls:"icon-dialog-cancel",handler:function(){e.closeTab()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:63}]})});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.addEditPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},hideFromSelector:function(){var d=this;var c=Ext.getCmp(d.ID_from_panel);c.removeAll();c.doLayout();var b=Ext.getCmp(d.ID_from_panel2);b.removeAll();b.doLayout();var a=Ext.getCmp(d.ID_from_panel3);a.removeAll();a.doLayout()},hideFromPlan:function(){var c=this;var b=Ext.getCmp(c.ID_from_panel2);b.removeAll();b.doLayout();var a=Ext.getCmp(c.ID_from_panel3);a.removeAll();a.doLayout()},hideFromMotherTask:function(){var c=this;var b=Ext.getCmp(c.ID_from_panel);b.removeAll();b.doLayout();var a=Ext.getCmp(c.ID_from_panel3);a.removeAll();a.doLayout()},hideFromProjectTask:function(){var c=this;var b=Ext.getCmp(c.ID_from_panel);b.removeAll();b.doLayout();var a=Ext.getCmp(c.ID_from_panel2);a.removeAll();a.doLayout()},loadPlanSelector:function(e){var d=this;var c=Ext.getCmp(d.ID_from_panel);var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=loadFromListForPlan&tid="+d.edit_id}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"value"},{name:"fromid"}]}),listeners:{load:function(f){if(e!=undefined){a.setValue(e)}}}});b.load();var a=new Ext.form.ComboBox({fieldLabel:lang("select"),name:"fromid",store:b,id:d.ID_form_combobox,hiddenName:"fromid",valueField:"value",displayField:"fromid",mode:"local",allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,width:275,allowBlank:false,listeners:{select:function(h,f,g){}}});c.removeAll();c.add(a);c.doLayout()},loadMotherTaskSelector:function(c){var e=this;var d=Ext.getCmp(e.ID_from_panel2);var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=loadFromListForMotherTask&tid="+e.edit_id}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"value"},{name:"fromid"}]}),listeners:{load:function(f){if(c!=undefined){a.setValue(c)}}}});b.load();var a=new Ext.form.ComboBox({fieldLabel:lang("select"),name:"fromid",store:b,id:e.ID_form_combobox2,hiddenName:"fromid",valueField:"value",displayField:"fromid",mode:"local",allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,width:275,allowBlank:false,listeners:{select:function(h,f,g){}}});d.removeAll();d.add(a);d.doLayout()},closeTab:function(){mainPanel.closeTab(CNOA.user.task.addedit.parentID.replace("docs-",""))},goToList:function(){mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=list","CNOA_MENU_USER_TASK_LIST",lang("taskList"),"icon-page-list")},goToTask:function(){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+this.edit_id,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},resetForm:function(){var a=this;a.formPanel.getForm().reset()},loadFormData:function(a){var b=this;this.formPanel.getForm().load({url:b.baseUrl,params:{task:"loadFormData",tid:b.edit_id},method:"POST",waitTitle:lang("notice"),success:function(c,d){b.loadCount++;if(d.result.data.from=="task"){b.hideFromSelector()}if(d.result.data.from=="plan"){b.loadPlanSelector(d.result.data.fromid)}if(d.result.data.from=="mothertask"){b.loadMotherTaskSelector(d.result.data.fromid)}if(d.result.data.from=="project"){b.loadProjectTaskSelector(d.result.data.fromid)}},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){})}})},submitForm:function(){var b=this,a=b.approvalor1.getValue();if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:b.baseUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:b.action,tid:b.edit_id,approveUid:a},success:function(c,d){try{b.smsSender.submit()}catch(f){}if(b.action=="add"){CNOA.msg.cf(d.result.msg+"<br>"+lang("whetherContinueAdd"),function(e){if(e=="yes"){b.resetForm()}else{b.closeTab();b.goToList()}})}if(b.action=="edit"){CNOA.msg.cf(d.result.msg+"<br /><br />"+lang("editTaskFinishNotice"),function(e){if(e=="yes"){b.goToTask()}else{b.goToList()}b.closeTab()})}},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})}}};var CNOA_user_task_listClass,CNOA_user_task_list;CNOA_user_task_listClass=CNOA.Class.create();CNOA_user_task_listClass.prototype={init:function(){var f=this;this.edit_id=0;this.content_start=1;this.baseUrl="index.php?app=user&func=task&action=default";this.action="add";this.actionTitle=this.action=="add"?lang("addPlan"):lang("editPlan");this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_plan_content=Ext.id();this.search={title:"",uid:0,execman:0,examapp:0,status:0};this.fields=[{name:"tid"},{name:"from"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData&goto=indexTask",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskTitle"),dataIndex:"title",width:140,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:70,sortable:true,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:50,sortable:false,menuDisabled:true},{header:lang("bzr"),dataIndex:"postter",width:50,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:60,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:60,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:80,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(g,h){if(f.search.title!=""){h.title=f.search.title}if(f.search.uid!=0&&f.search.uid!=""){h.uid=f.search.uid}if(f.search.execman!=0&&f.search.execman!=""){h.execman=f.search.execman}if(f.search.examapp!=0&&f.search.examapp!=""){h.examapp=f.search.examapp}}}});var d=Ext.id();var e=Ext.id();var a=Ext.id();var c=Ext.id();var b=Ext.id();this.searchBar=new Ext.Toolbar({items:[{handler:function(g,h){f.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(g,h){f.addTask()}.createDelegate(this),iconCls:"icon-system-s-task",cls:"btn-red1",text:lang("addTask")},{handler:function(g,h){f.openExportExcelWindow()}.createDelegate(this),iconCls:"icon-excel",cls:"btn-blue4",text:lang("export2")},"->",{xtype:"cnoa_helpBtn",helpid:64}]});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,layout:"fit",region:"center",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,viewConfig:{forceFit:true},listeners:{cellclick:function(h,k,i,j){var g=h.getStore().getAt(k);if(i==2){this.viewTask(g.data.tid)}}.createDelegate(this),render:function(){f.searchBar.render(this.tbar)}},tbar:new Ext.Toolbar({items:[lang("taskName")+":",{xtype:"textfield",id:e,width:128},"&nbsp;"+lang("status")+":",{xtype:"combo",width:100,id:b,mode:"local",store:new Ext.data.ArrayStore({fields:["sid","status"],data:[["1",lang("waitingForAccept")],["2",lang("pendingApproval")],["3",lang("approvalNotThrough")],["4",lang("rejectReceive")],["5",lang("inProgress")],["6",lang("submitApproval")],["7",lang("approved")],["8",lang("taskRecall")],["9",lang("failTask")]]}),displayField:"status",valueField:"sid",triggerAction:"all"},"&nbsp;"+lang("bzr")+":",{xtype:"hidden",id:a},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:a+"Tr",listeners:{selected:function(i,h,g){Ext.getCmp(a).setValue(h)}}},"&nbsp;"+lang("principal")+":",{xtype:"hidden",id:d},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:d+"Tr",listeners:{selected:function(i,h,g){Ext.getCmp(d).setValue(h)}}},"&nbsp;"+lang("approvalor")+":",{xtype:"hidden",id:c},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:c+"Tr",listeners:{selected:function(i,h,g){Ext.getCmp(c).setValue(h)}}},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){f.search.title=Ext.getCmp(e).getValue();f.search.uid=Ext.getCmp(a).getValue();f.search.execman=Ext.getCmp(d).getValue();f.search.examapp=Ext.getCmp(c).getValue();f.search.status=Ext.getCmp(b).getValue();f.store.load({params:{title:f.search.title,uid:f.search.uid,execman:f.search.execman,examapp:f.search.examapp,status:f.search.status}})}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){Ext.getCmp(e).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(a+"Tr").setValue("");Ext.getCmp(d+"Tr").setValue("");Ext.getCmp(c+"Tr").setValue("");Ext.getCmp(b).setValue("");f.store.load()}}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",items:[this.grid]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},openExportExcelWindow:function(){var d=this;var b=function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=exportExcel",waitMsg:lang("waiting"),params:{},method:"POST",success:function(e,f){c.close();d.openDownloadExcelWindow(f.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg,function(){})}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:110,items:[{xtype:"datefield",fieldLabel:lang("startTime"),width:150,format:"Y-m-d",editable:false,allowBlank:false,name:"stime"},{xtype:"datefield",fieldLabel:lang("endTime"),width:150,format:"Y-m-d",editable:false,allowBlank:false,name:"etime"},{xtype:"displayfield",hideLabel:true,value:lang("exportTaskNotice")}]});var c=new Ext.Window({width:320,height:160,title:lang("exportTaskNotice"),resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),iconCls:"icon-excel",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}.createDelegate(this)}]}).show()},openDownloadExcelWindow:function(a){var b=new Ext.Window({width:320,height:150,title:lang("downExcel"),resizable:false,modal:true,layout:"fit",bodyStyle:"padding:10px;background-color: #FFF;",html:lang("clickToDownload")+"：<br/>"+a,buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}.createDelegate(this)}]}).show()},makeStatus:function(j,g,d,h,f,b){var l=d.data;var k=l.status;var i="&nbsp;";var a=0;var c="#5B5B5B";i=l.statusText;a=l.progress;c=l.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+i+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},makeOperate:function(m,j,e,k,i,b){var o=e.data;var n=o.status;var a=false;var d=false;var g=false;var f=false;var l=false;a=o.eenable;d=o.denable;g=o.repealenable;f=o.urgeenable;l=o.failenable;var c=a?"<a href='javascript:void(0);' class='gridview4' onclick='CNOA_user_task_list.editTask("+o.tid+");'>"+lang("modify")+"</a>":"<span class='gridview5'>"+lang("modify")+"</span>";c+=d?"<a href='javascript:void(0);' class='gridview jianju' onclick='CNOA_user_task_list.deleteTask("+o.tid+", "+o.status+");'>"+lang("del")+"</a>":"<span class='gridview5 jianju'"+lang("del")+"</span>";c+=g?"<a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_user_task_list.repealTask("+o.tid+", "+o.status+");'>"+lang("recell")+"</a>":"<span class='gridview5 jianju'>"+lang("recell")+"</span>";c+="<a href='javascript:void(0);' class='gridview jianju' onclick='CNOA_user_task_list.viewTask("+o.tid+");'>"+lang("view")+"</a>";c+=f?"<a href='javascript:void(0);' class='gridview4 jianju' onclick='CNOA_user_task_list.urgeTask("+o.tid+", "+o.status+");'>"+lang("supervision")+"</a>":"<span class='gridview5 jianju'>"+lang("supervision")+"</span>";c+=f?"<a href='javascript:void(0);' class='gridview jianju' onclick='CNOA_user_task_list.delayTask("+o.tid+", "+o.status+', "'+o.etime+"\");'>"+lang("delay")+"</a>":"<span class='gridview5 jianju'>"+lang("delay")+"</span>";c+=l?"<a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_user_task_list.failTask("+o.tid+", "+o.status+");'>"+lang("fail")+"</a>":"<span class='gridview5 jianju'>"+lang("fail")+"</span>";return c},editTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_ADDEDIT");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=addedit&job=edit&tid="+a,"CNOA_MENU_USER_TASK_ADDEDIT",lang("editTask"))},deleteTask:function(b,a){var c=this;CNOA.msg.cf(lang("confirmToDelete"),function(d){if(d=="yes"){Ext.Ajax.request({url:c.baseUrl+"&task=operateTask&tid="+b,method:"POST",params:{tid:b,job:"delete",status:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice2(e.msg);c.store.reload()}else{CNOA.msg.alert(e.msg)}}})}})},repealTask:function(b,a){var c=this;CNOA.msg.cf(lang("confirmToRecell"),function(d){if(d=="yes"){c.makeMiniWindow(lang("recellTask"),lang("recellContent"),"repeal",b,a)}})},urgeTask:function(b,a){var c=this;CNOA.msg.cf(lang("confirmToDBTask"),function(d){if(d=="yes"){c.makeMiniWindow(lang("dbTask"),lang("dbContent"),"urge",b,a)}})},failTask:function(b,a){var c=this;CNOA.msg.cf(lang("confirmFailTask"),function(d){if(d=="yes"){c.makeMiniWindow(lang("failTask"),lang("failReason"),"fail",b,a)}})},delayTask:function(b,a,c){var d=this;CNOA.msg.cf(lang("confirmDelayTask"),function(e){if(e=="yes"){d.makeDelayWindow(lang("delay"),"delay",b,a,c)}})},makeMiniWindow:function(h,i,a,c,d){var e=this;var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",anchor:"-20 -20",name:"content",fieldLabel:i}]});var f=new Ext.Window({width:400,height:270,title:h,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){g();f.close()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var g=function(){var j=b.getForm().findField("content").getValue();Ext.Ajax.request({url:e.baseUrl+"&task=operateTask&tid="+c,method:"POST",params:{tid:c,job:a,status:d,content:j},success:function(l){var k=Ext.decode(l.responseText);if(k.success===true){CNOA.msg.notice2(k.msg);e.store.reload()}else{CNOA.msg.alert(k.msg)}}})}},makeDelayWindow:function(i,a,c,d,e){var f=this;var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"displayfield",fieldLabel:lang("oldEndTime"),value:e},{xtype:"datefield",name:"newtime",width:160,minValue:e,format:"Y-m-d",fieldLabel:lang("editTo")}]});var g=new Ext.Window({width:400,height:270,title:i,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){h();g.close()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}.createDelegate(this)}]}).show();var h=function(){var j=b.getForm().findField("newtime").getRawValue();Ext.Ajax.request({url:f.baseUrl+"&task=operateTask&tid="+c,method:"POST",params:{tid:c,job:a,status:d,newtime:j},success:function(l){var k=Ext.decode(l.responseText);if(k.success===true){CNOA.msg.notice2(k.msg);f.store.reload()}else{CNOA.msg.alert(k.msg)}}})}},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},addTask:function(){mainPanel.closeTab("CNOA_MENU_USER_TASK_ADDEDIT");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=addedit&job=add","CNOA_MENU_USER_TASK_ADDEDIT",lang("addTask"),"icon-page-addedit")}};var CNOA_user_task_settingClass,CNOA_user_task_setting;CNOA_user_task_settingClass=CNOA.Class.create();CNOA_user_task_settingClass.prototype={init:function(){var a=this;this.ID_man=Ext.id();this.hide_signInIDs=Ext.id();this.baseUrl="index.php?app=user&func=task&action=setting";this.mainPanel=new Ext.form.FormPanel({border:false,title:"设置",tbar:[{xtype:"button",text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",style:"margin: 0 0 0 10px",listeners:{click:function(b){a.submitForm()}}}],defaults:{xtype:"fieldset",autoWidth:true,style:"margin: 10px",autoHeight:true},items:[{title:"审批设置",items:[{xtype:"hidden",listeners:{beforerender:function(){a.formLoad()}}},{xtype:"radiogroup",fieldLabel:"是否需要设置审批",width:200,style:"padding: 0 0 0 20px",items:[{boxLabel:"是",name:"status",inputValue:1,listeners:{check:function(c,b){if(b){Ext.getCmp(a.ID_man).setVisible(true)}else{Ext.getCmp(a.ID_man).setVisible(false)}}}},{boxLabel:"否",inputValue:0,name:"status"}]}]},{title:"审批人员",id:this.ID_man,hidden:true,labelAlign:"right",items:[{xtype:"textarea",height:45,width:580,readOnly:true,fieldLabel:"审批人",name:"signInNames",emptyText:lang("clickSelectPerson"),style:{marginBottom:"3px"},listeners:{render:function(b){b.to=a.hide_signInIDs},focus:function(b){people_selector("user",b,true,false)}}},{xtype:"hidden",name:"signInIDs",id:this.hide_signInIDs}]}]})},formLoad:function(){var a=this;a.mainPanel.getForm().load({url:a.baseUrl+"&task=getStatus",method:"POST",success:function(b,c){if(c.result.data.status==1){Ext.getCmp(a.ID_man).setVisible(true)}},failure:function(b,c){if(c.result.data.status==0){Ext.getCmp(a.ID_man).setVisible(false)}}})},submitForm:function(){var a=this;if(a.mainPanel.getForm().isValid()){a.mainPanel.getForm().submit({url:a.baseUrl+"&task=approvalSetting",method:"POST",success:function(b,c){CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})}}};CNOA_user_task_viewClass=CNOA.Class.create();CNOA_user_task_viewClass.prototype={init:function(){var a=this;this.tid=CNOA.user.task.view.tid;this.status=CNOA.user.task.view.status;this.from=CNOA.user.task.view.from;this.title="";this.etime="";if(CNOA.user.task.view.type=="total"){this.baseUrl="index.php?app=user&func=task&action=total&tid="+this.tid+"&status="+this.status}else{this.baseUrl="index.php?app=user&func=task&action=default&tid="+this.tid+"&status="+this.status}this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_btn_repeal=Ext.id();this.ID_btn_complete=Ext.id();this.ID_btn_accept=Ext.id();this.ID_btn_reject=Ext.id();this.ID_btn_agree=Ext.id();this.ID_btn_disagree=Ext.id();this.ID_btn_finish=Ext.id();this.ID_btn_nofinish=Ext.id();this.ID_btn_viewedurge=Ext.id();this.ID_btn_fail=Ext.id();this.ID_btn_report_window_report=Ext.id();this.dataSource=null;this.tab_event_loadCount=0;this.tab_discuss_loadCount=0;this.tab_document_loadCount=0;this.tplTitle=new Ext.XTemplate('<div style="width:770px;margin-bottom:5px;height:40px;background-color:#FEFBDC;font-size:16px;font-weight:bold;line-height:40px; text-align: center;">['+lang("task")+"]{title}","</div>",'<div style="width:768px;height:auto;padding-bottom:3px;border:1px solid #F6C4AB;margin-top:5px;margin-bottom:5px;background-color:#FFF1CC;font-size:16px;display:{showTip}">','	<div style="font-size:12px;padding:5px;">',"	{tip}","	</div>",'	<div style="padding-left:5px;" id="CNOA_task_view_btn_job">',"	</div>",'	<div class="clear"></div>',"</div>");this.tplBody=new Ext.XTemplate('<div style="margin-bottom:5px;margin-top:1px;width:770px;">','	<div style="display:none;" id="CNOA_task_view_btn_operate_Ct"><div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("optArea")+"</span></div>",'	<div style="background-color:#EFF5FF;height:22px;padding:5px;" id="CNOA_task_view_btn_operate">',"	</div>",'	<div class="clear"></div></div>','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("baseInfo2")+"</span></div>",'	<div style="background-color:#EFF5FF;padding-bottom:5px;">','		<ul class="user_task_view_ul">','			<li><span class="first">'+lang("nowStatus")+': </span><span class="second" style="color:{statusColor};">{statusText}</span></li>','			<li><span class="first">'+lang("taskAddTime")+': </span><span class="second">{posttime}</span></li>',"			<li>&nbsp;</li>",'			<li><span class="first">'+lang("taskStartTime")+': </span><span class="second">{stime}</span></li>','			<li><span class="first">'+lang("taskAddEndTime")+': </span><span class="second">{etime}</span></li>','			<li><span class="first">'+lang("taskRatings")+': </span><span class="second">{point}</span></li>','			<li><span class="first">'+lang("sjStartTime")+': </span><span class="second">{sttime}</span></li>','			<li><span class="first">'+lang("sjwcsj")+': </span><span class="second">{entime}</span></li>','			<li><span class="first">'+lang("taskProgress")+': </span><span class="second" style="text-align:left;"><div style="width:100px;height:5px;background-color:#D4D4D4;float:left;margin-top:10px;"><div style="font-size:0;line-height:0;height:5px;width:{progress}px;background-color:{statusColor};"></div></div><span style="font-family:\'Arial\';font-size:9px;line-heigth:9px;height:9px;color:#7C7C7C;">&nbsp;{progress}%</span></span></li>','			<li><span class="first">'+lang("bzr")+': </span><span class="second"><a>{postter}</a></span></li>','			<li><span class="first">'+lang("principal")+': </span><span class="second"><a>{execman}</a></span></li>','			<li><span class="first">'+lang("approvalor")+': </span><span class="second"><a>{examapp}</a></span></li>','			<li><span class="first">'+lang("participant")+': </span><span class="second">{participant}</span></li>','			<li><span class="first">'+lang("workTimePG")+': </span><span class="second">{worktime1}</span></li>','			<li><span class="first">'+lang("confirmGS")+': </span><span class="second">{worktime2}</span></li>',"		</ul>",'		<div class="clear"></div>',"	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("taskContent")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{content}","	</div>",'	<tpl if="attachCount &gt; 0">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("attach")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"		{attach}","	</div>","	</tpl>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("jfbz")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{prizepunish}","	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("leaderInstruction")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{leadersay}","	</div>","</div>");this.infoPanel=new Ext.Panel({border:false,listeners:{render:function(){a.readInfo()}}});this.infoPanelBody=new Ext.Panel({border:false,listeners:{render:function(){}}});this.fieldsEvent=[{name:"id"},{name:"type"},{name:"typename"},{name:"title"},{name:"content"},{name:"user"},{name:"posttime"}];this.storeEvent=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEventList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsEvent})});this.colModelEvent=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:20,sortable:true,menuDisabled:true,hidden:true},{header:lang("type"),dataIndex:"type",width:40,menuDisabled:true,sortable:true,renderer:a.renderEventType.createDelegate(this)},{header:lang("eventTitle")+" / "+lang("content"),dataIndex:"content",width:574,menuDisabled:true,sortable:false,renderer:a.renderEventContent.createDelegate(this)},{header:lang("operator")+" / "+lang("time"),dataIndex:"other",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderEventOther.createDelegate(this)}]);this.gridEvent=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeEvent,loadMask:{msg:lang("waiting")},cm:this.colModelEvent,hideBorders:true,border:false,autoHeight:true,listeners:{cellclick:function(b,h,c,g){var d=b.getStore().getAt(h).data;if(d.content!=""){var f=new Ext.Window({title:lang("viewTaskEvent"),layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}});this.fields=[{name:"tid"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"}];this.storeChild=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData&goto=taskChild",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.storeChild.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskTitle"),dataIndex:"title",width:140,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:90,sortable:false,menuDisabled:true},{header:lang("bzr"),dataIndex:"postter",width:90,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:90,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:90,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:60,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.gridChild=new Ext.grid.GridPanel({store:this.storeChild,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,autoHeight:true,stripeRows:true,tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.refreshChildTaskList()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){if(a.from=="mothertask"){CNOA.msg.alert(lang("zTaskNoBZ"))}else{a.addTask()}}.createDelegate(this),iconCls:"icon-utils-s-add",cls:"btn-blue4",text:lang("bzZTask")}]})});this.fieldsDocument=[{name:"id"},{name:"tid"},{name:"attach"},{name:"content"},{name:"user"},{name:"posttime"},{name:"uid"}];this.storeDocument=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getDocumentList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsDocument})});this.colModelDocument=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},new Ext.grid.RowNumberer(),{header:lang("document"),dataIndex:"attach",id:"attach",width:250,menuDisabled:true,sortable:false},{header:lang("remark"),dataIndex:"content",width:250,menuDisabled:true,sortable:false,renderer:this.renderDocumentContent.createDelegate(this)},{header:lang("postter")+" / "+lang("time"),dataIndex:"",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderDocumentOther.createDelegate(this)},{header:lang("opt"),dataIndex:"id",width:60,sortable:false,resizable:false,menuDisabled:true,renderer:this.renderOpt.createDelegate(this)}]);this.gridDocument=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeDocument,loadMask:{msg:lang("waiting")},cm:this.colModelDocument,hideBorders:true,border:false,autoHeight:true,autoExpandColumn:"attach",listeners:{cellclick:function(b,h,c,g){if((c==3)||(c==4)){var d=b.getStore().getAt(h).data;if(d.content!=""){var f=new Ext.Window({title:lang("viewDetailDocument"),layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}},tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.storeDocument.load()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){a.showDocumentAddWindow()}.createDelegate(this),iconCls:"icon-file-up",cls:"btn-yellow1",text:lang("uploadDocument")}]})});this.tabItems=new Array();this.tabItems.push({xtype:"panel",title:lang("baseInfo"),autoHeight:true,items:[this.infoPanelBody],listeners:{}});this.tabItems.push({xtype:"panel",title:lang("taskEvent"),autoHeight:true,items:[this.gridEvent],listeners:{activate:function(){if(a.tab_event_loadCount<1){a.storeEvent.load()}a.tab_event_loadCount++}.createDelegate(this)}});if(a.from!="mothertask"){this.tabItems.push({xtype:"panel",title:lang("subtaskArea"),autoHeight:true,items:[this.gridChild],listeners:{activate:function(){if(a.tab_discuss_loadCount<1){a.storeChild.load()}a.tab_discuss_loadCount++}.createDelegate(this)}})}this.tabItems.push({xtype:"panel",title:lang("taskDocumentArea"),autoHeight:true,items:[this.gridDocument],listeners:{activate:function(){if(a.tab_document_loadCount<1){a.storeDocument.load()}a.tab_document_loadCount++}.createDelegate(this)}});this.tabPanel=new Ext.TabPanel({width:770,border:false,activeTab:0,autoHeight:true,bodyStyle:"margin-bottom:100px;",items:this.tabItems});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,bodyStyle:"padding:5px",items:[this.infoPanel,this.tabPanel],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("task2")+" - "+lang("viewTask")+"</span>",{handler:function(b,c){a.goToList()}.createDelegate(this),iconCls:"icon-system-reset",cls:"btn-gray1",text:lang("backToList")},{handler:function(b,c){a.reloadInfo()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("readStatus"),iconCls:"icon-flow-to-view",cls:"btn-blue4",handler:function(){a.getReaderPanel(a.tid)}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.closeTab()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:66}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeStatus:function(j,g,d,h,f,b){var l=d.data;var k=l.status;var i="&nbsp;";var a=0;var c="#5B5B5B";i=l.statusText;a=l.progress;c=l.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+i+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},makeOperate:function(m,j,e,k,i,b){var o=e.data;var n=o.status;var a=false;var d=false;var g=false;var f=false;var l=false;a=o.eenable;d=o.denable;g=o.repealenable;f=o.urgeenable;l=o.failenable;var c="<a href='javascript:void(0);' onclick='CNOA_user_task_view.viewTask("+o.tid+");'>"+lang("view")+"</a>";return c},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},addTask:function(){var b=this;var a=new Ext.Window({width:700,height:makeWindowHeight(550),title:"添加子任务",resizable:true,modal:true,layout:"fit",id:"CNOA_user_task_child_addedit",autoLoad:{url:"index.php?app=user&func=task&action=default&ajax=1&parentid=CNOA_user_task_child_addedit&task=loadPage&from=taskchild_add&tid="+b.tid,scripts:true,scope:this,nocache:true}}).show()},delDocument:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delDocument&id="+b,method:"GET",success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.storeDocument.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},refreshChildTaskList:function(){var a=this;a.storeChild.reload()},renderEventType:function(i,e,c,f,d,a){var j=c.data;var g="#00000";if(j.type==1){g="#FF0000"}else{if(j.type==2){g="#804040"}else{if(j.type==3){g="#FF8040"}else{if(j.type==4){g="#FF00FF"}else{if(j.type==5){g="#008000"}else{if(j.type==6){g="#408080"}else{if(j.type==7){g="#0080FF"}else{if(j.type==8){g="#8000FF"}else{if(j.type==9){g="#FF0000"}else{if(j.type==10){g="#2BB7D5"}else{if(j.type==11){g="#808080"}else{if(j.type==12){g="#0080C0"}}}}}}}}}}}}var b="<span style='color:#FFF;display:block;width:30px;height:16px;background-color:"+g+";text-indent:3px;'>"+j.typename+"</span>";return b},renderEventContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderEventOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDiscussContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderDiscussOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDocumentContent:function(g,f,c){var e=c.data;var b="";if(g!==""){var b="<br /><span style='color:#00006F'>("+lang("clickToView")+")</span>"}var d="<span style='color:#676767'>"+g.substr(0,150)+"</span>"+b;return d},renderOpt:function(f,e,c){var d=c.data;if(d.uid==CNOA_USER_UID){var b="<a href='javascript:void(0);' onclick='CNOA_user_task_view.delDocument("+f+");'>"+lang("del")+"</a>";return b}},renderDocumentOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},reloadInfo:function(){this.closeTab();mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+this.tid,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"))},readInfo:function(){var a=this;a.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:this.baseUrl+"&task=viewTask",method:"GET",params:{},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){var c=b.data;c.showTip=c.showTip?"block":"none";try{a.tplTitle.overwrite(a.infoPanel.body,c)}catch(f){}try{a.tplBody.overwrite(a.infoPanelBody.body,c)}catch(f){}a.dealJob(c);a.status=c.status;a.title=c.title;a.etime=c.etime;a.centerPanel.getEl().unmask();a.storeEvent.reload()}else{CNOA.msg.alert(b.msg,function(){a.closeTab()})}}})},goToList:function(){mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=list","CNOA_MENU_USER_TASK_LIST",lang("taskList"))},closeTab:function(){try{mainPanel.closeTab(CNOA.user.task.view.parentID.replace("docs-",""))}catch(a){}},dealJob:function(b){var e=this;var d="CNOA_task_view_btn_job";var c="CNOA_task_view_btn_operate";var a=0;if(b.eenable){a++;new Ext.Button({text:lang("editTask"),renderTo:c,handler:function(){e.editTask()}})}if(b.denable){a++;new Ext.Button({text:lang("delTask"),id:e.ID_btn_delete,renderTo:c,handler:function(){e.deleteTask()}})}if(b.renable){a++;new Ext.Button({text:lang("recellTask"),renderTo:c,id:e.ID_btn_repeal,handler:function(){e.repealTask()}})}if(b.uenable){a++;new Ext.Button({text:lang("dbTask"),renderTo:c,handler:function(){e.urgeTask()}})}if(b.uenable){a++;new Ext.Button({text:lang("delayTask"),renderTo:c,handler:function(){e.delayTask()}})}if(b.fenable){a++;new Ext.Button({text:lang("failTask"),renderTo:c,id:e.ID_btn_fail,handler:function(){e.failTask()}})}if(b.aenable){a++;new Ext.Button({text:lang("reportProgress"),renderTo:c,handler:function(){e.reportTask()}})}if(b.benable){a++;new Ext.Button({text:lang("finishTask"),renderTo:c,id:e.ID_btn_complete,handler:function(){e.completeTask()}})}if(b.uid==CNOA_USER_UID&&b.status!=7){a++;new Ext.Button({text:lang("editTheHead"),renderTo:c,handler:function(){e.principalTask(b.tid)}})}if(b.tipJob=="receive"){new Ext.Button({text:lang("receiveTask"),renderTo:d,id:e.ID_btn_accept,handler:function(){e.acceptTask()}});new Ext.Button({text:lang("rejectReceive"),renderTo:d,id:e.ID_btn_reject,handler:function(){e.rejectTask()}})}else{if(b.tipJob=="examapp"){new Ext.Button({text:lang("approvalAgree"),renderTo:d,id:e.ID_btn_agree,handler:function(){e.agreeTask()}});new Ext.Button({text:lang("disagree"),renderTo:d,id:e.ID_btn_disagree,handler:function(){e.disagreeTask()}})}else{if(b.tipJob=="check"){new Ext.Button({text:lang("agreeTaskComplete"),renderTo:d,id:e.ID_btn_finish,handler:function(){e.finishTask()}});new Ext.Button({text:lang("disagree"),renderTo:d,id:e.ID_btn_nofinish,handler:function(){e.nofinishTask()}})}else{if(b.tipJob=="viewedurge"){new Ext.Button({text:lang("gotIt"),renderTo:d,id:e.ID_btn_viewedurge,handler:function(){e.viewedurge()}})}}}}if(a>0){Ext.fly("CNOA_task_view_btn_operate_Ct").show()}},editTask:function(){mainPanel.closeTab("CNOA_MENU_USER_TASK_ADDEDIT");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=addedit&job=edit&tid="+this.tid,"CNOA_MENU_USER_TASK_ADDEDIT",lang("editTask"))},deleteTask:function(){var a=this;CNOA.msg.cf(lang("confirmDelTask"),function(b){if(b=="yes"){a.doAjax("delete",{},function(){a.closeTab()})}})},repealTask:function(){var a=this;CNOA.msg.cf(lang("confirmToRecell"),function(b){if(b=="yes"){a.makeMiniWindow(lang("recellTask"),lang("recellContent"),"repeal")}})},failTask:function(){var a=this;CNOA.msg.cf(lang("recellContent"),function(b){if(b=="yes"){a.makeMiniWindow(lang("failTask"),lang("failReason"),"fail")}})},reportTask:function(){var e=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,emptyText:"0-100",allowBlank:false,vtype:"num0_100",vtypeText:lang("only0to100"),fieldLabel:lang("taskProgress")+"(%)",name:"progress"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:lang("progressDes")},this.smsSender]});var d=new Ext.Window({width:400,height:300,id:c,title:lang("reportTaskProgress"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("report"),id:e.ID_btn_report_window_report,iconCls:"icon-order-s-accept",handler:function(){b()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}.createDelegate(this)}]}).show();var b=function(){if(a.getForm().isValid()){var h=a.getForm();var i=h.findField("progress").getValue();var j=h.findField("content").getValue();e.doAjax("report",{progress:i,content:j},function(){d.close()})}else{var g=Ext.getCmp(e.ID_btn_report_window_report).getEl().getBox();g=[g.x+35,g.y+26];CNOA.miniMsg.alert(lang("formValid"),g)}}},completeTask:function(){var a=this;CNOA.msg.cf(lang("confirmFinishTask"),function(b){if(b=="yes"){a.makeMiniWindow(lang("confirmFinishTask2"),lang("taskSummary"),"complete")}})},acceptTask:function(){var a=this;CNOA.msg.cf(lang("confirmReceiveTask"),function(b){if(b=="yes"){a.doAjax("accept")}})},rejectTask:function(){var a=this;CNOA.msg.cf(lang("confirmRejectTask"),function(b){if(b=="yes"){a.makeMiniWindow(lang("rejectTask"),lang("rejectReason"),"reject")}})},agreeTask:function(){var a=this;CNOA.msg.cf(lang("confirmAgreeSPTask"),function(b){if(b=="yes"){a.makeMiniWindowForAgree(lang("tyTaskZX"),lang("yjjy"),"agree")}})},disagreeTask:function(){var a=this;CNOA.msg.cf(lang("confirmDisagreeTaskSP"),function(b){if(b=="yes"){a.makeMiniWindow(lang("approvalTaskDisagree"),lang("dontAgreeReason"),"disagree")}})},finishTask:function(){var a=this;CNOA.msg.cf(lang("agreeTaskComplete2"),function(b){if(b=="yes"){a.makeMiniWindowForFinish(lang("agreeTaskComplete"),lang("taskOpinion"),"finish")}})},nofinishTask:function(){var a=this;CNOA.msg.cf(lang("confirmUngreeTaskComplete"),function(b){if(b=="yes"){a.makeMiniWindow(lang("dontAgree"),lang("dontAgreeReason"),"nofinish")}})},viewedurge:function(){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=operateTask",method:"POST",params:{tid:a.tid,job:"viewedurge",status:a.status},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){a.reloadInfo()}else{CNOA.msg.alert(b.msg)}}})},urgeTask:function(b,a){var c=this;CNOA.msg.cf(lang("confirmToDBTask"),function(d){if(d=="yes"){c.makeMiniWindow(lang("dbTask"),lang("dbContent"),"urge")}})},delayTask:function(){var a=this;CNOA.msg.cf(lang("confirmDelayTask"),function(b){if(b=="yes"){a.makeDelayWindow(lang("delayTask"),"delay",a.tid,a.status,a.etime)}})},makeDelayWindow:function(j,a,c,d,e){var h=this;var f=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"displayfield",fieldLabel:lang("oldEndTime"),value:e},{xtype:"datefield",name:"newtime",width:160,minValue:e,format:"Y-m-d",fieldLabel:lang("editTo")},this.smsSender]});var g=new Ext.Window({id:f,width:400,height:300,title:j,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){i()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}.createDelegate(this)}]}).show();var i=function(){var k=b.getForm().findField("newtime").getRawValue();if(b.getForm().isValid()){h.doAjax(a,{newtime:k},function(){g.close()})}}},doAjax:function(b,a,e){var d=this;var c;if(Ext.isObject(a)){c=a;c.tid=d.tid;c.job=b;c.status=d.status}else{c={tid:d.tid,job:b,status:d.status}}Ext.Ajax.request({url:this.baseUrl+"&task=operateTask",method:"POST",params:c,success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){try{d.smsSender.submit()}catch(h){}CNOA.msg.notice2(f.msg);try{e.call(this)}catch(h){}try{d.reloadInfo()}catch(h){}}else{CNOA.msg.alert(f.msg)}}})},makeMiniWindow:function(g,h,a,i){var d=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",height:147,width:280,name:"content",html:"",fieldLabel:h},this.smsSender]});var e=new Ext.Window({id:c,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){f()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}.createDelegate(this)}]}).show();var f=function(){var j=b.getForm().findField("content").getValue();if(b.getForm().isValid()){d.doAjax(a,{content:j},function(){e.close()})}}},makeMiniWindowForFinish:function(g,h,a,i){var d=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,emptyText:"0-100",allowBlank:false,vtype:"num0_100",vtypeText:lang("only0to100"),fieldLabel:lang("taskRatings"),name:"point"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:h},d.smsSender]});var e=new Ext.Window({id:c,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){f()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}.createDelegate(this)}]}).show();var f=function(){var k=b.getForm().findField("content").getValue();var j=b.getForm().findField("point").getValue();if(b.getForm().isValid()){d.doAjax(a,{content:k,point:j},function(){e.close()})}}},makeMiniWindowForAgree:function(g,c,e){var h=this;var b=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,fieldLabel:lang("confirmGS"),name:"worktime2"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:c},h.smsSender]});var f=new Ext.Window({id:b,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){d()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var d=function(){var j=a.getForm().findField("content").getValue();var i=a.getForm().findField("worktime2").getValue();if(a.getForm().isValid()){h.doAjax(e,{content:j,worktime2:i},function(){f.close()})}}},showDocumentAddWindow:function(){var e=this;var b=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:5px;",items:[{xtype:"flashfile",fieldLabel:lang("document"),name:"files",inputPre:"filesUpload"},{xtype:"textarea",width:290,height:100,name:"content",fieldLabel:lang("remark")},this.smsSender]});var d=new Ext.Window({id:b,width:400,height:270,title:lang("uploadDocument"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){c()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}.createDelegate(this)}]}).show();var c=function(){if(a.getForm().isValid()){a.getForm().submit({url:e.baseUrl+"&task=uploadDocument",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),success:function(f,g){try{e.smsSender.submit()}catch(h){}e.storeDocument.reload();CNOA.msg.notice2(g.result.msg);d.close()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}}},principalTask:function(f){var c=this;var b=new Ext.form.SelectorForm({fieldLabel:lang("choosePersonCharge"),hiddenName:"userid",multiselect:false,selectorType:"user",width:180});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:80,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:20px;",items:[b]});var e=new Ext.Window({width:300,height:150,title:lang("editTheHead"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show();var d=function(){var g=b.getValue();if(!g){CNOA.msg.alert(lang("pleaseChooseFZR"))}Ext.Ajax.request({url:c.baseUrl+"&task=editPrincipal",method:"POST",params:{uid:g,tid:f},success:function(i){var h=Ext.decode(i.responseText);if(h.success){CNOA.msg.alert(h.msg);c.reloadInfo();e.close()}else{CNOA.msg.alert(h.msg)}}})}},getReaderPanel:function(f){var d="index.php?app=user&func=task&action=default";var a=[{name:"name"},{name:"date"}];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d+"&task=getReaderList&tid="+f,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var c=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("name2"),dataIndex:"name",width:100,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"date",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var g=new Ext.grid.GridPanel({stripeRows:true,store:b,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:c,sm:h,stripeRows:true,hideBorders:true,border:false,viewConfig:{forceFit:true}});var e=new Ext.Window({layout:"fit",width:600,height:makeWindowHeight(500),title:lang("readStatus"),resizable:false,modal:true,items:[g],tbar:new Ext.Toolbar({items:[lang("redReaded"),lang("grayUnread")]}),buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]});e.show()}};var sm_user_task=1;
var CNOA_user_diary_statisticClass,CNOA_user_diary_statistic;CNOA_user_diary_statisticClass=CNOA.Class.create();CNOA_user_diary_statisticClass.prototype={init:function(){var g=this,b=edate=new Date().format("Y-m-d");this.baseUrl="index.php?app=user&func=diary&action=statistic";var a=[{name:"name"},{name:"num"}];this.store=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{beforeload:function(i,h){i.setBaseParam("sdate",b);i.setBaseParam("edate",edate)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("people"),dataIndex:"name",width:100,sortable:true,resizable:false,menuDisabled:true},{header:lang("diarys"),dataIndex:"num",width:80,sortable:true,resizable:false,menuDisabled:true}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("pagingToolbarDisplayMsg"),style:"border-left-width:1px;",store:this.store,pageSize:15});this.ID_period=Ext.id();this.grid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[{xtype:"box",id:this.ID_period,autoEl:{style:"font-weight:bold; color:#DD8800;",html:lang("tjddsj",new Date().format("Y-m-d"),new Date().format("Y-m-d"))}}]})});var d=Ext.id();var f=Ext.id();var c=Ext.id();var e=Ext.id();this.mainPanel=new Ext.Panel({border:false,layout:"fit",items:[this.grid],tbar:new Ext.Toolbar({items:[lang("tjfs")+"：",{xtype:"radiogroup",width:160,style:{marginRight:"20px"},items:[{boxLabel:lang("tian"),name:"mode",inputValue:1,checked:true},{boxLabel:lang("week"),name:"mode",inputValue:2},{boxLabel:lang("month"),name:"mode",inputValue:3},{boxLabel:lang("timeQuantum"),name:"mode",inputValue:4}],listeners:{change:function(k,j){var m=parseInt(j.getRawValue());var i=new Date(),l=i.getTime();switch(m){case 1:b=edate=i.format("Y-m-d");break;case 2:var h=i.getDay();b=new Date(l-h*86400000).format("Y-m-d");edate=new Date(l+(7-h)*86400000).format("Y-m-d");break;case 3:b=i.format("Y-m-"+1);edate=i.format("Y-m-"+i.format("t"));break}if(m==4){Ext.getCmp(d).setDisabled(false);Ext.getCmp(f).setDisabled(false);Ext.getCmp(c).setDisabled(false);Ext.getCmp(e).setDisabled(false)}else{Ext.getCmp(d).setDisabled(true);Ext.getCmp(f).setDisabled(true);Ext.getCmp(c).setDisabled(true);Ext.getCmp(e).setDisabled(true);g.reload(b,edate)}}}},{xtype:"container",id:d,disabled:true,layout:"column",defaults:{xtype:"datefield",format:"Y-m-d",editable:false,disabled:true,value:new Date().format("Y-m-d")},items:[{id:f},{xtype:"box",html:lang("to"),disabled:false,style:{margin:"5px"}},{id:c},{xtype:"button",text:lang("search"),cls:"btn-red1",id:e,handler:function(){b=Ext.getCmp(f).getRawValue();edate=Ext.getCmp(c).getRawValue();g.reload(b,edate)}}]}]}),bbar:this.pagingBar})},reload:function(a,b){Ext.getCmp(this.ID_period).getEl().update(lang("tjddsj",a,b));this.store.load({params:{sdate:a,edate:b}})}};var CNOA_user_diary_indexClass,CNOA_user_diary_index;CNOA_user_diary_indexClass=CNOA.Class.create();CNOA_user_diary_indexClass.prototype={init:function(){var c=this;this.ID_BTN_RETURN=Ext.id();this.ID_BTN_VIEWOVER=Ext.id();this.ID_openWidth=Ext.id();this.ID_currentUid=Ext.id();this.ID_year_text=Ext.id();this.ID_currentDate=Ext.id();this.date=new Date();this.todayIsMarkup=false;this.pageInit=false;this.nowYearMonth="";this.nowYearMonthDay="";this.doingCount=0;this.baseUrl="index.php?app=user&func=diary&action=index";this.tpl=new Ext.XTemplate('<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">'+lang("todayPlan")+":</div>",'  <div class="user_diary_body_right" style="margin-bottom:20px;">',"    <ul>",'     <tpl if="listCount &gt; 0">','     <tpl for="list">','		<tpl if="values.supplement !=1">',"			<li onmouseover=\"try{Ext.fly('user_diary_index_detail_plan_list_{id}').show();}catch(e){} this.style.backgroundColor='#FFF';\" onmouseout=\"try{Ext.fly('user_diary_index_detail_plan_list_{id}').hide();}catch(e){} this.style.backgroundColor='#F5F5F5';\">","		</tpl>",'		<tpl if="values.supplement !=1">','			<div class="user_diary_body_right_left"><span style="font-weight:bold;line-height:14px;">{[xindex]}.</span>&nbsp;&nbsp;&nbsp;<img {[this.makeIcon(values.done)]} style="margin-top:5px !important;margin-top:4px;" /></div>','			<div class="user_diary_body_right_mid">{[this.makeAlarm(values)]}&nbsp;&nbsp;{content}</div>','			<div class="user_diary_body_right_right">{plantime}</div>',"		</tpl>",'		<tpl if="values.done != 1 && values.supplement !=1">','			<div id="user_diary_index_detail_plan_list_{id}" style="width:100%;text-indent:26px;">{[this.makeFinish(values)]}&nbsp;&nbsp;<a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditPlanWindow(\'edit\', \'{id}\');">'+lang("modify")+'</a>&nbsp;&nbsp;<a href="javascript:void(0);" onclick="CNOA_user_diary_index.deletePlan(\'{id}\');">'+lang("del")+'</a>&nbsp;&nbsp;<a href="javascript:void(0);" onclick="CNOA_user_diary_index.delayPlan(\'{id}\');">'+lang("delayTo")+"</a></div>","		</tpl>",'      <div class="clear"></div>',"      </tpl>","      </tpl>","			</li>",'<tpl if="editable == true">','      <li style="width:580px;border-bottom:0px;">','        <a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditPlanWindow(\'add\');">['+lang("workContent")+"]</a>","      </li>","</tpl>","    </ul>","  </div>",'  <div class="clear"></div>',"</div>","",'<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("workSummary")+":</div>",'  <div class="user_diary_body_right">',"    {summary}",'<tpl if="editable == true">',"<tpl if=\"summary == ''\">",'<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditSummaryWindow(\'add\');">['+lang("addSummary")+"]</a></div>","</tpl>","<tpl if=\"summary != ''\">",'<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditSummaryWindow(\'edit\', \'{did}\');">'+lang("editSummary")+"</a></div>","</tpl>","</tpl>","  &nbsp;</div>",'  <div class="clear"></div>',"</div>","",'<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">'+lang("attach")+":</div>",'  <div class="user_diary_body_right">',"	{attach}",'	<tpl if="editable == true">',"		<tpl if=\"attachCount == ''\">",'			<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditAttachWindow(\'add\');">['+lang("addAttach")+"]</a></div>","		</tpl>","		<tpl if=\"attachCount != ''\">",'			<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditAttachWindow(\'edit\', \'{did}\');">'+lang("editAttach")+"</a></div>","		</tpl>","	</tpl>","  </div>",'  <div class="clear"></div>','  <img src="'+Ext.BLANK_IMAGE_URL+'" />',"</div>",'<tpl if="editable != true">','<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("workSummaryComplement")+":</div>",'  <div class="user_diary_body_right">',"    {summarycomplement}","<tpl if=\"summarycomplement == ''\">",'<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditSummaryComplement(\'add\');">['+lang("addSummary")+"]</a></div>","</tpl>","<tpl if=\"summarycomplement != ''\">",'<div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditSummaryComplement(\'edit\', \'{did}\');">'+lang("editSummary")+"</a></div>","</tpl>","  &nbsp;</div>",'  <div class="clear"></div>',"</div>","","</tpl>",'<tpl if="editable != true">','<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("diaryComplement")+":</div>",'  <div class="user_diary_body_right">',"    <ul>",'     <tpl for="additional">',"		<li onmouseover=\"try{Ext.fly('user_diary_index_detail_plan_list_{id}').show();}catch(e){} this.style.backgroundColor='#F5F5F5';\" onmouseout=\"try{Ext.fly('user_diary_index_detail_plan_list_{id}').hide();}catch(e){} this.style.backgroundColor='#FFF';\">",'			<div class="user_diary_body_right_left"><span style="font-weight:bold;line-height:14px;">{[xindex]}.</span>&nbsp;&nbsp;&nbsp;<img {[this.makeIcon(values.done)]} style="margin-top:5px !important;margin-top:4px;" /></div>','			<div class="user_diary_body_right_mid">{[this.makeAlarm(values)]}&nbsp;&nbsp;{content}</div>','			<div class="user_diary_body_right_right">{plantime}</div>','			<tpl if="values.done != 1">','				<div id="user_diary_index_detail_plan_list_{id}" style="width:100%;text-indent:26px;"><div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.planDoneDoing(\'{id}\')">'+lang("setComplete")+"</a>&nbsp;&nbsp;<a href=\"javascript:void(0);\" onclick=\"CNOA_user_diary_index.addEditPlanWindow('edit', '{id}', 'supplement');\">"+lang("editComplement")+"</a></div></div>","			</tpl>",'      	<div class="clear"></div>',"		</li>","     </tpl>",'	   <div style="width:700px;"><a href="javascript:void(0);" onclick="CNOA_user_diary_index.addEditPlanWindow(\'add\', 0, \'supplement\');">['+lang("addDiaryComplement")+"]</a></div>","    </ul>","  &nbsp;</div>",'  <div class="clear"></div>',"</div>","</tpl>",{makeIcon:function(d){if(d==1){return'src="./resources/images/cnoa/btn-job-done.gif" ext:qtip="'+lang("finished")+'"'}else{return'src="./resources/images/cnoa/btn-job-doing.gif" ext:qtip="'+lang("unfinished")+'"'}},makeAlarm:function(d){if(d.alarm==1){return'<img src="./resources/images/icons/alarm.png" ext:qtip="'+lang("noticeTime")+":"+d.alarmtime+'" />'}else{return""}},makeFinish:function(d){var e="";if(d.done==1){e='<a href="javascript:void(0);" onclick="CNOA_user_diary_index.planDoneDoing(\''+d.id+"');\">"+lang("setUnfinish")+"</a>"}else{e='<a href="javascript:void(0);" onclick="CNOA_user_diary_index.planDoneDoing(\''+d.id+"');\">"+lang("setComplete")+"</a>"}return e}});this.tplComment=new Ext.XTemplate('<div class="user_task_discuss_view" style="margin-left:5px;width:760px;margin-bottom:40px;">','  <div class="user_task_discuss_view_header" style="width:760px;height:24px;">','    <div class="user_task_discuss_view_header_title">'+lang("diaryOfLeader")+"</div>","  </div>",'  <tpl for="list">','  <div class="user_task_discuss_view_body" style="width:760px;">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_top">{user}[{dept}]</div>','      <div class="user_task_discuss_view_body_left_body">','        <span><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right" style="width:609px;">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{user}</a>&nbsp;&nbsp;'+lang("postAt")+"&nbsp;{posttime}</div>",'      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>","  </tpl>","</div>");this.calendarTip=new Ext.BoxComponent({id:this.ID_saveStatusBar,autoEl:{tag:"div",style:"",html:'<img src="./resources/images/cnoa/user_diary_datepicker_tip.gif">'}});this.calendar=new Ext.Calendar({style:"border:0;",format:"Y-m-d",autoHeight:true,listeners:{markupselected:function(e,d){c.todayIsMarkup=true},select:function(f,e){var d=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();if(c.todayIsMarkup){c.todayIsMarkup=false;c.getDiaryHave(d)}else{c.getDiaryEmpty(d)}},monthchange:function(f,e){var d=e.getFullYear()+"-"+(e.getMonth()+1);c.changeMonth(d)},afterrender:function(g){if(CNOA.user.diary.index.goDate!=""){var e=CNOA.user.diary.index.goDate;var h=/([0-9]{4,4})-([0-9]{1,2})-([0-9]{1,2})/g;if(h.test(e)){var d=e.split("-");var f=new Date(parseInt(d[0]),parseInt(d[1])-1,parseInt(d[2]));setTimeout(function(){g.goToDate(f)},500)}}}}});this.calendarPanel=new Ext.Panel({region:"west",layout:"fit",split:true,border:false,width:176,minWidth:176,maxWidth:176,bodyStyle:"border-right-width:1px;",items:[this.calendar,this.calendarTip],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){c.refreshMonthPanel()}.createDelegate(this),text:lang("refresh")},"->",lang("calendar")]})});var a='<div class="user_diary_header">';a+='  <span id="user_diary_index_btn_refreshtoday"></span>';a+='  <span id="user_diary_index_btn_preday"></span>';a+='  <span style="line-height:23px;" id="user_diary_index_todaytitle"></span>';a+='  <span id="user_diary_index_btn_nexday"></span>';a+='  <span id="user_diary_index_btn_today"></span>';a+='  <div class="clear"></div>';a+='  <img src="'+Ext.BLANK_IMAGE_URL+'" width="760" height="1" onload="CNOA_user_diary_index.initButtons();" />';a+="</div>";this.titlePanel=new Ext.Panel({border:false,region:"north",html:a});this.detailPanel=new Ext.Panel({bodyStyle:"width:774px;",border:false});this.commentPanel=new Ext.Panel({border:false,html:"<div style='margin:10px;'>"+lang("loading")+"</div>"});this.detailPanelCt=new Ext.Panel({autoScroll:true,region:"center",border:false,items:[this.detailPanel,this.commentPanel]});this.centerPanel=new Ext.Panel({region:"center",layout:"border",bodyStyle:"border-left-width:1px;overflow:auto;",items:[this.titlePanel,this.detailPanelCt]});this.viewPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.calendarPanel,this.centerPanel]});this.storeBar={uid:0,year:"",storeType:"nowyear"};this.fields=[{name:"did"},{name:"date"},{name:"user"},{name:"updatetime"},{name:"dateMonth"},{name:"content"},{name:"stime"},{name:"etime"},{name:"signtime"},{name:"number"},{name:"displaybtn"},{name:"signStatus"},{name:"formatStime"},{name:"additional"},{name:"signContent"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList"}),groupField:"dateMonth",sortInfo:{field:"dateMonth",direction:"ASC"},remoteSort:true,reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});var b=function(h,f,e){var i=this,g=e.data,d="";if(g.signStatus==1){d="<span style='color:gray'>"+lang("refreshCalendar")+"</span><br>"}else{d=""}d+="<a href='javascript:void(0)' onclick='CNOA_user_diary_index.viewDiary(\""+g.formatStime+"\");'>"+lang("enter")+"</a>";return d};this.colModel=new Ext.grid.ColumnModel([{header:"did",dataIndex:"did",width:20,sortable:true,hidden:true},{header:lang("month2"),dataIndex:"dateMonth",width:100,sortable:true},{header:lang("order2"),dataIndex:"number",width:50,sortable:true},{header:lang("date")+" / "+lang("people"),dataIndex:"date",width:170,sortable:true},{header:lang("content"),dataIndex:"content",width:349,sortable:true},{header:lang("jhwcsj"),dataIndex:"stime",width:100,sortable:true},{header:lang("sjwcsj"),dataIndex:"etime",width:100,sortable:true},{header:lang("receivedTime"),dataIndex:"signtime",width:100,sortable:true},{header:lang("receiveYJ"),dataIndex:"signContent",width:100,sortable:false},{header:lang("opt"),dataIndex:"",width:55,sortable:true,renderer:b}]);this.allDiaryCenterGrid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,autoScroll:true,viewConfig:{forceFit:true},listeners:{rowclick:function(e,f){var d=e.getStore().getAt(f)}},view:new Ext.grid.GroupingView({hideGroupedColumn:true,forceFit:true,groupTextTpl:'{text}--<span style="color:#9D9DFF">(共{[values.rs.length]}条)</span>'}),tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[new Ext.BoxComponent({id:this.ID_openWidth,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:lang("showAllDiary")}}),{xtype:"hidden",id:this.ID_currentUid},{text:lang("expandAll"),iconCls:"icon-roduction",enableToggle:false,pressed:true,toggleGroup:"btn_group",handler:function(){c.allDiaryCenterGrid.view.expandAllGroups()}},{text:lang("collapseAll"),iconCls:"icon-roduction",enableToggle:false,toggleGroup:"btn_group",handler:function(){c.allDiaryCenterGrid.view.collapseAllGroups()}},{xtype:"hidden",id:this.ID_year_text,value:new Date().getFullYear()},{text:"<< "+lang("prevYear"),enableToggle:true,allowDepress:false,toggleGroup:"diary_date",handler:function(){var d=Ext.getCmp(c.ID_currentUid).getValue();var e=parseInt(Ext.getCmp(c.ID_year_text).getValue())-1;c.storeBar.storeType="upyear";c.storeBar.year=e;c.storeBar.uid=d;c.store.load({params:c.storeBar});Ext.getCmp(c.ID_currentDate).getEl().update("<span style='color:red'>"+lang("currentYearIs",e)+"</span>");Ext.getCmp(c.ID_year_text).setValue(e)}},new Ext.BoxComponent({id:this.ID_currentDate,autoEl:{tag:"div",style:"color: #FF0000",html:lang("currentYearIs",new Date().getFullYear())}}),{text:lang("thisYear"),enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"diary_date",handler:function(){var d=Ext.getCmp(c.ID_currentUid).getValue();var e=parseInt(new Date().getFullYear());c.storeBar.storeType="nowyear";c.storeBar.year=e;c.storeBar.uid=d;c.store.load({params:c.storeBar});Ext.getCmp(c.ID_currentDate).getEl().update(lang("currentYearIs",e));Ext.getCmp(c.ID_year_text).setValue(e)}},{enableToggle:true,allowDepress:false,toggleGroup:"diary_date",text:lang("nextYear")+">>",handler:function(){var d=Ext.getCmp(c.ID_currentUid).getValue();var e=parseInt(Ext.getCmp(c.ID_year_text).getValue())+1;c.storeBar.storeType="downyear";c.storeBar.year=e;c.storeBar.uid=d;c.store.load({params:c.storeBar});Ext.getCmp(c.ID_currentDate).getEl().update(lang("currentYearIs",e));Ext.getCmp(c.ID_year_text).setValue(e)}},lang("content")+":",new Ext.ux.form.SearchField({store:c.store,allowBlank:false,width:110,onTrigger1Click:function(d){if(this.hasSearch){this.el.dom.value="";this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload();this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(f){var d=this.getRawValue();if(d.length<1){alert(lang("searchNotEmpty"));return}this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]=d;this.store.reload();this.hasSearch=true;this.triggers[0].show()}})]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"card",activeItem:0,autoScroll:false,items:[this.viewPanel,this.allDiaryCenterGrid],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){c.refreshPage()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("goBack"),iconCls:"icon-btn-arrow-left",id:this.ID_BTN_RETURN,hidden:true,handler:function(){Ext.getCmp(c.ID_BTN_VIEWOVER).show();this.hide();c.mainPanel.getLayout().setActiveItem(0)}},{text:lang("myAllDiary"),id:this.ID_BTN_VIEWOVER,cls:"btn-blue4",handler:function(){Ext.getCmp(c.ID_BTN_RETURN).show();this.hide();c.mainPanel.getLayout().setActiveItem(1);c.store.load()}},"->",{xtype:"cnoa_helpBtn",helpid:79}]})})},viewDiary:function(a){try{mainPanel.closeTab("CNOA_MENU_USER_DIARY_MY");mainPanel.loadClass("index.php?app=user&func=diary&action=index&goDate="+a,"CNOA_MENU_USER_DIARY_MY",lang("myDiary"),"icon-diary-my")}catch(b){}},additional:function(e,c,b){var f=this,a;var d=b.data;if(Ext.isEmpty(d.supplement)){a=e}else{a="<span style='color: red'>("+lang("diaryComplement")+":"+e+")"}return a},loadComment:function(){var b=this;var a={};Ext.Ajax.request({url:b.baseUrl+"&task=loadComment",method:"POST",params:{date:b.nowYearMonthDay},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){if(c.data.list.length<1){b.commentPanel.body.update("")}else{b.tplComment.overwrite(b.commentPanel.body,c.data)}}else{CNOA.msg.alert(c.msg,function(){})}}})},initButtons:function(){var a=this;new Ext.Button({renderTo:"user_diary_index_btn_refreshtoday",text:lang("refreshCurrentDay"),handler:function(){a.refreshDetailPanel()}});new Ext.Button({renderTo:"user_diary_index_btn_preday",text:"<< "+lang("prevDay"),handler:function(){a.calendar.showPrevDay()}});new Ext.Button({renderTo:"user_diary_index_btn_nexday",text:lang("nextDay")+" >>",handler:function(){a.calendar.showNextDay()}});new Ext.Button({renderTo:"user_diary_index_btn_today",text:lang("today"),handler:function(){a.calendar.selectToday()}})},changeMonth:function(a){var b=this;b.calendar.getEl().mask(lang("waiting"));b.calendar.setMarkup([]);b.nowYearMonth=a;Ext.Ajax.request({url:b.baseUrl+"&task=loadMonthList",method:"POST",params:{yearmonth:a},success:function(e){var c=Ext.decode(e.responseText);if(c.success===true){var d=c.data;b.calendar.setMarkup(d);if(!b.pageInit){b.pageInit=true;b.calendar.selectToday()}}else{CNOA.msg.alert(c.msg,function(){})}b.calendar.getEl().unmask()}})},getDiaryHave:function(a){this.showDetailPanel(a)},getDiaryEmpty:function(a){this.showDetailPanel(a)},showDetailPanel:function(a){var c=this;var b;c.nowYearMonthDay=a;c.loadComment();if(a==undefined){b={listCount:0,list:{}};c.doingCount=0;c.tpl.overwrite(c.detailPanel.body,b)}else{c.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:c.baseUrl+"&task=loadDiary",method:"POST",params:{date:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b=d.data;Ext.fly("user_diary_index_todaytitle").update(b.today);c.doingCount=0;Ext.each(b.list,function(f,g){if(f.done==0){c.doingCount++}})}else{CNOA.msg.alert(d.msg,function(){})}c.tpl.overwrite(c.detailPanel.body,b);c.centerPanel.getEl().unmask()}})}},refreshPage:function(){var a=CNOA.user.diary.index.parentID.replace("docs-","");mainPanel.closeTab(a);mainPanel.loadClass("index.php?app=user&func=diary&action=index",a,lang("myDiary"),"icon-page-list")},refreshMonthPanel:function(){this.changeMonth(this.nowYearMonth)},refreshDetailPanel:function(){this.showDetailPanel(this.nowYearMonthDay)},addEditPlanWindow:function(g,d,p){var m=this;var f=this.nowYearMonthDay;var b=f.split("-");if(b[1]<10){b[1]="0"+b[1]}if(b[2]<10){b[2]="0"+b[2]}f=b[0]+"-"+b[1]+"-"+b[2];var c=Ext.id();var j=Ext.id();var i=Ext.id();var o=Ext.id();var a=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",hidden:p=="supplement"?true:false,fieldLabel:lang("smsNotice")});var l=new Ext.form.SelectorForm({width:170,fieldLabel:lang("acceptor"),emptyText:lang("acceptorDefault"),hiddenName:"signUid",multiselect:false,selectorType:"user"});var h=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:85,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:10px;",listeners:{render:function(q){if(g=="edit"){q.load({url:m.baseUrl+"&task=loadPlanFormData",params:{id:d},method:"POST",waitMsg:lang("waiting"),success:function(r,s){var t=JSON.parse(s.response.responseText).data;l.hiddenField.setValue(t.signUid);l.setValue(t.signName)}.createDelegate(this),failure:function(r,s){CNOA.msg.alert(s.result.msg)}.createDelegate(this)})}}},items:[{xtype:"htmleditor",width:330,height:146,name:"content",allowBlank:false,fieldLabel:p=="supplement"?lang("diaryComplement"):lang("workContent"),enableFont:false,enableFontSize:false,enableColors:false,enableAlignments:false,enableLists:false,enableFormat:false,enableSourceEdit:false},{xtype:"compositefield",border:false,layout:"table",fieldLabel:lang("executionTime"),items:[{xtype:"datefield",format:"Y-m-d",id:i,width:100,editable:false,name:"plandate",value:f,minValue:(p=="supplement"||g=="edit")?null:new Date().add(Date.DAY,0)},{xtype:"timefield",format:"H:i",name:"plantime",editable:false,width:70,value:"09:00"}]},{xtype:"datefield",fieldLabel:lang("jhwcsj"),disabled:p=="supplement"?true:false,hidden:p=="supplement"?true:false,id:o,allowBlank:false,format:"Y-m-d",width:170,editable:false,name:"planetime"},l,{xtype:"checkbox",fieldLabel:lang("whetherToNotice"),hidden:p=="supplement"?true:false,name:"alarm",listeners:{check:function(r,q){if(q){Ext.getCmp(c).show()}else{Ext.getCmp(c).hide()}}}},{xtype:"datetimefield",fieldLabel:lang("noticeTime"),id:c,hidden:true,width:170,minValue:new Date(),name:"alarmtime"},this.smsSender]});var k=new Ext.Window({id:j,width:460,height:390,title:lang("addEditWork"),resizable:true,modal:true,layout:"fit",items:[h],buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){n()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){k.close()}.createDelegate(this)}]}).show();var e="";if(p=="supplement"){k.setTitle(lang("addEditDiary"));k.setHeight(320);e="addEditAdditional"}else{e="addEditPlan"}var n=function(){if(p!="supplement"){var s=Ext.getCmp(i).getValue();var r=Ext.getCmp(o).getValue();var q=l.getValue();if(s>r){CNOA.msg.alert(lang("planFTimeLessNotice"));return}}if(h.getForm().isValid()){h.getForm().submit({url:m.baseUrl+"&task="+e,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{job:g,id:d,date:m.nowYearMonthDay,signUid:q},success:function(t,u){try{m.smsSender.submit()}catch(v){}m.refreshMonthPanel();m.refreshDetailPanel();k.close()}.createDelegate(this),failure:function(t,u){CNOA.msg.alert(u.result.msg)}.createDelegate(this)})}}},planDoneDoing:function(b){var a=this;CNOA.msg.cf(lang("sureToFinish"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=planDoneDoing",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.refreshDetailPanel()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},deletePlan:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=deletePlan",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.refreshDetailPanel()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},delayPlan:function(e){var d=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,autoScroll:false,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:10px;",items:[{xtype:"datefield",width:160,format:"Y-m-d",minValue:new Date(+new Date()+24*3600000),name:"delaytime",allowBlank:false,fieldLabel:lang("delayTo")},{xtype:"radiogroup",fieldLabel:lang("delayType"),width:170,name:"delaytypeGroup",items:[{boxLabel:lang("jumpToDay"),name:"delaytype",inputValue:"1",checked:true},{boxLabel:lang("timeQuantum"),name:"delaytype",inputValue:"2"}]},{xtype:"checkbox",fieldLabel:lang("delSelf"),name:"deleteself"}]});var c=new Ext.Window({width:270,height:164,title:lang("deferredWorkPlan"),resizable:false,modal:true,autoScroll:false,layout:"fit",items:[a],buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}.createDelegate(this)}]}).show();var b=function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=delayPlan",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:e,date:d.nowYearMonthDay},success:function(f,g){d.refreshMonthPanel();d.refreshDetailPanel();c.close()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg,function(){c.close()}.createDelegate(this))}.createDelegate(this)})}}},addEditSummaryWindow:function(e,c){var g=this;var b=Ext.id();var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:10px;",listeners:{render:function(h){if(e=="edit"){h.load({url:g.baseUrl+"&task=loadSummaryFormData",params:{did:c},method:"POST",waitMsg:lang("waiting"),success:function(i,j){}.createDelegate(this),failure:function(i,j){CNOA.msg.alert(j.result.msg,function(){})}.createDelegate(this)})}}},items:[{xtype:"textarea",anchor:"-25 -25",name:"summary",allowBlank:false,fieldLabel:lang("summaryContent")}]});var f=new Ext.Window({width:440,height:310,title:lang("addEditSummary"),resizable:true,modal:true,layout:"fit",items:[a],tbar:new Ext.Toolbar({hidden:g.doingCount>0?false:true,items:lang("jtwwc",g.doingCount)}),buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){d()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var d=function(){if(a.getForm().isValid()){a.getForm().submit({url:g.baseUrl+"&task=addEditSummary",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{job:e,did:c,date:g.nowYearMonthDay},success:function(h,i){g.refreshMonthPanel();g.refreshDetailPanel();f.close()}.createDelegate(this),failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){f.close()}.createDelegate(this))}.createDelegate(this)})}}},addEditSummaryComplement:function(e,c){var g=this;var b=Ext.id();var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:10px;",listeners:{render:function(h){if(e=="edit"){h.load({url:g.baseUrl+"&task=loadSummaryFormData",params:{did:c},method:"POST",waitMsg:lang("waiting"),success:function(i,j){}.createDelegate(this),failure:function(i,j){CNOA.msg.alert(j.result.msg,function(){})}.createDelegate(this)})}}},items:[{xtype:"textarea",anchor:"-25 -25",name:"summarycomplement",allowBlank:false,fieldLabel:lang("summaryComplementContent")}]});var f=new Ext.Window({width:440,height:310,title:lang("addEditSummaryComplement"),resizable:true,modal:true,layout:"fit",items:[a],tbar:new Ext.Toolbar({hidden:g.doingCount>0?false:true,items:lang("jtwwc",g.doingCount)}),buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){d()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]}).show();var d=function(){if(a.getForm().isValid()){a.getForm().submit({url:g.baseUrl+"&task=addEditSummaryComplement",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{job:e,did:c,date:g.nowYearMonthDay},success:function(h,i){g.refreshMonthPanel();g.refreshDetailPanel();f.close()},failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){f.close()})}})}}},addEditAttachWindow:function(e,c){var g=this;var b=Ext.id();var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:10px;",listeners:{render:function(h){if(e=="edit"){h.load({url:g.baseUrl+"&task=loadAttachFormData",params:{did:c},method:"POST",waitMsg:lang("waiting"),success:function(i,j){}.createDelegate(this),failure:function(i,j){CNOA.msg.alert(j.result.msg,function(){})}.createDelegate(this)})}}},items:[{xtype:"flashfile",fieldLabel:lang("addAttach"),name:"files",style:"margin-top:5px;",inputPre:"filesUpload"}]});var f=new Ext.Window({width:440,height:310,title:lang("addEditDiaryAttach"),resizable:true,modal:true,layout:"fit",items:[a],buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){d()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var d=function(){if(a.getForm().isValid()){a.getForm().submit({url:g.baseUrl+"&task=addEditAttach",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{job:e,did:c,date:g.nowYearMonthDay},success:function(h,i){g.refreshMonthPanel();g.refreshDetailPanel();f.close()}.createDelegate(this),failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){f.close()}.createDelegate(this))}.createDelegate(this)})}}}};var sm_user_diary=1;
var cnoa_plan_user_plan_attach_btn="";function makeplanAttacBtn(g,e,d,f){var c=function(j,a){var i,l="none";var k=j.substring(j.lastIndexOf(".")+1).toLowerCase();switch(k){case"jpg":case"bmp":case"png":i="jpg.gif";l="pic";break;case"rar":case"zip":case"7z":i="rar.gif";break;case"txt":i="txt.gif";l="txt";break;case"xls":case"xlsx":i="excel.gif";l="xls";break;case"doc":case"docx":i="word.gif";l="doc";break;default:i="file.gif";break}if(a==true){return l}else{return'<img src="./resources/images/icons_file/'+i+'" width=16 height=16 align="absmiddle" >'+j+" ("+f+")"}};var b=Ext.fly(g);b.dom.innerHTML=c(d);var h=new Ext.menu.Menu({id:"menu_"+g,items:[{text:d,disabled:true},{xtype:"swfdownloadmenuitem",text:lang("download"),iconCls:"icon-file-down",dlurl:e,dlname:d},{text:lang("viewPreview"),hidden:(c(d,true)=="pic"||c(d,true)=="txt"||c(d,true)=="xls")?false:true,handler:function(){window.open("./resources/preview.php?url="+encodeURIComponent(e))}},{text:lang("edit"),pressed:false,hidden:true,handler:function(){window.open("./index.php?action=commonJob&act=viewDocForActivex&url="+encodeURIComponent(e))}}]});b.dom.onmouseover=function(a){try{Ext.getCmp(cnoa_plan_user_plan_attach_btn).hide();Ext.fly(cnoa_plan_user_plan_attach_btn.replace("menu_","")).dom.style.backgroundColor="#F2E6E6"}catch(j){}Ext.fly(g).dom.style.backgroundColor="#CEC1FF";if(Ext.isIE){i=[window.event.clientX,window.event.clientY]}else{var i=[a.clientX,a.clientY]}h.showAt(i);cnoa_plan_user_plan_attach_btn="menu_"+g}}function CNOA_USER_PLAN_TAB_CLOSE(a){var b="";switch(a){case"add":case"edit":b="CNOA_MENU_USER_PLAN_ADDEDIT";break;case"list_my":b="CNOA_MENU_USER_PLAN_LIST_MY";break;case"list_dept":b="CNOA_MENU_USER_PLAN_LIST_DEPT";break;case"workreport":b="CNOA_MENU_USER_PLAN_WORKREPORT";break;case"sum":b="CNOA_MENU_USER_PLAN_SUM";break;case"sharereport":b="CNOA_MENU_USER_PLAN_SHAREREPORT";break;case"view":b="CNOA_MENU_USER_PLAN_VIEW";break;case"task_add":b="CNOA_MENU_USER_TASK_ADDEDIT";break}mainPanel.closeTab(b)}function CNOA_USER_PLAN_TAB_OPEN(d,a,f){var g="";var b="";var e="";var c="";switch(d){case"add":g="CNOA_MENU_USER_PLAN_ADDEDIT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=addedit";e=lang("addPlan");c="icon-page-addedit";break;case"edit":g="CNOA_MENU_USER_PLAN_ADDEDIT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&job=edit&pid="+a;e=lang("editPlan");c="icon-page-addedit";break;case"list_my":g="CNOA_MENU_USER_PLAN_LIST_MY";b="index.php?app=user&func=plan&action=default&task=loadPage&from=myplan";e=lang("personPlan");c="icon-page-list";break;case"list_dept":g="CNOA_MENU_USER_PLAN_LIST_DEPT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=deptplan";e=lang("deptPlan");c="icon-page-list";break;case"workreport":g="CNOA_MENU_USER_PLAN_WORKREPORT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=workreport";e=lang("report");c="icon-page-list";break;case"sum":g="CNOA_MENU_USER_PLAN_SUM";b="index.php?app=user&func=plan&action=default&task=loadPage&from=sum";e=lang("summary");c="icon-page-list";break;case"sharereport":g="CNOA_MENU_USER_PLAN_SHAREREPORT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=sharereport";e=lang("shareReportPlan");c="icon-page-list";break;case"view":g="CNOA_MENU_USER_PLAN_VIEW";b="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+a;e=lang("viewPlan");c="icon-page-view";break;case"task_add":g="CNOA_MENU_USER_TASK_ADDEDIT";b="index.php?app=user&func=plan&action=default&task=loadPage&from=task_add&pid="+a;e=lang("addPlanTask");c="icon-page-addedit";break;default:return false;break}b=f==undefined?b:f;mainPanel.closeTab(g);mainPanel.loadClass(b,g,e,c)}function getPlanDate(b){var a=new Date();if(b!=undefined){a=new Date(b)}var h=a.getDay();var i=a.getDate();var d=a.getMonth();var e=a.getFullYear();e+=(e<2000)?1900:0;var f=new Date();if(b!=undefined){f=new Date(b)}f.setDate(1);f.setMonth(f.getMonth()+1);var g=f.getMonth();this.formatDate=function(j){var k=j.getFullYear();var m=j.getMonth()+1;var l=j.getDate();if(m<10){m="0"+m}if(l<10){l="0"+l}return(k+"-"+m+"-"+l)};function c(l){var j=new Date(e,l,1);var k=new Date(e,l+1,1);var m=(k-j)/(1000*60*60*24);return m}this.getDayStartDate=function(){var j=new Date(e,d,i);return this.formatDate(j)};this.getDayEndDate=function(){var j=new Date(e,d,i);return this.formatDate(j)};this.getLastDayStartDate=function(){var j=new Date(e,d,i+1);return this.formatDate(j)};this.getLastDayEndDate=function(){var j=new Date(e,d,i+1);return this.formatDate(j)};this.getWeekStartDate=function(){var j=new Date(e,d,i-h);return this.formatDate(j)};this.getWeekEndDate=function(){var j=new Date(e,d,i+(6-h));return this.formatDate(j)};this.getLadtWeekStartDate=function(){var j=new Date(e,d,i+(7-h));return this.formatDate(j)};this.getLastWeekEndDate=function(){var j=new Date(e,d,i+(13-h));return this.formatDate(j)};this.getMonthStartDate=function(){var j=new Date(e,d,1);return this.formatDate(j)};this.getMonthEndDate=function(){var j=new Date(e,d,c(d));return this.formatDate(j)};this.getLastMonthStartDate=function(){var j=new Date(e,g,1);return this.formatDate(j)};this.getLastMonthEndDate=function(){var j=new Date(e,g,c(g));return this.formatDate(j)};this.getYearStartDate=function(){var j=new Date(e,0,1);return this.formatDate(j)};this.getYearEndDate=function(){var j=new Date(e,11,31);return this.formatDate(j)};this.getLastYearStartDate=function(){var j=new Date(e+1,0,1);return this.formatDate(j)};this.getLastYearEndDate=function(){var j=new Date(e+1,11,31);return this.formatDate(j)}}CNOA_USER_PLAN_COMMON={viewTpl:new Ext.XTemplate('<div style="width:770px;height:40px;background-color:#FEFBDC;font-size:16px;font-weight:bold;line-height:40px; text-align: center;">[{plantypeName}]{title}',"</div>",'<div style="margin-top:5px;margin-bottom:5px;width:770px;">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("baseInfo2")+"</span></div>",'	<div style="background-color:#EFF5FF;padding-bottom:5px;">','		<ul class="user_task_view_ul">','			<li><span class="first">'+lang("planType")+': </span><span class="second" style="color:#800000;">{plantypeName}</span></li>','			<li><span class="first">'+lang("planer")+': </span><span class="second">{planer}</span></li>','			<li><span class="first">'+lang("planStatus")+': </span><span class="second">{statusText}</span></li>','			<li><span class="first">'+lang("startTime")+': </span><span class="second">{stime}</span></li>','			<li><span class="first">'+lang("endTime")+': </span><span class="second">{etime}</span></li>',"			<li>&nbsp;</li>","		</ul>",'		<div class="clear"></div>',"	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("content")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">','	<tpl for="contentList">','	  <div style="border-bottom:1px dashed #969AA7;margin:10px 0;line-heigth:20px;">{c}</div>',"	</tpl>","	</div>",'	<div id="user_plan_view_summary"><div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("planSummary")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">{summary}</div></div>','	<tpl if="attachCount &gt; 0">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("attach")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"		{attach}","	</div>","	</tpl>","</div>"),commentTpl:new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}'+lang("tiao")+")","		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:160px;width:120px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" style="background-color:#FFF;"></div>','				<div style="float:left;width:590px;">','					<div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">',"						#{[xindex]} "+lang("postter")+':<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;'+lang("inDepartment")+':<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;'+lang("posttime2")+":{posttime}",'						<tpl if="uid =='+CNOA_USER_UID+'">','							&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view.editComment({id})">修改</a>','							&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view.delComment({id})">删除</a>',"						</tpl>","					</div>",'				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>")};var CNOA_user_plan_addeditClass,CNOA_user_plan_addedit;CNOA_user_plan_addeditClass=CNOA.Class.create();CNOA_user_plan_addeditClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.TYPE_PERSON_PLAN=1;this.TYPE_DEPARTMENT_PLAN=2;this.TYPE_WORT_REPORT=3;this.TYPE_WORT_SUMMARY=4;this.planType=[[1,lang("weekPlan")],[2,lang("monthPlan")],[3,lang("yearPlan")],[4,lang("custom")]];this.reportType=[[5,lang("dayReport")],[1,lang("weekReport")],[2,lang("monthReport")],[3,lang("yearReport2")],[4,lang("custom")]];this.summaryType=[[1,lang("weekSummary")],[2,lang("monthSummary")],[3,lang("yearSummary")],[4,lang("custom")]];this.content_start=1;this.isLoadComplete=false;this.ID_plan_content=Ext.id();this.edit_id=CNOA.user.plan.addedit.pid;this.from=CNOA.user.plan.addedit.comefrom;this.plantype=parseInt(CNOA.user.plan.addedit.plantype)||this.TYPE_PERSON_PLAN;this.action=CNOA.user.plan.addedit.action;this.planTaskGrid=this.getPlanTaskGrid();this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",autoWidth:true,waitMsgTarget:true,items:[this.getPlanInfoView(),this.getPlanReportView(),this.getPlanShareView()],listeners:{render:function(b){if(a.action=="edit"||a.action=="addHB"||a.action=="addZJ"){a.loadAddEditForm()}}}});this.mainPanel=new Ext.Panel({hideBorders:true,autoScroll:true,border:false,autoScroll:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.formPanel,this.planTaskGrid],tbar:new Ext.Toolbar({items:[{xtype:"box",autoEl:{tag:"div",html:"<span style='font-weight:bold;margin-right:20px;'>"+this.getTitle()+"</span>"}},{text:lang("save"),cls:"btn-blue4",iconCls:"icon-btn-save",handler:function(){a.submitAddEdidForm()}},{text:lang("view"),hidden:this.action=="edit"?false:true,iconCls:"icon-flow-to-view",cls:"btn-yellow1",handler:function(){a.viewPlan(a.edit_id,false)}},{text:lang("cancel"),cls:"btn-red1",iconCls:"icon-dialog-cancel",handler:function(){a.closeTab()}},"->",{xtype:"cnoa_helpBtn",helpid:55}]})})},getPlanTaskGrid:function(){var d=this;this.planTaskGridStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPlanTaskList&pid="+this.edit_id}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"title"}]})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var c=function(f,g,e){return"<a href='javascript:void(0);' onclick='CNOA_user_plan_addedit.viewTask("+e.data.tid+");'>"+lang("view")+" / "+lang("modify")+" / "+lang("del")+"</a>"};var a=new Ext.grid.GridPanel({stripeRows:true,autoScroll:true,border:false,autoHeight:true,hidden:true,loadMask:lang("waiting"),sm:b,store:this.planTaskGridStore,cm:new Ext.grid.ColumnModel([b,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskName"),dataIndex:"title",width:550,sortable:true,menuDisabled:true,sortable:false},{header:lang("opt"),dataIndex:"op",width:120,sortable:true,renderer:c}]),viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[{text:lang("addTask"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){d.addTask()}},{text:lang("refresh"),iconCls:"icon-utils-s-delete",handler:function(){d.refreshTaskList()}}]})});return a},getPlanInfoView:function(){var b=this;var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getplanData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"},{name:"from"}]})});this.planSourceField=new Ext.form.ComboBox({fieldLabel:"计划来源",hidden:true,width:325,store:c,hiddenName:"from",valueField:"id",displayField:"from",mode:"local",triggerAction:"all",forceSelection:true,editable:false});this.smsSender=new Ext.form.SMSSender({from:"plan",fieldLabel:lang("smsNotice")});var a={xtype:"fieldset",title:lang("planXX"),anchor:"99%",height:350,autoHeight:true,defaults:{width:325,xtype:"textfield"},items:[{name:"title",fieldLabel:lang("title"),inputType:"text",allowBlank:false,maxLength:200,maxLengthText:lang("maxLengthText")+200},{xtype:"radiogroup",fieldLabel:lang("type"),allowBlank:false,name:"plantypeGroup",items:[{boxLabel:lang("personPlan"),name:"plantype",inputValue:this.TYPE_PERSON_PLAN},{boxLabel:lang("deptPlan"),name:"plantype",inputValue:this.TYPE_DEPARTMENT_PLAN},{boxLabel:lang("workReport2"),name:"plantype",inputValue:this.TYPE_WORT_REPORT},{boxLabel:lang("workSummary"),name:"plantype",inputValue:this.TYPE_WORT_SUMMARY}],listeners:{change:function(e,d){b.repaintView(d.inputValue)},afterrender:function(d){if(b.plantype){d.setValue(b.plantype)}if(b.plantype==b.TYPE_DEPARTMENT_PLAN){b.repaintView(b.TYPE_DEPARTMENT_PLAN)}if(b.plantype==b.TYPE_WORT_REPORT){b.repaintView(b.TYPE_WORT_REPORT)}if(b.plantype==b.TYPE_WORT_SUMMARY){b.repaintView(b.TYPE_WORT_SUMMARY)}}}},this.planSourceField,{xtype:"compositefield",fieldLabel:lang("plan")+lang("type")+'<font color="red">*</font>',items:[{xtype:"combo",width:110,name:"dateMode",hiddenName:"dateMode",valueField:"value",displayField:"dateMode",mode:"local",triggerAction:"all",forceSelection:true,allowBlank:false,editable:false,store:new Ext.data.SimpleStore({fields:["value","dateMode"],data:this.planType}),listeners:{select:function(f,d,e){b.updateTime(f.getValue())}}},{xtype:"label",html:lang("date")+'<font color="red">*</font>:',width:104,style:{textAlign:"right"}},{xtype:"datefield",format:"Y-m-d",editable:false,allowBlank:false,width:100,name:"ruler",value:new Date(),listeners:{select:function(e,d){var f=b.formPanel.getForm().findField("dateMode");b.updateTime(f.getValue())}}}]},{xtype:"compositefield",fieldLabel:lang("startTime"),items:[{xtype:"datefield",format:"Y-m-d",name:"stime",width:110},{xtype:"label",text:lang("endTime")+":",width:104,style:{textAlign:"right"}},{xtype:"datefield",format:"Y-m-d",name:"etime",width:100}]},{xtype:"datetimefield",format:"Y-m-d",name:"alarmtime",editable:false,fieldLabel:lang("noticeTime"),width:325},this.smsSender,{xtype:"container",layout:"form",id:this.ID_plan_content,hideBorders:true,border:false,autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("content"),width:480,height:110,name:"content_0",allowBlank:false,value:""}]},{xtype:"button",text:lang("addMoreContent"),cls:"btn-blue4",autoWidth:true,cls:"cnoa-margin-left-95",handler:function(){b.addPlanContent("")}},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",style:"margin-top:5px;",inputPre:"filesUpload"}]};return a},getPlanReportView:function(){var a=this;return{xtype:"fieldset",title:lang("reportMyPlan"),anchor:"99%",height:350,checkboxToggle:true,collapsed:true,checkboxName:"cnoa_user_plan_addedit_form_is_report",id:"cnoa_user_plan_addedit_form_is_report",autoHeight:true,defaults:{width:325,xtype:"textfield"},items:[{xtype:"textarea",height:35,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("reportToWho"),blankText:lang("selectReportToWho"),name:"reportNames"},{xtype:"hidden",name:"reportUids"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-20",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:95px;",text:lang("selectPeople"),listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("reportNames").setValue(f.join(","));a.formPanel.getForm().findField("reportUids").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("reportUids").getValue().split(","))}}}]}},getPlanShareView:function(){var a=this;return{xtype:"fieldset",title:lang("shareMyPlan"),anchor:"99%",height:350,checkboxToggle:true,collapsed:true,checkboxName:"cnoa_user_plan_addedit_form_is_share",id:"cnoa_user_plan_addedit_form_is_share",autoHeight:true,defaults:{width:325,xtype:"textfield"},items:[{xtype:"textarea",height:35,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("shareToWho"),blankText:lang("selectSharePeople"),name:"shareNames"},{xtype:"hidden",name:"shareUids"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-20",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:95px;",text:lang("selectPeople"),listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("shareNames").setValue(f.join(","));a.formPanel.getForm().findField("shareUids").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("shareUids").getValue().split(","))}}}]}},repaintView:function(a){switch(parseInt(a)){case this.TYPE_PERSON_PLAN:this.updateDateModeStore(this.planType,lang("plan"));this.planSourceField.hide();this.planTaskGrid.hide();break;case this.TYPE_DEPARTMENT_PLAN:this.updateDateModeStore(this.planType,lang("plan"));this.planSourceField.hide();this.planTaskGrid.show();break;case this.TYPE_WORT_REPORT:this.updateDateModeStore(this.reportType,lang("report"));this.planSourceField.show();this.planTaskGrid.hide();break;case this.TYPE_WORT_SUMMARY:this.updateDateModeStore(this.summaryType,lang("summary"));this.planSourceField.show();this.planTaskGrid.hide();break}},updateTime:function(i){i=parseInt(i);var a=this.formPanel.getForm();var d=a.findField("stime");var e=a.findField("etime");var l=a.findField("ruler").getRawValue().split("-");l=l[1]+"/"+l[2]+"/"+l[0];var c=new Date(l),h=c.getTime(),j=c.getFullYear(),g=c.getMonth()+1;var b,f;switch(i){case 1:var k=c.getDay();b=new Date(h-k*86400000);f=new Date(h+(6-k)*86400000);break;case 2:b=new Date(j,g-1,1);f=new Date(j,g,0);break;case 3:b=new Date(j,0,1);f=new Date(j,12,0);break;case 4:b=f="";break;case 5:b=f=c;break}d.setValue(b);e.setValue(f);if(i!==4){d.setReadOnly(true);e.setReadOnly(true)}else{d.setReadOnly(false);e.setReadOnly(false)}},updateDateModeStore:function(a,c){var e=this.formPanel.getForm();var g=e.findField("dateMode");var h=$("label[for="+g.id+"]");h.html(c+lang("type")+":");var b=g.getStore();b.removeAll();for(var d=0;d<a.length;d++){var f=new Ext.data.Record({value:a[d][0],dateMode:a[d][1]});b.add(f)}if(this.isLoadComplete){this.isLoadComplete=false}else{g.setValue("");e.findField("stime").setValue("");e.findField("etime").setValue("")}},addPlanContent:function(c){c=c||"";var d="CNOA_USER_PLAN_ADDEDIT_FORM_content_"+this.content_start;var a="content_"+this.content_start;var b=Ext.getCmp(this.ID_plan_content);b.add({xtype:"compositefield",id:d,items:[{xtype:"textarea",width:480,height:110,name:a,value:c},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:"X",handler:function(e){b.remove(d)}}]});b.doLayout();this.content_start++},getTitle:function(){var a;switch(this.action){case"edit":a=lang("modify");break;case"addZJ":a=lang("summary");break;case"addHB":a=lang("report");break;default:a=lang("add");break}return lang("plan2")+" - "+a},submitAddEdidForm:function(){var c=this;var b=c.baseUrl+"&task="+c.action;var a=this.formPanel.getForm();if(a.isValid()){a.submit({url:b,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:c.action,id:c.edit_id},success:function(d,f){try{c.smsSender.submit()}catch(g){}if(c.from!="report"){Ext.MessageBox.show({title:f.result.msg,msg:lang("addTaskFinishNotice"),buttons:{ok:lang("backToList"),cancel:lang("keepEdit"),no:lang("view")},fn:function(e){if(e=="ok"){if(d.findField("plantype").getValue()==1){c.goToList("list_my")}else{if(d.findField("plantype").getValue()==2){c.goToList("list_dept")}else{if(d.findField("plantype").getValue()==3){c.goToList("workreport")}else{c.goToList("sum")}}}}if(e=="no"){c.viewPlan(f.result.pid)}if(e=="cancel"){c.goToEdit(f.result.pid)}},icon:Ext.MessageBox.QUESTION})}else{c.viewPlan(f.result.pid)}}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}})}},loadAddEditForm:function(){var a=this;this.formPanel.getForm().load({url:this.baseUrl+"&task=loadFormData",params:{pid:this.edit_id,comefrom:this.from,type:this.action},method:"POST",waitMsg:lang("waiting"),success:function(c,d){a.isLoadComplete=true;var b=Ext.getCmp(a.ID_plan_content);Ext.each(d.result.data.contentList,function(f,e){if(e==0){a.formPanel.getForm().findField("content_0").setValue(f)}else{a.addPlanContent(f)}});if(d.result.data.cnoa_user_plan_addedit_form_is_share=="on"){Ext.getCmp("cnoa_user_plan_addedit_form_is_share").expand()}if(d.result.data.cnoa_user_plan_addedit_form_is_report=="on"){Ext.getCmp("cnoa_user_plan_addedit_form_is_report").expand()}if(a.action=="edit"){a.planTaskGridStore.load();setTimeout(function(){a.formPanel.getForm().findField("dateMode").setValue(d.result.data.dateMode)},100)}},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},viewPlan:function(c,b){if(b!==false){CNOA_USER_PLAN_TAB_CLOSE("add")}var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+c+"&comefrom="+this.from;mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},goToList:function(a){CNOA_USER_PLAN_TAB_CLOSE("add");CNOA_USER_PLAN_TAB_OPEN(a)},goToEdit:function(a){CNOA_USER_PLAN_TAB_CLOSE("add");CNOA_USER_PLAN_TAB_OPEN("edit",a)},addTask:function(){var c=this;if(c.action!="edit"){CNOA.msg.alert(lang("savePlanAndGoOn"));return false}var b=c.formPanel.getForm().findField("title").getValue();var a=new Ext.Window({width:700,height:makeWindowHeight(550),title:lang("addTaskInPlan"),resizable:true,modal:true,layout:"fit",id:"CNOA_USER_PLAN_TASK_ADD",autoLoad:{url:"index.php?app=user&func=plan&action=default&ajax=1&parentid=CNOA_USER_PLAN_TASK_ADD&task=loadPage&from=task_add&pid="+c.edit_id+"&title="+b,scripts:true,scope:this,nocache:true}}).show()},refreshTaskList:function(){var a=this;if(a.action!="edit"){CNOA.msg.alert(lang("savePlanAndGoOn"));return false}a.planTaskGridStore.reload()},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},closeTab:function(){mainPanel.closeTab(CNOA.user.plan.addedit.parentID.replace("docs-",""))}};var CNOA_user_plan_list_deptClass,CNOA_user_plan_list_dept;CNOA_user_plan_list_deptClass=CNOA.Class.create();CNOA_user_plan_list_deptClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.search={title:"",stime:0,etime:0,status:"",dateMode:0};this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.fields=[{name:"id"},{name:"plantime"},{name:"title"},{name:"status"},{name:"statusText"},{name:"dateMode"},{name:"updatetime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList&plantype=2",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(g,f,h,e,d,c){var b=Ext.decode(d.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("planTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("planTime"),dataIndex:"plantime",width:215,sortable:false,menuDisabled:true},{header:lang("planStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("recentUpdate"),dataIndex:"updatetime",width:85,sortable:false,menuDisabled:true},{header:lang("planType"),dataIndex:"dateMode",width:85,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:150,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){Ext.apply(c,a.search)}}});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,minColumnWidth:110,stripeRows:true,viewConfig:{},listeners:{rowdblclick:function(b,c){a.loadAddEditForm()},cellclick:function(b,f,c,d){}},tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("deptPlan")+"</span>",{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){CNOA_USER_PLAN_TAB_OPEN("add",0,"index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&plantype=2")}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:lang("addPlan"),text:lang("add")},{id:this.ID_btn_edit,handler:function(b,c){a.loadAddEditForm()}.createDelegate(this),iconCls:"icon-utils-s-edit",tooltip:lang("editPlan"),text:lang("modify")},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:56}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.grid],tbar:new Ext.Toolbar({items:[lang("planTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("type")+":",new Ext.form.ComboBox({id:this.ID_Search_dateMode,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekPlan")],["2",lang("monthPlan")],["3",lang("yearPlan")],["4",lang("custom")]]}),width:80,hiddenName:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,name:"dateMode",editable:false}),{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_plan_list_dept.viewPlan("+d.id+");'>"+lang("view")+"</a>";b+=d.status==0?("<a href='javascript:void(0);' class='gridview4 jianju' onclick='CNOA_user_plan_list_dept.editPlan("+d.id+");'>"+lang("modify")+"</a>"):"";b+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_user_plan_list_dept.deletePlanList("+d.id+");'>"+lang("del")+"</a>";return b},deletePlanList:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"delete",id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);a.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},loadAddEditForm:function(){var d=this;var b=d.grid.getSelectionModel().getSelections();if(b.length==0){var a=Ext.getCmp(d.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var c=b[0].get("id");CNOA_USER_PLAN_TAB_OPEN("edit",c)}},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+b+"&comefrom=owner";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},editPlan:function(a){CNOA_USER_PLAN_TAB_OPEN("edit",a)},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:a.search})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");a.search={title:"",stime:0,etime:0,status:"",dateMode:0};a.store.load()}};var CNOA_user_plan_list_myClass,CNOA_user_plan_list_my;CNOA_user_plan_list_myClass=CNOA.Class.create();CNOA_user_plan_list_myClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.search={title:"",stime:0,etime:0,status:"",dateMode:""};this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.fields=[{name:"id"},{name:"plantime"},{name:"title"},{name:"status"},{name:"statusText"},{name:"dateMode"},{name:"updatetime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList&plantype=1",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(g,f,h,e,d,c){var b=Ext.decode(d.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("title"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("planTime"),dataIndex:"plantime",width:215,sortable:false,menuDisabled:true},{header:lang("planStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("recentUpdate"),dataIndex:"updatetime",width:85,sortable:false,menuDisabled:true},{header:lang("planType"),dataIndex:"dateMode",width:85,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:150,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){if(a.search.title!=""){c.title=a.search.title}if(a.search.stime!=""){c.stime=a.search.stime}if(a.search.etime!=""){c.etime=a.search.etime}if(a.search.status!=""){c.status=a.search.status}if(a.search.dateMode!=""){c.dateMode=a.search.dateMode}}}});this.grid=new Ext.grid.GridPanel({store:this.store,minColumnWidth:110,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,stripeRows:true,viewConfig:{},listeners:{rowdblclick:function(b,c){a.loadAddEditForm()},cellclick:function(b,f,c,d){}},tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("personPlan")+"</span>",{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){CNOA_USER_PLAN_TAB_OPEN("add")}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:lang("addPlan"),text:lang("add")},{id:this.ID_btn_edit,handler:function(b,c){a.loadAddEditForm()}.createDelegate(this),iconCls:"icon-utils-s-edit",tooltip:lang("editPlan"),text:lang("modify")},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:57}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.grid],tbar:new Ext.Toolbar({items:[lang("planTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("planType"),{xtype:"combo",id:a.ID_Search_dateMode,name:"dateMode",hiddenName:"dateMode",displayField:"display",valueField:"value",store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekPlan")],["2",lang("monthPlan")],["3",lang("yearPlan")],["4",lang("custom")]]}),mode:"local",triggerAction:"all",forceSelection:true,editable:false,width:110},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},deletePlanList:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"delete",id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);a.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},loadAddEditForm:function(){var d=this;var b=d.grid.getSelectionModel().getSelections();if(b.length==0){var a=Ext.getCmp(d.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var c=b[0].get("id");CNOA_USER_PLAN_TAB_OPEN("edit",c)}},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a class='gridview' href='javascript:void(0);' onclick='CNOA_user_plan_list_my.viewPlan("+d.id+");'>"+lang("view")+"</a>";b+=d.status==0?("<a class='gridview4 jianju' href='javascript:void(0);' onclick='CNOA_user_plan_list_my.editPlan("+d.id+");'>"+lang("modify")+"</a>"):"";b+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_user_plan_list_my.deletePlanList("+d.id+");'>"+lang("del")+"</a>";return b},viewPlan:function(a){CNOA_USER_PLAN_TAB_OPEN("view",a)},editPlan:function(a){CNOA_USER_PLAN_TAB_OPEN("edit",a)},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:{title:a.search.title,stime:a.search.stime,etime:a.search.etime,status:a.search.status,dateMode:a.search.dateMode}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");a.search={title:"",stime:0,etime:0,status:"",dateMode:""};a.store.load()}};var CNOA_user_plan_reportClass,CNOA_user_plan_report;CNOA_user_plan_reportClass=CNOA.Class.create();CNOA_user_plan_reportClass.prototype={init:function(){var b=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_alltype=Ext.id();this.ID_btn_sharetype=Ext.id();this.ID_btn_reporttype=Ext.id();this.ID_ruler=Ext.id();this.mode=2;this.search={planer:0,title:"",stime:0,etime:0,status:"",dateMode:""};this.ID_Search_planer=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.ID_Search_readed=Ext.id();this.fields=[{name:"id"},{name:"title"},{name:"plantime"},{name:"plantype"},{name:"type"},{name:"planer"},{name:"updatetime"},{name:"readed"},{name:"statusText"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareReportList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,e,d){var c=Ext.decode(e.responseText);if(c.failure){CNOA.msg.alert(c.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.setBaseParam("type",2);this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("planTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("planTime"),dataIndex:"plantime",width:208,sortable:false,menuDisabled:true},{header:lang("srcComeFrom"),dataIndex:"plantype",width:80,sortable:false,menuDisabled:true},{header:lang("planStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("planer"),dataIndex:"planer",width:80,sortable:false,menuDisabled:true},{header:lang("reportTime"),dataIndex:"updatetime",width:111,sortable:false,menuDisabled:true},{header:lang("readStatus"),dataIndex:"readed",width:60,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"id",width:80,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(c,d){if(b.mode=="report"){d.type=2}if(b.mode=="share"){d.type=1}Ext.apply(d,b.search)}}});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,stripeRows:true,viewConfig:{},listeners:{rowdblclick:function(c){var d=c.getSelectionModel().getSelections();var e=d[0].get("id")}.createDelegate(this),cellclick:function(c,i,d,g){var f=c.getSelectionModel().getSelections();var h=f[0].get("id")},rowclick:function(c){}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},lang("reportTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("readStatus")+":",new Ext.form.ComboBox({id:this.ID_Search_readed,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["0",lang("unread")],["1",lang("readed")]]}),width:80,hiddenName:"readed",name:"readed",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("planType")+":",{xtype:"combo",id:this.ID_Search_dateMode,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekPlan")],["2",lang("monthPlan")],["3",lang("yearPlan")],["4",lang("custom")]]}),width:80,hiddenName:"dateMode",name:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,editable:false},{xtype:"button",text:lang("search"),handler:function(){b.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){b.resetSearch()}},"->",{xtype:"cnoa_helpBtn",helpid:59}]}),bbar:this.pagingBar});function a(c){var d=Ext.getCmp(b.ID_ruler).getRawValue();if(c==0){d=""}b.store.setBaseParam("dateType",c);b.store.setBaseParam("date",d);b.store.load()}this.menuPanel=new Ext.Panel({items:[this.grid],layout:"fit",hideBorders:true,border:false,tbar:new Ext.Toolbar({items:[{handler:function(c,d){a(0)}.createDelegate(this),enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",cls:"btn-blue4",text:lang("allPlan")},lang("date")+"：",{xtype:"datefield",name:"ruler",format:"Y-m-d",editable:false,id:b.ID_ruler,value:new Date()},{handler:function(c,d){a(1)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisMonth")},{handler:function(c,d){a(2)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisWeek")},{handler:function(c,d){a(3)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevMonth")},{handler:function(c,d){a(4)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevWeek")},{handler:function(c,d){a(5)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("daysUnread",15)}]})});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,layout:"fit",items:[this.menuPanel],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("planReportTome")+"</span>",{handler:function(c,d){b.store.setBaseParam("plantype","");b.store.load()}.createDelegate(this),iconCls:"icon-applications-stack",enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"user_plan_report_plantype",cls:"btn-red1",text:lang("All")},{handler:function(c,d){b.store.setBaseParam("plantype",1);b.store.load()}.createDelegate(this),iconCls:"icon-user-plan",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("personPlan")},{handler:function(c,d){b.store.setBaseParam("plantype",2);b.store.load()}.createDelegate(this),iconCls:"icon-cnoa-communication",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("deptPlan")},{handler:function(c,d){b.store.setBaseParam("plantype",3);b.store.load()}.createDelegate(this),iconCls:"icon-work-report",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workReport2")},{handler:function(c,d){b.store.setBaseParam("plantype",4);b.store.load()}.createDelegate(this),cls:"btn-blue2",iconCls:"icon-arrow_down",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workSummary")}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_plan_report.viewPlan("+g+");'>"+lang("view")+"</a>";return b},showList:function(a){var b=this;if(a=="all"){}else{if(a=="share"){b.mode=1}else{if(a=="report"){b.mode=2}}}b.store.removeAll();b.store.load({params:{type:b.mode}})},viewPlan:function(c){var b=this;setTimeout(function(){b.store.reload()},500);mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+c+"&comefrom=report";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.readed=Ext.getCmp(a.ID_Search_readed).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:{title:a.search.title,stime:a.search.stime,etime:a.search.etime,status:a.search.status,dateMode:a.search.dateMode,readed:a.search.readed}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");Ext.getCmp(a.ID_Search_readed).setValue("");a.search={title:"",stime:0,etime:0,status:"",dateMode:"",readed:""};a.store.load()}};var CNOA_user_plan_shareClass,CNOA_user_plan_share;CNOA_user_plan_shareClass=CNOA.Class.create();CNOA_user_plan_shareClass.prototype={init:function(){var b=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_alltype=Ext.id();this.ID_btn_sharetype=Ext.id();this.ID_btn_reporttype=Ext.id();this.mode=2;this.search={planer:0,title:"",stime:0,etime:0,status:"",dateMode:""};this.ID_Search_planer=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.ID_Search_readed=Ext.id();this.ID_ruler=Ext.id();this.fields=[{name:"id"},{name:"title"},{name:"plantime"},{name:"plantype"},{name:"statusText"},{name:"type"},{name:"updatetime"},{name:"readed"},{name:"planer"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShareReportList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,e,d){var c=Ext.decode(e.responseText);if(c.failure){CNOA.msg.alert(c.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.setBaseParam("type",1);this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("planTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("planTime"),dataIndex:"plantime",width:190,sortable:false,menuDisabled:true},{header:lang("srcComeFrom"),dataIndex:"plantype",width:80,sortable:false,menuDisabled:true},{header:lang("planStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("planer"),dataIndex:"planer",width:80,sortable:false,menuDisabled:true},{header:lang("reportTime"),dataIndex:"updatetime",width:111,sortable:false,menuDisabled:true},{header:lang("readStatus"),dataIndex:"readed",width:60,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:80,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.search)}}});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,stripeRows:true,viewConfig:{forceFit:true},listeners:{rowdblclick:function(c){var d=c.getSelectionModel().getSelections();var e=d[0].get("id")}.createDelegate(this),cellclick:function(c,i,d,g){var f=c.getSelectionModel().getSelections();var h=f[0].get("id")},rowclick:function(c){var d=c.getSelectionModel().getSelections();b.viewPlan(d[0].get("id"))}},tbar:new Ext.Toolbar({items:[{handler:function(c,d){b.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},lang("reportTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("readStatus")+":",new Ext.form.ComboBox({id:this.ID_Search_readed,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["0",lang("unread")],["1",lang("readed")]]}),width:80,hiddenName:"readed",name:"readed",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("planType")+":",{xtype:"combo",id:this.ID_Search_dateMode,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekPlan")],["2",lang("monthPlan")],["3",lang("yearPlan")],["4",lang("custom")]]}),width:80,hiddenName:"dateMode",name:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,editable:false},{xtype:"button",text:lang("search"),handler:function(){b.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){b.resetSearch()}},"->",{xtype:"cnoa_helpBtn",helpid:59}]}),bbar:this.pagingBar});function a(c){var d=Ext.getCmp(b.ID_ruler).getRawValue();if(c==0){d=""}b.store.setBaseParam("dateType",c);b.store.setBaseParam("date",d);b.store.load()}this.menuPanel=new Ext.Panel({items:[this.grid],layout:"fit",hideBorders:true,border:false,tbar:new Ext.Toolbar({items:[{handler:function(c,d){a(0)}.createDelegate(this),enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",cls:"btn-blue4",text:lang("allPlan")},lang("date")+"：",{xtype:"datefield",name:"ruler",format:"Y-m-d",editable:false,id:b.ID_ruler,value:new Date()},{handler:function(c,d){a(1)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisMonth")},{handler:function(c,d){a(2)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisWeek")},{handler:function(c,d){a(3)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevMonth")},{handler:function(c,d){a(4)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevWeek")},{handler:function(c,d){a(5)}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("daysUnread",15)}]})});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,layout:"fit",items:[this.menuPanel],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("planShareToME")+"</span>",{handler:function(c,d){b.store.setBaseParam("plantype","");b.store.load()}.createDelegate(this),iconCls:"icon-applications-stack",enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"user_plan_report_plantype",cls:"btn-red1",text:lang("All")},{handler:function(c,d){b.store.setBaseParam("plantype",1);b.store.load()}.createDelegate(this),iconCls:"icon-user-plan",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("personPlan")},{handler:function(c,d){b.store.setBaseParam("plantype",2);b.store.load()}.createDelegate(this),iconCls:"icon-cnoa-communication",enableToggle:true,cls:"btn-blue2",allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("deptPlan")},{handler:function(c,d){b.store.setBaseParam("plantype",3);b.store.load()}.createDelegate(this),iconCls:"icon-work-report",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workReport2")},{handler:function(c,d){b.store.setBaseParam("plantype",4);b.store.load()}.createDelegate(this),iconCls:"icon-arrow_down",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workSummary")}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a class='gridview' href='javascript:void(0);'>"+lang("view")+"</a>";return b},showList:function(a){var b=this;if(a=="all"){}else{if(a=="share"){b.mode=1}else{if(a=="report"){b.mode=2}}}b.store.removeAll();b.store.load({params:{type:b.mode}})},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+b+"&comefrom=share";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.readed=Ext.getCmp(a.ID_Search_readed).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:{planer:a.search.planer,title:a.search.title,stime:a.search.stime,etime:a.search.etime,status:a.search.status,dateMode:a.search.dateMode,readed:a.search.readed}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");Ext.getCmp(a.ID_Search_readed).setValue("");a.search={planer:0,title:"",stime:0,etime:0,status:"",dateMode:"",readed:""};a.store.load()}};var CNOA_user_plan_task_addeditClass,CNOA_user_plan_task_addedit;CNOA_user_plan_task_addeditClass=CNOA.Class.create();CNOA_user_plan_task_addeditClass.prototype={init:function(){var a=this;this.edit_id=CNOA.user.plan_task.addedit.tid;this.loadCount=0;this.baseUrl="index.php?app=user&func=task&action=default";this.action="add";this.actionTitle=this.action=="add"?lang("addTask"):lang("editTask");this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_checkbox_needexamapp=Ext.id();this.ID_from_panel=Ext.id();this.ID_from_combobox=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",fieldLabel:lang("smsNotice")});this.baseField=[{xtype:"fieldset",title:lang("taskBaseInfo"),anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{name:"title",fieldLabel:lang("taskTitle"),inputType:"text",allowBlank:false,maxLength:200,width:480,maxLengthText:lang("maxLengthText")+200},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"textfield",fieldLabel:lang("taskComeFrom"),name:"fromName",width:480,readOnly:true,value:lang("plan")+":"+CNOA.user.plan_task.addedit.title}]},{xtype:"hidden",name:"from",value:"plan"},{xtype:"hidden",name:"fromid",value:CNOA.user.plan_task.addedit.pid}]},{xtype:"datefield",format:"Y-m-d",name:"stime",allowBlank:false,editable:false,fieldLabel:lang("createTime"),width:150},{xtype:"textfield",name:"worktime1",fieldLabel:lang("workTimePG"),width:150},{xtype:"datefield",format:"Y-m-d",name:"etime",allowBlank:false,editable:false,fieldLabel:lang("finishTime"),width:150},{xtype:"compositefield",fieldLabel:lang("approvalor"),items:[{xtype:"userselectorfield",disabled:true,width:250,name:"examappUid",multiSelect:false},{xtype:"checkbox",boxLabel:lang("xysprsp"),name:"needexamapp",id:this.ID_checkbox_needexamapp,style:"margin-left:5px;margin-top:3px;",listeners:{check:function(d,b){var c=a.formPanel.getForm().findField("examappUid");if(b){if(a.loadCount!==0||a.action!=="edit"){CNOA.msg.alert(lang("taskNeedSpNotice"))}c.allowBlank=false;c.validationEvent=true;c.clearInvalid();c.enable()}else{c.allowBlank=true;c.validationEvent=false;c.clearInvalid();c.disable();c.setValue("")}}}}]},{xtype:"userselectorfield",fieldLabel:lang("principal"),width:250,allowBlank:false,name:"execmanUid",multiSelect:false},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("participant"),emptyText:lang("pstp"),height:35,width:438,readOnly:true,name:"participant"}]},{xtype:"hidden",name:"participantUids"},{xtype:"btnForPoepleSelector",text:lang("select"),dataUrl:a.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:6px",listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("participant").setValue(f.join(","));a.formPanel.getForm().findField("participantUids").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("participantUids").getValue().split(","))}}}]},{xtype:"textarea",fieldLabel:lang("taskContent"),width:480,height:140,name:"content",value:""},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",inputPre:"filesUpload"},this.smsSender,{xtype:"textarea",fieldLabel:lang("jfbz"),width:480,height:80,name:"prizepunish",value:""},{xtype:"textarea",fieldLabel:lang("leaderInstruction"),width:480,height:80,name:"leadersay",value:""}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.baseField],listeners:{render:function(b){if(a.action=="edit"){a.loadFormData(b)}}}});this.addEditPanelTitle=new Ext.BoxComponent({autoEl:{tag:"div",html:"<span style='font-weight:bold;margin-right:20px;'>"+lang("task2")+" - "+this.actionTitle+"</span>"}});this.addEditPanel=new Ext.Panel({hideBorders:true,autoScroll:true,border:false,items:[this.formPanel],buttons:[{text:lang("save"),id:this.ID_btn_save,cls:"btn-blue4",iconCls:"icon-btn-save",handler:function(){a.submitForm()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",cls:"btn-red1",handler:function(){a.closeWindow()}.createDelegate(this)}]});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.addEditPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},closeWindow:function(){Ext.getCmp(CNOA.user.plan_task.addedit.parentID).close()},submitForm:function(){var a=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:a.baseUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:a.action,tid:a.edit_id},success:function(b,c){try{a.smsSender.submit()}catch(d){}CNOA.msg.alert(c.result.msg+"",function(f){try{CNOA_user_plan_addedit.refreshTaskList()}catch(g){}a.closeWindow()})},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}.createDelegate(this)})}}};var CNOA_user_plan_viewClass,CNOA_user_plan_view;CNOA_user_plan_viewClass=CNOA.Class.create();CNOA_user_plan_viewClass.prototype={init:function(){var a=this;this.from=CNOA.user.plan.view.comefrom;this.pid=CNOA.user.plan.view.pid;this.status=0;this.plantype=0;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_plan_content=Ext.id();this.ID_plan_comment_htmleditor=Ext.id();this.ID_plan_report_htmleditor=Ext.id();this.ID_plan_attach=Ext.id();this.ID_plan_report_post_area=Ext.id();this.ID_btn_edit=Ext.id();this.ID_btn_finish=Ext.id();this.ID_btn_delete=Ext.id();this.ID_BTN_REPORT=Ext.id();this.ID_BTN_ZONGJIE=Ext.id();this.tpl=CNOA_USER_PLAN_COMMON.viewTpl;this.eastStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:a.baseUrl+"&task=getEastData&pid="+a.pid}),reader:new Ext.data.JsonReader({root:"data",fields:["title","id","type"]}),listeners:{load:function(d,b,c){}}});this.planTaskGridStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:a.baseUrl+"&task=getPlanTaskList&pid="+a.pid}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"title"},{name:"statusText"},{name:"progress"},{name:"statusColor"},{name:"execman"},{name:"stime"},{name:"etime"}]})});this.planTaskGridSm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.planTaskGrid=new Ext.grid.GridPanel({stripeRows:true,store:this.planTaskGridStore,sm:this.planTaskGridSm,autoScroll:true,border:false,hideBorders:true,autoWidth:true,autoHeight:true,loadMask:lang("waiting"),cm:new Ext.grid.ColumnModel([this.planTaskGridSm,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskName"),dataIndex:"title",width:200,sortable:true,menuDisabled:true,sortable:false},{header:lang("status"),dataIndex:"status",width:130,sortable:true,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:110,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:100,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:100,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"op",width:70,sortable:true,renderer:function(g,e,b,h,d,f){var c="<a href='javascript:void(0);' onclick='CNOA_user_plan_view.viewTask("+b.data.tid+");'>"+lang("view")+" </a>";return c}}]),tbar:new Ext.Toolbar({items:[lang("taskInPlan")]})});this.planTaskPanel=new Ext.Panel({width:775,bodyStyle:"margin:5px;margin-bottom:25px;",border:false,hidden:true,items:[this.planTaskGrid]});this.planbaseField=new Ext.Panel({border:false});this.reportPanelPost=new Ext.Panel({border:false,id:a.ID_plan_report_post_area,hidden:true,items:[{xtype:"htmleditor",width:748,id:a.ID_plan_report_htmleditor,height:140},{xtype:"button",text:lang("giveInstru"),cls:"cnoa-margin-top-5",handler:function(){a.postCommentReport("report")}}]});this.reportPanel=new Ext.Panel({width:770,border:false,html:lang("loading")});this.planreportField=[{xtype:"fieldset",title:lang("planOfLeader"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.reportPanel,this.reportPanelPost]}];this.commentPanelPost=new Ext.Panel({border:false,items:[{xtype:"htmleditor",id:a.ID_plan_comment_htmleditor,width:748,height:140},{xtype:"button",text:lang("addComment"),cls:"cnoa-margin-top-5",handler:function(){a.postCommentReport("comment")}}]});this.commentPanel=new Ext.Panel({border:false,html:lang("loading")});this.plancommentField=[{xtype:"fieldset",title:lang("commentOfPlan"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.commentPanel,this.commentPanelPost]}];this.infoPanel=new Ext.Panel({border:false,width:775,bodyStyle:"padding:5px",listeners:{render:function(){a.readInfo();a.loadComment();a.loadReport()}}});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,items:[this.infoPanel,this.planTaskPanel,this.planreportField,this.plancommentField],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("viewPlan")+"</span>",{handler:function(b,c){CNOA_USER_PLAN_TAB_CLOSE("view");CNOA_USER_PLAN_TAB_OPEN("view",this.pid)}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:this.ID_btn_edit,handler:function(b,c){a.editPlan(a.pid)}.createDelegate(this),iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("setComplete"),id:this.ID_btn_finish,iconCls:"icon-pass",cls:"btn-blue4",handler:function(){a.setFinish()}.createDelegate(this)},{text:lang("workReport"),id:this.ID_BTN_REPORT,cls:"btn-blue2",iconCls:"icon-work-report",handler:function(b,c){a.addRZPlan(a.pid,a.plantype)}.createDelegate(this)},{text:lang("workSummary"),id:this.ID_BTN_ZONGJIE,cls:"btn-blue2",iconCls:"icon-arrow_down",handler:function(b,c){a.addRZPlan(a.pid,"3")}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){CNOA_USER_PLAN_TAB_CLOSE("view")}.createDelegate(this)}]})});this.planStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:a.baseUrl+"&task=getPlanTaskList&pid="+a.pid}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"type"},{name:"title"}]})});this.planGrid=new Ext.grid.GridPanel({stripeRows:true,store:this.eastStore,sm:this.planSm,autoScroll:true,border:false,hideBorders:true,autoWidth:true,autoHeight:true,loadMask:lang("waiting"),cm:new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},{header:lang("taskName"),dataIndex:"title",width:100,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:lang("planType"),dataIndex:"type",width:120,sortable:true,menuDisabled:true,sortable:false}]),tbar:new Ext.Toolbar({items:[lang("contentOfThisPlan")]})});this.eastPanel=new Ext.Panel({region:"east",autoScroll:true,width:250,minWidth:180,maxWidth:180,split:true,items:[a.planGrid],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("contentRelated")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:61}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel,this.eastPanel]})},operate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' onclick='CNOA_user_plan_view.viewPlan("+d.id+");'>"+d.title+"</a>";return b},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+b+"&comefrom=workreport";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},makeStatus:function(j,g,d,h,f,b){var l=d.data;var k=l.status;var i="&nbsp;";var a=0;var c="#5B5B5B";i=l.statusText;a=l.progress;c=l.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+i+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},readInfo:function(a){var b=this;b.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=loadPlanInfo",method:"POST",params:{pid:b.pid},success:function(f){var c=Ext.decode(f.responseText);if(c.success===true){var d=c.data;b.tpl.overwrite(b.infoPanel.body,d);b.status=d.status;b.plantype=d.plantype;var k=Ext.getCmp(b.ID_btn_edit);var i=Ext.getCmp(b.ID_btn_finish);var j=Ext.getCmp(b.ID_BTN_REPORT);var h=Ext.getCmp(b.ID_BTN_ZONGJIE);if(c.owner==true){if(b.status==0){k.enable();i.enable();i.setText(lang("setComplete"));i.setIconClass("icon-pass");try{Ext.fly(user_plan_view_summary).dom.style.display="none"}catch(g){}}else{if(b.status==1){k.disable();i.enable();i.setText(lang("setUnfinish"));i.setIconClass("icon-arrow-redo")}else{if(b.status==2){k.disable();i.enable();i.setText(lang("setUnfinish"));i.setIconClass("icon-arrow-redo")}}}}else{i.hide()}if((b.from=="share")&&(c.owner!=true)){k.hide()}if(d.viewertype==2){Ext.getCmp(b.ID_plan_report_post_area).show()}if(d.plantype==3){j.hide()}else{if(d.plantype==4){j.hide()}}if(d.plantype==2){b.planTaskPanel.show();b.planTaskPanel.doLayout();b.planTaskGridStore.load()}b.centerPanel.getEl().unmask()}else{CNOA.msg.alert(c.msg,function(){CNOA_USER_PLAN_TAB_CLOSE("view")})}}})},setFinish:function(){var d=this;var b=function(e){Ext.Ajax.request({url:d.baseUrl+"&task=setFinish&pid="+d.pid,method:"POST",params:{content:e},success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){CNOA.msg.notice2(f.msg);d.readInfo()}else{CNOA.msg.alert(f.msg)}}})};if(d.status==0){var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",anchor:"-20 -20",name:"content",fieldLabel:lang("summary")}]});var c=new Ext.Window({width:400,height:270,title:lang("setComplete"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){var e=a.getForm().findField("content").getValue();if(Ext.isEmpty(e)){CNOA.msg.alert(lang("sumNotAllowBlank"));return}b(e);c.close()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}.createDelegate(this)}]}).show()}else{b()}},refreshTaskList:function(){_this.planTaskGridStore.reload()},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},editPlan:function(b){CNOA_USER_PLAN_TAB_CLOSE("view");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&job=edit&comefrom="+this.from+"&pid="+b;mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_ADDEDIT",lang("editPlan"),"icon-page-addedit")},addRZPlan:function(f,e){CNOA_USER_PLAN_TAB_CLOSE("view");if(e=="3"){var b=lang("workSummary");var d="addZJ"}else{var b=lang("workReport");var d="addHB"}var c="index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&job="+d+"&comefrom="+this.from+"&pid="+f;mainPanel.closeTab("CNOA_MENU_USER_PLAN_ADDEDIT");mainPanel.loadClass(c,"CNOA_MENU_USER_PLAN_ADDEDIT",b,"icon-page-addedit")},loadComment:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"loadPlanComment",pid:a.pid,id:b,from:"comment"},success:function(d){var c=Ext.decode(d.responseText);c.data.title=lang("planComment");a.getCommentTpl("comment").overwrite(a.commentPanel.body,c.data)}})},editComment:function(e,b){var d=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",anchor:"-20 -20",name:"content",fieldLabel:lang("comment")}],listeners:{render:function(f){f.load({url:d.baseUrl,params:{task:"loadPlanComment",pid:d.pid,id:e,from:b},method:"POST",waitMsg:lang("waiting"),failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}}});var c=new Ext.Window({width:400,height:270,title:lang("commentModif"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){var f=a.getForm().findField("content").getValue();a.getForm().submit({url:d.baseUrl+"&task=editComment",params:{id:e,content:f,pid:d.pid},method:"POST",success:function(g,h){if(b=="comment"){d.loadComment()}else{if(b=="report"){d.loadReport()}}CNOA.msg.notice2(lang("editSuccess"))},failure:function(g,h){CNOA.msg.alert(lang("editFail"))}});c.close()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]}).show()},delComment:function(c,a){var b=this;Ext.MessageBox.confirm(lang("notice"),lang("sureWantDelComment"),function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl,params:{task:"delComment",id:c},method:"POST",success:function(){if(a=="comment"){b.loadComment()}else{if(a=="report"){b.loadReport()}}CNOA.msg.notice2(lang("delSuccess"))},failure:function(){CNOA.msg.alert(lang("delFail"))}})}else{return false}})},loadReport:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"loadPlanComment",pid:a.pid,from:"report"},success:function(c){var b=Ext.decode(c.responseText);b.data.title=lang("planLeadSay");a.getCommentTpl("report").overwrite(a.reportPanel.body,b.data)}})},postCommentReport:function(d){var c=this;var b="";var a=null;if(d=="comment"){a=Ext.getCmp(c.ID_plan_comment_htmleditor)}else{if(d=="report"){a=Ext.getCmp(c.ID_plan_report_htmleditor)}}b=a.getValue();Ext.Ajax.request({url:c.baseUrl,method:"POST",params:{task:"postPlanComment",pid:c.pid,from:d,content:b},success:function(g){var f=Ext.decode(g.responseText);try{if(f.success===true){if(d=="comment"){c.loadComment()}else{if(d=="report"){c.loadReport()}}a.setValue("");CNOA.msg.alert(f.msg,function(){})}else{CNOA.msg.alert(f.msg)}}catch(h){}}})},getCommentTpl:function(a){return new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}'+lang("tiao")+")","		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:128px;width:118px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" onerror="this.src=\'./resources/images/default.jpg\'" style="background-color:#FFF; width:120px; height:130px;"></div>','				<div style="float:left;width:590px;">','					<div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">',"						#{[xindex]} "+lang("postter")+':<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;'+lang("inDepartment")+':<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;'+lang("posttime2")+":{posttime}",'						<tpl if="uid =='+CNOA_USER_UID+'">','							&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view.editComment({id}, \''+a+"')\">修改</a>",'							&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view.delComment({id}, \''+a+"')\">删除</a>","						</tpl>","					</div>",'				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>")}};var CNOA_user_plan_view_srClass,CNOA_user_plan_view_sr;var CNOA_user_plan_erport_editClass,CNOA_user_plan_erport_edit;CNOA_user_plan_erport_editClass=CNOA.Class.create();CNOA_user_plan_erport_editClass.prototype={init:function(a){var b=this;this.ID_radiogroup_jobTypeGroup=Ext.id();this.ID_plan_content=Ext.id();this.content_start=1;this.baseUrl="index.php?app=user&func=plan&action=default";this.edit_id=a;this.addEditPlanbaseField=[{xtype:"fieldset",title:lang("planXX"),anchor:"99%",height:350,autoHeight:true,defaults:{width:325,xtype:"textfield"},items:[{xtype:"displayfield",name:"title",fieldLabel:lang("planName")},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:215,items:[{xtype:"datefield",format:"Y-m-d",name:"stime",allowBlank:false,editable:false,fieldLabel:lang("startTime"),width:110}]},{xtype:"panel",layout:"form",width:218,items:[{xtype:"datefield",format:"Y-m-d",name:"etime",allowBlank:false,editable:false,fieldLabel:lang("endTime"),width:110}]}]},{xtype:"panel",id:this.ID_plan_content,hideBorders:true,border:false,autoWidth:true,items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",items:[{xtype:"textarea",fieldLabel:lang("planContent"),width:480,height:110,name:"content_0",value:""}]}]}]},{xtype:"button",text:lang("addMoreContent"),cls:"btn-blue4",autoWidth:true,cls:"cnoa-margin-left-95",handler:function(d,f){var e=Ext.getCmp(this.ID_plan_content);var g="CNOA_USER_PLAN_REPORT_EDIT_FORM_content_"+b.content_start;var c="content_"+b.content_start;b.content_start++;e.add([{xtype:"panel",hideBorders:true,border:false,id:g,layout:"table",layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",labelWidth:90,items:[{xtype:"textarea",width:480,height:110,name:c}]},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:"X",handler:function(h,i){e.remove(g)}.createDelegate(this)}]}]);e.doLayout()}.createDelegate(this),name:"content"},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",style:"margin-top:5px;",inputPre:"filesUpload"}]},{xtype:"fieldset",title:lang("ReportPlan"),anchor:"99%",height:350,checkboxToggle:true,collapsed:true,checkboxName:"cnoa_user_plan_report_edit_form_is_report",id:"cnoa_user_plan_report_edit_form_is_report",autoHeight:true,defaults:{width:325,xtype:"textfield"},items:[{xtype:"textarea",height:35,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("reportToWho"),blankText:lang("selectReportToWho"),name:"reportNames"},{xtype:"hidden",name:"reportUids"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-20",dataUrl:b.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:95px;",text:lang("selectPeople"),listeners:{selected:function(e,f){var g=new Array();var d=new Array();if(f.length>0){for(var c=0;c<f.length;c++){g.push(f[c].uname);d.push(f[c].uid)}}b.formPanel.getForm().findField("reportNames").setValue(g.join(","));b.formPanel.getForm().findField("reportUids").setValue(d.join(","))},onrender:function(c){c.setSelectedUids(b.formPanel.getForm().findField("reportUids").getValue().split(","))}}}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",autoWidth:true,waitMsgTarget:true,autoScroll:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.addEditPlanbaseField],listeners:{render:function(c){b.loadAddEditForm()}}});this.mainPanel=new Ext.Window({width:680,height:makeWindowHeight(500),title:lang("editPlanReportTome"),resizable:true,modal:true,layout:"fit",items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){b.submit()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}.createDelegate(this)}]}).show()},close:function(){this.mainPanel.close()},submit:function(){var a=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:a.baseUrl,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{task:"edit_report",id:this.edit_id},success:function(b,c){CNOA.msg.notice2(c.result.msg);a.close();mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW")}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}},loadAddEditForm:function(){var b=this;var a=b.edit_id;this.formPanel.getForm().load({url:b.baseUrl,params:{pid:a,task:"loadFormData_sr",comefrom:this.from},method:"POST",waitMsg:lang("waiting"),success:function(e,f){this.edit_id=f.result.data.id;b.action="edit";var d=Ext.getCmp(b.ID_plan_content);var g="";var c="";Ext.each(f.result.data.contentList,function(j,h,i){if(h==0){b.formPanel.getForm().findField("content_0").setValue(j)}else{g="CNOA_USER_PLAN_ADDEDIT_FORM_content_"+b.content_start;c="content_"+b.content_start;b.content_start++;d.add([{xtype:"panel",hideBorders:true,border:false,id:g,layout:"table",layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",labelWidth:90,items:[{xtype:"textarea",width:480,height:110,name:c,value:j}]},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:"X",handler:function(k,l){d.remove(g)}.createDelegate(this)}]}]);d.doLayout()}});if(f.result.data.cnoa_user_plan_report_edit_form_is_report=="on"){Ext.getCmp("cnoa_user_plan_report_edit_form_is_report").expand()}}.createDelegate(this),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){b.close()})}.createDelegate(this)})}};CNOA_user_plan_view_srClass=CNOA.Class.create();CNOA_user_plan_view_srClass.prototype={init:function(){var a=this;this.from=CNOA.user.plan.view_sr.comefrom;this.pid=CNOA.user.plan.view_sr.pid;this.status=0;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_plan_content=Ext.id();this.ID_plan_comment_htmleditor=Ext.id();this.ID_plan_report_htmleditor=Ext.id();this.ID_plan_attach=Ext.id();this.ID_plan_report_post_area=Ext.id();this.ID_btn_edit=Ext.id();this.tpl=CNOA_USER_PLAN_COMMON.viewTpl;this.planTaskGridStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:a.baseUrl+"&task=getPlanTaskList&pid="+a.pid}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"title"},{name:"status"},{name:"execman"},{name:"statusText"},{name:"statusColor"},{name:"progress"},{name:"stime"},{name:"etime"}]})});this.planTaskGridSm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.planTaskGrid=new Ext.grid.GridPanel({stripeRows:true,store:this.planTaskGridStore,sm:this.planTaskGridSm,autoScroll:true,border:false,hideBorders:true,autoWidth:true,autoHeight:true,loadMask:lang("waiting"),cm:new Ext.grid.ColumnModel([this.planTaskGridSm,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskName"),dataIndex:"title",width:200,sortable:true,menuDisabled:true,sortable:false},{header:lang("status"),dataIndex:"status",width:130,sortable:true,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:110,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:100,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:100,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"op",width:70,sortable:true,renderer:function(g,e,b,h,d,f){var c="<a href='javascript:void(0);' onclick='CNOA_user_plan_view_sr.viewTask("+b.data.tid+");'>"+lang("view")+"</a>";return c}}]),tbar:new Ext.Toolbar({items:[lang("taskInPlan")]})});this.planTaskPanel=new Ext.Panel({width:775,bodyStyle:"margin:5px;margin-bottom:25px;",border:false,hidden:true,items:[this.planTaskGrid]});this.planbaseField=new Ext.Panel({border:false});this.reportPanelPost=new Ext.Panel({border:false,id:a.ID_plan_report_post_area,hidden:true,items:[{xtype:"htmleditor",width:748,id:a.ID_plan_report_htmleditor,height:140},{xtype:"button",text:lang("giveInstru"),cls:"cnoa-margin-top-5",handler:function(){a.postCommentReport("report")}}]});this.reportPanel=new Ext.Panel({border:false,html:lang("loading")});this.planreportField=[{xtype:"fieldset",title:lang("planOfLeader"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.reportPanel,this.reportPanelPost]}];this.commentPanelPost=new Ext.Panel({border:false,items:[{xtype:"htmleditor",id:a.ID_plan_comment_htmleditor,width:748,height:140},{xtype:"button",text:lang("addComment"),cls:"cnoa-margin-top-5",handler:function(){a.postCommentReport("comment")}}]});this.commentPanel=new Ext.Panel({border:false,html:lang("loading")});this.plancommentField=[{xtype:"fieldset",title:lang("commentOfPlan"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.commentPanel,this.commentPanelPost]}];this.infoPanel=new Ext.Panel({border:false,bodyStyle:"padding:5px",listeners:{render:function(){a.readInfo();a.loadComment();a.loadReport()}}});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,items:[this.infoPanel,this.planTaskPanel,this.planreportField,this.plancommentField],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("viewTask")+"</span>",{handler:function(b,c){a.refresh()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:this.ID_btn_edit,handler:function(b,c){a.editPlan(a.pid)}.createDelegate(this),iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){CNOA_USER_PLAN_TAB_CLOSE("view")}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:62}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeStatus:function(j,g,d,h,f,b){var l=d.data;var k=l.status;var i="&nbsp;";var a=0;var c="#5B5B5B";i=l.statusText;a=l.progress;c=l.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+i+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},readInfo:function(a){var b=this;b.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=loadPlanInfo",method:"POST",params:{pid:b.pid,comefrom:this.from},success:function(f){var c=Ext.decode(f.responseText);if(c.success===true){var d=c.data;b.tpl.overwrite(b.infoPanel.body,d);b.status=d.status;var h=Ext.getCmp(b.ID_btn_edit);if((b.from=="share")&&(c.owner!=true)){h.hide()}if(d.viewertype==2){Ext.getCmp(b.ID_plan_report_post_area).show()}if(d.plantype==2){b.planTaskPanel.show();b.planTaskPanel.doLayout();b.planTaskGridStore.load()}b.centerPanel.getEl().unmask();try{CNOA_user_plan_share.store.reload()}catch(g){}}else{CNOA.msg.alert(c.msg,function(){CNOA_USER_PLAN_TAB_CLOSE("view")})}}})},refresh:function(){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+this.pid+"&comefrom="+this.from;mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewTask"),"icon-page-view")},refreshTaskList:function(){_this.planTaskGridStore.reload()},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},editPlan:function(a){CNOA_user_plan_erport_edit=new CNOA_user_plan_erport_editClass(a)},loadComment:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"loadPlanComment",pid:a.pid,from:"comment"},success:function(c){var b=Ext.decode(c.responseText);b.data.title=lang("planComment");a.getCommentTpl("comment").overwrite(a.commentPanel.body,b.data)}})},editComment:function(e,b){var d=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",anchor:"-20 -20",name:"content",fieldLabel:lang("comment")}],listeners:{render:function(f){f.load({url:d.baseUrl,params:{task:"loadPlanComment",pid:d.pid,id:e,from:b},method:"POST",waitMsg:lang("waiting"),failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}}});var c=new Ext.Window({width:400,height:270,title:lang("commentModif"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(){var f=a.getForm().findField("content").getValue();a.getForm().submit({url:d.baseUrl+"&task=editComment",params:{id:e,content:f,pid:d.pid},method:"POST",success:function(g,h){if(b=="comment"){d.loadComment()}else{if(b=="report"){d.loadReport()}}CNOA.msg.notice2(lang("editSuccess"))},failure:function(g,h){CNOA.msg.alert(lang("editFail"))}});c.close()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]}).show()},delComment:function(c,a){var b=this;Ext.MessageBox.confirm(lang("notice"),lang("sureWantDelComment"),function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl,params:{task:"delComment",id:c},method:"POST",success:function(){if(a=="comment"){b.loadComment()}else{if(a=="report"){b.loadReport()}}CNOA.msg.notice2(lang("delSuccess"))},failure:function(){CNOA.msg.alert(lang("delFail"))}})}})},loadReport:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"loadPlanComment",pid:a.pid,from:"report"},success:function(c){var b=Ext.decode(c.responseText);b.data.title=lang("planLeadSay");a.getCommentTpl("report").overwrite(a.reportPanel.body,b.data)}})},postCommentReport:function(d){var c=this;var b="";var a=null;if(d=="comment"){a=Ext.getCmp(c.ID_plan_comment_htmleditor)}else{if(d=="report"){a=Ext.getCmp(c.ID_plan_report_htmleditor)}}b=a.getValue();Ext.Ajax.request({url:c.baseUrl,method:"POST",params:{task:"postPlanComment",pid:c.pid,from:d,content:b},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){if(d=="comment"){c.loadComment()}else{if(d=="report"){c.loadReport()}}a.setValue("");CNOA.msg.notice2(e.msg)}else{CNOA.msg.alert(e.msg)}}})},getCommentTpl:function(a){return new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}'+lang("tiao")+")","		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:128px;width:118px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" onerror="this.src=\'./resources/images/default.jpg\'" style="background-color:#FFF; width:120px; height: 130px;"></div>','				<div style="float:left;width:590px;">','					<div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">',"						#{[xindex]} "+lang("postter")+':<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;'+lang("inDepartment")+':<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;'+lang("posttime2")+":{posttime}",'						<tpl if="uid =='+CNOA_USER_UID+'">','							&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view_sr.editComment({id}, \''+a+"')\">"+lang("modify")+"</a>",'							&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="CNOA_user_plan_view_sr.delComment({id}, \''+a+"')\">"+lang("del")+"</a>","						</tpl>","					</div>",'				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>")}};var CNOA_user_plan_workreportClass,CNOA_user_plan_workreport;CNOA_user_plan_workreportClass=CNOA.Class.create();CNOA_user_plan_workreportClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.search={title:"",stime:0,etime:0,status:"",dateMode:0};this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.fields=[{name:"id"},{name:"plantime"},{name:"title"},{name:"status"},{name:"statusText"},{name:"dateMode"},{name:"updatetime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList&plantype=3",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(g,f,h,e,d,c){var b=Ext.decode(d.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("reportTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("reportTime"),dataIndex:"plantime",width:215,sortable:false,menuDisabled:true},{header:lang("reportStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("recentUpdate"),dataIndex:"updatetime",width:85,sortable:false,menuDisabled:true},{header:lang("planType"),dataIndex:"dateMode",width:85,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:150,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){if(a.search.title!=""){c.title=a.search.title}if(a.search.stime!=""){c.stime=a.search.stime}if(a.search.etime!=""){c.etime=a.search.etime}if(a.search.status!=""){c.status=a.search.status}}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,minColumnWidth:110,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,listeners:{rowdblclick:function(b,c){a.loadAddEditForm()}},tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("workReport")+"</span>",{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){CNOA_USER_PLAN_TAB_OPEN("add",0,"index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&plantype=3")}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:lang("addPlan"),text:lang("add")},{id:this.ID_btn_edit,handler:function(b,c){a.loadAddEditForm()}.createDelegate(this),iconCls:"icon-utils-s-edit",tooltip:lang("editPlan"),text:lang("modify")},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:57}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.grid],tbar:new Ext.Toolbar({items:[lang("reportTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("type")+":",new Ext.form.ComboBox({id:this.ID_Search_dateMode,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["5",lang("dayReport")],["1",lang("weekReport")],["2",lang("monthReport")],["3",lang("yearReport2")],["4",lang("custom")]]}),width:80,hiddenName:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,name:"dateMode",editable:false}),{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},deletePlanList:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"delete",id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice2(c.msg);a.store.reload()}else{CNOA.msg.alert(c.msg)}}})},loadAddEditForm:function(){var d=this;var b=d.grid.getSelectionModel().getSelections();if(b.length==0){var a=Ext.getCmp(d.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var c=b[0].get("id");CNOA_USER_PLAN_TAB_OPEN("edit",c)}},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_plan_workreport.viewPlan("+d.id+");'>"+lang("view")+"</a>";b+=d.status==0?"<a href='javascript:void(0);' class='gridview4 jianju' onclick='CNOA_user_plan_workreport.editPlan("+d.id+");'>"+lang("modify")+"</a>":"";b+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_user_plan_workreport.deletePlan("+d.id+");'>"+lang("del")+"</a>";return b},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+b+"&comefrom=workreport";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},editPlan:function(a){CNOA_USER_PLAN_TAB_OPEN("edit",a)},deletePlan:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){a.deletePlanList(b)}})},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:a.search})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");a.search={title:"",stime:0,etime:0,status:"",dateMode:0};a.store.load()}};var CNOA_user_plan_sumClass,CNOA_user_plan_sum;CNOA_user_plan_sumClass=CNOA.Class.create();CNOA_user_plan_sumClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=user&func=plan&action=default";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.search={title:"",stime:0,etime:0,status:"",dateMode:0};this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.fields=[{name:"id"},{name:"plantime"},{name:"title"},{name:"status"},{name:"statusText"},{name:"dateMode"},{name:"updatetime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList&plantype=4",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(g,f,h,e,d,c){var b=Ext.decode(d.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("summaryTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("summaryTime"),dataIndex:"plantime",width:215,sortable:false,menuDisabled:true},{header:lang("summaryStatus"),dataIndex:"statusText",width:70,sortable:false,menuDisabled:true},{header:lang("recentUpdate"),dataIndex:"updatetime",width:85,sortable:false,menuDisabled:true},{header:lang("planType"),dataIndex:"dateMode",width:85,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:150,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){Ext.apply(c,a.search)}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,minColumnWidth:110,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,stripeRows:true,viewConfig:{},listeners:{rowdblclick:function(b,c){a.loadAddEditForm()},cellclick:function(b,f,c,d){}},tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("workSummary")+"</span>",{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,c){CNOA_USER_PLAN_TAB_OPEN("add",0,"index.php?app=user&func=plan&action=default&task=loadPage&from=addedit&plantype=4")}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:lang("addSummary"),text:lang("add")},{id:this.ID_btn_edit,handler:function(b,c){a.loadAddEditForm()}.createDelegate(this),iconCls:"icon-utils-s-edit",tooltip:lang("editSummary"),text:lang("modify")},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:57}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.grid],tbar:new Ext.Toolbar({items:[lang("summaryTitle")+":",{xtype:"textfield",id:this.ID_Search_title,width:128},lang("createTime")+":",{xtype:"datefield",format:"Y-m-d",id:this.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:this.ID_Search_etime,format:"Y-m-d",width:100},lang("status")+":",new Ext.form.ComboBox({id:this.ID_Search_status,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),lang("type")+":",new Ext.form.ComboBox({id:this.ID_Search_dateMode,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekSummary")],["2",lang("monthSummary")],["3",lang("yearSummary")],["4",lang("custom")]]}),width:80,hiddenName:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,name:"dateMode",editable:false}),{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},deletePlanList:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{task:"delete",id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice2(c.msg);a.store.reload()}else{CNOA.msg.alert(c.msg)}}})},loadAddEditForm:function(){var d=this;var b=d.grid.getSelectionModel().getSelections();if(b.length==0){var a=Ext.getCmp(d.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var c=b[0].get("id");CNOA_USER_PLAN_TAB_OPEN("edit",c)}},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_user_plan_sum.viewPlan("+d.id+");'>"+lang("view")+"</a>";b+=d.status==0?"<a href='javascript:void(0);' class='gridview4 jianju' onclick='CNOA_user_plan_sum.editPlan("+d.id+");'>"+lang("modify")+"</a>":"";b+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_user_plan_sum.deletePlan("+d.id+");'>"+lang("del")+"</a>";return b},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=user&func=plan&action=default&task=loadPage&from=view&pid="+b+"&comefrom=sum";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")},editPlan:function(a){CNOA_USER_PLAN_TAB_OPEN("edit",a)},deletePlan:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){a.deletePlanList(b)}})},doSearch:function(){var a=this;a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.status=Ext.getCmp(a.ID_Search_status).getValue();a.search.dateMode=Ext.getCmp(a.ID_Search_dateMode).getValue();a.store.load({params:a.search})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_status).setValue("");Ext.getCmp(a.ID_Search_dateMode).setValue("");a.search={title:"",stime:0,etime:0,status:"",dateMode:0};a.store.load()}};var sm_user_plan=1;
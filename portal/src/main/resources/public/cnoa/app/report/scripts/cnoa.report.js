var CNOA_report_mgr_wfClass,CNOA_report_mgr_wf;CNOA_report_mgr_wfClass=CNOA.Class.create();CNOA_report_mgr_wfClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=report&func=form&action=mgr&modul=wf";this.storeBar={name:""};this.fields=[{name:"tid"},{name:"name"},{name:"cname"},{name:"status"},{name:"freeze"},{name:"statusName"},{name:"postname"},{name:"posttime"},{name:"fromid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("tempName"),dataIndex:"name",id:"flowName",width:140,sortable:true,menuDisabled:true,renderer:function(d,e,b){return'<a href="javascript:void(0)" onclick="CNOA_report_mgr_wf.temple('+b.data.fromid+')">'+d+"</a>"}},{header:lang("conditionName"),dataIndex:"cname",width:220,sortable:true,menuDisabled:true,renderer:function(d,e,b){return'<a href="javascript:void(0)" onclick="CNOA_report_mgr_wf.condit('+b.data.fromid+')">'+d+"</a>"}},{header:lang("status"),dataIndex:"statusName",width:180,sortable:false,menuDisabled:true,renderer:function(k,j,h){var m=h.data;var f="";var g=' / <a href="javascript:void(0)" onclick="CNOA_report_mgr_wf.changeStatus(\'status\', 0, '+m.tid+')" >'+lang("disable")+"</a>";var e=' / <a href="javascript:void(0)" onclick="CNOA_report_mgr_wf.changeStatus(\'status\', 1, '+m.tid+')" >'+lang("enable")+"</a>";var d='/ <a href="javascript:void(0);" onclick="CNOA_report_mgr_wf.changeStatus(\'freeze\', 0, '+m.tid+');">'+lang("unlock")+"</a>";var b='/ <a href="javascript:void(0);" ext:qtip="'+lang("freezeTemplate")+"\" onclick=\"CNOA_report_mgr_wf.changeStatus('freeze', 1, "+m.tid+');">'+lang("lock")+"</a>";if(m.status==0){g=""}else{if(m.status==1){e=""}}if(m.freeze==0){d=""}else{if(m.freeze==1){b=""}}f=k+g+e+d+b;return f}},{header:lang("designer"),dataIndex:"postname",width:120,sortable:false,menuDisabled:true},{header:lang("designTime"),dataIndex:"posttime",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"tid",width:60,sortable:false,menuDisabled:true,renderer:function(e,f,b){var d=b.data;return'<a href="javascript:void(0);" class="gridview4" onclick="CNOA_report_mgr_wf.deleteData('+e+');">'+lang("del")+"</a>"}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){Ext.apply(c,a.storeBar)}}});this.ID_SEARCH_FIELD=Ext.id();this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",autoExpandColumn:"flowName",stripeRows:true,tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(b,c){a.store.reload()}.createDelegate(this)},lang("repostName")+":",{xtype:"textfield",width:200,id:this.ID_SEARCH_FIELD,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){a.storeBar.name=Ext.getCmp(a.ID_SEARCH_FIELD).getValue();a.store.load({params:a.storeBar})}}}},{xtype:"button",text:lang("search"),handler:function(){a.storeBar.name=Ext.getCmp(a.ID_SEARCH_FIELD).getValue();a.store.load({params:a.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){a.storeBar.name="";Ext.getCmp(a.ID_SEARCH_FIELD).setValue("");a.store.load()}}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},changeStatus:function(a,d,b){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=changeStatus",method:"POST",params:{status:a,id:d,tid:b},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){c.store.reload()}else{CNOA.msg.alert(e.msg,function(){})}}})},deleteData:function(a){var b=this;CNOA.msg.cf(lang("areYouDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteTemple",method:"POST",params:{tid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},temple:function(a){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=temple&flowId="+a,"CNOA_MENU_REPORT_USE_WF_TEMPLE",lang("setReportTemp"),"icon-table-insert")},condit:function(a){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_SETTING");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=condition&flowId="+a,"CNOA_MENU_REPORT_USE_WF_SETTING",lang("setConditionReport"),"icon-table-insert")}};var CNOA_report_use_wf_settingClass,CNOA_report_use_wf_setting;CNOA_report_use_wf_settingClass=CNOA.Class.create();CNOA_report_use_wf_settingClass.prototype={init:function(){var e=this;var b=CNOA.report.use_wf_setting.flowId;this.baseUrl="index.php?app=report&func=form&action=use&modul=wf&flowId="+b;this.conditionFields=["id","fieldid","fieldname","condit","value","from","fid"];this.conditionStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getConditionJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.conditionFields})});this.singleStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSingleJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.conditionFields})});this.conditionCM=new Ext.grid.ColumnModel([{id:"fieldname",header:lang("controlName"),width:160,sortable:true,dataIndex:"fieldname",menuDisabled:true},{header:lang("condition"),width:160,sortable:true,dataIndex:"condit",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["0",lang("nothing")],["1",lang("contains")],["2",lang("equal")],["3",lang("greaterThan")],["4",lang("lessThan")],["5",lang("greaterOrEqual")],["6",lang("lessOrEqual")],["7",lang("beganTo")],["8",lang("endOf")],["9",lang("notInclude")]]}),value:"1",valueField:"name",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("value"),width:160,sortable:true,dataIndex:"value",menuDisabled:true,editor:new Ext.form.TextField({name:"value"})}]);this.bottom=new Ext.grid.EditorGridPanel({xtype:"editorgrid",region:"center",layout:"fit",clicksToEdit:1,store:this.conditionStore,border:false,cm:this.conditionCM,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:"fieldname",bodyStyle:"border-top-width:1px;"});this.fields=["id","name","postname","flowid","name","type","title","number","faqiuid","faqiname","faqidept","faqideptname","faqistation","faqistationname","choice","timetype","dstime","day","gap","dayMonthYear","stime","etime","singleField"];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getBaseJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.colModel=new Ext.grid.ColumnModel([{id:"name",header:lang("conditionName"),sortable:true,dataIndex:"name",menuDisabled:true,width:145},{header:lang("designer"),width:80,sortable:true,dataIndex:"postname",menuDisabled:true},{header:lang("opt"),width:85,sortable:true,dataIndex:"id",menuDisabled:true,renderer:function(g,m,j,k){var h=j.data;var f='<a href="javascript:void(0)" class="gridview4" onclick="CNOA_report_use_wf_setting.editCondition('+k+')">'+lang("edit")+"</a>";f+='<a href="javascript:void(0)" class="gridview2 jianju" onclick="CNOA_report_use_wf_setting.deleteCondition('+g+')">'+lang("del")+"</a>";return f}}]);this.left=new Ext.grid.GridPanel({region:"west",layout:"fit",width:300,store:this.store,border:false,bodyStyle:"border-right-width:1px;",cm:this.colModel,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:"name",tbar:new Ext.Toolbar({style:"border-right-width:1px;",height:27,items:[lang("listOfCondition")]})});var a=Ext.id();var c=Ext.id();var d=Ext.id();this.ID_BTN_SAVE=Ext.id();this.ID_faqiname=Ext.id();this.ID_faqistationname=Ext.id();this.right=new Ext.form.FormPanel({region:"center",layout:"fit",width:250,border:false,items:[{xtype:"fieldset",labelWidth:80,padding:10,autoScroll:true,border:false,items:[{xtype:"hidden",name:"flowId",value:b},{xtype:"hidden",name:"id"},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,width:620,items:[{xtype:"panel",layout:"form",border:false,width:310,items:[{xtype:"textfield",fieldLabel:lang("conditionName"),allowBlank:false,width:205,name:"name"},{xtype:"combo",fieldLabel:lang("workFlowStatus"),width:205,name:"type",store:new Ext.data.SimpleStore({fields:["value","name"],data:[["1",lang("yibanli")],["4",lang("checkIn")],["3",lang("hasBeenHandled")],["2",lang("allFlow")]]}),value:1,hiddenName:"type",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false},{xtype:"textfield",fieldLabel:lang("serial"),width:205,name:"number"},{xtype:"combo",fieldLabel:lang("timeToJudge"),width:205,name:"choice",store:new Ext.data.SimpleStore({fields:["value","name"],data:[[1,lang("basedOnTime")],[2,lang("TimeEndProcess")],[3,lang("bothBaseOn")]]}),value:1,hiddenName:"choice",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]},{xtype:"panel",width:310,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:lang("customFlowTitle"),width:205,name:"title"},{xtype:"hidden",id:e.ID_faqiname,name:"faqiuid"},{xtype:"compositefield",fieldLabel:lang("initiator"),items:[{xtype:"textfield",width:186,readOnly:true,name:"faqiname",listeners:{render:function(f){f.to=e.ID_faqiname},focus:function(f){people_selector("user",f,false,false)}}},{xtype:"button",text:"×",handler:function(){e.right.getForm().findField("faqiuid").setValue("");e.right.getForm().findField("faqiname").setValue("")}}]},{xtype:"compositefield",fieldLabel:lang("department"),items:[{xtype:"departmentselectorfield",hiddenName:"faqidept",width:186,readOnly:true,name:"faqideptname",multiSelect:false},{xtype:"button",text:"×",handler:function(){e.right.getForm().findField("faqidept").setValue("")}}]},{xtype:"hidden",id:e.ID_faqistationname,name:"faqistation"},{xtype:"compositefield",fieldLabel:lang("station"),items:[{xtype:"textfield",name:"faqistationname",width:186,readOnly:true,listeners:{render:function(f){f.to=e.ID_faqistationname},focus:function(f){people_selector("station",f,false,false)}}},{xtype:"button",text:"×",handler:function(){e.right.getForm().findField("faqistation").setValue("");e.right.getForm().findField("faqistationname").setValue("")}}]}]}]},{xtype:"radiogroup",fieldLabel:lang("timeSet"),width:205,items:[{boxLabel:lang("nothing"),name:"timetype",inputValue:"0",checked:true},{boxLabel:lang("custom"),name:"timetype",inputValue:"1"},{boxLabel:lang("fixed"),name:"timetype",inputValue:"2"}],listeners:{change:function(g,f){if(f.inputValue==2){Ext.getCmp(a).show();Ext.getCmp(c).show();Ext.getCmp(d).hide()}else{if(f.inputValue==1){Ext.getCmp(a).hide();Ext.getCmp(c).hide();Ext.getCmp(d).show()}else{Ext.getCmp(a).hide();Ext.getCmp(c).hide();Ext.getCmp(d).hide()}}}}},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,width:600,items:[{xtype:"panel",layout:"form",border:false,width:310,items:[{xtype:"datefield",fieldLabel:lang("flowStartTime"),width:205,id:a,hidden:true,format:"Y-m-d",name:"stime"}]},{xtype:"panel",width:310,layout:"form",border:false,items:[{xtype:"datefield",fieldLabel:lang("flowEndTime"),id:c,width:205,format:"Y-m-d",hidden:true,name:"etime"}]}]},{xtype:"compositefield",fieldLabel:lang("customTime"),hidden:true,id:d,items:[{xtype:"displayfield",value:lang("beginExecutionTime")},{xtype:"datefield",name:"dstime",format:"Y-m-d",value:new Date(),editable:false},{xtype:"displayfield",value:lang("atInterval")},{xtype:"numberfield",name:"gap",value:0,width:48},{xtype:"combo",width:50,store:new Ext.data.SimpleStore({fields:["value","name"],data:[[0,lang("month")],[1,lang("tian")]]}),value:0,name:"dayMonthYear",hiddenName:"dayMonthYear",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){if(g==1){e.right.getForm().findField("day").hide()}else{e.right.getForm().findField("day").show()}},change:function(g,f,h){if(f==1){e.right.getForm().findField("day").hide()}else{e.right.getForm().findField("day").show()}}}},{xtype:"combo",width:100,store:new Ext.data.SimpleStore({fields:["value","name"],data:[[0,lang("lastThisMonth")],[1,"01"],[2,"02"],[3,"03"],[4,"04"],[5,"05"],[6,"06"],[7,"07"],[8,"08"],[9,"09"],[10,"10"],[11,"11"],[12,"12"],[13,"13"],[14,"14"],[15,"15"],[16,"16"],[17,"17"],[18,"18"],[19,"19"],[20,"20"],[21,"21"],[22,"22"],[23,"23"],[24,"24"],[25,"25"],[26,"26"],[27,"27"],[28,"28"],[29,"29"],[30,"30"],[31,"31"]]}),value:0,name:"day",hiddenName:"day",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:40px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("everyMon1mon")}}),{layout:"form",border:false,items:[{xtype:"combo",width:205,fieldLabel:lang("independentFields"),store:e.singleStore,name:"singleField",hiddenName:"singleField",valueField:"fieldid",displayField:"fieldname",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:40px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("wageStatemnt")}})]}],tbar:[{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){var f=e.right.getForm();f.findField("id").setValue(0);var g=[];Ext.each(e.conditionStore.data.items,function(h,j){g.push(h.data)});g=Ext.encode(g);if(f.isValid()){f.submit({url:e.baseUrl+"&task=submitCondition",method:"POST",params:{children:g},success:function(h,j){CNOA.msg.notice(j.result.msg,lang("saveFlowCondition"));e.store.reload()}.createDelegate(this),failure:function(h,j){CNOA.msg.alert(j.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}}},{text:lang("save"),iconCls:"icon-btn-save",hidden:true,id:this.ID_BTN_SAVE,handler:function(){var f=e.right.getForm();var g=[];Ext.each(e.conditionStore.data.items,function(h,j){g.push(h.data)});g=Ext.encode(g);if(f.isValid()){f.submit({url:e.baseUrl+"&task=submitCondition",method:"POST",params:{children:g},success:function(h,j){CNOA.msg.notice(j.result.msg,lang("saveFlowCondition"));Ext.getCmp(e.ID_BTN_SAVE).hide();h.reset();e.store.reload();e.conditionStore.load()}.createDelegate(this),failure:function(h,j){CNOA.msg.alert(j.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}}}]});this.top=new Ext.Panel({region:"north",height:320,layout:"border",border:false,items:[this.left,this.right]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,layout:"border",autoScroll:false,border:false,items:[this.top,this.bottom]})},editCondition:function(b){var a=this.store.getAt(b);this.right.getForm().loadRecord(a);if(a.data.dayMonthYear==1){this.right.getForm().findField("day").hide()}Ext.getCmp(this.ID_BTN_SAVE).show();this.conditionStore.load({params:{bid:a.id}})},deleteCondition:function(b){var a=this;CNOA.msg.cf(lang("areYouDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=deleteCondition&id="+b,method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("delCondition"));a.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},setDefaults:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=setDefaults&id="+c,method:"POST",params:{type:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("successSetting"));b.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}};var CNOA_report_use_wf_templeClass,CNOA_report_use_wf_temple;CNOA_report_use_wf_templeClass=CNOA.Class.create();CNOA_report_use_wf_templeClass.prototype={init:function(){var b=this;var a=CNOA.report.use_wf_temple.flowId;if(CNOA.report.use_wf_temple.fromUser){this.fromUser=true;this.tid=CNOA.report.use_wf_temple.tid}else{this.tid=0}this.baseUrl="index.php?app=report&func=form&action=use&modul=temple&flowId="+a;this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,layout:"border",autoScroll:false,border:false,items:[this.top(),this.bottom()]});if(this.fromUser){setTimeout(function(){b.editData(b.tid)},100)}},top:function(){var c=this;this.treeStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList&from=all",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["kong","fieldid"]})});this.groupStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["kong","fieldid"]})});this.conditionStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getConditionList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"value"},{name:"name"}]})});this.conFields=["tid","name","postname","freeze"];this.conStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.conFields})});this.conColModel=new Ext.grid.ColumnModel([{id:"name",header:lang("tempName"),sortable:true,dataIndex:"name",menuDisabled:true},{header:lang("designer"),width:70,sortable:true,dataIndex:"postname",menuDisabled:true},{header:lang("opt"),width:70,sortable:true,dataIndex:"tid",menuDisabled:true,renderer:function(g,h,e){var f=e.data;if(f.freeze==1){return lang("tempHaveBeenFrozen")}var d='<a href="javascript:void(0)"  class="gridview4" onclick="CNOA_report_use_wf_temple.editData('+g+')">'+lang("edit")+"</a>";d+='<a href="javascript:void(0)"  class="gridview2 jianju" onclick="CNOA_report_use_wf_temple.deleteData('+g+')">'+lang("del")+"</a>";return d}}]);this.conPanel=new Ext.grid.GridPanel({store:this.conStore,region:"west",width:300,border:false,cm:this.conColModel,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),bodyStyle:"border-right-width:1px;",autoExpandColumn:"name",tbar:new Ext.Toolbar({style:"border-right-width:1px;",height:27,items:[lang("templatesList"),"->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.conStore.reload()}}]})});this.infoPanel=new Ext.form.FormPanel({autoScroll:true,region:"center",border:false,height:400,labelAlign:"right",labelWidth:80,padding:5,tbar:[{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){if(c.templeStore.data.items.length==0){return CNOA.msg.alert(lang("notAddColumn"))}c.submitData("add")}},{text:lang("save"),iconCls:"icon-btn-save",hidden:true,id:"ID_BTN_SAVE",handler:function(){c.submitData("edit")}}],items:[{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"textfield",fieldLabel:lang("tempName"),allowBlank:false,name:"name",width:200}]},{layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("bindingConditions"),name:"condition",allowBlank:false,store:c.conditionStore,hiddenName:"condition",valueField:"value",displayField:"name",hidden:c.fromUser,mode:"local",width:200,triggerAction:"all",forceSelection:true,editable:false})]}]},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("grouping"),name:"group",store:c.groupStore,hiddenName:"group",disabled:c.fromUser,valueField:"fieldid",displayField:"kong",mode:"local",width:200,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(f,d,e){if(d.data.fieldid=="operate"){CNOA.msg.alert(lang("optCanNotGroup"),function(){f.setValue("");return})}b.findField("groupTitile").setValue(d.data.name)}}}),{xtype:"hidden",name:"groupTitile"}]},{layout:"form",items:[{xtype:"radiogroup",fieldLabel:lang("sortType"),disabled:c.fromUser,width:200,items:[{boxLabel:lang("sortAscText"),name:"group1",inputValue:"ASC",checked:true},{boxLabel:lang("sortDescText"),name:"group1",inputValue:"DESC"},{boxLabel:lang("clear2"),name:"group1",inputValue:"no"}],listeners:{change:function(d,e){if(e.inputValue=="no"){b.findField("group").setValue("")}}}}]}]},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("order"),name:"firstOrder",store:c.treeStore,hiddenName:"firstOrder",disabled:c.fromUser,valueField:"fieldid",displayField:"kong",mode:"local",width:200,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(f,d,e){if(d.data.fieldid=="operate"){CNOA.msg.alert(lang("actionNotSort"),function(){f.setValue("")})}}}})]},{layout:"form",items:[{xtype:"radiogroup",disabled:c.fromUser,fieldLabel:lang("sortType"),width:200,items:[{boxLabel:lang("sortAscText"),name:"order1",inputValue:"asc",checked:true},{boxLabel:lang("sortDescText"),name:"order1",inputValue:"desc"},{boxLabel:lang("clear2"),name:"order1",inputValue:"no"}],listeners:{change:function(d,e){if(e.inputValue=="no"){b.findField("firstOrder").setValue("")}}}}]}]},{layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("eachPageDisplay"),name:"page",store:new Ext.data.SimpleStore({fields:["value","name"],data:[[30,"30"+lang("data1")],[50,"50"+lang("data1")],[80,"80"+lang("data1")],[100,"100"+lang("data1")],[120,"120"+lang("data1")],[0,lang("unlimitNum")]]}),width:200,value:30,hiddenName:"page",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:90px;margin-top:5px;margin-bottom:5px;",html:lang("warningSelect30Ie6")+'(<a style="color:#00F;text-decoration:underline" target="_blank" href="http://baike.baidu.com/view/1222082.htm" >'+lang("kernelIE")+"</a>)"+lang("someBrowserLow")+"<br/>"+lang("selectMore50Data")+"("+lang("kernelFor")+'<a style="color:#00F;text-decoration:underline" target="_blank" href="http://baike.baidu.com/view/1510583.htm" >webkit</a>)'+lang("andOtherBrowser")+"。<br />"+lang("chooseNotToLimit")}}),{layout:"form",border:false,items:[{xtype:"checkboxgroup",fieldLabel:lang("optColumnButton"),width:300,items:[{boxLabel:lang("browse"),name:"operateV",inputValue:1},{boxLabel:lang("downloadAttachment"),name:"operateD",inputValue:1,disabled:c.fromUser},{boxLabel:lang("attachmentView"),name:"operateA",inputValue:1,disabled:c.fromUser},{boxLabel:lang("other"),name:"operateO",inputValue:1,disabled:true}],listeners:{change:function(e,d){Ext.each(d,function(f,g){if(f.name=="operateD"){e.setValue("operateA",true)}})}}}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:90px;margin-bottom:5px;",html:"[<b>"+lang("browse")+"</b>] "+lang("saidBrowsingForm")+"<br /> [<b>"+lang("attachmentView")+"</b>] "+lang("saidCanOnlineCheck")+", <br />[<b>"+lang("other")+"</b>] "+lang("saidWeCanhelpYOU")}}),{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"textarea",fieldLabel:lang("peopleToView"),name:"people",width:200,height:80,readOnly:true,listeners:{afterrender:function(d){d.mon(d.el,"click",function(){var e=b.findField("peopleUid").getValue();new_selector("user",b.findField("people"),b.findField("peopleUid"),true,c.baseUrl+"&task=selector&target=user",e)})}}},{xtype:"hidden",name:"peopleUid"}]},{layout:"form",items:[{xtype:"textarea",fieldLabel:lang("tdcv"),name:"dept",width:200,height:80,readOnly:true,listeners:{afterrender:function(d){d.mon(d.el,"click",function(){new_selector("dept",b.findField("dept"),b.findField("deptId"),true,c.baseUrl+"&task=selector&target=dept")})}}},{xtype:"hidden",name:"deptId"}]}]},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"radiogroup",fieldLabel:lang("allowExportExcel"),width:200,items:[{boxLabel:lang("allow"),name:"allowexcel",inputValue:1},{boxLabel:lang("notAllow"),name:"allowexcel",inputValue:0,checked:true}]}]},{layout:"form",items:[{xtype:"textfield",fieldLabel:lang("exportExcelFile"),width:200,name:"excelname",value:"<L><Y>-<M>-<D>"}]}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:90px;color:#676767;",html:lang("listRules")+": &lt;L&gt;:"+lang("flowName")+" &nbsp; &lt;T&gt;:"+lang("tempName")+" &nbsp; &nbsp;&lt;Y&gt;:"+lang("generateYear")+" &nbsp; &nbsp;&lt;M&gt;:"+lang("generateMon")+" &nbsp;&nbsp;&lt;D&gt;:"+lang("generateDays")+" &nbsp;<br />&nbsp;&lt;H&gt;: "+lang("generateHour")+" &nbsp;&nbsp;&lt;I&gt;:"+lang("generateMinutes")+" &nbsp;&nbsp;&lt;N&gt;:"+lang("generatePeople")+" &nbsp;"}}),new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:90px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("forExampleSalesReport")+"&lt;L&gt;&lt;Y&gt;-&lt;M&gt;-&lt;D&gt; => "+lang("salesReportForTravel")}}),{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"textarea",fieldLabel:lang("canExportDataStaff"),name:"excel",width:200,height:80,readOnly:true,listeners:{afterrender:function(d){d.mon(d.el,"click",function(){var e=b.findField("excelUid").getValue();new_selector("user",b.findField("excel"),b.findField("excelUid"),true,c.baseUrl+"&task=selector&target=user",e)})}}},{xtype:"hidden",name:"excelUid"}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:30px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("reminderAllNull")}})]}]});var b=this.infoPanel.getForm();if(this.fromUser){var a=[this.infoPanel]}else{var a=[this.conPanel,this.infoPanel]}this.top=new Ext.Panel({region:"north",layout:"border",height:250,items:a});return this.top},bottom:function(){var b=this;this.templeFields=["fieldid","kong","title","width","calculate","color","unit","unitposition","baoliu","comma","round","advancecount","type"];this.templeStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList&from=all",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.templeFields})});this.templeColModel=new Ext.grid.ColumnModel([{header:"",hidden:true,dataIndex:"fieldid"},{header:lang("bingdingFileName"),width:150,sortable:true,dataIndex:"kong",menuDisabled:true},{id:"title",header:lang("customName"),sortable:true,dataIndex:"title",menuDisabled:true,editor:{xtype:"textfield",allowBlank:true}},{header:lang("width"),width:80,sortable:true,dataIndex:"width",menuDisabled:true,editor:{xtype:"textfield",allowBlank:true}},{header:lang("opt"),width:150,sortable:true,dataIndex:"kong",menuDisabled:true,renderer:function(g,k,e,j){var d="";var f=e.data;if(f.getType==1){var h="平均"}else{var h="合计"}if(f.fieldid=="operate"){return}d+='<a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.editAdvance(\''+j+"')\">"+lang("seniorEdit")+"</a>";if(f.fieldid==0||f.type=="create"){d+=' / <a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.createKongjian(\''+j+"', 'edit')\">"+lang("edit")+'</a> / <a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.deleteCreate(\''+j+'\')"><span class="cnoa_color_red">'+lang("del")+"</span></a>"}if(f.fromUser!=="0"){d+=' / <a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.setType(\''+j+"',"+f.getType+",'"+f.fieldid+"')\">"+h+"</a>"}return d}}]);this.templePanel=new Ext.grid.EditorGridPanel({region:"center",ddGroup:"wordDDGroup",layout:"fit",enableDragDrop:true,store:this.templeStore,cm:this.templeColModel,autoExpandColumn:"title",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),clicksToEdit:1,border:false,listeners:{afterrender:function(c){if(!b.fromUser){setTimeout(function(){new Ext.dd.DropTarget(b.wordPanel.getView().scroller.dom,{ddGroup:"wordDDGroup",notifyEnter:function(g,f,d){},notifyDrop:function(j,h,g){var d=j.dragData.selections;Ext.each(d,j.grid.store.remove,j.grid.store);var f=j.getDragData(h).rowIndex;if(typeof(f)=="undefined"){b.wordPanel.store.add(d)}else{b.wordStore.insert(f,d)}}})},1000)}}},tbar:new Ext.Toolbar({style:"border-top-width:1px;",height:27,items:[{text:lang("preview"),handler:function(){if(b.templeStore.data.items.length==0){return CNOA.msg.alert(lang("notAddColumn"))}var c=[];setTimeout(function(){b.previewColumn()})}},{text:lang("createCustomDate"),handler:function(){b.createKongjian(0,"add")}},{text:"添加其他流程字段",hidden:b.fromUser,handler:function(){b.addOtherFlowFieldsWin()}},lang("canDragColumLeft")]})});this.wordFields=["fieldid","kong","title","width","calculate","color","unit","unitposition","baoliu","comma","round","advancecount","expressionText","type"];this.wordStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList&from=all",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.wordFields}),listeners:{load:function(e,c,d){}}});this.wordColModel=new Ext.grid.ColumnModel([{id:"name",header:lang("controlName"),sortable:true,dataIndex:"kong",menuDisabled:true}]);this.wordPanel=new Ext.grid.GridPanel({region:"west",width:300,ddGroup:"wordDDGroup",layout:"fit",enableDragDrop:true,store:this.wordStore,cm:this.wordColModel,autoExpandColumn:"name",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),dropConfig:{appendOnly:true},border:false,bodyStyle:"border-right-width:1px;",listeners:{afterrender:function(c){setTimeout(function(){new Ext.dd.DropTarget(b.templePanel.getView().scroller.dom,{ddGroup:"wordDDGroup",notifyDrop:function(j,h,g){var d=j.dragData.selections;Ext.each(d,j.grid.store.remove,j.grid.store);var f=j.getDragData(h).rowIndex;if(typeof(f)=="undefined"){b.templePanel.store.add(d)}else{b.templeStore.insert(f,d)}}})},1000)}},tbar:new Ext.Toolbar({height:27,style:"border-right-width:1px;border-top-width:1px;",items:[lang("canDragColumnAdd")]})});if(this.fromUser){var a=[this.templePanel]}else{var a=[this.wordPanel,this.templePanel]}this.bottom=new Ext.Panel({region:"center",layout:"border",items:a});return this.bottom},deleteCreate:function(a){var b=this;CNOA.msg.cf(lang("areYouDelete"),function(c){if(c=="yes"){b.templeStore.removeAt(a)}})},createKongjian:function(n,k){var f=this;var e=["kong","fieldid"];var m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList&from=normal",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e}),listeners:{load:function(){var o=Ext.data.Record.create([{name:"fieldid",name:"kong"}]);Ext.each(f.templeStore.data.items,function(q,r){if(q.data.type=="create"||q.data.fromMerge!=0||q.data.fromUser!=0){var p=new o({fieldid:q.data.fieldid,kong:q.data.kong});m.add(p)}})}}});var j=new Ext.grid.ColumnModel([{header:lang("controlName"),width:170,sortable:true,dataIndex:"kong",menuDisabled:true}]);var b=new Ext.grid.GridPanel({store:m,region:"west",width:200,border:false,cm:j,ddGroup:"gridDDGroup",enableDragDrop:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.ID_TEXTAREA_EXPRESSION=Ext.id();var c="";var h=new Ext.form.FormPanel({autoScroll:true,region:"center",height:100,labelAlign:"right",labelWidth:40,padding:5,items:[{xtype:"textfield",fieldLabel:lang("name"),regex:/^(?!\d|_)[A-Za-z0-9\u4e00-\u9fa5_]+$/,regexText:lang("beginningNotOnlyNum"),name:"name",allowBlank:false,width:300},{xtype:"textarea",fieldLabel:lang("formula"),name:"expressionText",allowBlank:false,id:this.ID_TEXTAREA_EXPRESSION,width:550,height:150},{xtype:"panel",layout:"table",style:"margin-left:50px;",layoutConfig:{columns:12},border:false,defaults:{border:false},items:[{xtype:"button",text:lang("leftKuo")+'<span class="cnoa_color_red">(</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"(")}},{xtype:"button",style:"margin-left:10px;",text:lang("rightKuo")+'<span class="cnoa_color_red">)</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),")")}},{xtype:"button",style:"margin-left:10px;",text:lang("plus")+'<span class="cnoa_color_red">+</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"+")}},{xtype:"button",style:"margin-left:10px;",text:lang("minus")+'<span class="cnoa_color_red">－</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"－")}},{xtype:"button",style:"margin-left:10px;",text:lang("multiply")+'<span class="cnoa_color_red">×</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"×")}},{xtype:"button",style:"margin-left:10px;",text:lang("divsion")+'<span class="cnoa_color_red">/</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"/")}},{xtype:"button",style:"margin-left:10px;",text:lang("semicolon")+'<span class="cnoa_color_red">;</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),";")}},{xtype:"button",style:"margin-left:10px;",text:lang("equal")+'<span class="cnoa_color_red">==</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"==")}},{xtype:"button",style:"margin-left:10px;",text:lang("notEqual")+'<span class="cnoa_color_red">!=</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"!=")}},{xtype:"button",style:"margin-left:10px;",text:lang("and1"),handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"&&")}},{xtype:"button",style:"margin-left:10px;",text:lang("or"),handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"||")}},{xtype:"button",style:"margin-left:10px;",text:lang("if"),handler:function(){var o=c+"if(  ){\n"+c+"\n"+c+"}else{\n"+c+"\n"+c+"}";insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),o);c+="\t"}}]},{xtype:"panel",layout:"table",style:"margin-left:50px;margin-top:10px;",layoutConfig:{columns:10},border:false,defaults:{border:false},items:[{xtype:"button",text:'等号<span class="cnoa_color_red">=</span>',handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"=")}},{xtype:"button",text:lang("lessThan")+'<span class="cnoa_color_red"><</span>',style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"<")}},{xtype:"button",text:lang("greaterThan")+' <span class="cnoa_color_red">></span>',style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),">")}},{xtype:"button",text:lang("lessOrEqual")+' <span class="cnoa_color_red"><=</span>',style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"<=")}},{xtype:"button",text:lang("greaterOrEqual")+' <span class="cnoa_color_red">>=</span>',style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),">=")}},{xtype:"button",text:lang("assignMent")+' <span class="cnoa_color_red"><<=</span>',style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"<<=")}},{xtype:"button",text:lang("variate"),style:"margin-left:10px;",handler:function(){Ext.MessageBox.prompt("",lang("wantToSetInput"),function(o,p){if(o=="ok"){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"$"+p+"")}})}},{xtype:"button",text:lang("string"),style:"margin-left:10px;",handler:function(){Ext.MessageBox.prompt("",lang("enterStringDisplay"),function(o,p){if(o=="ok"){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),'"'+p+'"')}})}},{xtype:"button",text:lang("connector"),style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"[.]")}},{xtype:"button",text:lang("result"),style:"margin-left:10px;",handler:function(){insertAtCursor(Ext.getCmp(f.ID_TEXTAREA_EXPRESSION),"[result]")}}]}]});var g=new Ext.Window({title:lang("createCustomDate"),layout:"border",modal:true,width:940,height:400,items:[b,h],buttons:[{text:k=="edit"?lang("save"):lang("add"),handler:function(){if(!h.getForm().isValid()){CNOA.msg.alert(lang("beginOfEngOrCN"));return}var o=h.getForm().findField("name").getValue();if(o==""){CNOA.msg.alert(lang("alsoDoNotFill"));return}var p=h.getForm().findField("expressionText").getValue();if(p==""){CNOA.msg.alert(lang("doNotFillFormula"));return}Ext.Ajax.request({url:f.baseUrl+"&task=checkExpression",method:"POST",params:{expressionText:p,tid:f.tid},success:function(u){var q=Ext.decode(u.responseText);if(q.success==true){if(k=="edit"){f.templeStore.getAt(n).set("kong",o);f.templeStore.getAt(n).set("expressionText",p)}else{var t=new Ext.data.Record.create([{name:"fieldid"},{name:"kong"},{name:"title"},{name:"width"},{name:"calculate"},{name:"color"},{name:"unit"},{name:"unitposition"},{name:"baoliu"},{name:"comma"},{name:"round"},{name:"expressionText"}]);var s=new t({fieldid:0,kong:o,title:o,width:100,expressionText:p,type:"create"});f.templePanel.store.add(s)}g.close()}else{CNOA.msg.alert(q.msg,function(){})}}})}},{text:lang("close"),handler:function(){g.close()}}],listeners:{afterrender:function(){var p=h.body.dom;var o=new Ext.dd.DropTarget(p,{ddGroup:"gridDDGroup",notifyEnter:function(s,r,q){h.body.stopFx();h.body.highlight()},notifyDrop:function(t,s,r){var q=t.dragData.selections[0];insertAtCursor(h.getForm().findField("expressionText"),"["+q.data.kong+"]");return(true)}})}}}).show();if(k=="edit"){var a=f.templePanel.store.getAt(n);var d=a.data;h.getForm().findField("name").setValue(d.kong);h.getForm().findField("expressionText").setValue(d.expressionText)}},deleteData:function(a){var b=this;CNOA.msg.cf(lang("sureWantDelTemp"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteTemple",method:"POST",params:{tid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(lang("reportTemp"),lang("delSuccess"));b.conStore.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},previewColumn:function(){var g=this;var b=[];var a=[];Ext.each(g.templeStore.data.items,function(j,k){var m=j.data;var h={};h.header=m.title;h.sortable=true;h.dataIndex=m.fileid;h.width=+m.width;h.menuDisabled=true;b.push(h)});var c=new Ext.data.Store({reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var d=new Ext.grid.ColumnModel(b);var e=new Ext.grid.GridPanel({store:c,region:"center",bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:d,hideBorders:true,border:false,autoScroll:true});var f=new Ext.Window({title:lang("previewColumn"),layout:"border",modal:true,maximized:true,items:[e]}).show()},editData:function(a){var b=this;b.tid=a;this.infoPanel.getForm().load({url:b.baseUrl+"&task=loadFormData&tid="+a,method:"POST",waitTitle:lang("notice"),success:function(f,g){var e=g.result.data;var d=Ext.decode(e.column);var c=Ext.data.Record.create([{name:"name"}]);b.templeStore.removeAll();Ext.each(d,function(j,k){var h=new c({fieldid:j.fieldid,kong:j.kong,title:j.title,width:j.width,calculate:j.calculate,color:j.color,unit:j.unit,unitposition:j.unitposition,advancecount:j.advancecount,baoliu:j.baoliu,comma:j.comma,round:j.round,expressionText:j.expressionText,type:j.type,fromMerge:j.fromMerge,fromUser:j.fromUser,getType:j.getType});b.templeStore.add(h)});b.wordStore.load({params:{tid:a}});Ext.getCmp("ID_BTN_SAVE").show()},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){})}})},submitData:function(c){var b=this;if(b.infoPanel.getForm().isValid()){columnData=[];Ext.each(b.templeStore.data.items,function(d,e){columnData.push(d.data)});if(b.fromUser){var a=b.baseUrl+"&task=submitcolumn&fromid="+CNOA.report.use_wf_temple.fromid}else{var a=b.baseUrl+"&task=submitcolumn"}if(c=="edit"){a+="&tid="+b.tid}b.infoPanel.getForm().submit({url:a,method:"POST",waitMsg:lang("waiting"),params:{data:Ext.encode(columnData)},success:function(e,f){var d=f.result;if(d.success===true){b.conStore.reload();b.infoPanel.getForm().reset();b.wordStore.load();b.templeStore.removeAll();Ext.getCmp("ID_BTN_SAVE").hide();if(d.msg=="操作成功"){CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}if(b.fromUser){setTimeout(function(){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");if(CNOA_report_user_setting.store){CNOA_report_user_setting.store.reload()}},100)}}else{CNOA.msg.alert(d.msg,function(){})}}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}},editAdvance:function(h){var f=this;var d=["color","value1","value2","logic","condit1","condit2","content"];var m=new Ext.data.Store({reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var k=new Ext.grid.ColumnModel([{header:lang("condition"),width:80,sortable:true,dataIndex:"condit1",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["大于","大于"],["小于","小于"],["等于","等于"],["大于或等于","大于或等于"],["小于或等于","小于或等于"]]}),value:"大于",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("value"),width:140,sortable:true,dataIndex:"value1",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("logic"),width:40,sortable:true,dataIndex:"logic",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["或","或"],["并","并"]]}),value:"或",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("condition"),width:80,sortable:true,dataIndex:"condit2",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["大于","大于"],["小于","小于"],["等于","等于"],["大于或等于","大于或等于"],["小于或等于","小于或等于"]]}),value:"大于",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("value"),width:140,sortable:true,dataIndex:"value2",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("selectColor"),width:100,sortable:true,dataIndex:"color",menuDisabled:true,editor:{xtype:"colorfield",defaultColor:"000000",editable:false,name:"title_color"},renderer:function(o,p,n){return'<div style="background-color:#'+o+'; width:80px; height:15px;"></div>'}},{header:lang("showContent"),width:100,sortable:true,dataIndex:"content",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("opt"),width:80,sortable:true,dataIndex:"color",menuDisabled:true,renderer:function(o,q,n,p){return'<a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.deleteCondit('+p+')"><span class="cnoa_color_red">'+lang("del")+"</span></a>"}}]);var a=new Ext.grid.EditorGridPanel({store:m,layout:"fit",region:"center",border:false,cm:k,clicksToEdit:1,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:[{text:lang("addCondition"),handler:function(){var o=a.getStore().recordType;var n=new o({condit1:lang("greaterThan"),condit2:lang("lessThan"),logic:lang("and1"),color:"000000"});a.stopEditing();m.insert(0,n);a.startEditing(0,0)}}]});f.ID_TEXT_FIELD_ADVANCED=Ext.id();var j=new Ext.form.FormPanel({autoScroll:true,region:"north",height:100,border:false,labelAlign:"right",labelWidth:80,padding:5,items:[{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"radiogroup",fieldLabel:lang("unitAddLocation"),width:200,items:[{boxLabel:lang("rear"),name:"unitposition",inputValue:0,checked:true},{boxLabel:lang("pre"),name:"unitposition",inputValue:1}]}]},{xtype:"panel",layout:"table",layoutConfig:{columns:3},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"textfield",fieldLabel:lang("unitName"),name:"unit"}]},{xtype:"checkboxgroup",width:75,style:"margin-left:5px",items:[{boxLabel:lang("addComma"),name:"comma",inputValue:1}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:10px",html:'<a href="javascript:void(0)" id="danwei">'+lang("unitSettingSM")+"</a>"}})]}]},{xtype:"panel",layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false},items:[{layout:"form",items:[new Ext.form.ComboBox({fieldLabel:lang("columnCount"),store:new Ext.data.SimpleStore({fields:["value","name"],data:[[0,"无"],[1,"列平均数"],[2,"列总和"],[4,"列最大值"],[5,"列最小值"],[6,"列数量"],[7,"高级列数量"]]}),width:200,hiddenName:"calculate",name:"calculate",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(p,n,o){if(o==6){f.countWin()}}}}),{xtype:"hidden",name:"advancecount",id:f.ID_TEXT_FIELD_ADVANCED}]},{xtype:"panel",layout:"table",layoutConfig:{columns:3},border:false,defaults:{border:false},items:[{layout:"form",items:[{xtype:"textfield",fieldLabel:lang("keepFigures"),width:50,value:0,name:"baoliu"}]},{xtype:"checkboxgroup",width:75,style:"margin-left:5px",items:[{boxLabel:lang("rounding"),name:"round",inputValue:1}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:10px",html:'<a href="javascript:void(0)" id="baoliuweishu">'+lang("keepFiguresSm")+"</a>"}})]}]}]});var g=new Ext.Window({title:lang("columnSeniorEdit"),layout:"border",modal:true,width:800,height:400,items:[a,j],buttons:[{text:lang("save"),handler:function(){var n=j.getForm().getValues();var o=[];Ext.each(m.data.items,function(p,q){o.push(p.data)});f.templeStore.getAt(h).set("color",o);f.templeStore.getAt(h).set("baoliu",n.baoliu);f.templeStore.getAt(h).set("calculate",n.calculate);f.templeStore.getAt(h).set("unit",n.unit);f.templeStore.getAt(h).set("unitposition",n.unitposition);f.templeStore.getAt(h).set("comma",n.comma);f.templeStore.getAt(h).set("round",n.round);f.templeStore.getAt(h).set("advancecount",n.advancecount);g.close()}},{text:lang("close"),handler:function(){g.close()}}],listeners:{afterrender:function(){var n=lang("value")+"3.5, "+lang("keepFigures")+"0， "+lang("isDisplay")+"4";n+="<br />";n+=lang("value")+"3.2, "+lang("keepFigures")+"0， "+lang("isDisplay")+"3";n+="<br />";n+=lang("value")+"1.95583, "+lang("keepFigures")+"2， "+lang("isDisplay")+"1.96";n+="<br />";n+=lang("value")+"1241757, "+lang("keepFigures")+"-3， "+lang("isDisplay")+"1242000";n+="<br />";n+=lang("value")+"5.045, "+lang("keepFigures")+"2， "+lang("isDisplay")+"5.05";new Ext.ToolTip({target:"baoliuweishu",html:n,title:lang("keepFiguresSm"),autoHide:false,closable:true,draggable:true});var n=lang("ifUnitIs")+"%,"+lang("locationSelectRear")+"， "+lang("isDisplay")+" 89%";n+="<br />";n+=lang("ifUnitIs")+"￥,"+lang("locationSelectFront")+"， "+lang("isDisplay")+" ￥999";n+="<br />";new Ext.ToolTip({target:"danwei",html:n,title:lang("unitSettingSM"),autoHide:false,closable:true,draggable:true})}}}).show();this.deleteCondit=function(n){m.removeAt(n)};var e=f.templeStore.getAt(h).data,c=e.color;if(c!=null){Ext.each(c,function(o,p){var q=Ext.data.Record.create([{name:"name"}]);var n=new q({value1:o.value1,value2:o.value2,logic:o.logic,condit1:o.condit1,condit2:o.condit2,color:o.color,content:o.content});m.add(n)})}var b=j.getForm();if(e.baoliu!=undefined){b.findField("baoliu").setValue(e.baoliu)}if(e.calculate!=undefined){b.findField("calculate").setValue(e.calculate)}if(e.unit!=undefined){b.findField("unit").setValue(e.unit)}if(e.unitposition!=undefined){b.findField("unitposition").setValue(e.unitposition)}if(e.comma!=undefined){b.findField("comma").setValue(e.comma)}if(e.round!=undefined){b.findField("round").setValue(e.round)}if(e.advancecount!=undefined){b.findField("advancecount").setValue(e.advancecount)}},countWin:function(){var g=this;var a=["name","value1","value2","logic","condit1","condit2"];var b=new Ext.data.Store({reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.ColumnModel([{header:lang("name"),width:140,sortable:true,dataIndex:"name",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("condition"),width:80,sortable:true,dataIndex:"condit1",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["大于","大于"],["小于","小于"],["等于","等于"],["大于或等于","大于或等于"],["小于或等于","小于或等于"]]}),value:"大于",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("value"),width:100,sortable:true,dataIndex:"value1",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("logic"),width:40,sortable:true,dataIndex:"logic",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["或","或"],["并","并"]]}),value:"或",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("condition"),width:80,sortable:true,dataIndex:"condit2",menuDisabled:true,editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:[["大于","大于"],["小于","小于"],["等于","等于"],["大于或等于","大于或等于"],["小于或等于","小于或等于"]]}),value:"大于",valueField:"value",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})},{header:lang("value"),width:100,sortable:true,dataIndex:"value2",menuDisabled:true,editor:{xtype:"textfield"}},{header:lang("opt"),width:80,sortable:true,dataIndex:"color",menuDisabled:true,renderer:function(j,m,h,k){return'<a href="javascript:void(0)" onclick="CNOA_report_use_wf_temple.deleteCountCondit('+k+')"><span class="cnoa_color_red">'+lang("del")+"</span></a>"}}]);var d=new Ext.grid.EditorGridPanel({store:b,layout:"fit",region:"center",border:false,cm:c,clicksToEdit:1,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:[{text:lang("addCondition"),handler:function(){var j=d.getStore().recordType;var h=new j({condit1:lang("equal"),condit2:lang("notEqual"),logic:lang("or"),name:lang("undefines")});d.stopEditing();b.insert(0,h);d.startEditing(0,0)}}]});var e=new Ext.Window({title:lang("columnTotal"),layout:"border",modal:true,width:680,height:300,items:d,buttons:[{text:lang("save"),handler:function(){var h=[];Ext.each(b.data.items,function(j,k){h.push(j.data)});Ext.getCmp(g.ID_TEXT_FIELD_ADVANCED).setValue(Ext.encode(h));e.close()}},{text:lang("close"),handler:function(){e.close()}}]}).show();var f=Ext.getCmp(g.ID_TEXT_FIELD_ADVANCED).getValue();if(f!=""){f=Ext.decode(f);Ext.each(f,function(j,k){var m=Ext.data.Record.create([{name:"name"}]);var h=new m({value1:j.value1,value2:j.value2,logic:j.logic,condit1:j.condit1,condit2:j.condit2,name:j.name});b.add(h)})}this.deleteCountCondit=function(h){b.removeAt(h)}},addOtherFlowFieldsWin:function(){var h=this;var b=["id","flowId","name"];var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"id",hidden:true},{header:"flowId",dataIndex:"flowId",hidden:true},{header:"[流程分类]流程名称",dataIndex:"name",width:270},{header:lang("opt"),dataIndex:"",width:300,align:"center",renderer:h.makeOperate}]});var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getMergeFlowList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:b})});var f=Ext.id();var d=new Ext.grid.GridPanel({store:c,cm:a,sm:g,layout:"fit",border:false,height:300,tbar:new Ext.Toolbar({items:["选择流程：",{xtype:"combo",width:250,displayField:"name",valueField:"flowId",triggerAction:"all",id:f,editable:false,mode:"local",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getFlowList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["flowId","name"]})})},{text:"添加流程",handler:function(){var k=Ext.getCmp(f).getValue();var j=Ext.getCmp(f).lastSelectionText;if(Ext.isEmpty(k)){CNOA.msg.alert("请选择流程")}else{Ext.Ajax.request({url:h.baseUrl+"&task=saveFlow",params:{otherFlowId:k,name:j},method:"POST",success:function(n){var m=Ext.decode(n.responseText);if(m.success){CNOA.msg.notice2(m.msg);c.reload()}else{CNOA.msg.alert(m.msg)}}})}}}]})});h.mergeGrid=d;var e=new Ext.Window({modal:true,items:[d],title:"添加其他流程字段"}).show()},makeOperate:function(j,f,d){var a=d.json.id,h=d.json.tids,b=d.json.fieldsMap,e=d.json.otherFlowId,k=d.json.conditionId,g=d.json.dataType,c=d.json.condition?1:0;j='<a href="javascript:void(0);"  class="gridview" onclick="CNOA_report_use_wf_temple.setCondition('+a+",'"+b+"',"+e+');">连接条件</a> ';j+='<a href="javascript:void(0);"  class="gridview3" onclick="CNOA_report_use_wf_temple.setFields('+a+",'"+b+"',"+e+","+g+');">设置字段</a> ';j+='<a href="javascript:void(0);"  class="gridview2" onclick="CNOA_report_use_wf_temple.setTemple('+a+",'"+h+"',"+c+');">选择模板</a> ';j+='<a href="javascript:void(0);"  class="gridview" onclick="CNOA_report_use_wf_temple.selectCondition('+a+","+e+","+k+');">筛选数据</a> ';j+='<a href="javascript:void(0);"  class="gridview4" onclick="CNOA_report_use_wf_temple.delTemple('+a+');">删除</a>';return j},selectCondition:function(h,f,d){var g=this;var a=["name","id"];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getSelectCondition&flowId="+f,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:a}),listeners:{load:function(){if(d){Ext.getCmp(c).setValue(d)}}}});var c=Ext.id();var e=new Ext.Window({items:[{fieldLabel:"筛选条件",xtype:"combo",store:b,id:c,valueField:"id",displayField:"name",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false}],bodyStyle:"margin:5px;",layout:"form",labelWidth:80,title:"筛选数据",modal:true,width:320,buttons:[{text:"确定",handler:function(){var j=Ext.getCmp(c).getValue();if(j){Ext.Ajax.request({url:g.baseUrl+"&task=selectCondition",params:{id:h,conditionId:j},method:"POST",success:function(m){var k=Ext.decode(m.responseText);if(k.success){CNOA.msg.notice2(k.msg);conditionStore.reload();g.mergeGrid.getStore().reload()}else{CNOA.msg.alert(k.msg)}}})}else{CNOA.msg.alert("请选择条件")}}},{text:"取消",handler:function(){e.hide()}}]}).show()},setCondition:function(c,e,n){var m=this;var j=["fieldid","kong"];var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:m.baseUrl+"&task=getMergeFlowFields&from=all&flowId="+n,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:j})});var f=new Ext.form.ComboBox({fieldLabel:"主流程报表字段",store:m.treeStore,valueField:"fieldid",displayField:"kong",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false});var h=new Ext.form.ComboBox({fieldLabel:"次流程报表字段",store:d,valueField:"fieldid",displayField:"kong",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false});var g=new Ext.Button({text:"添加条件",width:80,cls:"btn-blue3",handler:function(){var r=f.getValue(),s=h.getValue(),u="[主]"+f.lastSelectionText,t="[次]"+h.lastSelectionText;if(Ext.isEmpty(r)||Ext.isEmpty(s)){CNOA.msg.alert("请选择字段")}else{Ext.Ajax.request({url:m.baseUrl+"&task=saveCondition",params:{flowField:r,id:c,otherFlowField:s,flowFieldText:u,otherFlowFieldText:t},method:"POST",success:function(w){var v=Ext.decode(w.responseText);if(v.success){CNOA.msg.notice2(v.msg);o.reload();m.mergeGrid.getStore().reload()}else{CNOA.msg.alert(v.msg)}}})}}});var p=["flowField","otherFlowField","name"];var o=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:m.baseUrl+"&task=getCondition&otherFlowId="+n+"&id="+c,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:p})});var q=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"flowField",dataIndex:"flowField",hidden:true},{header:"条件",dataIndex:"name",width:210},{header:lang("opt"),dataIndex:"",align:"center",width:50,renderer:function(t,s,r){var t='<a href="javascript:void(0);"  class="gridview4" onclick="CNOA_report_use_wf_temple.delCondition( '+c+", '"+r.data.flowField+"');\">删除</a> ";return t}}]});var b=new Ext.grid.GridPanel({cm:q,border:false,id:"ID_CONDITION_GRID",store:o,layout:"fit",height:130});var a=new Ext.Panel({border:false,layout:"form",style:"margin:5px;",items:[f,h,g],labelWidth:95});var k=new Ext.Window({items:[a,b],title:"连接条件",modal:true,width:320}).show()},setFields:function(b,d,k,m){var j=this;var g=["fieldid","kong"];var c=[];var o=new Ext.data.Store({autoLoad:true,baseParams:{type:m},proxy:new Ext.data.HttpProxy({url:j.baseUrl+"&task=getMergeFlowFields&flowId="+k,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:g}),listeners:{load:function(){if(d!="0"){var p=d.split("|");o.each(function(s){for(var q=0;q<p.length;q++){if(p[q]==s.data.fieldid){c.push(s);break}}})}a.getSelectionModel().selectRecords(c)}}});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var n=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"fieldid",dataIndex:"fieldid",hidden:true},{header:"名称",dataIndex:"kong",width:200}]});var e=Ext.id();var a=new Ext.grid.GridPanel({sm:f,cm:n,border:false,store:o,layout:"fit",height:160,tbar:new Ext.Toolbar({items:[{xtype:"radiogroup",id:e,style:"margin-left:5px;",width:180,items:[{boxLabel:"普通数据",name:"selectorType",inputValue:0,checked:!m},{boxLabel:"明细表数据",name:"selectorType",inputValue:1,checked:m}],listeners:{change:function(p){o.reload({params:{type:p.getValue()}})}}}]})});var h=new Ext.Window({items:[a],title:"设置字段",modal:true,width:280,buttons:[{text:lang("save"),handler:function(){var s=a.getSelectionModel().getSelections();var r="",q=Ext.getCmp(e).getValue();if(s.length>0){for(var p=0;p<s.length;p++){r+=s[p].data.fieldid+"|"}r=r.substr(0,r.length-1)}Ext.Ajax.request({url:j.baseUrl+"&task=saveFields",params:{fieldids:r,id:b,type:q},method:"POST",success:function(u){var t=Ext.decode(u.responseText);if(t.success){CNOA.msg.notice2(t.msg);j.mergeGrid.getStore().reload();h.hide()}else{CNOA.msg.alert(t.msg)}}})}}]}).show()},setTemple:function(b,h,d){if(d==0){CNOA.msg.alert("请先设置条件");return}var g=this;var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"tid",dataIndex:"tid",hidden:true},{header:"名称",dataIndex:"name",width:200}]});var a=new Ext.grid.GridPanel({sm:e,cm:j,border:false,store:g.conStore,layout:"fit",height:160});var c=[];if(h!="0"){h=h.split("|");g.conStore.each(function(m){for(var k=0;k<h.length;k++){if(h[k]==m.data.tid){c.push(m);break}}})}var f=new Ext.Window({items:[a],title:"选择模板",modal:true,width:280,buttons:[{text:lang("save"),handler:function(){var m=a.getSelectionModel().getSelections();var n="";if(m.length>0){for(var k=0;k<m.length;k++){n+=m[k].data.tid+"|"}n=n.substr(0,n.length-1)}Ext.Ajax.request({url:g.baseUrl+"&task=saveTemple",params:{tids:n,id:b},method:"POST",success:function(p){var o=Ext.decode(p.responseText);if(o.success){g.mergeGrid.getStore().reload();f.hide();if(o.msg=="操作成功"){CNOA.msg.notice2(o.msg)}else{CNOA.msg.alert(o.msg)}}else{CNOA.msg.alert(o.msg)}}})}}],listeners:{show:function(){setTimeout(function(){a.getSelectionModel().selectRecords(c)},300)}}}).show()},delCondition:function(c,a){var b=this;CNOA.msg.cf("确定删除?",function(d){if(d=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=delCondition",params:{id:c,flowField:a},method:"POST",success:function(f){var e=Ext.decode(f.responseText);if(e.success){CNOA.msg.notice2(e.msg);Ext.getCmp("ID_CONDITION_GRID").getStore().reload()}}})}})},delTemple:function(b){var a=this;CNOA.msg.cf("确定删除?",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delTemple",params:{id:b},method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success){CNOA.msg.notice2(d.msg);a.mergeGrid.getStore().reload()}}})}})},setType:function(d,b,a){var e=this;var c="合计值";if(b==1){b=2;c="平均值"}else{b=1}CNOA.msg.cf("点击确定后将设置为"+c,function(f){if(f=="yes"){Ext.Ajax.request({url:e.baseUrl+"&task=setType",params:{type:b,tid:e.tid,fieldid:a},method:"POST",success:function(h){var g=Ext.decode(h.responseText);if(g.success){CNOA.msg.notice2(g.msg);e.templeStore.getAt(d).set("getType",b)}}})}})}};var CNOA_report_use_wf_templelistClass,CNOA_report_use_wf_templelist;CNOA_report_use_wf_templelistClass=CNOA.Class.create();CNOA_report_use_wf_templelistClass.prototype={init:function(){var b=this;var a=Ext.id();this.ID_FAVNOTICE=Ext.id();this.baseUrl="index.php?app=report&func=form&action=use&modul=wf";this.storeBar={flowName:"",name:"",sortId:0};this.nowSortType="normal";this.fields=[{name:"tid"},{name:"flowName"},{name:"name"},{name:"conName"},{name:"fromid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTempleJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:lang("tempName"),dataIndex:"name",width:140,sortable:false,menuDisabled:true},{header:lang("conditionName"),dataIndex:"conName",width:140,sortable:false,menuDisabled:true},{header:lang("flowName"),dataIndex:"flowName",id:"flowName",width:140,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"fromid",width:200,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.storeBar)}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",autoExpandColumn:"flowName",stripeRows:true,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(c,d){b.store.reload()}.createDelegate(this)},"->",lang("conditionName")+":",{xtype:"textfield",width:200,id:a,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}}}},{xtype:"button",text:lang("search"),style:"margin-left:5px",iconCls:"icon-search",handler:function(){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(a).setValue("");b.storeBar.name="";b.store.load({params:b.storeBar})}}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},makeOperate:function(g,e,a,j,c,f){var d=a.data;var b="";b+="<a href='javascript:void(0);' class='gridview' onclick='CNOA_report_use_wf_templelist.temple("+g+");'>"+lang("setTemp")+"</a>";return b},temple:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=temple&flowId="+a,"CNOA_MENU_REPORT_USE_WF_TEMPLE",lang("setReportTemp"),"icon-table-insert")}};var CNOA_report_use_wf_conlistClass,CNOA_report_use_wf_conlist;CNOA_report_use_wf_conlistClass=CNOA.Class.create();CNOA_report_use_wf_conlistClass.prototype={init:function(){var b=this;var a=Ext.id();this.ID_FAVNOTICE=Ext.id();this.baseUrl="index.php?app=report&func=form&action=use&modul=wf";this.storeBar={flowName:"",name:"",sortId:0};this.nowSortType="normal";this.fields=[{name:"id"},{name:"flowName"},{name:"name"},{name:"flowid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getConJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:lang("conditionName"),dataIndex:"name",width:140,sortable:false,menuDisabled:true},{header:lang("flowName"),dataIndex:"flowName",id:"flowName",width:140,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"flowid",width:200,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.storeBar)}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",autoExpandColumn:"flowName",stripeRows:true,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(c,d){b.store.reload()}.createDelegate(this)},"->",lang("conditionName")+":",{xtype:"textfield",width:200,id:a,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}}}},{xtype:"button",text:lang("search"),style:"margin-left:5px",iconCls:"icon-search",handler:function(){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(a).setValue("");b.storeBar.name="";b.store.load({params:b.storeBar})}}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},makeOperate:function(g,e,a,j,c,f){var d=a.data;var b="";b+="<a href='javascript:void(0);' class='gridview' onclick='CNOA_report_use_wf_conlist.setting("+g+");'>"+lang("settingCondition")+"</a>";return b},setting:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_SETTING");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=setting&flowId="+a,"CNOA_MENU_REPORT_USE_WF_SETTING",lang("setConditionReport"),"icon-table-insert")}};var CNOA_report_use_wfClass,CNOA_report_use_wf;CNOA_report_use_wfClass=CNOA.Class.create();CNOA_report_use_wfClass.prototype={init:function(){var b=this;this.dsc=Ext.data.Record.create([{name:"",tempname:""}]);var a=Ext.id();this.ID_FAVNOTICE=Ext.id();this.baseUrl="index.php?app=report&func=form&action=use&modul=wf";this.storeBar={flowName:"",sortId:0};this.nowSortType="normal";this.fields=[{name:"flowId"},{name:"flowName"},{name:"sname"},{name:"about"},{name:"nameRuleId"},{name:"buildtime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"flowId",dataIndex:"flowId",hidden:true},{header:lang("flowName"),dataIndex:"flowName",id:"flowName",width:140,sortable:true,menuDisabled:true},{header:lang("sort2"),dataIndex:"sname",width:140,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"flowId",width:200,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.storeBar)}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",autoExpandColumn:"flowName",stripeRows:true,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(c,d){b.store.reload()}.createDelegate(this)},{text:lang("iDefineCondition"),style:"margin-left:5px",cls:"btn-blue4",handler:function(){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_CONLIST");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=conlist","CNOA_MENU_REPORT_USE_WF_CONLIST",lang("iDefineCondition"),"icon-table-insert")}},{text:lang("iDefineTemp"),style:"margin-left:5px",cls:"btn-blue4",handler:function(){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLELIST");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=templelist","CNOA_MENU_REPORT_USE_WF_TEMPLELIST",lang("iDefineTemp"),"icon-table-insert")}},"->",(lang("flowName")+":"),{xtype:"textfield",width:200,id:a,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){b.storeBar.flowName=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}}}},{xtype:"button",text:lang("search"),style:"margin-left:5px",iconCls:"icon-search",handler:function(){b.storeBar.flowName=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(a).setValue("");b.storeBar.flowName="";b.store.load({params:b.storeBar})}}]}),bbar:this.pagingBar,listeners:{afterrender:function(d){var c=new Ext.dd.DropTarget(b.grid.getEl(),{ddGroup:"GridDD",copy:false,notifyDrop:function(f,m,k){if(b.nowSortType=="wffav"){var j=k.selections;var g=f.getDragData(m).rowIndex;if(typeof(g)=="undefined"){return}for(i=0;i<j.length;i++){var h=j[i];if(!this.copy){b.store.remove(h)}if(g==0){h.data.orderNum-=1}else{if(g==b.store.data.items.length){h.data.id=b.store.data.items[g-1].data.id+1}else{h.data.id=(b.store.data.items[g-1].data.id+b.store.data.items[g].data.id)/2}}b.store.insert(g,h)}b.orderFavFlow()}}})}}});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("processCategoryList"),type:"",sortId:"0",iconCls:"icon-tree-root-cnoa",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){b.sortTree.selectPath(b.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(c){if(c.attributes.from=="wffav"){b.store.load({params:{sort:"wffav"}});b.grid.getBottomToolbar().hide();b.grid.doLayout();b.nowSortType="wffav";return}b.grid.getBottomToolbar().show();b.grid.doLayout();b.storeBar.sortId=c.attributes.sortId;b.store.load({params:b.storeBar});b.nowSortType="normal"}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:180,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("processCategoryList"),"->",{handler:function(c,d){b.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid,this.sortPanel]})},makeFav:function(j,f,d,g,e,b){var k=d.data;var a="./resources/images/icons/";var c="";if(this.nowSortType=="normal"){c+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_report_use_wf.addFavFlow("+j+");' ext:qtip='"+lang("collectProcess")+"'><img src='"+a+"heart.png' style='margin:2px 2px 4px 2px' align='absmiddle' />"+lang("collect")+"</a>"}else{if(this.nowSortType=="wffav"){c+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_report_use_wf.delFavFlow("+j+");' ext:qtip='"+lang("delCollectionProcess")+"'><img src='"+a+"icon-attac-delete.gif' style='margin:2px 2px 4px 2px' align='absmiddle' />"+lang("delFlowBind")+"</a>"}}return c},makeOperate:function(j,f,d,g,e,b){var k=d.data;var a="./resources/images/icons/";var c="";c+="<a href='javascript:void(0);' class='gridview' onclick='CNOA_report_use_wf.setting("+j+","+k.nameRuleId+");'>"+lang("settingCondition")+"</a> ";c+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_report_use_wf.temple("+j+");'>"+lang("setTemp")+"</a>";return c},buildFast:function(a){var b=this;b.mainPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=buildFast",method:"POST",params:{flowid:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice("",lang("quicklyGenerate"));b.mainPanel.getEl().unmask();b.store.reload();b.downloadWin(c.msg)}else{b.mainPanel.getEl().unmask();CNOA.msg.alert(c.msg,function(){})}}})},downloadWin:function(e){var h=this;var b=[{name:"name"},{name:"tempname"},{name:"fname"}];var c=new Ext.data.Store({reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});Ext.each(Ext.decode(e),function(k,m){var j=new h.dsc({name:k.name,tempname:k.tempname,fname:k.fname});c.add(j)});var g=new Ext.grid.CheckboxSelectionModel({});var a=[new Ext.grid.RowNumberer(),g,{header:lang("fileName"),dataIndex:"name",width:300,sortable:true},{header:lang("opt"),dataIndex:"tempname",width:100,sortable:true,renderer:function(j,n,m){var k=m.data;return"<a href=\"javascript:ajaxDownload('"+j+"');\">"+lang("download")+'</a> / <a href="javascript:void(0);" onclick="CNOA_report_use_wf.savedisk(\''+k.fname+",', '"+k.name+",')\">"+lang("saveTO")+"</a>"}}];var d=new Ext.grid.GridPanel({store:c,plain:false,region:"center",layout:"fit",border:false,autoScroll:true,columns:a,sm:g,stripeRows:true});var f=new Ext.Window({title:lang("processGenerating"),width:500,height:makeWindowHeight(500),modal:true,resizable:false,layout:"border",items:[d],buttons:[{text:lang("close"),handler:function(){f.close()}}]}).show()},savedisk:function(b,a){new Ext.MoveToDisk({data:b,name:a,from:"reportWf"})},setting:function(a,b){var c=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_SETTING");mainPanel.loadClass(c.baseUrl+"&task=loadPage&from=setting&flowId="+a,"CNOA_MENU_REPORT_USE_WF_SETTING",lang("setConditionReport"),"icon-table-insert")},temple:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=temple&flowId="+a,"CNOA_MENU_REPORT_USE_WF_TEMPLE",lang("setReportTemp"),"icon-table-insert")},viewFlow:function(a){var b=this;CNOA_wf_use_flowpreview=new CNOA_wf_use_flowpreviewClass(a)},viewForm:function(c){var j=this;var e=Ext.getBody().getBox();var b=e.width-100;var d=e.height-100;var f=function(){Ext.Ajax.request({url:j.baseUrl+"&task=show_loadFormInfo",method:"POST",params:{flowId:c},success:function(k){var h=Ext.decode(k.responseText);if(h.success===true){a.getEl().update("<center>"+h.data.formHtml+"</center>")}else{CNOA.msg.alert(h.msg,function(){})}g.getEl().unmask()}})};var a=new Ext.Panel({border:false,html:lang("workFormLoad")+"...",listeners:{afterrender:function(h){f()}}});var g=new Ext.Window({title:lang("viewJobForm"),width:b,height:d,layout:"fit",bodyStyle:"background-color:#FFFFFF",modal:true,autoScroll:true,maximizable:false,resizable:false,items:[a],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}}],listeners:{show:function(h){h.getEl().mask(lang("waiting"))}}}).show()},addFavFlow:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=addFavFlow",method:"POST",params:{flowId:a},success:function(d){var c=Ext.decode(d.responseText);CNOA.msg.notice(c.msg,lang("collectionFlow"));if(c.success===true){b.treeRoot.reload()}}})},delFavFlow:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delFavFlow",method:"POST",params:{flowId:a},success:function(d){var c=Ext.decode(d.responseText);CNOA.msg.notice(c.msg,lang("delCollectionProcess"));if(c.success===true){b.store.reload();b.treeRoot.reload()}}})},orderFavFlow:function(a){var c=this;var b=[];this.store.each(function(e,d){b.push(e.get("flowId"))});Ext.Ajax.request({url:this.baseUrl+"&task=orderFavFlow",method:"POST",params:{ids:b.join(",")},success:function(e){var d=Ext.decode(e.responseText);CNOA.msg.notice(d.msg,lang("sortCollectionFlow"))}})}};var CNOA_report_view_detail_wfClass,CNOA_report_view_detail_wf;CNOA_report_view_detail_wfClass=CNOA.Class.create();CNOA_report_view_detail_wfClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=report&func=form&action=view&modul=wf&tid="+CNOA.report.view_detail_wf.tid;this.baseUrl+="&hid="+CNOA.report.view_detail_wf.hid;Ext.Ajax.request({url:a.baseUrl+"&task=loadColumn",method:"POST",success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){var d=Ext.decode(b.msg);a.layoutPanel(d)}else{CNOA.msg.alert(b.msg,function(){})}}})},layoutPanel:function(c){var d=this;this.cmList=[];this.searchDatas={searchId:"",kong1:"",condition1:"equal",value1:"",kong2:"",condition2:"equal",value2:"",kong3:"",condition3:"equal",value3:"",kong4:"",condition4:"equal",value4:"",kong5:"",condition5:"equal",value5:""};Ext.each(c.data,function(e,f){if(e.dataIndex=="operate"){d.cmList.push({header:e.header,sortable:true,dataIndex:e.dataIndex,width:e.width,menuDisabled:e.menuDisabled,renderer:d.operate.createDelegate(this)})}else{if(e.dataIndex.search("M_")!=-1){d.cmList.push({header:e.header,sortable:true,dataIndex:e.dataIndex,width:e.width,menuDisabled:e.menuDisabled,renderer:d.operate2.createDelegate(this)})}else{d.cmList.push(e)}}});this.fields=c.fields;this.store=new Ext.data.GroupingStore({autoLoad:true,baseParams:this.searchDatas,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTempleJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),groupDir:c.group.order,groupField:c.group.field,listeners:{exception:function(k,j,m,h,g,f){var e=Ext.decode(g.responseText);if(e.failure){CNOA.msg.alert(e.msg)}}}});this.treeFields=["fieldid","kong","type","dataType"];this.treeStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getWordList&from=normal",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.treeFields})});if(c.page==0){this.pagingBar={}}else{this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:c.page})}this.colModel=new Ext.grid.ColumnModel(this.cmList);this.grid=new Ext.grid.GridPanel({store:this.store,region:"center",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,autoScroll:true,view:new Ext.grid.GroupingView({rowOverCls:"x-grid3-row-over2",groupTextTpl:"{text}",getRowClass:function(e,f){if(e.data.calculate=="calculate"){return"x-grid-record-gray"}}}),tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.store.reload()}},{text:lang("expandAll"),hidden:c.group.field==""?true:false,iconCls:"icon-style-tree",enableToggle:false,cls:"btn-blue4",pressed:true,toggleGroup:"btn_group",handler:function(){d.store.groupBy("group",true);d.grid.view.expandAllGroups()}},{text:lang("collapseAll"),hidden:c.group.field==""?true:false,iconCls:"icon-view-form-png",enableToggle:false,cls:"btn-green1",toggleGroup:"btn_group",handler:function(){d.store.groupBy("group",true);d.grid.view.collapseAllGroups()}},{text:lang("clearGroup"),hidden:c.group.field==""?true:false,iconCls:"icon-system-s-report",enableToggle:false,cls:"btn-gray1",toggleGroup:"btn_group",handler:function(){d.store.clearGrouping()}},{text:lang("exportAllToExcel"),iconCls:"icon-excel",cls:"btn-blue4",hidden:c.allexcel==1?false:true,handler:function(){var e=this;e.searchDatas=a.getValues();e.searchDatas.search="now";Ext.Ajax.request({url:d.baseUrl+"&task=exportAllExcel&step=1",method:"POST",params:e.searchDatas,success:function(g,h){var f=Ext.decode(g.responseText);ajaxDownload(d.baseUrl+"&task=exportAllExcel&step=2&tempname="+f.tempname+"&filename="+f.filename)}})}}],bbar:this.pagingBar});var b={simple:[["equal","等于"],["noEqual","不等于"]],total:[["equal","等于"],["noEqual","不等于"],["contain","包含"],["dayu","大于"],["xiaoyu","小于"],["dayuEqual","大于或等于"],["xiaoyuEqual","小于或等于"]]};this.searchPanel=new Ext.form.FormPanel({region:"north",height:150,border:false,hidden:true,defaults:{border:false},padding:5,items:[{xtype:"panel",defaults:{border:false},items:[{xtype:"hidden",name:"id"},{xtype:"panel",layout:"table",layoutConfig:{columns:6},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong1",hiddenName:"kong1",valueField:"fieldid",displayField:"kong",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){if(e.data.fieldid=="operate"){CNOA.msg.alert(lang("actionColumnCanNot"),function(){g.setValue("")})}var h=d.searchPanel.getForm().findField("condition1").getStore();if(e.data.dataType=="user_sel"){h.loadData(b.simple)}else{h.loadData(b.total)}}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:b.total}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition1",hiddenName:"condition1",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value1"},{xtype:"button",text:lang("reset"),handler:function(){a.findField("kong1").setValue("");a.findField("condition1").setValue("equal");a.findField("value1").setValue("")}},{xtype:"displayfield",value:lang("timeFormat")+":2011-05-25"}]},{xtype:"panel",layout:"table",layoutConfig:{columns:4},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong2",hiddenName:"kong2",valueField:"fieldid",displayField:"kong",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){if(e.data.fieldid=="operate"){CNOA.msg.alert(lang("actionColumnCanNot"),function(){g.setValue("")})}var h=d.searchPanel.getForm().findField("condition2").getStore();if(e.data.dataType=="user_sel"){h.loadData(b.simple)}else{h.loadData(b.total)}}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:b.total}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition2",hiddenName:"condition2",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value2"},{xtype:"button",text:lang("reset"),handler:function(){a.findField("kong2").setValue("");a.findField("condition2").setValue("equal");a.findField("value2").setValue("")}}]},{xtype:"panel",layout:"table",layoutConfig:{columns:4},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong3",hiddenName:"kong3",valueField:"fieldid",displayField:"kong",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,e,f){if(e.data.fieldid=="operate"){CNOA.msg.alert(lang("actionColumnCanNot"),function(){h.setValue("")})}var g=d.searchPanel.getForm().findField("condition3").getStore();if(e.data.dataType=="user_sel"){g.loadData(b.simple)}else{g.loadData(b.total)}}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:b.total}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition3",hiddenName:"condition3",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value3"},{xtype:"button",text:lang("reset"),handler:function(){a.findField("kong3").setValue("");a.findField("condition3").setValue("equal");a.findField("value3").setValue("")}}]},{xtype:"panel",layout:"table",layoutConfig:{columns:4},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong4",hiddenName:"kong4",valueField:"fieldid",displayField:"kong",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,e,f){if(e.data.fieldid=="operate"){CNOA.msg.alert(lang("actionColumnCanNot"),function(){h.setValue("")})}var g=d.searchPanel.getForm().findField("condition4").getStore();if(e.data.dataType=="user_sel"){g.loadData(b.simple)}else{g.loadData(b.total)}}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:b.total}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition4",hiddenName:"condition4",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value4"},{xtype:"button",text:lang("reset"),handler:function(){a.findField("kong4").setValue("");a.findField("condition4").setValue("equal");a.findField("value4").setValue("")}}]},{xtype:"panel",layout:"table",layoutConfig:{columns:5},defaults:{style:"margin-left:5px;"},height:30,items:[new Ext.form.ComboBox({store:d.treeStore,name:"kong5",hiddenName:"kong5",valueField:"fieldid",displayField:"kong",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,e,f){if(e.data.fieldid=="operate"){CNOA.msg.alert(lang("actionColumnCanNot"),function(){h.setValue("")})}var g=d.searchPanel.getForm().findField("condition5").getStore();if(e.data.dataType=="user_sel"){g.loadData(b.simple)}else{g.loadData(b.total)}}}}),new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],data:b.total}),width:100,value:"equal",valueField:"value",displayField:"name",name:"condition5",hiddenName:"condition5",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),{xtype:"textfield",width:200,name:"value5"},{xtype:"button",text:lang("reset"),handler:function(){a.findField("kong5").setValue("");a.findField("condition5").setValue("equal");a.findField("value5").setValue("")}},{xtype:"button",text:lang("delSaveQuery"),handler:function(){CNOA.msg.cf(lang("areYouDelete"),function(e){if(e=="yes"){var f=a.findField("id").getValue();d.deleteSearchBtn(f)}})}}]}]}]});var a=d.searchPanel.getForm();this.searchExpandBtn="close";this.searchGroup=[];this.searchGroup.push({text:lang("expandSearch"),id:"EXPAND_SEARCH_PANEL",handler:function(){if(d.searchExpandBtn=="close"){d.searchPanel.show();d.searchExpandBtn="open";Ext.getCmp("EXPAND_SEARCH_PANEL").setText(lang("foldSearch"));Ext.getCmp("ID_BTN_SEARCH_ADD").show();Ext.getCmp("ID_BTN_SEARCH").show()}else{d.searchPanel.hide();d.searchExpandBtn="close";Ext.getCmp("EXPAND_SEARCH_PANEL").setText(lang("expandSearch"));Ext.getCmp("ID_BTN_SEARCH_ADD").hide();Ext.getCmp("ID_BTN_SEARCH_SAVE").hide();Ext.getCmp("ID_BTN_SEARCH").hide()}d.mainPanel.doLayout()}});this.searchGroup.push({text:lang("search"),style:"margin-left:5px",id:"ID_BTN_SEARCH",iconCls:"icon-search",hidden:true,enableToggle:false,toggleGroup:"search_definde_btn_group",handler:function(){d.searchDatas.kong1=a.getValues().kong1;d.searchDatas.kong2=a.getValues().kong2;d.searchDatas.kong3=a.getValues().kong3;d.searchDatas.kong4=a.getValues().kong4;d.searchDatas.kong5=a.getValues().kong5;d.searchDatas.condition1=a.getValues().condition1;d.searchDatas.condition2=a.getValues().condition2;d.searchDatas.condition3=a.getValues().condition3;d.searchDatas.condition4=a.getValues().condition4;d.searchDatas.condition5=a.getValues().condition5;d.searchDatas.value1=a.getValues().value1;d.searchDatas.value2=a.getValues().value2;d.searchDatas.value3=a.getValues().value3;d.searchDatas.value4=a.getValues().value4;d.searchDatas.value5=a.getValues().value5;d.searchDatas.search="now";d.store.load()}});this.searchGroup.push({text:lang("clear"),style:"margin-left:5px",toggleGroup:"search_definde_btn_group",handler:function(){d.searchDatas.kong1="";d.searchDatas.kong2="";d.searchDatas.kong3="";d.searchDatas.kong4="";d.searchDatas.kong5="";d.searchDatas.condition1="";d.searchDatas.condition2="";d.searchDatas.condition3="";d.searchDatas.condition4="";d.searchDatas.condition5="";d.searchDatas.value1="";d.searchDatas.value2="";d.searchDatas.value3="";d.searchDatas.value4="";d.searchDatas.value5="";d.searchDatas.searchId="";d.searchDatas.search="";a.reset();d.store.load()}});this.searchGroup.push({text:lang("addNewQuery"),style:"margin-left:5px",id:"ID_BTN_SEARCH_ADD",iconCls:"icon-utils-s-add",cls:"btn-blue4",hidden:true,handler:function(){Ext.MessageBox.prompt(lang("rename"),lang("enterNewNameAdd"),function(e,f){if(e=="ok"){d.saveSearch("add",f)}})}});this.searchGroup.push({text:lang("saveQuery"),style:"margin-left:5px",id:"ID_BTN_SEARCH_SAVE",iconCls:"icon-btn-save",hidden:true,handler:function(){d.saveSearch("edit","")}});Ext.each(c.search,function(e,f){var g=d.buildSearchBtn(e);d.searchGroup.push(g)});this.mainPanel=new Ext.Panel({hideBorders:true,border:false,layout:"border",autoScroll:false,border:false,items:[this.searchPanel,this.grid],height:200,tbar:this.searchGroup});Ext.getCmp(CNOA.report.view_detail_wf.parentID).add(this.mainPanel);Ext.getCmp(CNOA.report.view_detail_wf.parentID).doLayout()},operate:function(f,g,d){var b="",a=d.data.operateV,e=d.data.operateA;download=d.data.operateD;if(a==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.viewFlow('+d.data.uFlowId+')" >'+lang("browse")+"</a> / "}if(download==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.attachFlow('+d.data.uFlowId+", 'd')\" >"+lang("downloadAttachment")+"</a> / "}else{if(e==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.attachFlow('+d.data.uFlowId+", 'v')\" >"+lang("attachmentView")+"</a> / "}}return b},operate2:function(e,d,a,f,c,b){l='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.viewOtherFlow(\''+a.id+"',"+c+')" >'+e+"</a>";return l},viewOtherFlow:function(f,b){var e=this;var a=this.store.getById(f);var d=this.colModel.getColumnById(b);Ext.Ajax.request({url:e.baseUrl+"&task=getFromMerge",method:"POST",params:{field:d.dataIndex},success:function(k){var c=Ext.decode(k.responseText);var j={};if(c.success===true){var g=c.fromMerge;var m=c.data;for(x in m){var h=m[x];if(!Ext.isEmpty(a.json[h+"_t"])){j[x]=a.json[h+"_t"]}else{j[x]=a.json[h]}}j="&search="+Ext.encode(j);mainPanel.closeTab("CNOA_MENU_WF_USE_OPENOTHERFLOW");mainPanel.loadClass("index.php?app=report&func=form&action=view&modul=merge&task=loadPage&fromMerge="+g+j,"CNOA_MENU_WF_USE_OPENOTHERFLOW","查看关联数据","icon-flow")}}})},viewFlow:function(a){mainPanel.closeTab("CNOA_MENU_WF_USE_OPENFLOW");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=viewflow&uFlowId="+a,"CNOA_MENU_WF_USE_OPENFLOW",lang("viewFlow"),"icon-flow")},attachFlow:function(a,b){var c=this;this.fields=[{name:"uFlowId"},{name:"filename"},{name:"uname"},{name:"date"},{name:"optStr"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getAttachList&uFlowId="+a+"&type="+b,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"uFlowId",dataIndex:"uFlowId",hidden:true},{header:lang("attName"),dataIndex:"filename",width:140,sortable:true,menuDisabled:true},{header:lang("uploadBy"),dataIndex:"uname",width:140,sortable:false,menuDisabled:true},{header:lang("uploadDate"),dataIndex:"date",width:140,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"optStr",width:200,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,region:"center",stripeRows:true});this.win=new Ext.Window({layout:"border",modal:true,title:lang("AccList"),width:700,height:350,items:[this.grid],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.win.close()}}]}).show()},saveSearch:function(c,a){var b=this;this.searchPanel.getForm().submit({url:b.baseUrl+"&task=submitSearch",method:"POST",waitMsg:lang("waiting"),params:{from:c,text:a},success:function(d,e){if(c=="add"){var f=b.buildSearchBtn(e.result.data);b.mainPanel.getTopToolbar().addItem(f);b.mainPanel.getTopToolbar().doLayout()}}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})},loadSearch:function(b){var a=this;this.searchPanel.getForm().load({url:a.baseUrl+"&task=loadSearchData",method:"POST",params:{id:b},waitTitle:lang("notice"),failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){})}})},buildSearchBtn:function(a){var c=this;var b={text:a.name,id:"ID_BTN_GROUP_USER_"+a.id,style:"margin-left:5px",enableToggle:true,allowDepress:false,toggleGroup:"search_definde_btn_group",handler:function(){c.searchDatas.searchId=a.id;c.searchDatas.search="have";c.store.load();if(c.searchExpandBtn=="open"){Ext.getCmp("ID_BTN_SEARCH_SAVE").show();c.loadSearch(a.id)}}};return b},deleteSearchBtn:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deleteSearchBtn",method:"POST",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.alert(c.msg,function(){Ext.getCmp("ID_BTN_SEARCH_SAVE").hide();a.mainPanel.getTopToolbar().remove("ID_BTN_GROUP_USER_"+b);a.mainPanel.getTopToolbar().doLayout()})}else{CNOA.msg.alert(c.msg,function(){})}}})}};var CNOA_report_view_wfClass,CNOA_report_view_wf;CNOA_report_view_wfClass=CNOA.Class.create();CNOA_report_view_wfClass.prototype={init:function(){var b=this;this.dsc=Ext.data.Record.create([{name:"",tempname:""}]);var a=Ext.id();this.ID_FAVNOTICE=Ext.id();this.baseUrl="index.php?app=report&func=form&action=view&modul=wf";this.storeBar={sortId:0,name:""};this.nowSortType="normal";this.fields=[{name:"tid"},{name:"name"},{name:"postname"},{name:"history"},{name:"condition"},{name:"stime"},{name:"etime"},{name:"excel"},{name:"allowexcel"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("repostName"),dataIndex:"name",id:"flowName",width:140,sortable:true,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:140,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:140,sortable:true,menuDisabled:true},{header:lang("designer"),dataIndex:"postname",width:140,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"tid",width:260,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.storeBar)}}});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",autoExpandColumn:"flowName",stripeRows:true,tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(c,d){b.store.reload()}.createDelegate(this)},{xtype:"box",id:this.ID_FAVNOTICE,autoEl:{tag:"div",html:"",style:"margin-left:20px;color:#333333"}},lang("repostName")+":",{xtype:"textfield",width:200,id:a,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}}}},{xtype:"button",text:lang("search"),handler:function(){b.storeBar.name=Ext.getCmp(a).getValue();b.store.load({params:b.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(a).setValue("");b.storeBar.name="";b.store.load({params:b.storeBar})}}]}),bbar:this.pagingBar,listeners:{afterrender:function(d){var c=new Ext.dd.DropTarget(b.grid.getEl(),{ddGroup:"GridDD",copy:false,notifyDrop:function(f,m,k){if(b.nowSortType=="wffav"){var j=k.selections;var g=f.getDragData(m).rowIndex;if(typeof(g)=="undefined"){return}for(i=0;i<j.length;i++){var h=j[i];if(!this.copy){b.store.remove(h)}if(g==0){h.data.orderNum-=1}else{if(g==b.store.data.items.length){h.data.id=b.store.data.items[g-1].data.id+1}else{h.data.id=(b.store.data.items[g-1].data.id+b.store.data.items[g].data.id)/2}}b.store.insert(g,h)}b.orderFavFlow()}}})}}});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("processCategoryList"),type:"",sortId:"0",iconCls:"icon-tree-root-cnoa",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){b.sortTree.selectPath(b.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(c){if(c.attributes.from=="wffav"){b.store.load({params:{sort:"wffav"}});b.grid.getBottomToolbar().hide();b.grid.doLayout();b.nowSortType="wffav";Ext.getCmp(b.ID_FAVNOTICE).getEl().update(lang("operationTip"));return}b.grid.getBottomToolbar().show();b.grid.doLayout();Ext.getCmp(b.ID_FAVNOTICE).getEl().update("");b.storeBar.sortId=c.attributes.sortId;b.store.load({params:b.storeBar});b.nowSortType="normal"}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:180,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("processCategoryList"),"->",{handler:function(c,d){b.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},makeFav:function(j,f,d,g,e,b){var k=d.data;var a="./resources/images/icons/";var c="";if(this.nowSortType=="normal"){c+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_report_use_wf.addFavFlow("+j+");' ext:qtip='"+lang("collectProcess")+"'><img src='"+a+"heart.png' style='margin:2px 2px 4px 2px' align='absmiddle' />"+lang("collect")+"</a>"}else{if(this.nowSortType=="wffav"){c+="&nbsp;&nbsp;<a href='javascript:void(0);' onclick='CNOA_report_use_wf.delFavFlow("+j+");' ext:qtip='"+lang("delCollectionProcess")+"'><img src='"+a+"icon-attac-delete.gif' style='margin:2px 2px 4px 2px' align='absmiddle' />"+lang("del")+"</a>"}}return c},makeOperate:function(j,f,d,g,e,b){var k=d.data;var a="./resources/images/icons/";var c="";c+='<a href="javascript:void(0);" class="gridview" onclick="CNOA_report_view_wf.view('+j+');">'+lang("view")+"</a>";if(k.history==1){c+=' <a class="gridview3 jianju" href="javascript:void(0);" onclick="CNOA_report_view_wf.viewHistory('+j+","+k.condition+');">'+lang("viewHistoryReport")+"</a>"}if(k.allowexcel=="1"&&k.excel=="1"){c+=' <a class="gridview2 jianju" href="javascript:void(0);" onclick="CNOA_report_view_wf.otherExcel('+j+');">'+lang("zhuancunExcel")+"</a>"}return c},otherExcel:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=exportExcel",method:"POST",params:{tid:a},timeout:9999999,success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){new Ext.MoveToDisk({data:c.tempname,name:c.filename,from:"reportWf"})}else{CNOA.msg.alert(c.msg,function(){})}}})},view:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_VIEW_WF_DETAIL");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=detail&tid="+a,"CNOA_MENU_REPORT_VIEW_WF_DETAIL",lang("reportView"),"icon-table-insert")},buildFast:function(a){var b=this;b.mainPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=buildFast",method:"POST",params:{flowid:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice("",lang("quicklyGenerate"));b.mainPanel.getEl().unmask();b.store.reload();b.downloadWin(c.msg)}else{b.mainPanel.getEl().unmask();CNOA.msg.alert(c.msg,function(){})}}})},viewHistory:function(e,h){var g=this;var b=[{name:"id"},{name:"hid"},{name:"name"},{name:"stime"},{name:"etime"}];var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getHistoryJsonData&cid="+h,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var f=new Ext.grid.CheckboxSelectionModel({});var a=[new Ext.grid.RowNumberer(),f,{header:lang("reportStartTime"),dataIndex:"stime",width:100,sortable:true},{header:lang("reportEndTime"),dataIndex:"etime",width:100,sortable:true},{header:lang("opt"),dataIndex:"hid",width:100,sortable:true,renderer:function(j){return'<a href="javascript:void(0)" onclick="CNOA_report_view_wf.viewOnce('+e+","+j+')">'+lang("view")+"</a>"}}];var d=new Ext.grid.GridPanel({store:c,plain:false,region:"center",layout:"fit",border:false,autoScroll:true,columns:a,sm:f,stripeRows:true});this.historywin=new Ext.Window({title:lang("historyReportList"),width:500,height:makeWindowHeight(500),modal:true,resizable:false,layout:"border",items:[d],buttons:[{text:lang("close"),handler:function(){g.historywin.close()}}]}).show()},viewOnce:function(b,a){var c=this;this.historywin.close();mainPanel.closeTab("CNOA_MENU_REPORT_VIEW_WF_DETAIL");mainPanel.loadClass(c.baseUrl+"&task=loadPage&from=detail&tid="+b+"&hid="+a,"CNOA_MENU_REPORT_VIEW_WF_DETAIL",lang("reportView"),"icon-table-insert")},savedisk:function(b,a){new Ext.MoveToDisk({data:b,name:a,from:"reportWf"})},setting:function(a,b){var c=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_SETTING");mainPanel.loadClass(c.baseUrl+"&task=loadPage&from=setting&flowId="+a,"CNOA_MENU_REPORT_USE_WF_SETTING",lang("setConditionReport"),"icon-table-insert")},temple:function(a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");mainPanel.loadClass(b.baseUrl+"&task=loadPage&from=temple&flowId="+a,"CNOA_MENU_REPORT_USE_WF_TEMPLE",lang("setReportTemp"),"icon-table-insert")},viewFlow:function(a){var b=this;CNOA_wf_use_flowpreview=new CNOA_wf_use_flowpreviewClass(a)},viewForm:function(c){var j=this;var e=Ext.getBody().getBox();var b=e.width-100;var d=e.height-100;var f=function(){Ext.Ajax.request({url:j.baseUrl+"&task=show_loadFormInfo",method:"POST",params:{flowId:c},success:function(k){var h=Ext.decode(k.responseText);if(h.success===true){a.getEl().update("<center>"+h.data.formHtml+"</center>")}else{CNOA.msg.alert(h.msg,function(){})}g.getEl().unmask()}})};var a=new Ext.Panel({border:false,html:lang("workFormLoad")+"...",listeners:{afterrender:function(h){f()}}});var g=new Ext.Window({title:lang("viewJobForm"),width:b,height:d,layout:"fit",bodyStyle:"background-color:#FFFFFF",modal:true,autoScroll:true,maximizable:false,resizable:false,items:[a],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}}],listeners:{show:function(h){h.getEl().mask(lang("waiting"))}}}).show()},addFavFlow:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=addFavFlow",method:"POST",params:{flowId:a},success:function(d){var c=Ext.decode(d.responseText);CNOA.msg.notice(c.msg,lang("collectionFlow"));if(c.success===true){b.treeRoot.reload()}}})},delFavFlow:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delFavFlow",method:"POST",params:{flowId:a},success:function(d){var c=Ext.decode(d.responseText);CNOA.msg.notice(c.msg,lang("delCollectionProcess"));if(c.success===true){b.store.reload();b.treeRoot.reload()}}})},orderFavFlow:function(a){var c=this;var b=[];this.store.each(function(e,d){b.push(e.get("flowId"))});Ext.Ajax.request({url:this.baseUrl+"&task=orderFavFlow",method:"POST",params:{ids:b.join(",")},success:function(e){var d=Ext.decode(e.responseText);CNOA.msg.notice(d.msg,lang("sortCollectionFlow"))}})}};var CNOA_report_view_otherWfClass,CNOA_report_view_otherWf;CNOA_report_view_otherWfClass=CNOA.Class.create();CNOA_report_view_otherWfClass.prototype={init:function(){var c=this;if(CNOA.report.view_otherWf.fromUser){this.baseUrl="index.php?app=report&func=form&action=view&modul=user&fromUser="+CNOA.report.view_otherWf.fromUser+"&uid="+CNOA.report.view_otherWf.uid}else{this.baseUrl="index.php?app=report&func=form&action=view&modul=merge&fromMerge="+CNOA.report.view_otherWf.fromMerge}var a=[{name:"uFlowId"},{name:"flowNumber"},{name:"flowName"},{name:"uid"}];var b=[{header:"uFlowId",dataIndex:"uFlowId",hidden:true},{header:"流程编号",dataIndex:"flowNumber",width:180},{header:"流程名称",dataIndex:"flowName",width:180},{header:"发起人",dataIndex:"uid",width:120}];this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"fit",autoScroll:false,items:[]});Ext.Ajax.request({url:this.baseUrl+"&task=loadColumn",success:function(e){var d=Ext.decode(e.responseText);for(var f=d.fields.length-1;f>=0;f--){a.push({name:d.fields[f].field});b.push({header:d.fields[f].name,dataIndex:d.fields[f].field,width:120})}b.push({header:lang("opt"),dataIndex:"",width:100,renderer:c.makeOperate});c.getGrid(a,b)}})},getGrid:function(b,f){var g=this;var a=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:f});if(CNOA.report.view_otherWf.fromUser){var d=g.baseUrl+"&task=getJsonData"}else{var d=g.baseUrl+"&task=getJsonData&search="+CNOA.report.view_otherWf.search}var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:b})});var e=new Ext.grid.GridPanel({store:c,cm:a,tbar:new Ext.Toolbar({items:[{text:"刷新",cls:"btn-blue4",handler:function(){c.reload()}}]})});g.mainPanel.add(e);g.mainPanel.doLayout()},makeOperate:function(a,d,b){return'<a href="javascript:void(0)" onclick="CNOA_report_view_otherWf.viewFlow('+b.json.uFlowId+')">浏览</a>'},viewFlow:function(a){mainPanel.closeTab("CNOA_MENU_WF_USE_OPENFLOW");mainPanel.loadClass("index.php?app=report&func=form&action=view&modul=wf&task=loadPage&from=viewflow&uFlowId="+a,"CNOA_MENU_WF_USE_OPENFLOW",lang("viewFlow"),"icon-flow")}};var CNOA_report_user_viewIndexClass,CNOA_report_user_viewIndex;CNOA_report_user_viewIndexClass=CNOA.Class.create();CNOA_report_user_viewIndexClass.prototype={init:function(){this.baseUrl="index.php?app=report&func=user&action=view";var a=this.getGrid();this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[a]})},getGrid:function(){var d=this;var b=[{name:"id"},{name:"name"}];var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"id",dataIndex:"id",hidden:true},{header:"报表名称",dataIndex:"name",width:250,align:"left",editor:new Ext.form.TextField({allowBlank:false})},{header:lang("opt"),dataIndex:"",width:80,renderer:d.makeOperate}]});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getReportList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:b})});var c=new Ext.grid.GridPanel({store:this.store,cm:a,sm:e,border:false,tbar:new Ext.Toolbar({items:[{text:"刷新",cls:"btn-blue4",handler:function(){d.store.reload()}}]})});return c},makeOperate:function(c,b,a){var e=a.json.fromid;var d=a.json.tid;c="<a href='javascript:void(0);'  class='gridview3' onclick='CNOA_report_user_viewIndex.view("+e+","+d+");'>查看</a>";return c},view:function(c,a){var b=this;mainPanel.closeTab("CNOA_MENU_REPORT_USER_VIEW_FLOW");mainPanel.loadClass(b.baseUrl+"&task=loadPage&model=view&id="+c+"&tid="+a,"CNOA_MENU_REPORT_USER_VIEW_FLOW",lang("reportView"),"icon-table-insert")}};var CNOA_report_user_viewClass,CNOA_report_user_view;CNOA_report_user_viewClass=CNOA.Class.create();CNOA_report_user_viewClass.prototype={init:function(){var a=this;this.id=CNOA.report.user.view.id;this.tid=CNOA.report.user.view.tid;if(CNOA.report.user.view.allowexcel==1){this.allowexcel=true}else{this.allowexcel=false}this.baseUrl="index.php?app=report&func=user&action=view";Ext.Ajax.request({url:a.baseUrl+"&task=loadColumn",params:{id:a.id,tid:a.tid},method:"POST",success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){var d=Ext.decode(b.msg);a.layoutPanel(d)}else{CNOA.msg.alert(b.msg,function(){})}}})},layoutPanel:function(a){var c=this;var b=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.cmList=[new Ext.grid.RowNumberer(),b];Ext.each(a.data,function(d,e){if(d.dataIndex.search("M_")!=-1){c.cmList.push({header:d.header,sortable:true,dataIndex:d.dataIndex,width:d.width,menuDisabled:d.menuDisabled,renderer:c.operate2.createDelegate(this)})}else{c.cmList.push(d)}});this.fields=a.fields;this.store=new Ext.data.GroupingStore({autoLoad:true,baseParams:{tid:c.tid,id:c.id},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),groupDir:a.group.order,groupField:a.group.field,listeners:{exception:function(j,h,k,g,f,e){var d=Ext.decode(f.responseText);if(d.failure){CNOA.msg.alert(d.msg)}}}});if(a.page==0){this.pagingBar={}}else{this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:a.page})}this.colModel=new Ext.grid.ColumnModel(this.cmList);this.grid=new Ext.grid.GridPanel({store:this.store,region:"center",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:b,hideBorders:true,border:false,autoScroll:true,view:new Ext.grid.GroupingView({rowOverCls:"x-grid3-row-over2",groupTextTpl:"{text}",getRowClass:function(d,e){if(d.data.calculate=="calculate"){return"x-grid-record-gray"}}}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({hideBorders:true,border:false,layout:"fit",autoScroll:false,border:false,items:[this.grid],tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.store.reload()}},{text:lang("exportAllToExcel"),cls:"btn-blue4",iconCls:"icon-excel",hidden:!c.allowexcel,handler:function(){Ext.Ajax.request({url:c.baseUrl+"&task=exportAllExcel&step=1",method:"POST",params:{tid:c.tid,id:c.id},success:function(e,f){var d=Ext.decode(e.responseText);ajaxDownload(c.baseUrl+"&task=exportAllExcel&step=2&tempname="+d.tempname+"&filename="+d.filename)}})}}],height:200});Ext.getCmp(CNOA.report.user.view.parentID).add(this.mainPanel);Ext.getCmp(CNOA.report.user.view.parentID).doLayout()},makeOperate:function(c,b,a){var d=a.json.id;c="<a href='javascript:void(0);'  class='gridview3' onclick='CNOA_report_user_view.view("+d+");'>查看</a>";return c},operate:function(f,g,d){var b="",a=d.data.operateV,e=d.data.operateA;download=d.data.operateD;if(a==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.viewFlow('+d.data.uFlowId+')" >'+lang("browse")+"</a> / "}if(download==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.attachFlow('+d.data.uFlowId+", 'd')\" >"+lang("downloadAttachment")+"</a> / "}else{if(e==1){b+='<a href="javascript:void(0)" onclick="CNOA_report_view_detail_wf.attachFlow('+d.data.uFlowId+", 'v')\" >"+lang("attachmentView")+"</a> / "}}return b},operate2:function(f,e,a,g,d,b){var c=a.json.uid2;if(f&&c){l='<a href="javascript:void(0)" onclick="CNOA_report_user_view.viewOtherFlow(\''+a.id+"',"+d+","+c+')" >'+f+"</a>"}else{l=f}return l},viewOtherFlow:function(g,d,b){var f=this;var a=this.store.getById(g);var e=this.colModel.getColumnById(d);Ext.Ajax.request({url:f.baseUrl+"&task=getFromUser",method:"POST",params:{field:e.dataIndex,tid:f.tid},success:function(k){var c=Ext.decode(k.responseText);var j={};if(c.success===true){var h=c.fromUser;mainPanel.closeTab("CNOA_MENU_WF_USE_OPENOTHERFLOW");mainPanel.loadClass("index.php?app=report&func=form&action=view&modul=user&task=loadPage&fromUser="+h+"&uid="+b,"CNOA_MENU_WF_USE_OPENOTHERFLOW","查看关联数据","icon-flow")}}})},view:function(b){var a=this;mainPanel.closeTab("CNOA_MENU_REPORT_USER_VIEW_FLOW");mainPanel.loadClass(a.baseUrl+"&task=loadPage&model=view&id="+b,"CNOA_MENU_REPORT_USER_VIEW_FLOW",lang("reportView"),"icon-table-insert")}};var CNOA_report_user_settingClass,CNOA_report_user_setting;CNOA_report_user_settingClass=CNOA.Class.create();CNOA_report_user_settingClass.prototype={init:function(){this.baseUrl="index.php?app=report&func=user&action=setting";var a=this.getGrid();this.mainPanel=new Ext.Panel({layout:"fit",border:false,items:[a]})},getGrid:function(){var d=this;var b=[{name:"tid"},{name:"name"},{name:"fromid"}];var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"tid",dataIndex:"tid",hidden:true},{header:"fromid",dataIndex:"fromid",hidden:true},{header:"报表名称",dataIndex:"name",width:150,align:"left",editor:new Ext.form.TextField({allowBlank:false})},{header:lang("opt"),dataIndex:"",width:330,renderer:d.makeOperate}]});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:b})});var c=new Ext.grid.EditorGridPanel({store:this.store,cm:a,sm:e,border:false,tbar:new Ext.Toolbar({items:[{text:"刷新",cls:"btn-blue4",handler:function(){d.store.reload()}},{text:"添加报表",cls:"btn-blue4",handler:function(){d.addUserReport()}}]}),listeners:{afteredit:function(h){var g=h.field,k=h.record.get("fromid"),f=h.value,j=h.row;d.updateName(k,g,f)}}});return c},makeOperate:function(c,b,a){var e=a.json.fromid;var d=a.json.tid;c="<a href='javascript:void(0);'  class='gridview3' onclick='CNOA_report_user_setting.settingWin("+e+");'>设置流程字段</a>";c+=" <a href='javascript:void(0);'  class='gridview2' onclick='CNOA_report_user_setting.setColumnWin("+d+","+e+");'>设置列模板</a>";c+=" <a href='javascript:void(0);'  class='gridview' onclick='CNOA_report_user_setting.view("+e+","+d+");'>查看</a>";c+=" <a href='javascript:void(0);'  class='gridview3' onclick='CNOA_report_user_setting.viewRule("+e+");'>查看规则</a>";c+=" <a href='javascript:void(0);'  class='gridview4' onclick='CNOA_report_user_setting.deleteWin("+e+");'>删除</a>";return c},view:function(b,a){mainPanel.closeTab("CNOA_MENU_REPORT_USER_VIEW_FLOW");mainPanel.loadClass("index.php?app=report&func=user&action=view&task=loadPage&model=view&id="+b+"&tid="+a,"CNOA_MENU_REPORT_USER_VIEW_FLOW",lang("reportView"),"icon-table-insert")},setting:function(a,b){var c=this;mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_SETTING");mainPanel.loadClass(c.baseUrl+"&task=loadPage&from=setting&flowId="+a,"CNOA_MENU_REPORT_USE_WF_SETTING",lang("setConditionReport"),"icon-table-insert")},setColumnWin:function(b,a){mainPanel.closeTab("CNOA_MENU_REPORT_USE_WF_TEMPLE");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from=temple&tid="+b+"&fromid="+a,"CNOA_MENU_REPORT_USE_WF_TEMPLE",lang("setReportTemp"),"icon-table-insert")},updateName:function(d,c,b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=updateName",params:{id:d,field:c,value:b},success:function(f){var e=Ext.decode(f.responseText);if(e.failure===true){CNOA.msg.alert(e.msg)}else{CNOA.msg.notice2(e.msg);a.store.reload()}}})},addUserReport:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=addUserReport",success:function(b){var c=Ext.decode(b.responseText);if(c.success){CNOA.msg.notice2(c.msg);a.store.reload()}else{CNOA.msg.alert(c.msg)}}})},settingWin:function(b){var g=this;var e=["id","flowId","name"];var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:"flowId",dataIndex:"flowId",hidden:true},{header:"[流程分类]流程名称",dataIndex:"name",width:270},{header:lang("opt"),dataIndex:"",width:300,align:"center",renderer:g.makeOperateForCondition}]});var h=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getConditionFlowList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:e}),baseParams:{fid:b}});var c=Ext.id();var a=new Ext.grid.GridPanel({store:h,cm:j,sm:d,layout:"fit",border:false,height:300,tbar:new Ext.Toolbar({items:["选择流程：",{xtype:"combo",width:250,displayField:"name",valueField:"flowId",triggerAction:"all",id:c,editable:false,mode:"local",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getFlowList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["flowId","name"]})})},{text:"添加流程",handler:function(){var m=Ext.getCmp(c).getValue();var k=Ext.getCmp(c).lastSelectionText;if(Ext.isEmpty(m)){CNOA.msg.alert("请选择流程")}else{Ext.Ajax.request({url:g.baseUrl+"&task=saveFlow",params:{fid:b,flowId:m,name:k},method:"POST",success:function(o){var n=Ext.decode(o.responseText);if(n.success){CNOA.msg.notice2(n.msg);h.reload()}else{CNOA.msg.alert(n.msg)}}})}}}]})});g.conditionGrid=a;var f=new Ext.Window({modal:true,items:[a],title:"添加流程字段"}).show()},deleteWin:function(b){var a=this;CNOA.msg.cf("确定删除?",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delUserReport",params:{id:b},method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success){CNOA.msg.notice2(d.msg);a.store.reload()}}})}})},makeOperateForCondition:function(h,f,e){var b=e.json.id,c=e.json.fieldsMap,d=e.json.fid,k=e.json.connectField,a=e.json.flowId,j=e.json.conditionId,g=e.json.dataType;h='<a href="javascript:void(0);"  class="gridview" onclick="CNOA_report_user_setting.setCondition('+b+","+a+",'"+k+"');\">连接条件</a> ";h+='<a href="javascript:void(0);"  class="gridview3" onclick="CNOA_report_user_setting.setFields('+b+",'"+c+"',"+a+","+g+","+d+');">设置字段</a> ';h+='<a href="javascript:void(0);"  class="gridview2" onclick="CNOA_report_user_setting.selectCondition('+b+","+a+","+j+');">筛选数据</a> ';h+='<a href="javascript:void(0);"  class="gridview4" onclick="CNOA_report_user_setting.delCondition('+b+');">删除</a>';return h},setCondition:function(d,c,k){var j=this;var g=["fieldid","kong"];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:j.baseUrl+"&task=getFieldsList&from=all&flowId="+c,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:g}),listeners:{load:function(){if(k){e.setValue(k)}}}});var e=new Ext.form.ComboBox({fieldLabel:"流程报表字段",store:b,valueField:"fieldid",displayField:"kong",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false});var f=new Ext.Button({text:"选择",width:80,cls:"btn-blue3",handler:function(){var m=e.getValue();if(Ext.isEmpty(m)){CNOA.msg.alert("请选择字段")}else{Ext.Ajax.request({url:j.baseUrl+"&task=saveCondition",params:{flowField:m,id:d},method:"POST",success:function(o){var n=Ext.decode(o.responseText);if(n.success){CNOA.msg.notice2(n.msg);h.hide();j.conditionGrid.getStore().reload()}else{CNOA.msg.alert(n.msg)}}})}}});var a=new Ext.Panel({border:false,layout:"form",style:"margin:5px;",items:[e],labelWidth:95});var h=new Ext.Window({items:[a],buttons:[f],title:"连接条件",modal:true,width:320}).show()},setFields:function(c,e,b,n,h){var m=this;var j=["fieldid","kong"];var d=[];var p=new Ext.data.Store({autoLoad:true,baseParams:{type:n},proxy:new Ext.data.HttpProxy({url:m.baseUrl+"&task=getFieldsList&flowId="+b,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:j}),listeners:{load:function(){if(e!="0"){var q=e.split("|");p.each(function(t){for(var s=0;s<q.length;s++){if(q[s]==t.data.fieldid){d.push(t);break}}})}a.getSelectionModel().selectRecords(d)}}});var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var o=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),g,{header:"fieldid",dataIndex:"fieldid",hidden:true},{header:"名称",dataIndex:"kong",width:200}]});var f=Ext.id();var a=new Ext.grid.GridPanel({sm:g,cm:o,border:false,store:p,layout:"fit",height:160,tbar:new Ext.Toolbar({items:[{xtype:"radiogroup",id:f,style:"margin-left:5px;",width:180,items:[{boxLabel:"普通数据",name:"selectorType",inputValue:0,checked:!n},{boxLabel:"明细表数据",name:"selectorType",inputValue:1,checked:n}],listeners:{change:function(q){p.reload({params:{type:q.getValue()}})}}}]})});var k=new Ext.Window({items:[a],title:"设置字段",modal:true,width:280,buttons:[{text:lang("save"),handler:function(){var t=a.getSelectionModel().getSelections();var s="",r=Ext.getCmp(f).getValue();if(t.length>0){for(var q=0;q<t.length;q++){s+=t[q].data.fieldid+"|"}s=s.substr(0,s.length-1)}Ext.Ajax.request({url:m.baseUrl+"&task=saveFields",params:{fieldids:s,id:c,type:r,fid:h},method:"POST",success:function(v){var u=Ext.decode(v.responseText);if(u.success){CNOA.msg.notice2(u.msg);m.conditionGrid.getStore().reload();k.hide()}else{CNOA.msg.alert(u.msg)}}})}}]}).show()},selectCondition:function(h,c,e){var g=this;var a=["name","id"];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getSelectCondition&flowId="+c,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:a}),listeners:{load:function(){if(e){Ext.getCmp(d).setValue(e)}}}});var d=Ext.id();var f=new Ext.Window({items:[{fieldLabel:"筛选条件",xtype:"combo",store:b,id:d,valueField:"id",displayField:"name",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false}],bodyStyle:"margin:5px;",layout:"form",labelWidth:80,title:"筛选数据",modal:true,width:320,buttons:[{text:"确定",handler:function(){var j=Ext.getCmp(d).getValue();if(j){Ext.Ajax.request({url:g.baseUrl+"&task=setSelectCondition",params:{id:h,conditionId:j},method:"POST",success:function(m){var k=Ext.decode(m.responseText);if(k.success){CNOA.msg.notice2(k.msg);g.conditionGrid.getStore().reload();f.hide()}else{CNOA.msg.alert(k.msg)}}})}else{CNOA.msg.alert("请选择条件")}}},{text:"取消",handler:function(){f.hide()}}]}).show()},delCondition:function(b){var a=this;CNOA.msg.cf("确定删除?",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delCondition",params:{id:b},method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success){CNOA.msg.notice2(d.msg);a.conditionGrid.getStore().reload()}}})}})},viewRule:function(d){var b=this;var a=new Ext.form.FormPanel({style:"margin: 5px;",border:false,items:[{layout:"table",border:false,fieldLabel:"开启规则",items:[{xtype:"checkbox",name:"rule"},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:10px",html:'<a href="javascript:void(0)" id="explain">'+lang("description")+"</a>"},listeners:{afterrender:function(){var e="不开启规则，则默认所有人可以查看所有信息<br />";e+="开启规则后，不作设置则只能看到自己的报表<br />";e+="如需查看部门及下属部门报表则可选择第一项<br />";e+="如需查看公司所有人报表信息则可选择第二项<br />";new Ext.ToolTip({target:"explain",html:e,title:lang("ruleDescription"),autoHide:false,closable:true,draggable:true})}}})]},{xtype:"hidden",name:"deptRuleUids"},{xtype:"hidden",name:"deptRuleDids"},{fieldLabel:"查看自身部门及下属部门",layout:"table",border:false,items:[{xtype:"textarea",width:200,height:60,name:"deptRulePeople",readOnly:true,listeners:{afterrender:function(e){e.mon(e.el,"click",function(){var f=a.getForm();var g=f.findField("deptRuleUids").getValue();new_selector("user",f.findField("deptRulePeople"),f.findField("deptRuleUids"),true,"index.php?action=commonJob&act=getSelectorData&target=user",g)})}}},{xtype:"textarea",style:"margin-left: 5px;",width:200,height:60,name:"deptRuleDept",readOnly:true,listeners:{afterrender:function(e){e.mon(e.el,"click",function(){var f=a.getForm();var g=f.findField("deptRuleDids").getValue();new_selector("dept",f.findField("deptRuleDept"),f.findField("deptRuleDids"),true,"index.php?action=commonJob&act=getSelectorData&target=dept",g)})}}}]},{xtype:"hidden",name:"companyRuleUids"},{xtype:"hidden",name:"companyRuleDids"},{fieldLabel:"可查看全部人员",layout:"table",border:false,items:[{xtype:"textarea",width:200,height:60,name:"companyPeople",readOnly:true,listeners:{afterrender:function(e){e.mon(e.el,"click",function(){var f=a.getForm();var g=f.findField("companyRuleUids").getValue();new_selector("user",f.findField("companyPeople"),f.findField("companyRuleUids"),true,"index.php?action=commonJob&act=getSelectorData&target=user",g)})}}},{xtype:"textarea",style:"margin-left: 5px;",width:200,height:60,name:"companyDept",readOnly:true,listeners:{afterrender:function(e){e.mon(e.el,"click",function(){var f=a.getForm();var g=f.findField("companyRuleDids").getValue();new_selector("dept",f.findField("companyDept"),f.findField("companyRuleDids"),true,"index.php?action=commonJob&act=getSelectorData&target=dept",g)})}}}]}]});var c=new Ext.Window({items:[a],width:560,buttons:[{text:lang("save"),handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=saveRule",method:"POST",params:{id:d},waitMsg:lang("notice"),success:function(e,f){c.hide()}})}}}]}).show();Ext.Ajax.request({url:b.baseUrl+"&task=getRule",params:{id:d},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){a.getForm().setValues(e.msg)}}})}};var sm_report_wf=1;
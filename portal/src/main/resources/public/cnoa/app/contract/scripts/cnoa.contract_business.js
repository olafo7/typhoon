var CNOA_contract_business_noticeClass,CNOA_contract_business_notice;CNOA_contract_business_noticeClass=CNOA.Class.create();CNOA_contract_business_noticeClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=contract&func=business&action=notice";this.fields=[{name:"id"},{name:"cid"},{name:"name"},{name:"title"},{name:"time"},{name:"content"},{name:"names"},{name:"jobs"},{name:"status"},{name:"type"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(g,f,h,e,d,c){var b=Ext.decode(d.responseText);if(b.failure){CNOA.msg.alert(b.msg)}},load:function(c,b,d){}}});a.store.setBaseParam("type",2);a.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("opt"),dataIndex:"cid",width:80,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("noticeTitle1"),dataIndex:"title",width:130,sortable:true,menuDisabled:true},{header:lang("noticeContent"),dataIndex:"content",width:150,sortable:true,menuDisabled:true},{header:lang("noticeTime"),dataIndex:"time",width:123,sortable:true,menuDisabled:true},{header:lang("noticePerson"),dataIndex:"names",width:150,sortable:true,menuDisabled:true},{header:lang("remindPosition"),dataIndex:"jobs",width:150,sortable:true,menuDisabled:true},{header:lang("contractName"),dataIndex:"name",width:150,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:50,sortable:true,menuDisabled:true},{header:lang("reminderType"),dataIndex:"type",width:100,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({stripeRows:true,region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{handler:function(b,c){a.store.setBaseParam("type",2);a.store.load()}.createDelegate(this),iconCls:"icon-thisMonth",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayContractThisMonth"),cls:"btn-blue4",text:lang("contractWorkToDo")},{handler:function(b,c){a.store.setBaseParam("type",3);a.store.load()}.createDelegate(this),iconCls:"icon-nextMonth",enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayContractNextMonth"),cls:"btn-blue3",text:lang("contractWorkToDo1")},{handler:function(b,c){a.store.setBaseParam("type",1);a.store.load()}.createDelegate(this),iconCls:"icon-all-contracts",enableToggle:true,cls:"btn-yellow1",allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayContractAll"),text:lang("contractWorkToDoAll")},{handler:function(b,c){var d=a.list.getSelectionModel().getSelections();if(d.length==0){CNOA.msg.alert(lang("chooseEdit"))}else{var e=d[0].get("id");a.EditNotice(e)}}.createDelegate(this),iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){a.doDeleteList(b)}},"-",{text:lang("Modifiedstate"),cls:"btn-red1",iconCls:"icon-utils-s-edit",handler:function(b){a.doEditStatusList(b)}}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list]})},operation:function(f,a,c,e,h,g){var d=this;var b=c.data;var i="<a href='javascript:void(0)' class='gridview' onclick='CNOA_contract_business_notice.viewDetails("+f+")'>"+lang("view")+"</a>";return i},viewDetails:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;b.type="add";window.open("index.php?app=contract&func=business&action=manage&task=viewDetails&id="+a,"contractView","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},doEditStatus:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=editStatus",params:{ids:a},method:"POST",success:function(d){var c=d.responseText;jsData=Ext.decode(c);arrData=jsData.data;CNOA.msg.notice(jsData.msg,lang("contractMgr"));b.store.reload()}})},doEditStatusList:function(a){var c=this;var b=c.list.getSelectionModel().getSelections();if(b.length==0){CNOA.msg.alert(lang("firstOperateData"))}else{CNOA.msg.cf(lang("editToInformation"),function(f){if(f=="yes"){if(b){var g="";var h="";var d=0;for(var e=0;e<b.length;e++){h=b[e];id=parseInt(h.get("id"));g+=id+((e!=b.length-1)?",":"")}c.doEditStatus(g)}}})}},doDelete:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=deleteNotice",params:{ids:a},method:"POST",success:function(d){var c=d.responseText;jsData=Ext.decode(c);arrData=jsData.data;CNOA.msg.notice(jsData.msg,lang("contractMgr"));b.store.reload()}})},doDeleteList:function(a){var c=this;var b=c.list.getSelectionModel().getSelections();if(b.length==0){CNOA.msg.alert(lang("firstOperateData"))}else{CNOA.msg.cf(lang("deleteToInformation"),function(f){if(f=="yes"){if(b){var g="";var h="";var d=0;for(var e=0;e<b.length;e++){h=b[e];id=parseInt(h.get("id"));g+=id+((e!=b.length-1)?",":"")}c.doDelete(g)}}})}},EditNotice:function(h){var g=this;var d=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getContractList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});d.load();function b(i){if(e.getForm().isValid()){e.getForm().submit({url:g.baseUrl+"&task=addNotice",waitMsg:lang("waiting"),method:"POST",params:{nid:i},success:function(j,k){CNOA.msg.notice(k.result.msg,lang("contractMgr"));c.close();g.store.reload()}.createDelegate(this),failure:function(j,k){CNOA.msg.alert(k.result.msg)}.createDelegate(this)})}}var a=new Ext.form.FieldSet({title:lang("contractRemind"),defaults:{style:{marginBottom:"10px"},width:350},items:[{xtype:"combo",width:200,name:"contract",valueField:"id",hiddenName:"contract",displayField:"name",triggerAction:"all",mode:"local",editable:false,store:d,fieldLabel:lang("belongTo"),allowBlank:false},{xtype:"textfield",name:"ntTitle",fieldLabel:lang("noticeTitle1"),allowBlank:false},{xtype:"datetimefield",fieldLabel:lang("noticeTime"),name:"ntTime",editable:false,allowBlank:false},{xtype:"textarea",name:"ntContent",fieldLabel:lang("noticeContent"),height:100,allowBlank:false},{xtype:"textarea",name:"ntNames",fieldLabel:lang("noticePerson"),height:100,allowBlank:false,readOnly:true},{xtype:"btnForPoepleSelector",style:"padding: 0 0 0 83px;",text:lang("selectPeople"),allowBlank:false,dataUrl:g.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:230,listeners:{selected:function(n,o){var p=new Array();var m=new Array();if(o.length>0){for(var l=0;l<=o.length-1;l++){p.push(o[l].uname);m.push(o[l].uid)}}var k=p.join(",");var j=m.join(",");e.getForm().findField("ntUids").setValue(j);e.getForm().findField("ntNames").setValue(k)},onrender:function(j){var i=e.getForm().findField("ntUids").getValue().split(",");j.setSelectedUids(i)}}},{xtype:"hidden",name:"ntUids"}]});var e=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px",autoScroll:true,items:a});function f(i){e.getForm().load({url:g.baseUrl+"&task=loadNoticeData",params:{nid:i},method:"POST",success:function(j,k){},failure:function(j,k){CNOA.msg.alert(k.result.msg,function(){})}})}if(parseInt(h)>0){f(h)}var c=new Ext.Window({title:lang("addContractRemind"),width:500,height:makeWindowHeight(520),modal:true,layout:"fit",resizable:false,border:false,items:[e],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){b(h)}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]});return c.show()}};var CNOA_contract_business_manageIndexClass,CNOA_contract_business_manageIndex;CNOA_contract_business_manageIndexClass=CNOA.Class.create();CNOA_contract_business_manageIndexClass.prototype={init:function(){var _this=this;this.edit_id=0;this.type="add";this.searchPar={name:"",number:"",type:"",person:"",notice:2,deptID:0,deptName:"",writePerson:"",a_company:"",b_company:"",a_charge_name:"",b_charge_name:"",start_from:"",end_from:"",sign_from:"",start_to:"",end_to:"",sign_to:""};this.baseUrl="index.php?app=contract&func=business&action=manage";this.fields=[{name:"id"},{name:"number"},{name:"name"},{name:"type"},{name:"deptName"},{name:"a_charge_name"},{name:"b_company"},{name:"b_charge_name"},{name:"b_contact"},{name:"startTime"},{name:"endTime"},{name:"sortType"},{name:"permit"},{name:"uFlowId"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getList&type=business",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(){try{_this.searchWindow.close()}catch(e){}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"uFlowId",dataIndex:"uFlowId",hidden:true},{header:lang("opt"),dataIndex:"id",width:210,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("contractNO"),dataIndex:"number",width:120,sortable:true,menuDisabled:true},{header:lang("contractName"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("contractType"),dataIndex:"type",width:80,sortable:true,menuDisabled:true},{header:lang("inDepartment"),dataIndex:"deptName",width:80,sortable:true,menuDisabled:true},{header:lang("contractStime"),dataIndex:"startTime",width:90,sortable:false,menuDisabled:true},{header:lang("contractEtime"),dataIndex:"endTime",width:90,sortable:false,menuDisabled:true},{header:lang("partyHead"),dataIndex:"a_charge_name",width:80,sortable:true,menuDisabled:true},{header:lang("partyUnitB"),dataIndex:"b_company",width:120,sortable:true,menuDisabled:true},{header:lang("partyHead1"),dataIndex:"b_charge_name",width:80,sortable:true,menuDisabled:true},{header:lang("PartyNumberB"),dataIndex:"b_contact",width:100,sortable:false,menuDisabled:true}]);this.pagingBar=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],style:"border-left-width:1px;",displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(th,params){var search=_this.searchPar;for(var key in search){if(key=="sortid"){continue}eval("var val = search."+key);if(val!=""){eval("params."+key+" = search."+key+";")}}}}});var add_contract_ID=Ext.id();var view_contract_ID=Ext.id();this.list=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,listeners:{rowdblclick:function(button,event){var rows=_this.list.getSelectionModel().getSelections();_this.edit_id=rows[0].get("id");_this.viewDetails(_this.edit_id)}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(button,event){_this.store.reload()}},{text:lang("addContravt"),iconCls:"icon-utils-s-add",cls:"btn-blue4",id:add_contract_ID,handler:function(){_this.type="add";_this.reset;_this.contractPanel()}},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){Ext.Ajax.request({url:_this.baseUrl+"&task=exportExcel",method:"POST",success:function(response,action){ajaxDownload(response.responseText)}})}},{text:lang("checkApproval"),iconCls:"icon-page-list",id:view_contract_ID,hidden:true},{text:lang("search"),iconCls:"icon-hr-search",cls:"btn-red1",handler:function(button){_this.doSearch()}},{xtype:"box",html:lang("bindingContract"),style:{color:"#666",marginLeft:"20px"}},"->",{xtype:"cnoa_helpBtn",helpid:100}],bbar:this.pagingBar,listeners:{render:function(th){getFlowId4Engine("contract",function(send,view){Ext.getCmp(add_contract_ID).setHandler(function(){send()});var btn_view=Ext.getCmp(view_contract_ID);btn_view.show();btn_view.setHandler(function(th){var row=_this.list.selModel.getSelected();if(typeof row==="undefined"){CNOA.miniMsg.alertShowAt(th,lang("chooseSeeContract"))}else{if(row.get("uFlowId")!=0){view(row.get("uFlowId"))}else{CNOA.miniMsg.alertShowAt(th,lang("contractWithoutApproval"))}}})})}}});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allSort"),rid:"0",iconCls:"icon-arrow-block",cls:"feeds-node",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(node){_this.sortTree.selectPath(_this.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(node){var sid=parseInt(node.attributes.id);_this.searchPar.sortid=isNaN(sid)?0:sid;_this.store.load({params:_this.searchPar})}}});this.left=new Ext.Panel({region:"west",layout:"fit",split:true,width:200,minWidth:80,maxWidth:300,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(button,event){_this.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",lang("contractType")]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.centerPanel,this.left]})},doModify:function(b){var a=this;a.type="edit";a.edit_id=b;a.contractPanel()},operation:function(f,a,c,e,h,g){var d=this;var b=c.data;var i="<a href='javascript:void(0)' class='gridview' onclick='CNOA_contract_business_manageIndex.viewDetails("+f+")'>"+lang("view")+"</a>";if(b.permit==1){i+="<a href='javascript:void(0)' class='gridview4 jianju' onclick='CNOA_contract_business_manageIndex.doModify("+f+")' >"+lang("modify")+"</a>";i+="<a href='javascript:void(0)' class='gridview3 jianju' onclick='CNOA_contract_business_manageIndex.deleteData("+f+")' >"+lang("del")+"</a>";i+="<a href='javascript:void(0)' class='gridview jianju' onclick='CNOA_contract_business_manageIndex.EditNotice("+f+', "'+b.name+"\")' >"+lang("addContractRemind")+"</a>"}return i},viewDetails:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;b.type="add";window.open(b.baseUrl+"&task=viewDetails&id="+a,"contractView","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},deleteData:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delete",method:"POST",params:{id:b},success:function(f){var d=Ext.decode(f.responseText);try{if(d.success===true){CNOA.msg.notice(d.msg,lang("contractMgr"));a.store.reload()}else{CNOA.msg.alert(d.msg)}}catch(g){}}})}})},EditNotice:function(h,b){var g=this;var e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getContractList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});function c(){if(f.getForm().isValid()){f.getForm().submit({url:g.baseUrl+"&task=addNotice",method:"POST",params:{cid:h},success:function(i,j){CNOA.msg.notice(j.result.msg,lang("contractMgr"));d.close()}.createDelegate(this),failure:function(i,j){CNOA.msg.alert(j.result.msg)}.createDelegate(this)})}}var a=new Ext.form.FieldSet({title:lang("contractMgr"),defaults:{style:{marginBottom:"10px"},width:350,allowBlank:false},items:[{xtype:"displayfield",value:"<b>《"+b+"》</b>",fieldLabel:lang("contractName"),allowBlank:true},{xtype:"hidden",name:"contract",value:h},{xtype:"textfield",name:"ntTitle",fieldLabel:lang("noticeTitle1")},{xtype:"datetimefield",fieldLabel:lang("noticeTime"),name:"ntTime",editable:false},{xtype:"textarea",name:"ntContent",fieldLabel:lang("noticeContent"),height:100},{xtype:"textarea",name:"ntNames",fieldLabel:lang("noticePerson"),height:100,readOnly:true},{xtype:"btnForPoepleSelector",style:"padding: 0 0 0 83px;",text:lang("selectPeople"),dataUrl:g.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:230,listeners:{selected:function(n,o){var p=new Array();var m=new Array();if(o.length>0){for(var l=0;l<=o.length-1;l++){p.push(o[l].uname);m.push(o[l].uid)}}var k=p.join(",");var j=m.join(",");f.getForm().findField("ntUids").setValue(j);f.getForm().findField("ntNames").setValue(k)},onrender:function(j){var i=f.getForm().findField("ntUids").getValue().split(",");j.setSelectedUids(i)}}},{xtype:"hidden",name:"ntUids"}]});var f=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px",layout:"form",autoScroll:true,items:a});var d=new Ext.Window({title:lang("addContractRemind"),width:500,height:makeWindowHeight(515),modal:true,layout:"fit",resizable:false,border:false,items:[f],buttons:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){c()}},{text:lang("close"),iconCls:"icon-dialog-cancel",cls:"btn-red1",handler:function(){d.close()}}]}).show()},contractPanel:function(){var e=this;this.optionNum=0;var c=new Ext.Panel({layout:"form",defaults:{style:{marginBottom:"10px"},width:220},items:[{xtype:"button",text:"删除收款",width:100,style:{marginLeft:"225px",marginBottom:"10px"},handler:function(){j()}}]});var d=new Ext.Panel({layout:"form",defaults:{style:{marginBottom:"10px"},width:220},items:[{xtype:"button",text:"添加收款",width:100,style:{marginLeft:"225px",marginBottom:"10px"},handler:function(){e.addgatheringOption()}}]});var h=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});h.load();var k=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTypeList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"tname"}]})});this.baseField=[{xtype:"fieldset",title:lang("contractInformation"),defaults:{width:350,border:false},layout:"table",columns:2,items:[{layout:"form",defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"cnoa_textfield",fieldLabel:lang("contractName"),name:"name",allowBlank:false},{xtype:"combo",fieldLabel:lang("contractType"),name:"type",store:k,hiddenName:"type",valueField:"tid",displayField:"tname",editable:false,mode:"local",triggerAction:"all"},{xtype:"departmentselectorfield",fieldLabel:lang("inDepartment"),allowBlank:false,name:"deptID",multiSelect:false},{xtype:"datefield",fieldLabel:lang("contractStime"),format:"Y-m-d",name:"startTime"},{xtype:"datefield",fieldLabel:lang("contractSigningTime"),name:"signTime",format:"Y-m-d"},{xtype:"cnoa_textfield",fieldLabel:lang("contractEnPeople"),value:CNOA_USER_TRUENAME,readOnly:true}]},{layout:"form",defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"combo",width:230,name:"sort",valueField:"id",hiddenName:"sort",displayField:"name",triggerAction:"all",mode:"local",editable:false,store:h,fieldLabel:lang("contractClass"),allowBlank:false,listeners:{select:function(n,l){var m=e.formPanel.getForm().findField("type");m.setValue("");m.setRawValue("");k.load({params:{sid:l.get("id")}})}}},{xtype:"cnoa_textfield",fieldLabel:lang("contractNO"),name:"number"},{xtype:"cnoa_textfield",fieldLabel:lang("businessPerson"),name:"person"},{xtype:"numberfield",fieldLabel:lang("contractAmount")+"(元)",nanText:lang("enternumber"),name:"money",allowNegative:false},{xtype:"datefield",fieldLabel:lang("contractEtime"),name:"endTime",format:"Y-m-d"},{xtype:"panel",layout:"form",border:false,items:[{xtype:"checkbox",boxLabel:lang("SFZDTX"),name:"autoNotice",width:195,style:"margin-left:5px;margin-top:3px;"}]}]}]},{xtype:"fieldset",title:lang("companyInformation"),defaults:{border:false,width:350},layout:"table",columns:2,items:[{layout:"form",defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"cnoa_textfield",fieldLabel:lang("partyUnitA"),name:"a_company"},{xtype:"cnoa_textfield",fieldLabel:lang("partyHead"),name:"a_charge_name"},{xtype:"textarea",fieldLabel:lang("partyNumberA"),name:"a_contact"}]},{layout:"form",defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"cnoa_textfield",fieldLabel:lang("partyUnitB"),name:"b_company"},{xtype:"cnoa_textfield",fieldLabel:lang("partyHead1"),name:"b_charge_name"},{xtype:"textarea",name:"b_contact",fieldLabel:lang("PartyNumberB")}]}]},{xtype:"fieldset",title:lang("CollectionNotice"),defaults:{border:false,width:330},layout:"table",columns:2,items:[d,c]},{xtype:"fieldset",title:lang("noticeSetting"),defaults:{style:{marginBottom:"5px"},width:580,xtype:"textarea"},items:[{xtype:"cnoa_textfield",name:"notice_forward",fieldLabel:lang("howDays"),width:300,regex:/^\d{1,}$/i,regexText:lang("TXTSWZS"),helpTip:lang("setHowDays")},{fieldLabel:lang("noticePerson"),name:"ntNames",readOnly:true},{xtype:"btnForPoepleSelector",style:"margin:0 0 5px 630px;",text:lang("selectPeople"),dataUrl:e.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:60,listeners:{selected:function(p,q){var r=new Array();var o=new Array();if(q.length>0){for(var n=0;n<=q.length-1;n++){r.push(q[n].uname);o.push(q[n].uid)}}var m=r.join(",");var l=o.join(",");e.formPanel.getForm().findField("ntUids").setValue(l);e.formPanel.getForm().findField("ntNames").setValue(m)},onrender:function(m){var l=e.formPanel.getForm().findField("ntUids").getValue().split(",");m.setSelectedUids(l)}}},{xtype:"hidden",name:"ntUids"},{xtype:"textarea",fieldLabel:lang("selectDept"),name:"ntJobs",readOnly:true,listeners:{afterrender:function(l){l.mon(l.el,"click",function(){var m=e.formPanel.getForm().findField("ntJids").getValue();new_selector("job",e.formPanel.getForm().findField("ntJobs"),e.formPanel.getForm().findField("ntJids"),true,"index.php?action=commonJob&act=getSelectorData&target=job",m)})}}},{xtype:"hidden",name:"ntJids",id:"ntJids"}]},{xtype:"fieldset",title:lang("detailContract"),defaults:{style:{marginBottom:"5px"},width:580,xtype:"textarea"},items:[{fieldLabel:lang("contractMainContent"),name:"mainContent"},{fieldLabel:lang("remark"),name:"notes"},{xtype:"flashfile",fieldLabel:lang("addContractDoeument"),name:"attach",style:"margin-top:5px;",inputPre:"filesUpload"}]},{xtype:"hidden",name:"flows"}];this.formPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:100,labelAlign:"right",bodyStyle:"padding:10px",autoScroll:true,defaults:{autoWidth:true},items:this.baseField});function a(){if(e.formPanel.getForm().isValid()){e.formPanel.getForm().submit({url:e.baseUrl+"&task="+e.type+"&type=contract&id="+e.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(l,m){CNOA.msg.notice(m.result.msg,lang("contractMgr"));e.contractWindow.close();e.store.load()}.createDelegate(this),failure:function(l,m){CNOA.msg.alert(m.result.msg)}.createDelegate(this)})}}function i(l){return new Ext.form.NumberField({fieldLabel:"第"+e.optionNum+"次收款(元)",name:"gatheringoptions[]",nanText:lang("enternumber"),id:"gatheringoptions"+e.optionNum,allowNegative:false,allowBlank:false,value:l})}function g(l){return new Ext.ux.form.DateTimeField({fieldLabel:"第"+e.optionNum+"次收款时间",name:"timeoptions[]",id:"timeoptions"+e.optionNum,allowBlank:false,value:l})}e.addgatheringOption=function(t,m,n){t=t||"";var s=this.type;if(s=="edit"){if(typeof(t)=="object"&&t.length){var l=[];var r=[];for(var o=0,q=t.length;o<q;o++){this.optionNum+=1;d.add(i(t[o]));c.add(g(m[o]))}}else{if(n==1){n=0}else{e.optionNum+=1;var m=g();var p=i();d.add(p);c.add(m)}}}else{e.optionNum+=1;var m=g();var p=i();d.add(p);c.add(m)}d.doLayout();c.doLayout()};function j(){var l="gatheringoptions"+e.optionNum;var m="timeoptions"+e.optionNum;d.remove(l);c.remove(m);e.optionNum-=1;if(e.optionNum<0){e.optionNum=0}d.doLayout();c.doLayout()}var b=0;var f=Ext.id();this.contractWindow=new Ext.Window({title:lang("addContravt"),width:800,height:makeWindowHeight(500),modal:true,layout:"fit",resizable:false,border:false,items:this.formPanel,buttons:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){a()}},{text:lang("close"),iconCls:"icon-dialog-cancel",cls:"btn-red1",handler:function(){e.contractWindow.close()}}]}).show();if(this.type=="edit"){e.loadFormData()}},doSearch:function(){var _this=this;this.findBaseField=[{title:lang("contractQuery"),defaults:{border:false,width:260,layout:"form",defaults:{style:{marginBottom:"10px"},width:150}},items:[{items:[{xtype:"cnoa_textfield",fieldLabel:lang("contractName"),name:"name"},{xtype:"cnoa_textfield",fieldLabel:lang("contractEnPeople"),name:"writePerson"},{xtype:"cnoa_textfield",fieldLabel:lang("businessPerson"),name:"person"}]},{items:[{xtype:"cnoa_textfield",fieldLabel:lang("contractNO"),name:"number"},{xtype:"departmentselectorfield",fieldLabel:lang("inDepartment"),allowBlank:false,name:"deptID",multiSelect:false}]}]},{title:lang("companyQuery"),defaults:{border:false,layout:"form",width:260,defaults:{style:{marginBottom:"10px"},width:150}},items:[{items:[{xtype:"cnoa_textfield",fieldLabel:lang("partyUnitA"),name:"a_company"},{xtype:"cnoa_textfield",fieldLabel:lang("partyHead"),name:"a_charge_name"}]},{items:[{xtype:"cnoa_textfield",fieldLabel:lang("partyUnitB"),name:"b_company"},{xtype:"cnoa_textfield",fieldLabel:lang("partyHead1"),name:"b_charge_name"}]}]},{title:lang("contractTimeQuery"),defaults:{border:false,layout:"form",width:260,defaults:{style:{marginBottom:"10px"},width:150}},items:[{items:[{xtype:"datefield",fieldLabel:lang("startTime"),name:"start_from",format:"Y-m-d"},{xtype:"datefield",fieldLabel:lang("endTime"),name:"end_from",format:"Y-m-d"},{xtype:"datefield",fieldLabel:lang("contractSigningTime"),name:"sign_from",format:"Y-m-d"}]},{items:[{xtype:"datefield",fieldLabel:lang("to"),name:"start_to",format:"Y-m-d"},{xtype:"datefield",fieldLabel:lang("to"),name:"end_to",format:"Y-m-d"},{xtype:"datefield",fieldLabel:lang("to"),name:"sign_to",format:"Y-m-d"}]}]}];this.findFormPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px",layout:"form",autoScroll:true,defaults:{layout:"table",columns:2,xtype:"fieldset"},items:this.findBaseField,listeners:{afterrender:function(){var form=_this.findFormPanel.getForm();for(var key in _this.searchPar){eval("var field = form.findField('"+key+"')");if(field){eval("field.setValue(_this.searchPar."+key+");")}}}}});this.submitFind=function(){var form=_this.findFormPanel.getForm();for(var key in _this.searchPar){eval("var field = form.findField('"+key+"')");if(field){if(field.xtype=="datefield"){eval("_this.searchPar."+key+" = field.getRawValue();")}else{eval("_this.searchPar."+key+" = field.getValue();")}}}_this.store.load({params:_this.searchPar})};this.ressetForm=function(){var form=_this.findFormPanel.getForm();for(var key in _this.searchPar){eval("var field = form.findField('"+key+"')");if(field){eval("_this.searchPar."+key+" = field.setValue('');")}}};this.searchWindow=new Ext.Window({title:lang("lookContract"),width:600,height:makeWindowHeight(520),modal:true,layout:"fit",resizable:false,border:false,items:[this.findFormPanel],buttons:[{text:lang("clear"),handler:function(){this.ressetForm()}.createDelegate(this)},{text:lang("search"),iconCls:"icon-hr-search",handler:function(){this.submitFind()}.createDelegate(this)},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){var form=_this.findFormPanel.getForm();for(var key in _this.searchPar){eval("var field = form.findField('"+key+"')");if(field){if(field.xtype=="datefield"){eval("_this.searchPar."+key+" = field.getRawValue();")}else{eval("_this.searchPar."+key+" = field.getValue();")}}}Ext.Ajax.request({url:_this.baseUrl+"&task=export2",params:_this.searchPar,method:"POST",success:function(response){if(response.responseText.failure===true){CNOA.msg.alert(Ext.decode(response.responseText).msg)}else{ajaxDownload(response.responseText)}}})}},{text:lang("close"),iconCls:"icon-dialog-cancel",cls:"btn-red1",handler:function(){this.searchWindow.close()}.createDelegate(this)}]}).show()},loadFormData:function(){var b=this;var a=b.formPanel.getForm();a.load({url:b.baseUrl+"&task=getEditData&type=business",params:{id:b.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(e,f){var c=a.findField("sort").getValue();if(c!=""){var d=a.findField("type");d.getStore().reload({params:{sid:c},callback:function(){var h=JSON.parse(f.response.responseText),g=h.data;d.setValue(g.type);b.addgatheringOption(g.gatheringoptions,g.timeoptions,1)}})}},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){b.close()})}.createDelegate(this)})},submitForm:function(){var a=this;alert(a.baseUrl+"&task="+a.type+"&type=contract&id="+a.edit_id);if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&type=contract&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("contractMgr"));a.contractWindow.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}}};var CNOA_contract_business_checkClass,CNOA_contract_business_check;CNOA_contract_business_checkClass=CNOA.Class.create();CNOA_contract_business_checkClass.prototype={init:function(){var g=this;this.baseUrl="index.php?app=contract&func=business&action=check";var d=Ext.id();var b=Ext.id();var e=Ext.id();var a=Ext.id();var c=Ext.id();var f=Ext.id();this.storeBar={storeType:"thisOver",name:"",title:"",type:"",status:"",s_time:"",e_time:""};this.fields=[{name:"id"},{name:"name"},{name:"type"},{name:"deptName"},{name:"a_charge_name"},{name:"b_company"},{name:"b_charge_name"},{name:"b_contact"},{name:"status"},{name:"qqNum"},{name:"startTime"},{name:"endTime"},{name:"sortType"},{name:"notice"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(m,l,n,k,j,i){var h=Ext.decode(j.responseText);if(h.failure){CNOA.msg.alert(h.msg)}},load:function(i,h,j){}}});g.store.setBaseParam("check",1);g.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(h,i){Ext.apply(i,storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("contract"),dataIndex:"name",width:150,sortable:true,menuDisabled:true},{header:lang("contractType"),dataIndex:"type",width:80,sortable:true,menuDisabled:true},{header:lang("inDepartment"),dataIndex:"deptName",width:80,sortable:true,menuDisabled:true},{header:lang("partyHead"),dataIndex:"a_charge_name",width:80,sortable:true,menuDisabled:true},{header:lang("partyUnitB"),dataIndex:"b_company",width:120,sortable:true,menuDisabled:true},{header:lang("partyHead1"),dataIndex:"b_charge_name",width:80,sortable:true,menuDisabled:true},{header:lang("PartyNumberB"),dataIndex:"b_contact",width:100,sortable:false,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:80,sortable:false,menuDisabled:true},{header:lang("contractStime"),dataIndex:"startTime",width:100,sortable:false,menuDisabled:true},{header:lang("contractEtime"),dataIndex:"endTime",width:100,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"id",width:100,sortable:false,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({stripeRows:true,region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,listeners:{rowdblclick:function(h,i){}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(h,i){g.store.reload()}},{text:lang("approvalThrough"),iconCls:"icon-dialog-ok-apply",handler:function(h){g.doPass()}},{text:lang("approvalNotThrough"),iconCls:"icon_cnoa_dialog-cancel",handler:function(h){g.doUnPass()}}],bbar:g.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list]})},doPass:function(){var b=this;var a=b.list.getSelectionModel().getSelections();if(a.length==0){CNOA.msg.alert(lang("firstOperateData"))}else{CNOA.msg.cf(lang("approvalByContract"),function(c){if(c=="yes"){var d=a[0].get("id");Ext.Ajax.request({url:b.baseUrl+"&task=pass",method:"POST",params:{cid:d},success:function(g){var f=g.responseText;var e=Ext.decode(f);CNOA.msg.notice(e.msg,lang("contractMgr"));b.store.reload()},failure:function(e,f){CNOA.msg.alert(result.msg,function(){b.store.reload()})}})}})}},doUnPass:function(){var f=this;var d=f.list.getSelectionModel().getSelections();if(d.length==0){CNOA.msg.alert(lang("firstOperateData"));return}var b=[{xtype:"textarea",width:340,height:180,name:"reason",fieldLabel:lang("reason")}];var a=new Ext.form.FormPanel({hideBorders:true,border:false,labelWidth:60,labelAlign:"right",bodyStyle:"padding: 10px",items:[b]});var e=new Ext.Window({title:lang("approvalNotThrough"),width:480,height:280,resizable:false,items:[a],modal:true,layout:"fit",buttons:[{text:lang("save"),handler:function(){CNOA.msg.cf(lang("approvalNotThrough1"),function(g){if(g=="yes"){var h=d[0].get("id");c(h)}})}},{text:lang("close"),handler:function(){e.close()}}]}).show();function c(h){var g=a.getForm();if(g.isValid()){g.submit({url:f.baseUrl+"&task=unpass",method:"POST",params:{cid:h},success:function(i,j){CNOA.msg.notice(j.result.msg,lang("contractMgr"));e.close();f.store.reload()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}else{CNOA.miniMsg.alertShowAt(ID_btn_save,lang("formValid"))}}},operate:function(a){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_contract_business_check.viewDetails("+a+")'>"+lang("view")+"</a>"},viewDetails:function(b){var a=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(a.baseUrl+"&task=getList&type=viewDetails&ID="+b,"contractView","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};var CNOA_contract_business_setting_noticeClass;CNOA_contract_business_setting_noticeClass=CNOA.Class.create();CNOA_contract_business_setting_noticeClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=contract&func=business&action=setting&for=notice";this.ID_btn_save=Ext.id();this.fields=[{name:"id"},{name:"uid"},{name:"jid"},{name:"type"},{name:"status"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTargetList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.colum=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",sortable:true,hidden:true},{header:lang("noticePerson"),width:200,sortable:true,dataIndex:"uid"},{header:lang("remindPosition"),width:200,sortable:true,dataIndex:"jid"},{header:lang("reminderType"),width:200,sortable:true,dataIndex:"type",renderer:this.makeType.createDelegate(this)},{header:lang("takeEffect"),width:200,sortable:true,dataIndex:"status",renderer:this.makeStatus.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,title:lang("remindObject"),store:this.store,sm:this.sm,loadMask:{msg:lang("waiting")},height:358,colModel:this.colum,viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(b,c){this.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){a.showAddWindow()}.createDelegate(this)},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){var d=this.grid.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(e){if(e=="yes"){if(d){id=d[0].get("id");a.deleteTargetList(id)}}})}}.createDelegate(this)},lang("noteClick")]})});this.baseField=[{xtype:"fieldset",title:lang("contractRemindSet"),defaults:{style:{marginBottom:"10px"}},items:[{xtype:"cnoa_checkbox",name:"notice_enable",helpTip:lang("checkedAuto"),fieldLabel:lang("enableConRemind")},{xtype:"cnoa_textfield",name:"notice_forward",fieldLabel:lang("howDays"),allowBlank:false,width:300,regex:/^\d{1,}$/i,regexText:lang("mustPureNumbers"),helpTip:lang("setHowDays")}]},this.grid,{xtype:"hidden",listeners:{afterrender:function(){a.loadForm()}}}];this.mainPanel=new Ext.form.FormPanel({title:lang("remindObject"),hideBorders:true,border:false,waitMsgTarget:true,autoScroll:true,layout:"border",labelWidth:130,bodyStyle:"border-left-width:1px;",labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",items:[this.baseField]}],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",id:this.ID_btn_save,handler:function(){a.submitForm()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:0}]})})},submitForm:function(a){var c=this;var b=this.mainPanel.getForm();if(b.isValid()){b.submit({url:c.baseUrl+"&task=submitFormDataInfo",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{},success:function(d,e){CNOA.msg.notice(e.result.msg,lang("contractMgr"));c.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(this.ID_btn_save,lang("formValid"))}},loadForm:function(){var a=this;this.mainPanel.getForm().load({url:a.baseUrl+"&task=editLoadFormDataInfo",method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},makeType:function(a){return a=="u"?lang("people"):lang("job")},makeStatus:function(a){var b="";if(a==1){b="<span class='cnoa_color_green'>"+lang("takeEffect")+"</span>"}else{if(a=="0"){b="<span class='cnoa_color_red'>"+lang("noEffect")+"</span>"}else{if(a=="2"){b="<span class='cnoa_color_gray'>"+lang("AlreadyDel")+"</span>"}}}return b},showAddWindow:function(){var g=this;var c=Ext.id();var b=Ext.id();var d=Ext.id();var e=function(h){var i=a.getForm();if(i.isValid()){i.submit({url:g.baseUrl+"&task=addTarget",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{},success:function(j,k){CNOA.msg.notice(k.result.msg,lang("contractMgr"));f.close();g.store.reload()}.createDelegate(this),failure:function(j,k){CNOA.msg.alert(k.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(d,lang("formValid"))}};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:60,labelAlign:"right",items:[{xtype:"radiogroup",fieldLabel:lang("reminderType"),name:"typeGroup",items:[{boxLabel:lang("people"),name:"type",inputValue:"u",checked:true},{boxLabel:lang("job"),name:"type",inputValue:"j"}],listeners:{change:function(l,k){var i=Ext.getCmp(c);var h=Ext.getCmp(b);if(k.inputValue==="u"){i.setDisabled(false);h.setDisabled(true)}else{i.setDisabled(true);h.setDisabled(false)}}}},{xtype:"userselectorfield",id:c,fieldLabel:lang("noticePerson"),width:200,allowBlank:false,hiddenName:"uid",multiSelect:false},{xtype:"jobselectorfield",id:b,fieldLabel:lang("remindPosition"),width:200,disabled:true,allowBlank:false,hiddenName:"jid",multiSelect:false}]});var f=new Ext.Window({width:357,height:175,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:lang("addRemindObject"),layout:"fit",items:[a],listeners:{},buttons:[{text:lang("save"),id:d,iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){e()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]}).show()},deleteTargetList:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteTarget",method:"POST",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){a.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_contract_business_setting,CNOA_contract_business_settingClass;var CNOA_contract_business_sort,CNOA_contract_business_sortClass;var CNOA_contract_business_type,CNOA_contract_business_typeClass;var CNOA_contract_business_noticesetting,CNOA_contract_business_noticesettingClass;CNOA_contract_business_noticesettingClass=CNOA.Class.create();CNOA_contract_business_noticesettingClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=contract&func=business&action=setting";this.ID_btn_save=Ext.id();this.fields=[{name:"id"},{name:"uid"},{name:"jid"},{name:"type"},{name:"status"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTargetList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.colum=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",sortable:true,hidden:true},{header:lang("noticePerson"),width:200,sortable:true,dataIndex:"uid"},{header:lang("remindPosition"),width:200,sortable:true,dataIndex:"jid"},{header:lang("reminderType"),width:200,sortable:true,dataIndex:"type",renderer:this.makeType.createDelegate(this)},{header:lang("takeEffect"),width:200,sortable:true,dataIndex:"status",renderer:this.makeStatus.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,title:lang("remindObject"),store:this.store,sm:this.sm,loadMask:{msg:lang("waiting")},height:358,colModel:this.colum,viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(b,c){this.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){a.showAddWindow()}.createDelegate(this)},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){var d=this.grid.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(e){if(e=="yes"){if(d){id=d[0].get("id");a.deleteTargetList(id)}}})}}.createDelegate(this)},lang("noteClick")]})});this.baseField=[{xtype:"fieldset",title:lang("contractRemindSet"),defaults:{style:{marginBottom:"10px"}},items:[{xtype:"cnoa_checkbox",name:"notice_enable",helpTip:lang("checkedAuto"),fieldLabel:lang("enableConRemind")},{xtype:"cnoa_textfield",name:"notice_forward",fieldLabel:lang("howDays"),allowBlank:false,width:300,regex:/^\d{1,}$/i,regexText:lang("howDays"),helpTip:lang("setHowDays")}]},this.grid,{xtype:"hidden",listeners:{afterrender:function(){a.loadForm()}}}];this.mainPanel=new Ext.form.FormPanel({title:lang("contractRemindSet"),hideBorders:true,border:false,waitMsgTarget:true,autoScroll:true,layout:"border",labelWidth:130,bodyStyle:"border-left-width:1px;",labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",items:[this.baseField]}],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",id:this.ID_btn_save,handler:function(){a.submitForm()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:160}]})})},submitForm:function(a){var c=this;var b=this.mainPanel.getForm();if(b.isValid()){b.submit({url:c.baseUrl+"&task=submitFormDataInfo",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{},success:function(d,e){CNOA.msg.notice(e.result.msg,lang("hrMgr"));c.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(this.ID_btn_save,lang("formValid"))}},loadForm:function(){var a=this;this.mainPanel.getForm().load({url:a.baseUrl+"&task=editLoadFormDataInfo",method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},makeType:function(a){return a=="u"?lang("people"):lang("job")},makeStatus:function(a){var b="";if(a==1){b="<span class='cnoa_color_green'>"+lang("takeEffect")+"</span>"}else{if(a=="0"){b="<span class='cnoa_color_red'>"+lang("noEffect")+"</span>"}else{if(a=="2"){b="<span class='cnoa_color_gray'>"+lang("AlreadyDel")+"</span>"}}}return b},showAddWindow:function(){var g=this;var c=Ext.id();var b=Ext.id();var d=Ext.id();var e=function(h){var i=a.getForm();if(i.isValid()){i.submit({url:g.baseUrl+"&task=addTarget",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{},success:function(j,k){f.close();g.store.reload()}.createDelegate(this),failure:function(j,k){CNOA.msg.alert(k.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(d,lang("formValid"))}};var a=new Ext.form.FormPanel({waitMsgTarget:true,border:false,bodyStyle:"padding: 10px",labelWidth:60,labelAlign:"right",items:[{xtype:"radiogroup",fieldLabel:lang("reminderType"),name:"typeGroup",items:[{boxLabel:lang("people"),name:"type",inputValue:"u",checked:true},{boxLabel:lang("job"),name:"type",inputValue:"j"}],listeners:{change:function(l,k){var i=Ext.getCmp(c);var h=Ext.getCmp(b);if(k.inputValue==="u"){i.setDisabled(false);h.setDisabled(true)}else{i.setDisabled(true);h.setDisabled(false)}}}},{xtype:"userselectorfield",id:c,fieldLabel:lang("noticePerson"),width:200,allowBlank:false,hiddenName:"uid",multiSelect:false},{xtype:"jobselectorfield",id:b,fieldLabel:lang("remindPosition"),width:200,disabled:true,allowBlank:false,hiddenName:"jid",multiSelect:false}]});var f=new Ext.Window({width:357,height:190,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:lang("addRemindObject"),layout:"fit",items:[a],buttons:[{text:lang("save"),id:d,iconCls:"icon-btn-save",handler:function(){e()}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]}).show()},deleteTargetList:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteTarget",method:"POST",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){a.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};CNOA_contract_business_sortClass=CNOA.Class.create();CNOA_contract_business_sortClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=contract&func=business&action=setting";this.fields=[{name:"id"},{name:"name"},{name:"viewMan"},{name:"vUids"},{name:"mUids"},{name:"managerMan"},{name:"uname"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.colum=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",sortable:true,hidden:true},{header:lang("sortName"),width:150,sortable:true,dataIndex:"name",sortable:false,menuDisabled:true},{header:lang("peopleToView"),width:170,sortable:true,dataIndex:"viewMan",sortable:false,menuDisabled:true},{header:lang("manager"),width:170,sortable:true,dataIndex:"managerMan",sortable:false,menuDisabled:true},{header:lang("manager"),width:80,sortable:true,dataIndex:"uname",sortable:false,menuDisabled:true},{header:lang("opt"),width:80,sortable:true,dataIndex:"id",sortable:false,menuDisabled:true,renderer:this.renOper.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,sm:this.sm,loadMask:{msg:lang("waiting")},height:358,colModel:this.colum,tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(b,c){this.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){a.showAddWindow()}.createDelegate(this)}]})});this.mainPanel=new Ext.form.FormPanel({title:lang("sortSet"),hideBorders:true,border:false,waitMsgTarget:true,autoScroll:true,layout:"fit",labelWidth:130,bodyStyle:"border-left-width:1px;",labelAlign:"right",items:[this.grid],tbar:new Ext.Toolbar({style:"border-left-width:1px;"})})},renOper:function(f,b,a,g,d,c){var e="";e+="<a href='javascript:void(0)' class='gridview4' onclick='CNOA_contract_business_sort.showAddWindow(2, "+f+","+g+")'>"+lang("modify")+"</a>";e+="<a href='javascript:void(0)' class='gridview3 jianju' onclick='CNOA_contract_business_sort.deleteTargetList("+f+")'>"+lang("del")+"</a>";return e},deleteTargetList:function(a){var b=this;CNOA.msg.cf(lang("deleteToInformation"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteSort",method:"POST",params:{sid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("contractSetMgr"));b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},showAddWindow:function(k,a,l){var f=this;var c=Ext.id();var i=f.baseUrl+"&task=editSort",m;if(k==2){m=lang("editSort")}else{m=lang("addSort")}function j(n){var o=b.getForm();if(o.isValid()){o.submit({url:i,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{sid:n},success:function(p,q){CNOA.msg.notice(q.result.msg,lang("contractMgr"));e.close();f.store.reload()}.createDelegate(this),failure:function(p,q){CNOA.msg.alert(q.result.msg)}.createDelegate(this)})}else{CNOA.miniMsg.alertShowAt(c,lang("formValid"))}}var h=new Ext.form.FieldSet({title:lang("view"),width:450,items:[{xtype:"hidden",name:"view_uids"},{xtype:"textarea",fieldLabel:lang("peopleToView"),width:230,height:123,name:"view_unames",readOnly:true},{xtype:"btnForPoepleSelector",text:lang("selectPeople"),allowBlank:false,name:"view_sortUser",dataUrl:f.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:230,hideLabel:true,style:"padding: 0 0 0 65px",listeners:{selected:function(r,s){var t=new Array();var q=new Array();if(s.length>0){for(var p=0;p<=s.length-1;p++){t.push(s[p].uname);q.push(s[p].uid)}}var o=t.join(",");var n=q.join(",");b.getForm().findField("view_unames").setValue(o);b.getForm().findField("view_uids").setValue(n)},onrender:function(n){n.setSelectedUids(b.getForm().findField("view_uids").getValue().split(","))}}}]});var g=new Ext.form.FieldSet({title:lang("manage"),width:450,items:[{xtype:"hidden",name:"manager_uids"},{xtype:"textarea",fieldLabel:lang("manager"),width:230,height:123,allowBlank:false,name:"manager_unames",readOnly:true},{xtype:"btnForPoepleSelector",text:lang("selectManager"),allowBlank:false,name:"manager_sortUser",dataUrl:f.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:230,hideLabel:true,style:"padding: 0 0 0 65px",listeners:{selected:function(r,s){var t=new Array();var q=new Array();if(s.length>0){for(var p=0;p<=s.length-1;p++){t.push(s[p].uname);q.push(s[p].uid)}}var o=t.join(",");var n=q.join(",");b.getForm().findField("manager_unames").setValue(o);b.getForm().findField("manager_uids").setValue(n)},onrender:function(n){n.setSelectedUids(b.getForm().findField("manager_uids").getValue().split(","))}}}]});var b=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:60,labelAlign:"right",autoScroll:true,layout:"form",bodyStyle:"padding: 10px",items:[{xtype:"textfield",fieldLabel:lang("sortName"),name:"sortName",width:200,allowBlank:false},h,g]});function d(n){var p=f.store.getAt(l).data;var o=b.getForm();o.findField("view_uids").setValue(p.vUids);o.findField("view_unames").setValue(p.viewMan);o.findField("manager_uids").setValue(p.mUids);o.findField("manager_unames").setValue(p.managerMan);o.findField("sortName").setValue(p.name)}if(k==2){d(a)}var e=new Ext.Window({width:500,height:makeWindowHeight(540),modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:m,layout:"fit",items:b,buttons:[{text:lang("save"),id:c,iconCls:"icon-btn-save",handler:function(){j(a)}.createDelegate(this)},{text:lang("cancel"),id:this.ID_btn_close,iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()}};CNOA_contract_business_typeClass=CNOA.Class.create();CNOA_contract_business_typeClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=contract&func=business&action=setting";var a=[{name:"tid"},{name:"tname"},{name:"sid"},{name:"sname"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTypeList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),c,{header:"tid",dataIndex:"tid",hidden:true},{header:"sid",dataIndex:"sid",hidden:true},{header:lang("type"),width:150,sortable:true,dataIndex:"tname"},{header:lang("sort2"),width:170,sortable:true,dataIndex:"sname"}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,sm:c,loadMask:{msg:lang("waiting")},height:358,colModel:b,clicksToEdit:1,tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh"),handler:function(e,f){d.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.showAddWindow("add")}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(g){var f=d.getSelects();var e=f.length;if(e>1){CNOA.miniMsg.alertShowAt(g,lang("notAllowEditMoreOneRecord"))}else{if(e==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{d.showAddWindow("edit",f[0])}}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var f=d.getSelects();var e=f.length;if(e==0){CNOA.miniMsg.alertShowAt(g,lang("noChoiceNeed"))}else{Ext.MessageBox.confirm(lang("notice"),lang("sureRemoveType"),function(j){if(j=="yes"){var k=[];for(var h=0;h<e;++h){k.push(f[h].get("tid"))}d.delType(k.join(","))}})}}}]})});this.mainPanel=new Ext.form.FormPanel({title:lang("typeSet"),hideBorders:true,border:false,waitMsgTarget:true,autoScroll:true,layout:"fit",labelWidth:130,bodyStyle:"border-left-width:1px;",labelAlign:"right",items:this.grid,tbar:new Ext.Toolbar({style:"border-left-width:1px;"})})},getSelects:function(){return this.grid.getSelectionModel().getSelections()},delType:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delType",method:"POST",params:{tids:a},success:function(c){b.store.reload();CNOA.msg.notice(Ext.decode(c.responseText).msg)},failure:function(){CNOA.msg.notice(lang("optFail"))}})},showAddWindow:function(d,c){var h=this;var g=d=="edit"?lang("editStyle"):lang("addStyle");var e=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"index.php?app=contract&func=business&action=manage&task=getSortList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});var b=Ext.id();var f=Ext.id();var a=new Ext.Window({title:g,width:300,height:170,layout:"form",labelAlign:"right",labelWidth:50,bodyStyle:"padding:10px",modal:true,defaults:{width:"100",allowBlank:false},items:[{xtype:"textfield",fieldLabel:lang("type"),id:b},{xtype:"combo",fieldLabel:lang("sort"),id:f,hiddenName:"sort",valueField:"id",displayField:"name",triggerAction:"all",mode:"local",editable:false,store:e,typeAhead:true}],buttons:[{text:lang("ok"),handler:function(){var i={};i.tname=Ext.getCmp(b).getValue();i.sid=Ext.getCmp(f).getValue();if(c!==undefined){i.tid=c.get("tid")}Ext.Ajax.request({url:h.baseUrl+"&task=editType",method:"POST",params:i,success:function(j){h.store.reload();a.close();CNOA.msg.notice(Ext.decode(j.responseText).msg)},failure:function(){a.close();CNOA.msg.notice(lang("optFail"))}})}},{text:lang("cancel"),handler:function(){a.close()}}]}).show();if(d=="edit"){Ext.getCmp(b).setValue(c.get("tname"));Ext.getCmp(f).setValue(c.get("sid"));Ext.getCmp(f).setRawValue(c.get("sname"))}}};CNOA_contract_business_settingClass=CNOA.Class.create();CNOA_contract_business_settingClass.prototype={init:function(){var a=this;this.noticePanel=new CNOA_contract_business_setting_noticeClass();CNOA_contract_business_sort=new CNOA_contract_business_sortClass();CNOA_contract_business_type=new CNOA_contract_business_typeClass();CNOA_contract_business_noticesetting=new CNOA_contract_business_noticesettingClass();this.centerPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,items:[CNOA_contract_business_sort.mainPanel,CNOA_contract_business_type.mainPanel,CNOA_contract_business_noticesetting.mainPanel]});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.centerPanel]})}};var sm_contract_business=1;
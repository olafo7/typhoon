var CNOA_main_monitor_commgrClass,CNOA_main_monitor_commgr;CNOA_main_monitor_commgrClass=CNOA.Class.create();CNOA_main_monitor_commgrClass.prototype={init:function(){var a=this;this.ID_btn_refreshList=Ext.id();this.ID_tree_treeRoot="CNOA_main_im_mgr_tree_root";this.ID_tree_treeRoot2="CNOA_main_im_mgr_tree_root2";this.ID_btn_collapseExpand=Ext.id();this.ID_btn_collapseExpand2=Ext.id();this.ID_chattingWith=Ext.id();this.ID_exportBtn=Ext.id();this.baseUrl="index.php?app=main&func=monitor";this.fields=[{name:"id",mapping:"id"},{name:"date",mapping:"date"},{name:"content",mapping:"content"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&action=commgr"}),groupField:"date",sortInfo:{field:"id",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.colModel=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:20,sortable:true,hidden:true},{header:"日期",dataIndex:"date",width:20,sortable:true},{header:"内容",dataIndex:"content",width:60,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderContent}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:CNOA.lang.mainUser.emptyMsg,displayMsg:CNOA.lang.mainUser.displayMsg,style:"border-left-width:1px;",store:this.store,pageSize:15,listeners:{beforechange:function(g,k){try{var c=a.deptTree.getSelectionModel().getSelectedNode();var b=a.deptTree2.getSelectionModel().getSelectedNode();var f=c.attributes.uid;var j=b.attributes.uid;k.task="getHistory";k.fuid=f;k.tuid=j}catch(i){var d=a.ddGroupGridPanel.getSelectionModel().selections.items[0];if(d){k.task="getHistory";k.fuid=0;k.tuid=0;k.gid=d.data.id}}}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,hideHeaders:true,loadMask:{msg:CNOA.lang.msgLoadMask},cm:this.colModel,hideBorders:true,border:false,viewConfig:{forceFit:true},view:new Ext.grid.GroupingView({forceFit:true,showGroupName:true,enableNoGroups:false,enableGroupingMenu:false,hideGroupedColumn:true})});this.centerPanel=new Ext.Panel({title:"会话记录",region:"center",layout:"fit",autoScroll:true,items:[this.grid],tbar:new Ext.Toolbar({style:"height:22px;line-height:22px;",items:[new Ext.BoxComponent({id:this.ID_chattingWith,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:"请点击左边联系人查看记录"}}),"->",{xtype:"button",text:"删除选中的",cls:"x-btn-over",hidden:true,listeners:{mouseout:function(b){b.addClass("x-btn-over")}},handler:function(b){var c=a.grid.getSelectionModel().getSelections();if(c.length==0){CNOA.miniMsg.alertShowAt(b,CNOA.lang.mainJob.oneMoreDataToDel)}else{CNOA.msg.cf("确定要删该记录吗?",function(e){if(e=="yes"){if(c){var f="";for(var d=0;d<c.length;d++){f+=c[d].get("id")+",";var g=c[d];a.store.remove(g)}Ext.Ajax.request({url:a.baseUrl+"&action=commgr&task=deleteRecord",method:"POST",params:{ids:f},success:function(j){var i=Ext.decode(j.responseText);if(i.success===true){}else{CNOA.msg.alert(i.msg,function(){})}}})}}})}}},"-",{xtype:"button",text:"导出",hidden:true,hidden:true,id:this.ID_exportBtn,iconCls:"icon-file-down",handler:function(){a.exportHistory()}}]}),bbar:this.pagingBar});this.treeRoot=new Ext.tree.AsyncTreeNode({id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&action=commgr&task=getAllUserListsInDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){this.treeRoot.firstChild.collapse(true);try{if(Ext.getCmp(this.ID_btn_collapseExpand).pressed){this.treeRoot.expand(true)}else{this.treeRoot.firstChild.expand()}}catch(c){}try{if(Ext.getCmp(this.ID_btn_collapseExpand2).pressed){this.treeRoot2.expand(true)}else{this.treeRoot2.firstChild.expand()}}catch(c){}this.deptTree.getEl().unmask()}.createDelegate(this)}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(){setTimeout(function(){a.openHistory()},100)}.createDelegate(this)}});this.deptPanel=new Ext.Panel({title:"用户 与",headerCfg:{cls:"x-panel-header",style:"text-align:right"},region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.deptTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:"展开",iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand,tooltip:CNOA.lang.strExpandMenuTip,enableToggle:true,toggleHandler:function(b,c){if(c){b.setIconClass("icon-collapse-all");b.setText("折叠");b.setTooltip(CNOA.lang.strCollapseMenuTip);a.treeRoot.expand(true)}else{b.setIconClass("icon-expand-all");b.setText("展开");b.setTooltip(CNOA.lang.strExpandMenuTip);a.treeRoot.collapse(true);a.treeRoot.firstChild.expand()}}},"->",{handler:function(b,c){this.reloadDeptData()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:CNOA.lang.mainUser.refreshList,text:CNOA.lang.mainUser.refreshList}]})});this.treeRoot2=new Ext.tree.AsyncTreeNode({id:this.ID_tree_treeRoot2,expanded:true});this.deptTree2=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot2,autoScroll:true,listeners:{click:function(){setTimeout(function(){a.openHistory()},100)}.createDelegate(this)}});this.deptPanel2=new Ext.Panel({title:"用户 的会话记录",region:"center",layout:"fit",width:180,minWidth:80,maxWidth:200,bodyStyle:"border-right-width:1px;",items:[this.deptTree2],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:"展开",iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand2,tooltip:CNOA.lang.strExpandMenuTip,enableToggle:true,toggleHandler:function(b,c){if(c){b.setIconClass("icon-collapse-all");b.setText("折叠");b.setTooltip(CNOA.lang.strCollapseMenuTip);a.treeRoot2.expand(true)}else{b.setIconClass("icon-expand-all");b.setText("展开");b.setTooltip(CNOA.lang.strExpandMenuTip);a.treeRoot2.collapse(true);a.treeRoot2.firstChild.expand()}}},"->",{handler:function(b,c){this.reloadDeptData()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:CNOA.lang.mainUser.refreshList,text:CNOA.lang.mainUser.refreshList}]})});this.ddtoCenterPanel=new Ext.Panel({region:"center",layout:"border",hideBorders:true,bodyStyle:"border-left-width:1px;",items:[this.deptPanel2]});this.ddmainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.ddtoCenterPanel]});this.groupFields=[{name:"id"},{name:"uid"},{name:"uname"},{name:"theme"},{name:"isdelete"}];this.groupStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&action=commgr&task=getGroupList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.groupFields})});this.groupStore.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.groupColModel=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},{header:"",dataIndex:"uid",sortable:false,menuDisabled:true,hidden:true},{header:"uname",dataIndex:"uname",hidden:true},{header:"讨论组",dataIndex:"theme",width:210,sortable:true,menuDisabled:true,renderer:this.makeOper.createDelegate(this)}]);this.ddGroupGridPanel=new Ext.grid.GridPanel({border:false,hideBorders:false,autoScroll:true,region:"center",layout:"fit",store:this.groupStore,cm:this.groupColModel,stripeRows:true,viewConfig:{forceFit:true},bbar:[{text:CNOA.lang.mainUser.refreshList,iconCls:"icon-system-refresh",handler:function(b,c){a.groupStore.reload()}}],listeners:{rowclick:function(c,f,d){var b=a.ddGroupGridPanel.getStore().getAt(f);a.store.load({params:{task:"getHistory",gid:b.data.id}})}}});this.ddGroupMainPanel=new Ext.Panel({width:280,collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.ddGroupGridPanel]});this.ddPanel=new Ext.Panel({width:380,minWidth:400,maxWidth:450,region:"west",layout:"card",activeItem:0,hideBorders:true,bodyStyle:"border-left-width:1px;",items:[this.ddmainPanel,this.ddGroupMainPanel],tbar:[{enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"CHAT_RECORD_VIEW",iconCls:"icon-roduction",text:"联系人",handler:function(){a.ddPanel.getLayout().setActiveItem(0);a.store.load({params:{task:"getHistory",fuid:0,tuid:0}});var b="请点击左边联系人查看记录";Ext.getCmp(a.ID_chattingWith).getEl().update(b);a.ddGroupGridPanel.getSelectionModel().clearSelections()}},"-",{enableToggle:true,allowDepress:false,toggleGroup:"CHAT_RECORD_VIEW",iconCls:"icon-roduction",text:"讨论组",handler:function(){a.ddPanel.getLayout().setActiveItem(1);var b="点击左边的讨论组查看会话记录";Ext.getCmp(a.ID_chattingWith).getEl().update(b)}}]});this.toCenterPanel=new Ext.Panel({region:"center",layout:"border",hideBorders:true,bodyStyle:"border-left-width:1px;",items:[this.centerPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,listeners:{afterlayout:function(){}},items:[this.ddPanel,this.toCenterPanel]})},exportHistory:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&action=commgr&task=exportHistory",method:"POST",params:{uid:a.newSelectUid,step:1},success:function(b){ajaxDownload(a.baseUrl+"&action=commgr&task=exportHistory&uid="+a.newSelectUid+"&file="+b.responseText)}})},renderContent:function(c,b,a){b.attr='style="white-space:normal;"';return c},reloadDeptData:function(){this.treeRoot2.reload();this.treeRoot.reload()},openHistory:function(){var f=this;var b=this.deptTree.getSelectionModel().getSelectedNode();var a=this.deptTree2.getSelectionModel().getSelectedNode();if(!b||!a){return}if((b==undefined)||b.disabled||(b.attributes.uid==undefined)){return}if((a==undefined)||a.disabled||(a.attributes.uid==undefined)){return}var c=b.attributes.uid;var d=a.attributes.uid;if(c==d){return}var e=b.text+"与 "+a.text+" 的会话记录";Ext.getCmp(this.ID_chattingWith).getEl().update(e);this.store.load({params:{task:"getHistory",fuid:c,tuid:d}})},makeOper:function(e,c,b){var f=this;var d=b.data;var a="";if(d.isdelete==1){a+=e+'<span style="color: red">(已退出)</span>'}else{a+=e}return a}};var CNOA_main_monitor_taskmgrClass,CNOA_main_monitor_taskmgr;CNOA_main_monitor_taskmgrClass=CNOA.Class.create();CNOA_main_monitor_taskmgrClass.prototype={init:function(){var g=this;this.edit_id=0;this.content_start=1;this.baseUrl="index.php?app=main&func=monitor&action=taskmgr";this.action="add";this.actionTitle=this.action=="add"?"添加计划":"修改计划";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_plan_content=Ext.id();this.search={title:"",uid:0,execman:0,examapp:0};this.fields=[{name:"tid"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"jixiao"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"uid"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"},{name:"_id"},{name:"_parent"},{name:"_is_leaf"},{name:"_level"}];try{this.store=new Ext.ux.maximgb.tg.AdjacencyListStore({autoLoad:true,url:this.baseUrl+"&task=getTaskTreeList",reader:new Ext.data.JsonReader({id:"_id",root:"data",totalProperty:"total",successProperty:"success"},this.fields)})}catch(f){}this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=[{header:"任务标题",dataIndex:"title",width:220},{header:"状态",dataIndex:"status",width:120,renderer:this.makeStatus.createDelegate(this)},{header:"进度绩效",dataIndex:"jixiao",width:120},{header:"负责人",dataIndex:"execman",width:80},{header:"布置人",dataIndex:"postter",width:80},{header:"开始时间",dataIndex:"stime",width:80},{header:"结束时间",dataIndex:"etime",width:80},{header:"操作",dataIndex:"",width:80,renderer:this.makeOperate.createDelegate(this)}];this.pagingBar=new Ext.ux.maximgb.tg.PagingToolbar({store:this.store,displayInfo:true,pageSize:15});var c=Ext.id();var d=Ext.id();var a=Ext.id();var b=Ext.id();this.searchBar=new Ext.Toolbar({items:["任务名称:",{xtype:"textfield",id:d,width:128},"&nbsp;布置人:",{xtype:"hidden",id:a},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:a+"Tr",listeners:{selected:function(j,i,e){Ext.getCmp(a).setValue(i)}}},"&nbsp;负责人:",{xtype:"hidden",id:c},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:c+"Tr",listeners:{selected:function(j,i,e){Ext.getCmp(c).setValue(i)}}},"&nbsp;审批人:",{xtype:"hidden",id:b},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:b+"Tr",listeners:{selected:function(j,i,e){Ext.getCmp(b).setValue(i)}}},{xtype:"button",text:"查询",style:"margin-left:5px",cls:"x-btn-over",listeners:{mouseout:function(e){e.addClass("x-btn-over")}},handler:function(){g.search.title=Ext.getCmp(d).getValue();g.search.uid=Ext.getCmp(a).getValue();g.search.execman=Ext.getCmp(c).getValue();g.search.examapp=Ext.getCmp(b).getValue();g.store.load({params:{title:g.search.title,uid:g.search.uid,execman:g.search.execman,examapp:g.search.examapp}})}},{xtype:"button",text:"清空",style:"margin-left:5px",listeners:{mouseout:function(e){}},handler:function(){Ext.getCmp(d).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(a+"Tr").setValue("");Ext.getCmp(c+"Tr").setValue("");Ext.getCmp(b+"Tr").setValue("");g.search={title:"",uid:0,execman:0,examapp:0};g.store.load()}}]});this.grid=new Ext.ux.maximgb.tg.GridPanel({columns:this.colModel,store:this.store,border:false,enableDD:true,useArrows:false,stripeRows:true,listeners:{rowdblclick:function(e,i){},cellclick:function(i,l,j,k){},cellclick:function(j,m,k,l){var i=j.getStore().getAt(m);if(k==2){this.viewTask(i.data.tid)}}.createDelegate(this),render:function(){g.searchBar.render(this.tbar)}},tbar:new Ext.Toolbar({items:[{handler:function(e,i){g.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:CNOA.lang.mainJob.refreshList},"-",{handler:function(e,i){g.openExportExcelWindow()}.createDelegate(this),iconCls:"icon-excel",tooltip:"导出任务列表为Excel文件",text:"导出"},"->",{xtype:"cnoa_helpBtn",helpid:65}]}),bbar:this.pagingBar});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",items:[this.grid]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},openExportExcelWindow:function(){var e=this;var c=function(){if(a.getForm().isValid()){a.getForm().submit({url:e.baseUrl+"&task=exportExcel",waitMsg:CNOA.lang.msgLoadMask,params:{},method:"POST",success:function(f,g){d.close();e.openDownloadExcelWindow(g.result.msg)},failure:function(f,g){CNOA.msg.alert(g.result.msg,function(){})}})}};var b=Ext.id();var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:110,items:[{xtype:"hidden",name:"execman",id:b},{xtype:"triggerForPeople",fieldLabel:"负责人",dataUrl:e.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,allowBlank:false,listeners:{selected:function(i,g,f){Ext.getCmp(b).setValue(g)}}},{xtype:"datefield",fieldLabel:"布置任务开始时间",width:150,format:"Y-m-d",editable:false,allowBlank:false,name:"stime"},{xtype:"datefield",fieldLabel:"布置任务结束时间",width:150,format:"Y-m-d",editable:false,allowBlank:false,name:"etime"}]});var d=new Ext.Window({width:320,height:170,title:"导出工作任务",resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:"导出",iconCls:"icon-excel",handler:function(){c()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){d.close()}.createDelegate(this)}]}).show()},openDownloadExcelWindow:function(a){var b=new Ext.Window({width:320,height:150,title:"下载EXCEL表格",resizable:false,modal:true,layout:"fit",bodyStyle:"padding:10px;background-color: #FFF;",html:"请点击下载：<br/>"+a,buttons:[{text:"关闭",iconCls:"icon-dialog-cancel",handler:function(){b.close()}.createDelegate(this)}]}).show()},makeOperate:function(f,d,a,g,b,e){var c=a.data;h="<a href='javascript:void(0);' onclick='CNOA_main_monitor_taskmgr.viewTask("+c.tid+");'>查看</a>";return h},makeStatus:function(k,g,d,i,f,b){var m=d.data;var l=m.status;var j="&nbsp;";var a=0;var c="#5B5B5B";j=m.statusText;a=m.progress;c=m.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+j+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_MAIN_MONITOR_TASKMGR_VIEW");mainPanel.loadClass("index.php?app=main&func=monitor&action=taskmgr&task=loadPage&from=view&tid="+a,"CNOA_MENU_MAIN_MONITOR_TASKMGR_VIEW","查看任务","icon-page-view")}};var CNOA_main_monitor_diarymgrClass,CNOA_main_monitor_diarymgr;CNOA_main_monitor_diarymgrClass=CNOA.Class.create();CNOA_main_monitor_diarymgrClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=main&func=monitor&action=diarymgr";this.tpl=new Ext.XTemplate('<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">今日计划:</div>','  <div class="user_diary_body_right" style="margin-bottom:20px;">',"    <ul>",'     <tpl if="listCount &gt; 0">','     <tpl for="list">',"      <li>",'        <div class="user_diary_body_right_left"><span style="font-weight:bold;line-height:14px;">{[xindex]}.</span>&nbsp;&nbsp;&nbsp;<img {[this.makeIcon(values.done)]} style="margin-top:5px !important;margin-top:4px;" /></div>','        <div class="user_diary_body_right_mid">{[this.makeAlarm(values)]}&nbsp;&nbsp;{content}</div>','        <div class="user_diary_body_right_right">{plantime}</div>',"      </tpl>","      </tpl>","      </li>","    </ul>","  </div>",'  <div class="clear"></div>',"</div>",'<div class="user_diary_body">','  <div class="user_diary_body_left">工作总结:</div>','  <div class="user_diary_body_right">{summary}&nbsp;</div>','  <div class="clear"></div></div>','<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">附件:</div>','  <div class="user_diary_body_right">',"		{attach}","  </div>",'  <div class="clear"></div>','  <img src="'+Ext.BLANK_IMAGE_URL+'" />',"</div>",'<tpl if="editable != true">','<div class="user_diary_body">','  <div class="user_diary_body_left">日记补充:</div>','  <div class="user_diary_body_right">',"    {additional}","  &nbsp;</div>",'  <div class="clear"></div>',"</div>","</tpl>",{makeIcon:function(b){if(b==1){return'src="./resources/images/cnoa/btn-job-done.gif" ext:qtip="已完成"'}else{return'src="./resources/images/cnoa/btn-job-doing.gif" ext:qtip="未完成"'}},makeAlarm:function(b){if(b.alarm==1){return'<img src="./resources/images/icons/alarm.png" ext:qtip="提醒时间:'+b.alarmtime+'" />'}else{return""}}});this.tplComment=new Ext.XTemplate('<div class="user_task_discuss_view" style="margin-left:5px;width:760px;margin-bottom:5px;">','  <div class="user_task_discuss_view_header" style="width:760px;height:24px;">','    <div class="user_task_discuss_view_header_title">关于本日记的领导批示</div>',"  </div>",'  <tpl for="list">','  <div class="user_task_discuss_view_body" style="width:760px;">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_top">{user}[{dept}]</div>','      <div class="user_task_discuss_view_body_left_body">','        <span><img src="{face}" onerror="this.src=\'./resources/images/empty_photo.png\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right" style="width:609px;">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{user}</a>&nbsp;&nbsp;发表于&nbsp;{posttime}<tpl if="uid == '+CNOA_USER_UID+'"><a style="float:right;" href="javascript:void(0);" onclick="CNOA_main_monitor_diarymgr.deleteComment({id});">删除&nbsp;&nbsp;</a></tpl></div>','      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>","  </tpl>","</div>");this.ID_btn_collapseExpand=Ext.id();this.ID_openWidth=Ext.id();this.newSelectUid;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getAllUserListsInDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){this.treeRoot.firstChild.collapse(true);if(Ext.getCmp(this.ID_btn_collapseExpand).pressed){this.treeRoot.expand(true)}else{this.treeRoot.firstChild.expand()}a.westPanel.getEl().unmask();try{var b=a.deptTree.getNodeById("CNOA_main_im_index_userlist_tree_node_"+CNOA_USER_UID);a.treeRoot.removeChild(b)}catch(c){}}.createDelegate(this),beforeload:function(c,b,d){a.westPanel.getEl().mask(CNOA.lang.msgLoadMask)}}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.openGridList(b)}}});this.westPanel=new Ext.Panel({region:"west",layout:"fit",split:true,border:false,width:176,minWidth:120,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.deptTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:"展开",iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand,tooltip:CNOA.lang.strExpandMenuTip,enableToggle:true,toggleHandler:function(b,c){if(c){b.setIconClass("icon-collapse-all");b.setText("折叠");b.setTooltip(CNOA.lang.strCollapseMenuTip);a.treeRoot.expand(true)}else{b.setIconClass("icon-expand-all");b.setText("展开");b.setTooltip(CNOA.lang.strExpandMenuTip);a.treeRoot.collapse(true);a.treeRoot.firstChild.expand()}}},"->",{handler:function(b,c){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:CNOA.lang.mainUser.refreshList,text:CNOA.lang.mainUser.refreshList}]})});this.fields=[{name:"did"},{name:"date"},{name:"user"},{name:"updatetime"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.colModel=new Ext.grid.ColumnModel([{header:"did",dataIndex:"did",width:20,sortable:true,hidden:true},{header:"日期 / 人员",dataIndex:"date",width:60,sortable:true,renderer:this.renderDate},{header:"更新时间",dataIndex:"updatetime",width:20,sortable:false,resizable:false,menuDisabled:true}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:CNOA.lang.mainUser.emptyMsg,displayMsg:CNOA.lang.mainUser.displayMsg,style:"border-left-width:1px;",store:this.store,pageSize:15,listeners:{beforechange:function(b,c){c.uid=0;if(a.newSelectUid!=undefined){c.uid=a.newSelectUid}}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,loadMask:{msg:CNOA.lang.msgLoadMask},cm:this.colModel,hideBorders:true,border:false,viewConfig:{forceFit:true},listeners:{rowclick:function(c,d){var b=c.getStore().getAt(d);a.openDiaryDetailWindow(b.data.did)}}});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",bodyStyle:"border-left-width:1px;overflow:auto;",items:[this.grid],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[new Ext.BoxComponent({id:this.ID_openWidth,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:"请点击左边列表查看该人工作日记"}}),"->",{xtype:"cnoa_helpBtn",helpid:54}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.westPanel,this.centerPanel]})},renderDate:function(c,b,a){return"<span style='font-weight:bold;'>"+c+"</span><br /><span style='color:#333'>"+a.data.user+"</span>"},refreshTreeList:function(){},refreshGridList:function(){},openGridList:function(a){var c=this;if((a==undefined)||a.disabled||(a.attributes.uid==undefined)||(a.attributes.uid==CNOA_USER_UID)){return}c.newSelectUid=a.attributes.uid;var b=a.text+" 的工作日记";Ext.getCmp(this.ID_openWidth).getEl().update(b);this.store.load({params:{task:"history",job:"getHistory",uid:a.attributes.uid}})},deleteComment:function(b){var a=this;CNOA.msg.cf("确定删除吗？",function(c){if(c=="yes"){a.commentWindow.getEl().mask(CNOA.lang.msgLoadMask);Ext.Ajax.request({url:a.baseUrl+"&task=deleteComment",method:"POST",params:{cid:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.loadComment()}else{CNOA.msg.alert(d.msg,function(){})}a.commentWindow.getEl().unmask()}})}})},openDiaryDetailWindow:function(m){var g=this;var d=Ext.id();var a;var l=function(){Ext.Ajax.request({url:g.baseUrl+"&task=loadDiary",method:"POST",params:{did:m},success:function(o){var n=Ext.decode(o.responseText);if(n.success===true){a=n.data;Ext.fly("user_diary_manage_todaytitle").update(a.user+"的工作日记&nbsp;&nbsp;"+a.today)}else{CNOA.msg.alert(n.msg,function(){})}g.tpl.overwrite(c.body,a);g.commentWindow.getEl().unmask()}})};this.loadComment=function(){Ext.Ajax.request({url:g.baseUrl+"&task=loadComment",method:"POST",params:{did:m},success:function(o){var n=Ext.decode(o.responseText);if(n.success===true){if(n.data.list.length<1){f.body.update("")}else{g.tplComment.overwrite(f.body,n.data)}}else{CNOA.msg.alert(n.msg,function(){})}g.tpl.overwrite(c.body,a)}})};var i=function(){var n=Ext.getCmp(d);if(n.getValue().length<2){CNOA.msg.alert("意见不能为空");return false}g.commentWindow.getEl().mask(CNOA.lang.msgLoadMask);Ext.Ajax.request({url:g.baseUrl+"&task=addComment",method:"POST",params:{did:m,comment:n.getValue()},success:function(p){var o=Ext.decode(p.responseText);if(o.success===true){n.setValue("");g.loadComment()}else{CNOA.msg.alert(o.msg,function(){})}g.commentWindow.getEl().unmask()}})};var b='<div class="user_diary_header">';b+='  <span style="line-height:23px;" id="user_diary_manage_todaytitle"></span>';b+='  <div class="clear"></div>';b+='  <img src="'+Ext.BLANK_IMAGE_URL+'" width="760" height="1" />';b+="</div>";var j=new Ext.Panel({border:false,region:"north",html:b});var c=new Ext.Panel({border:false,listeners:{render:function(){l()}}});var f=new Ext.Panel({border:false,listeners:{render:function(){g.loadComment()}}});var e=new Ext.Panel({border:false,bodyStyle:"margin-left:5px;",items:[{xtype:"htmleditor",id:d,width:762,heigth:130},{xtype:"button",style:"margin:5px 0 10px 694px;",text:"评阅意见",handler:function(){i()}}]});var k=new Ext.Panel({border:false,region:"center",autoScroll:true,items:[c,f,e]});this.commentWindow=new Ext.Window({width:800,height:500,title:"查看日记",resizable:true,maximizable:true,modal:true,layout:"border",items:[j,k]}).show()}};CNOA_main_monitor_viewTaskClass=CNOA.Class.create();CNOA_main_monitor_viewTaskClass.prototype={init:function(){var a=this;this.tid=CNOA.main.monitor.viewTask.tid;this.status=CNOA.main.monitor.viewTask.status;this.from=CNOA.main.monitor.viewTask.from;this.title="";this.etime="";if(CNOA.main.monitor.viewTask.type=="total"){this.baseUrl="index.php?app=user&func=task&action=total&tid="+this.tid+"&status="+this.status}else{this.baseUrl="index.php?app=user&func=task&action=default&tid="+this.tid+"&status="+this.status}this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_btn_repeal=Ext.id();this.ID_btn_complete=Ext.id();this.ID_btn_accept=Ext.id();this.ID_btn_reject=Ext.id();this.ID_btn_agree=Ext.id();this.ID_btn_disagree=Ext.id();this.ID_btn_finish=Ext.id();this.ID_btn_nofinish=Ext.id();this.ID_btn_viewedurge=Ext.id();this.ID_btn_fail=Ext.id();this.ID_btn_report_window_report=Ext.id();this.dataSource=null;this.tab_event_loadCount=0;this.tab_discuss_loadCount=0;this.tab_document_loadCount=0;this.tplTitle=new Ext.XTemplate('<div style="width:770px;margin-bottom:5px;height:40px;background-color:#FEFBDC;font-size:16px;font-weight:bold;line-height:40px; text-align: center;">[任务]{title}',"</div>",'<div style="width:768px;height:auto;padding-bottom:3px;border:1px solid #F6C4AB;margin-top:5px;margin-bottom:5px;background-color:#FFF1CC;font-size:16px;display:{showTip}">','	<div style="font-size:12px;padding:5px;">',"	{tip}","	</div>",'	<div style="padding-left:5px;" id="CNOA_task_view_btn_job">',"	</div>",'	<div class="clear"></div>',"</div>");this.tplBody=new Ext.XTemplate('<div style="margin-bottom:5px;margin-top:1px;width:770px;">','	<div style="display:none;" id="CNOA_task_view_btn_operate_Ct"><div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">任务操作区</span></div>','	<div style="background-color:#EFF5FF;height:22px;padding:5px;" id="CNOA_task_view_btn_operate">',"	</div>",'	<div class="clear"></div></div>','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">基本信息</span></div>','	<div style="background-color:#EFF5FF;padding-bottom:5px;">','		<ul class="user_task_view_ul">','			<li><span class="first">当前状态: </span><span class="second" style="color:{statusColor};">{statusText}</span></li>','			<li><span class="first">任务布置时间: </span><span class="second">{posttime}</span></li>',"			<li>&nbsp;</li>",'			<li><span class="first">布置开始时间: </span><span class="second">{stime}</span></li>','			<li><span class="first">布置结束时间: </span><span class="second">{etime}</span></li>','			<li><span class="first">任务评分: </span><span class="second">{point}</span></li>','			<li><span class="first">实际开始时间: </span><span class="second">{sttime}</span></li>','			<li><span class="first">实际完成时间: </span><span class="second">{entime}</span></li>','			<li><span class="first">任务进度: </span><span class="second" style="text-align:left;"><div style="width:100px;height:5px;background-color:#D4D4D4;float:left;margin-top:10px;"><div style="font-size:0;line-height:0;height:5px;width:{progress}px;background-color:{statusColor};"></div></div><span style="font-family:\'Arial\';font-size:9px;line-heigth:9px;height:9px;color:#7C7C7C;">&nbsp;{progress}%</span></span></li>','			<li><span class="first">布置人: </span><span class="second"><a>{postter}</a></span></li>','			<li><span class="first">负责人: </span><span class="second"><a>{execman}</a></span></li>','			<li><span class="first">审批人: </span><span class="second"><a>{examapp}</a></span></li>','			<li><span class="first">参与人: </span><span class="second">{participant}</span></li>','			<li><span class="first">评估工时: </span><span class="second">{worktime1}</span></li>','			<li><span class="first">确认工时: </span><span class="second">{worktime2}</span></li>',"		</ul>",'		<div class="clear"></div>',"	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">任务内容</span></div>','	<div style="padding:20px;background-color:#EFF5FF;">',"	{content}","	</div>",'	<tpl if="attachCount &gt; 0">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">任务附件</span></div>','	<div style="padding:20px;background-color:#EFF5FF;">',"		{attach}","	</div>","	</tpl>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">奖罚标准</span></div>','	<div style="padding:20px;background-color:#EFF5FF;">',"	{prizepunish}","	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">领导批示</span></div>','	<div style="padding:20px;background-color:#EFF5FF;">',"	{leadersay}","	</div>","</div>");this.infoPanel=new Ext.Panel({border:false,listeners:{render:function(){a.readInfo()}}});this.infoPanelBody=new Ext.Panel({border:false,listeners:{render:function(){}}});this.fieldsEvent=[{name:"id"},{name:"type"},{name:"typename"},{name:"title"},{name:"content"},{name:"user"},{name:"posttime"}];this.storeEvent=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEventList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsEvent})});this.colModelEvent=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:20,sortable:true,menuDisabled:true,hidden:true},{header:"类型",dataIndex:"type",width:40,menuDisabled:true,sortable:true,renderer:a.renderEventType.createDelegate(this)},{header:"事件标题 / 内容",dataIndex:"content",width:574,menuDisabled:true,sortable:false,renderer:a.renderEventContent.createDelegate(this)},{header:"操作者 / 时间",dataIndex:"other",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderEventOther.createDelegate(this)}]);this.gridEvent=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeEvent,loadMask:{msg:CNOA.lang.msgLoadMask},cm:this.colModelEvent,hideBorders:true,border:false,autoHeight:true,listeners:{cellclick:function(b,i,c,g){var d=b.getStore().getAt(i).data;if(d.content!=""){var f=new Ext.Window({title:"查看任务事件详细内容",layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:"关闭",iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}});this.fields=[{name:"tid"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"}];this.storeChild=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData&goto=taskChild",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.storeChild.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:"任务标题",dataIndex:"title",width:140,sortable:true,menuDisabled:true},{header:"状态",dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:"负责人",dataIndex:"execman",width:90,sortable:false,menuDisabled:true},{header:"布置人",dataIndex:"postter",width:90,sortable:false,menuDisabled:true},{header:"开始时间",dataIndex:"stime",width:90,sortable:false,menuDisabled:true},{header:"结束时间",dataIndex:"etime",width:90,sortable:false,menuDisabled:true},{header:"操作",dataIndex:"",width:60,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.gridChild=new Ext.grid.GridPanel({store:this.storeChild,loadMask:{msg:CNOA.lang.msgLoadMask},cm:this.colModel,hideBorders:true,border:false,autoHeight:true,stripeRows:true,tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.refreshChildTaskList()}.createDelegate(this),iconCls:"icon-system-refresh",text:CNOA.lang.mainJob.refreshList},"-",{handler:function(b,c){if(a.from=="mothertask"){CNOA.msg.alert("此任务已是子任务,不能再布置")}else{a.addTask()}}.createDelegate(this),iconCls:"icon-utils-s-add",tooltip:"布置子任务",text:"布置子任务"}]})});this.fieldsDocument=[{name:"id"},{name:"tid"},{name:"attach"},{name:"content"},{name:"user"},{name:"posttime"}];this.storeDocument=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getDocumentList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsDocument})});this.colModelDocument=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},new Ext.grid.RowNumberer(),{header:"文档",dataIndex:"attach",id:"attach",width:250,menuDisabled:true,sortable:false},{header:"备注",dataIndex:"content",width:250,menuDisabled:true,sortable:false,renderer:this.renderDocumentContent.createDelegate(this)},{header:"发布人 / 时间",dataIndex:"",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderDocumentOther.createDelegate(this)},{header:"操作",dataIndex:"id",width:60,sortable:false,resizable:false,menuDisabled:true,renderer:this.renderOpt.createDelegate(this)}]);this.gridDocument=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeDocument,loadMask:{msg:CNOA.lang.msgLoadMask},cm:this.colModelDocument,hideBorders:true,border:false,autoHeight:true,autoExpandColumn:"attach",listeners:{cellclick:function(b,i,c,g){if((c==3)||(c==4)){var d=b.getStore().getAt(i).data;if(d.content!=""){var f=new Ext.Window({title:"查看文档备注详细内容",layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:"关闭",iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}},tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.storeDocument.load()}.createDelegate(this),iconCls:"icon-system-refresh",text:CNOA.lang.mainJob.refreshList},"-",{handler:function(b,c){a.showDocumentAddWindow()}.createDelegate(this),iconCls:"icon-file-upload",text:"上传文档"}]})});this.tabItems=new Array();this.tabItems.push({xtype:"panel",title:"基本信息",autoHeight:true,items:[this.infoPanelBody],listeners:{}});this.tabItems.push({xtype:"panel",title:"任务事件",autoHeight:true,items:[this.gridEvent],listeners:{activate:function(){if(a.tab_event_loadCount<1){a.storeEvent.load()}a.tab_event_loadCount++}.createDelegate(this)}});if(a.from!="mothertask"){this.tabItems.push({xtype:"panel",title:"子任务区",autoHeight:true,items:[this.gridChild],listeners:{activate:function(){if(a.tab_discuss_loadCount<1){a.storeChild.load()}a.tab_discuss_loadCount++}.createDelegate(this)}})}this.tabItems.push({xtype:"panel",title:"任务文档区",autoHeight:true,items:[this.gridDocument],listeners:{activate:function(){if(a.tab_document_loadCount<1){a.storeDocument.load()}a.tab_document_loadCount++}.createDelegate(this)}});this.tabPanel=new Ext.TabPanel({width:770,border:false,activeTab:0,autoHeight:true,bodyStyle:"margin-bottom:100px;",items:this.tabItems});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,bodyStyle:"padding:5px",items:[this.infoPanel,this.tabPanel],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>工作任务 - 查看任务</span>",{handler:function(b,c){a.goToList()}.createDelegate(this),iconCls:"icon-btn-arrow-left",text:"返回任务列表"},"-",{handler:function(b,c){a.reloadInfo()}.createDelegate(this),iconCls:"icon-system-refresh",text:CNOA.lang.mainJob.refreshList},"-",{text:"关闭",iconCls:"icon-dialog-cancel",handler:function(){a.closeTab()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:66}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeStatus:function(k,g,d,i,f,b){var m=d.data;var l=m.status;var j="&nbsp;";var a=0;var c="#5B5B5B";j=m.statusText;a=m.progress;c=m.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+j+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},makeOperate:function(m,j,e,k,i,b){var o=e.data;var n=o.status;var a=false;var d=false;var g=false;var f=false;var l=false;a=o.eenable;d=o.denable;g=o.repealenable;f=o.urgeenable;l=o.failenable;var c="<a href='javascript:void(0);' onclick='CNOA_main_monitor_viewTask.viewTask("+o.tid+");'>查看</a>";return c},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW","查看任务","icon-page-view")},addTask:function(){var b=this;var a=new Ext.Window({width:700,height:550,title:"添加子任务",resizable:true,modal:true,layout:"fit",id:"CNOA_main_childtask_addedit",autoLoad:{url:"index.php?app=main&func=monitor&action=taskmgr&ajax=1&parentid=CNOA_main_childtask_addedit&task=loadPage&from=taskchild_add&tid="+b.tid,scripts:true,scope:this,nocache:true}}).show()},delDocument:function(b){var a=this;CNOA.msg.cf("确定删除此文档吗？",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delDocument&id="+b,method:"GET",success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.storeDocument.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},refreshChildTaskList:function(){var a=this;a.storeChild.reload()},renderEventType:function(i,e,c,f,d,a){var j=c.data;var g="#00000";if(j.type==1){g="#FF0000"}else{if(j.type==2){g="#804040"}else{if(j.type==3){g="#FF8040"}else{if(j.type==4){g="#FF00FF"}else{if(j.type==5){g="#008000"}else{if(j.type==6){g="#408080"}else{if(j.type==7){g="#0080FF"}else{if(j.type==8){g="#8000FF"}else{if(j.type==9){g="#FF0000"}else{if(j.type==10){g="#2BB7D5"}else{if(j.type==11){g="#808080"}else{if(j.type==12){g="#0080C0"}}}}}}}}}}}}var b="<span style='color:#FFF;display:block;width:30px;height:16px;background-color:"+g+";text-indent:3px;'>"+j.typename+"</span>";return b},renderEventContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderEventOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDiscussContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderDiscussOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDocumentContent:function(g,f,c){var e=c.data;var b="";if(g!==""){var b="<br /><span style='color:#00006F'>(点击查看详细)</span>"}var d="<span style='color:#676767'>"+g.substr(0,150)+"</span>"+b;return d},renderOpt:function(f,e,c){var d=c.data;var b="<a href='javascript:void(0);' onclick='CNOA_main_monitor_viewTask.delDocument("+f+");'>删除</a>";return b},renderDocumentOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},reloadInfo:function(){this.closeTab();mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+this.tid,"CNOA_MENU_USER_TASK_VIEW","查看任务")},readInfo:function(){var a=this;a.centerPanel.getEl().mask(CNOA.lang.msgLoadMask);Ext.Ajax.request({url:this.baseUrl+"&task=viewTask",method:"GET",params:{},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){var c=b.data;c.showTip=c.showTip?"block":"none";try{a.tplTitle.overwrite(a.infoPanel.body,c)}catch(f){}try{a.tplBody.overwrite(a.infoPanelBody.body,c)}catch(f){}a.dealJob(c);a.status=c.status;a.title=c.title;a.etime=c.etime;a.centerPanel.getEl().unmask();a.storeEvent.reload()}else{CNOA.msg.alert(b.msg,function(){a.closeTab()})}}})},goToList:function(){mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=list","CNOA_MENU_USER_TASK_LIST","任务列表")},closeTab:function(){try{mainPanel.closeTab(CNOA.main.monitor.viewTask.parentID.replace("docs-",""))}catch(a){}},dealJob:function(b){var e=this;var d="CNOA_task_view_btn_job";var c="CNOA_task_view_btn_operate";var a=0;if(b.eenable){a++;new Ext.Button({text:"修改任务",renderTo:c,handler:function(){e.editTask()}})}if(b.denable){a++;new Ext.Button({text:"删除任务",id:e.ID_btn_delete,renderTo:c,handler:function(){e.deleteTask()}})}if(b.renable){a++;new Ext.Button({text:"撤销任务",renderTo:c,id:e.ID_btn_repeal,handler:function(){e.repealTask()}})}if(b.uenable){a++;new Ext.Button({text:"督办任务",renderTo:c,handler:function(){e.urgeTask()}})}if(b.uenable){a++;new Ext.Button({text:"任务延期",renderTo:c,handler:function(){e.delayTask()}})}if(b.fenable){a++;new Ext.Button({text:"任务失败",renderTo:c,id:e.ID_btn_fail,handler:function(){e.failTask()}})}if(b.aenable){a++;new Ext.Button({text:"汇报进度",renderTo:c,handler:function(){e.reportTask()}})}if(b.benable){a++;new Ext.Button({text:"完成任务",renderTo:c,id:e.ID_btn_complete,handler:function(){e.completeTask()}})}if(b.tipJob=="receive"){new Ext.Button({text:"接收任务",renderTo:d,id:e.ID_btn_accept,handler:function(){e.acceptTask()}});new Ext.Button({text:"拒绝接收",renderTo:d,id:e.ID_btn_reject,handler:function(){e.rejectTask()}})}else{if(b.tipJob=="examapp"){new Ext.Button({text:"同意审批",renderTo:d,id:e.ID_btn_agree,handler:function(){e.agreeTask()}});new Ext.Button({text:"不同意",renderTo:d,id:e.ID_btn_disagree,handler:function(){e.disagreeTask()}})}else{if(b.tipJob=="check"){new Ext.Button({text:"同意任务完成",renderTo:d,id:e.ID_btn_finish,handler:function(){e.finishTask()}});new Ext.Button({text:"不同意",renderTo:d,id:e.ID_btn_nofinish,handler:function(){e.nofinishTask()}})}else{if(b.tipJob=="viewedurge"){new Ext.Button({text:"知道了",renderTo:d,id:e.ID_btn_viewedurge,handler:function(){e.viewedurge()}})}}}}if(a>0){Ext.fly("CNOA_task_view_btn_operate_Ct").show()}},editTask:function(){mainPanel.closeTab("CNOA_MENU_USER_TASK_ADDEDIT");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=addedit&job=edit&tid="+this.tid,"CNOA_MENU_USER_TASK_ADDEDIT","修改任务")},deleteTask:function(){var a=this;CNOA.msg.cf("确定要删除本任务吗?",function(b){if(b=="yes"){a.doAjax("delete",{},function(){a.closeTab()})}})},repealTask:function(){var a=this;CNOA.msg.cf("确定要撤销本任务吗?",function(b){if(b=="yes"){a.makeMiniWindow("撤销任务","撤销理由","repeal")}})},failTask:function(){var a=this;CNOA.msg.cf("确定要使本任务失败吗?",function(b){if(b=="yes"){a.makeMiniWindow("任务失败","失败理由","fail")}})},reportTask:function(){var e=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,emptyText:"0-100",allowBlank:false,vtype:"num0_100",vtypeText:"只能输入从0-100的数字",fieldLabel:"任务进度(%)",name:"progress"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:"进度说明"},this.smsSender]});var d=new Ext.Window({width:400,height:300,id:c,title:"汇报任务进度",resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:"汇报",id:e.ID_btn_report_window_report,iconCls:"icon-order-s-accept",handler:function(){b()}.createDelegate(this)},{text:CNOA.lang.btnClose,iconCls:"icon-dialog-cancel",handler:function(){d.close()}.createDelegate(this)}]}).show();var b=function(){if(a.getForm().isValid()){var i=a.getForm();var j=i.findField("progress").getValue();var k=i.findField("content").getValue();e.doAjax("report",{progress:j,content:k},function(){d.close()})}else{var g=Ext.getCmp(e.ID_btn_report_window_report).getEl().getBox();g=[g.x+35,g.y+26];CNOA.miniMsg.alert("部分表单未完成,请检查",g)}}},completeTask:function(){var a=this;CNOA.msg.cf("确定要完成本任务吗?",function(b){if(b=="yes"){a.makeMiniWindow("确认完成任务","任务总结","complete")}})},acceptTask:function(){var a=this;CNOA.msg.cf("确定要接收本任务吗?",function(b){if(b=="yes"){a.doAjax("accept")}})},rejectTask:function(){var a=this;CNOA.msg.cf("确定拒绝接收任务吗?",function(b){if(b=="yes"){a.makeMiniWindow("拒绝接收任务","拒绝理由","reject")}})},agreeTask:function(){var a=this;CNOA.msg.cf("同意审批本任务吗?",function(b){if(b=="yes"){a.makeMiniWindowForAgree("同意任务执行(审批同意)","意见建议","agree")}})},disagreeTask:function(){var a=this;CNOA.msg.cf("确定不同意该任务的审批?",function(b){if(b=="yes"){a.makeMiniWindow("审批任务不同意","不同意理由","disagree")}})},finishTask:function(){var a=this;CNOA.msg.cf("同意本任务完成吗?",function(b){if(b=="yes"){a.makeMiniWindowForFinish("同意任务完成","任务意见","finish")}})},nofinishTask:function(){var a=this;CNOA.msg.cf("确定不同意任务完成的申请吗?",function(b){if(b=="yes"){a.makeMiniWindow("不同意任务完成的申请(审核不同意)","不同意理由","nofinish")}})},viewedurge:function(){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=operateTask",method:"POST",params:{tid:a.tid,job:"viewedurge",status:a.status},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){a.reloadInfo()}else{CNOA.msg.alert(b.msg)}}})},urgeTask:function(b,a){var c=this;CNOA.msg.cf("确定督办本任务吗？",function(d){if(d=="yes"){c.makeMiniWindow("督办任务","督办内容","urge")}})},delayTask:function(){var a=this;CNOA.msg.cf("确定延长本任务的完成时间吗？",function(b){if(b=="yes"){a.makeDelayWindow("任务延期","delay",a.tid,a.status,a.etime)}})},makeDelayWindow:function(k,a,c,d,e){var i=this;var f=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"displayfield",fieldLabel:"原结束时间",value:e},{xtype:"datefield",name:"newtime",width:160,minValue:e,format:"Y-m-d",fieldLabel:"修改为"},this.smsSender]});var g=new Ext.Window({id:f,width:400,height:300,title:k,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:"确定",iconCls:"icon-order-s-accept",handler:function(){j()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){g.close()}.createDelegate(this)}]}).show();var j=function(){var l=b.getForm().findField("newtime").getRawValue();if(b.getForm().isValid()){i.doAjax(a,{newtime:l},function(){g.close()})}}},doAjax:function(b,a,e){var d=this;var c;if(Ext.isObject(a)){c=a;c.tid=d.tid;c.job=b;c.status=d.status}else{c={tid:d.tid,job:b,status:d.status}}Ext.Ajax.request({url:this.baseUrl+"&task=operateTask",method:"POST",params:c,success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){try{d.smsSender.submit()}catch(i){}CNOA.msg.notice(f.msg,"任务管理");try{e.call(this)}catch(i){}try{d.reloadInfo()}catch(i){}}else{CNOA.msg.alert(f.msg)}}})},makeMiniWindow:function(g,i,a,j){var d=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",height:147,width:280,name:"content",html:"",fieldLabel:i},this.smsSender]});var e=new Ext.Window({id:c,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:"确定",iconCls:"icon-order-s-accept",handler:function(){f()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){e.close()}.createDelegate(this)}]}).show();var f=function(){var k=b.getForm().findField("content").getValue();if(b.getForm().isValid()){d.doAjax(a,{content:k},function(){e.close()})}}},makeMiniWindowForFinish:function(g,i,a,j){var d=this;var c=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,emptyText:"0-100",allowBlank:false,vtype:"num0_100",vtypeText:"只能输入从0-100的数字",fieldLabel:"任务评分",name:"point"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:i},d.smsSender]});var e=new Ext.Window({id:c,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:"确定",iconCls:"icon-order-s-accept",handler:function(){f()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){e.close()}.createDelegate(this)}]}).show();var f=function(){var l=b.getForm().findField("content").getValue();var k=b.getForm().findField("point").getValue();if(b.getForm().isValid()){d.doAjax(a,{content:l,point:k},function(){e.close()})}}},makeMiniWindowForAgree:function(g,c,e){var i=this;var b=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textfield",width:70,fieldLabel:"确认工时",name:"worktime2"},{xtype:"textarea",height:147,width:280,name:"content",fieldLabel:c},i.smsSender]});var f=new Ext.Window({id:b,width:400,height:300,title:g,resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:"确定",iconCls:"icon-order-s-accept",handler:function(){d()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var d=function(){var k=a.getForm().findField("content").getValue();var j=a.getForm().findField("worktime2").getValue();if(a.getForm().isValid()){i.doAjax(e,{content:k,worktime2:j},function(){f.close()})}}},showDocumentAddWindow:function(){var e=this;var b=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fwindow:b,fieldLabel:"手机短信提醒"});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,bodyStyle:"padding-top:5px;",items:[{xtype:"flashfile",fieldLabel:"文档",name:"files",inputPre:"filesUpload"},{xtype:"textarea",width:290,height:146,name:"content",fieldLabel:"备注"},this.smsSender]});var d=new Ext.Window({id:b,width:400,height:270,title:"文档上传",resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:"确定",iconCls:"icon-order-s-accept",handler:function(){c()}.createDelegate(this)},{text:"取消",iconCls:"icon-dialog-cancel",handler:function(){d.close()}.createDelegate(this)}]}).show();var c=function(){if(a.getForm().isValid()){a.getForm().submit({url:e.baseUrl+"&task=uploadDocument",waitTitle:CNOA.lang.msgLoginWaitTitle,method:"POST",waitMsg:CNOA.lang.msgLoadMask,success:function(f,g){try{e.smsSender.submit()}catch(i){}e.storeDocument.reload();CNOA.msg.notice(g.result.msg,"任务管理");d.close()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}}}};var CNOA_main_childtask_addeditClass,CNOA_main_childtask_addedit;CNOA_main_childtask_addeditClass=CNOA.Class.create();CNOA_main_childtask_addeditClass.prototype={init:function(){var a=this;this.edit_id=CNOA.main.childtask.addedit.tid;this.loadCount=0;this.baseUrl="index.php?app=main&func=monitor&action=taskmgr";this.action="add";this.actionTitle=this.action=="add"?"布置任务":"修改任务";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_btn_examapp=Ext.id();this.ID_checkbox_needexamapp=Ext.id();this.ID_from_panel=Ext.id();this.ID_from_combobox=Ext.id();this.smsSender=new Ext.form.SMSSender({from:"task",modal:true,fieldLabel:"手机短信提醒"});this.baseField=[{xtype:"fieldset",title:"任务基本信息",anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{name:"title",fieldLabel:"任务标题",inputType:"text",allowBlank:false,maxLength:200,width:480,maxLengthText:CNOA.lang.msgMaxLengthText+200},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"textfield",fieldLabel:"任务来源",name:"fromName",width:480,readOnly:true,value:"[母任务:]"+CNOA_main_monitor_viewTask.title}]},{xtype:"hidden",name:"from",value:"mothertask"},{xtype:"hidden",name:"fromid",value:CNOA.main.childtask.addedit.tid}]},{xtype:"datefield",format:"Y-m-d",name:"stime",allowBlank:false,editable:false,fieldLabel:"布置时间",width:150},{xtype:"textfield",name:"worktime1",fieldLabel:"评估工时",width:150},{xtype:"datefield",format:"Y-m-d",name:"etime",allowBlank:false,editable:false,fieldLabel:"完成时间",width:150},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:4},items:[{xtype:"panel",layout:"form",width:350,items:[{xtype:"textfield",width:250,readOnly:true,fieldLabel:"审批人",name:"examapp"}]},{xtype:"hidden",name:"examappUid"},{xtype:"btnForPoepleSelectorSingle",text:"选择",dataUrl:a.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-right:2px",disabled:true,id:this.ID_btn_examapp,listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("examapp").setValue(f.join(","));a.formPanel.getForm().findField("examappUid").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("examappUid").getValue().split(","))}}},{xtype:"checkbox",boxLabel:"需要审批人审批",name:"needexamapp",id:this.ID_checkbox_needexamapp,style:"margin-left:5px;margin-top:3px;",listeners:{check:function(d,b){var c=a.formPanel.getForm().findField("examapp");if(b){if(a.loadCount==0&&a.action=="edit"){}else{CNOA.msg.alert('选中此项，则任务需要审批人审批同意后才会进入负责人手里<br><br>当任务未通过审批时，任务不会出现在负责人与参与人任务列表中。当任务通过审批后，负责人将无条件接收任务。<br><br>任务通过审批后，任务直接进入"任务进行中"的状态。')}c.allowBlank=false;c.validationEvent=true;c.clearInvalid();Ext.getCmp(this.ID_btn_examapp).enable()}else{c.allowBlank=true;c.validationEvent=false;c.clearInvalid();c.setValue("");a.formPanel.getForm().findField("examappUid").setValue("");Ext.getCmp(this.ID_btn_examapp).disable()}}.createDelegate(this),render:function(){}.createDelegate(this)}}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",width:350,items:[{xtype:"textfield",readOnly:true,width:250,allowBlank:false,readOnly:true,fieldLabel:"负责人",emptyText:"请选择任务负责人",blankText:"请选择任务负责人",name:"execman"}]},{xtype:"hidden",name:"execmanUid"},{xtype:"btnForPoepleSelectorSingle",text:"选择",dataUrl:a.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-right:2px",listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("execman").setValue(f.join(","));a.formPanel.getForm().findField("execmanUid").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("execmanUid").getValue().split(","))}}}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:"参与人",emptyText:"请选择任务参与人",height:35,width:438,readOnly:true,name:"participant"}]},{xtype:"hidden",name:"participantUids"},{xtype:"btnForPoepleSelector",text:"选择",dataUrl:a.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:6px",listeners:{selected:function(d,e){var f=new Array();var c=new Array();if(e.length>0){for(var b=0;b<e.length;b++){f.push(e[b].uname);c.push(e[b].uid)}}a.formPanel.getForm().findField("participant").setValue(f.join(","));a.formPanel.getForm().findField("participantUids").setValue(c.join(","))},onrender:function(b){b.setSelectedUids(a.formPanel.getForm().findField("participantUids").getValue().split(","))}}}]},{xtype:"textarea",fieldLabel:"任务内容",width:480,height:140,name:"content",value:""},{xtype:"flashfile",fieldLabel:"附件",name:"files",inputPre:"filesUpload"},this.smsSender,{xtype:"textarea",fieldLabel:"奖罚标准",width:480,height:80,name:"prizepunish",value:""},{xtype:"textarea",fieldLabel:"领导批示",width:480,height:80,name:"leadersay",value:""}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[this.baseField],listeners:{render:function(b){if(a.action=="edit"){a.loadFormData(b)}}}});this.addEditPanelTitle=new Ext.BoxComponent({autoEl:{tag:"div",html:"<span style='font-weight:bold;margin-right:20px;'>工作任务 - "+this.actionTitle+"</span>"}});this.addEditPanel=new Ext.Panel({hideBorders:true,autoScroll:true,border:false,items:[this.formPanel],buttons:[{text:CNOA.lang.btnSave,id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){a.submitForm()}.createDelegate(this)},{text:"关闭",iconCls:"icon-dialog-cancel",handler:function(){a.closeWindow()}.createDelegate(this)}]});this.centerPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,items:[this.addEditPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},closeWindow:function(){Ext.getCmp(CNOA.main.childtask.addedit.parentID).close()},submitForm:function(){var a=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:"index.php?app=user&func=task&action=default",waitTitle:CNOA.lang.msgLoginWaitTitle,method:"POST",waitMsg:CNOA.lang.msgLoadMask,params:{task:a.action,tid:a.edit_id},success:function(b,c){try{a.smsSender.submit()}catch(d){}CNOA.msg.alert(c.result.msg+"",function(f){try{CNOA_main_monitor_viewTask.storeChild.reload()}catch(g){}a.closeWindow()})},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}.createDelegate(this)})}}};var sm_main_monitor=1;
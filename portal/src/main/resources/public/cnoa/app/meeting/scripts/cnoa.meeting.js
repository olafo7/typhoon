var CNOA_meeting_mgr_appointment,CNOA_meeting_mgr_appointmentClass;CNOA_meeting_mgr_appointmentClass=CNOA.Class.create();CNOA_meeting_mgr_appointmentClass.prototype={init:function(){var b=this;this.edit_id=0;this.type="add";this.day=0;var a=Ext.id();b.baseUrl="index.php?app=meeting&func=mgr&action=appointment";this.fd=Ext.data.Record.create([{name:"name"},{name:"mid"},{name:"t0",mapping:"dt.t0"},{name:"t1",mapping:"dt.t1"},{name:"t2",mapping:"dt.t2"},{name:"t3",mapping:"dt.t3"},{name:"t4",mapping:"dt.t4"},{name:"t5",mapping:"dt.t5"},{name:"t6",mapping:"dt.t6"},{name:"t7",mapping:"dt.t7"},{name:"t8",mapping:"dt.t8"},{name:"t9",mapping:"dt.t9"},{name:"t10",mapping:"dt.t10"},{name:"t11",mapping:"dt.t11"},{name:"t12",mapping:"dt.t12"},{name:"t13",mapping:"dt.t13"},{name:"t14",mapping:"dt.t14"},{name:"t15",mapping:"dt.t15"},{name:"t16",mapping:"dt.t16"},{name:"t17",mapping:"dt.t17"},{name:"t18",mapping:"dt.t18"},{name:"t19",mapping:"dt.t19"},{name:"t20",mapping:"dt.t20"},{name:"t21",mapping:"dt.t21"},{name:"t22",mapping:"dt.t22"},{name:"t23",mapping:"dt.t23"},{name:"t24",mapping:"dt.t24"},{name:"t25",mapping:"dt.t25"},{name:"t26",mapping:"dt.t26"},{name:"t27",mapping:"dt.t27"},{name:"t28",mapping:"dt.t28"},{name:"t29",mapping:"dt.t29"},{name:"t30",mapping:"dt.t30"},{name:"t31",mapping:"dt.t31"},{name:"t32",mapping:"dt.t32"},{name:"t33",mapping:"dt.t33"},{name:"t34",mapping:"dt.t34"},{name:"t35",mapping:"dt.t35"},{name:"t36",mapping:"dt.t36"},{name:"t37",mapping:"dt.t37"},{name:"t38",mapping:"dt.t38"},{name:"t39",mapping:"dt.t39"},{name:"t40",mapping:"dt.t40"},{name:"t41",mapping:"dt.t41"},{name:"t42",mapping:"dt.t42"},{name:"t43",mapping:"dt.t43"},{name:"t44",mapping:"dt.t44"},{name:"t45",mapping:"dt.t45"},{name:"t46",mapping:"dt.t46"},{name:"t47",mapping:"dt.t47"}]);this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data"},this.fd),listeners:{load:function(e,c,d){Ext.getCmp(a).getEl().update(e.reader.jsonData.date)}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel({defaults:{header:"",menuDisabled:true,resizable:false,sortable:false,width:15},columns:[{header:"",width:200,dataIndex:"name",menuDisabled:true,resizable:false,sortable:false},{header:"",width:15,dataIndex:"t0",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t1",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t2",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t3",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t4",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t5",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t6",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t7",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t8",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t9",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t10",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t11",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t12",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t13",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t14",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t15",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t16",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t17",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t18",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t19",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t20",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t21",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t22",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t23",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t24",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t25",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t26",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t27",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t28",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t29",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t30",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t31",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t32",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t33",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t34",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t35",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t36",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t37",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t38",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t39",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t40",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t41",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t42",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t43",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t44",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t45",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t46",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t47",renderer:this.mkBG.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]});this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(c,d){b.store.reload()}},{text:lang("prevDay"),handler:function(){b.day--;b.store.load({params:{day:b.day}})}},{text:lang("today"),handler:function(){b.day=0;b.store.load({params:{day:b.day}})}},{xtype:"box",id:a,autoEl:{tag:"div",html:""}},{text:lang("nextDay"),handler:function(){b.day++;b.store.load({params:{day:b.day}})}},"<span class='cnoa_color_gray'>"+lang("colorShuoMing")+":&nbsp;</span><span class='cnoa_car_a'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("pendingOfmr")+"&nbsp;</span><span class='cnoa_car_b'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("meetRoomAppTime")+"&nbsp;</span><span class='cnoa_car_c'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("appByMeetingRoom")+"&nbsp;</span>","->",{xtype:"cnoa_helpBtn",helpid:4006}],plugins:[new Ext.ux.grid.ColumnHeaderGroup({rows:[[{header:lang("meetRoom")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;("+lang("hour")+")",colspan:1,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"0",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"1",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"2",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"3",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"4",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"5",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"6",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"7",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"8",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"9",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"10",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"11",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"12",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"13",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"14",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"15",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"16",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"17",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"18",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"19",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"20",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"21",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"22",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"23",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false}]],hierarchicalColMenu:true})],bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.alert(c.result.msg);this.window.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editList",params:{id:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.window.close()})}.createDelegate(this)})},deleteList:function(a){var c=this;var b=this.list.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("id")+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("meetRoomMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},mkBG:function(e,c,a,f,b,d){if(e==0||e==1){c.css="cnoa_bgc_F6F6F6"}else{if(e==2){c.css="cnoa_car_a"}else{if(e%2==0){c.css="cnoa_car_b"}else{if(e==3){c.css="cnoa_car_c"}}}}}};var CNOA_meeting_mgr_jiyaoClass,CNOA_meeting_mgr_jiyao;CNOA_meeting_mgr_jiyaoClass=CNOA.Class.create();CNOA_meeting_mgr_jiyaoClass.prototype={init:function(){var d=this;var h=Ext.id();var b=Ext.id();var g=Ext.id();var i=Ext.id();var c=Ext.id();var a=Ext.id();var f=Ext.id();var e=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=jiyao";this.storeBar={storeType:"all",name:"",title:"",stime:"",etime:"",meetingroom:""};this.fields=[{name:"aid"},{name:"name"},{name:"markname"},{name:"title"},{name:"stime"},{name:"etime"},{name:"statusname"},{name:"appname"},{name:"jiyaotime"}];this.getMeetingRoomListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(o,n,p,m,l,k){var j=Ext.decode(l.responseText);if(j.failure){CNOA.msg.alert(j.msg)}},load:function(k,j,l){Ext.getCmp(e).setText(lang("needRewrite")+"(<span class='cnoa_color_white'>"+k.reader.jsonData.returnback+"</span>)")}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(j,k){Ext.apply(k,d.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:200,sortable:true,menuDisabled:true,renderer:this.showDetails.createDelegate(this)},{header:lang("theme"),dataIndex:"title",width:100,sortable:true,menuDisabled:true},{header:lang("membersMinutes"),dataIndex:"markname",width:155,sortable:true,menuDisabled:true},{header:lang("proposer"),dataIndex:"appname",width:80,sortable:true,menuDisabled:true},{header:lang("meeting")+lang("startTime"),dataIndex:"stime",width:120,sortable:true,menuDisabled:true},{header:lang("meeting")+lang("endTime"),dataIndex:"etime",width:120,sortable:true,menuDisabled:true},{header:lang("approvalTime"),dataIndex:"jiyaotime",width:120,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(j,k){var l=d.list.getSelectionModel().getSelections();if(l.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){d.store.reload()}},{handler:function(j,k){d.storeBar.storeType="waiting";d.store.load({params:d.storeBar});Ext.getCmp(a).show();Ext.getCmp(f).show()}.createDelegate(this),iconCls:"icon-waiting",enableToggle:true,cls:"btn-red1",pressed:true,allowDepress:false,toggleGroup:"project_proj_approve_type",text:lang("pendingApproval")},{handler:function(j,k){d.storeBar.storeType="pass";d.store.load({params:d.storeBar});Ext.getCmp(a).hide();Ext.getCmp(f).hide()}.createDelegate(this),enableToggle:true,allowDepress:false,cls:"btn-blue4",toggleGroup:"project_proj_approve_type",iconCls:"icon-pass",text:lang("approvalThrough")},{handler:function(j,k){d.storeBar.storeType="returnback";d.store.load({params:d.storeBar});Ext.getCmp(a).hide();Ext.getCmp(f).hide()}.createDelegate(this),id:e,enableToggle:true,allowDepress:false,toggleGroup:"project_proj_approve_type",cls:"btn-blue3",iconCls:"icon-needRewrite",text:lang("needRewrite")},{text:lang("approvalThrough"),id:a,cls:"btn-blue2",handler:function(j){var k=d.list.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("youDoNotSelectMeet"))}else{CNOA.msg.cf(lang("sureAppreovedIt"),function(m){if(m=="yes"){if(k){var n="";for(var l=0;l<k.length;l++){n+=k[l].get("aid")+",";var o=k[l]}d.submit("pass",n)}}})}}},{text:lang("approvalNotThrough"),id:f,cls:"btn-gray1",handler:function(j){var k=d.list.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("chosenRequire"))}else{CNOA.msg.cf(lang("doNotDetermine"),function(m){if(m=="yes"){if(k){var n="";for(var l=0;l<k.length;l++){n+=k[l].get("aid")+","}d.submit("unpass",n)}}})}}},"->",{xtype:"cnoa_helpBtn",helpid:4005}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("meetName")+":",{xtype:"textfield",width:168,id:h},lang("meetTheme")+":",{xtype:"textfield",width:168,id:b},lang("meeting")+lang("startTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:g}]},lang("meeting")+lang("endTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:i}]},lang("meetRoom")+":",{xtype:"panel",border:false,layout:"fit",items:[new Ext.form.ComboBox({name:"mid",store:d.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",width:120,id:c,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(l,j,k){}.createDelegate(this)}})]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){d.storeBar.name=Ext.getCmp(h).getValue();d.storeBar.title=Ext.getCmp(b).getValue();d.storeBar.stime=Ext.getCmp(g).getRawValue();d.storeBar.etime=Ext.getCmp(i).getRawValue();d.storeBar.meetingroom=Ext.getCmp(c).getValue();d.store.load({params:d.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(h).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(g).setValue("");Ext.getCmp(i).setValue("");Ext.getCmp(c).setValue("");d.storeBar.name="";d.storeBar.title="";d.storeBar.stime="";d.storeBar.etime="";d.storeBar.meetingroom="";d.store.load({params:d.storeBar})}}]})})},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_jiyao.showDetailsWin("+a.data.aid+")'>"+e+"</a>"},showDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomApplyDetails&aid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:570px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeApplicationDetail"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},operate:function(b,e,a){var d=this;if(d.storeBar.storeType=="pass"){}},read:function(e){var h=this;var a=[{name:"deptname"},{name:"name"},{name:"readtime"}];var c=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getReaderList&aid="+e,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});c.load();var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var d=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("belongDept"),dataIndex:"deptname",width:100,sortable:true,menuDisabled:true},{header:lang("name2"),dataIndex:"name",width:100,sortable:false,menuDisabled:true},{header:lang("redingDate"),dataIndex:"readtime",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var b=new Ext.grid.GridPanel({store:c,region:"center",layout:"fit",loadMask:{msg:lang("waiting")},cm:d,sm:g,stripeRows:true,hideBorders:true,border:false,viewConfig:{forceFit:true}});var f=new Ext.Window({title:lang("readStatus"),layout:"border",width:600,height:makeWindowHeight(500),resizable:false,modal:true,items:[b],buttons:[{text:lang("close"),handler:function(){f.close()}}]}).show()},submit:function(b,a){var c=this;Ext.Ajax.request({url:this.baseUrl+"&task=check",method:"POST",params:{type:b,ids:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("meetMgr"));c.store.reload()}else{CNOA.msg.alert(d.msg)}}})},returnBack:function(){var c=this;var a=new Ext.form.FormPanel({region:"center",border:false,bodyStyle:"padding:10px",labelWidth:100,labelAlign:"top",layout:"fit",waitMsgTarget:true,items:[{xtype:"fieldset",title:lang("theMinutesDoNotPass"),anchor:"99%",autoHeight:true,items:[{xtype:"panel",layout:"form",hideBorders:true,border:false,autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("yjjy"),height:150,width:450,name:"opinion"}]}]}]});var b=new Ext.Window({title:lang("minutesDoNotPass"),width:510,height:300,modal:true,layout:"border",items:a,buttons:[{text:lang("submit"),handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=opinion",waitMsg:lang("waiting"),method:"POST",params:{ids:ids},success:function(d,e){CNOA.msg.notice(e.result.msg,lang("meetMgr"));b.close();c.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}}},{text:lang("close"),handler:function(){b.close();c.store.reload()}}]}).show()}};var CNOA_meeting_mgr_apply,CNOA_meeting_mgr_applyClass;CNOA_meeting_mgr_applyClass=CNOA.Class.create();CNOA_meeting_mgr_applyClass.prototype={init:function(){var f=this;var j=Ext.id();var a=Ext.id();var i=Ext.id();var l=Ext.id();var e=Ext.id();var g=Ext.id();var b=Ext.id();var k=Ext.id();var h=Ext.id();var d=Ext.id();this.formData="";this.baseUrl="index.php?app=meeting&func=mgr&action=apply";this.getMeetingRoomEquipmentStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=meetingroomEquipment"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"eid"},{name:"name"}]}),listeners:{load:function(){if(f.type=="edit"){Ext.each(f.formData.equipment.eids,function(o,m,n){if(m==0){f.formPanel.getForm().findField("equipment[0]").setValue(o)}else{f.formPanel.getForm().findField("equipment["+m+"]").setValue(o)}});Ext.each(f.formData.equipment.quantity,function(o,m,n){if(m==0){f.formPanel.getForm().findField("quantity[0]").setValue(o)}else{f.formPanel.getForm().findField("quantity["+m+"]").setValue(o)}})}}}});this.storeBar={storeType:"waiting",name:"",title:"",stime:"",etime:"",meetingroom:""};this.fields=[{name:"aid"},{name:"mid"},{name:"name"},{name:"title"},{name:"meetingroom"},{name:"plan"},{name:"type"},{name:"mgrman"},{name:"markman"},{name:"meetingroom"},{name:"stime"},{name:"etime"},{name:"isovertime"},{name:"checkman"},{name:"checktime"}];this.getMeetingRoomListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.getMeetingRoomCheckerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingCheckerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"checkuid",mapping:"uid"},{name:"name"}]})});this.getMeetingRoomMgrerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingMgrerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mgruid",mapping:"uid"},{name:"name"}]}),listeners:{load:function(){if(f.type=="edit"){f.formPanel.getForm().findField("mgruid").setValue(f.formData.markuid)}}}});this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(r,q,s,p,o,n){var m=Ext.decode(o.responseText);if(m.failure){CNOA.msg.alert(m.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(m,n){Ext.apply(n,f.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName")+"/"+lang("numPeople"),dataIndex:"name",width:120,sortable:true,menuDisabled:true,renderer:this.showDetails.createDelegate(this)},{header:lang("theme"),dataIndex:"title",width:120,sortable:true,menuDisabled:true},{header:lang("meetRoomMgr"),dataIndex:"meetingroom",width:165,sortable:true,menuDisabled:true,renderer:f.showMeetingroomDetails},{header:lang("meetType"),dataIndex:"type",width:100,sortable:true,menuDisabled:true},{header:lang("meetMgrPeople"),dataIndex:"mgrman",width:155,sortable:true,menuDisabled:true},{header:lang("membersMinutes"),dataIndex:"markman",width:155,sortable:true,menuDisabled:true},{header:lang("time"),dataIndex:"stime",width:110,sortable:true,menuDisabled:true,renderer:this.formatTime.createDelegate(this)},{header:lang("approvalor")+"/"+lang("time"),dataIndex:"checkman",width:110,sortable:true,menuDisabled:true,renderer:this.formatCheck.createDelegate(this)},{header:lang("opt"),dataIndex:"aid",width:160,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var c=Ext.id();this.list=new Ext.grid.GridPanel({region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{render:function(){getFlowId4Engine("meeting",function(n,m){Ext.getCmp(c).setHandler(function(){n()})})},rowdblclick:function(m,n){var o=f.list.getSelectionModel().getSelections();if(o.length==0){CNOA.miniMsg.alertShowAt(m,lang("mustSelectOneRow"))}else{f.type="edit";f.edit_id=o[0].get("aid");f.taskwindow()}}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(m,n){f.store.reload()}},{text:lang("application"),iconCls:"icon-utils-s-edit",cls:"btn-red1",id:c,handler:function(){f.window(0,"add")}},{handler:function(m,n){f.storeBar.storeType="waiting";f.store.load({params:f.storeBar})}.createDelegate(this),id:g,iconCls:"icon-waiting",cls:"btn-yellow1",enableToggle:true,allowDepress:false,toggleGroup:"MEETING_MGR_APPLY",tooltip:lang("displayPendingMeet"),text:lang("pendingMeet")},{handler:function(m,n){f.storeBar.storeType="draft";f.store.load({params:f.storeBar})}.createDelegate(this),id:b,iconCls:"icon-apply-cost-check",enableToggle:true,cls:"btn-blue3",allowDepress:false,toggleGroup:"MEETING_MGR_APPLY",tooltip:lang("showMeetingDraft"),text:lang("meetDraft")},{handler:function(m,n){f.storeBar.storeType="pass";f.store.load({params:f.storeBar})}.createDelegate(this),id:k,enableToggle:true,allowDepress:false,toggleGroup:"MEETING_MGR_APPLY",cls:"btn-blue3",iconCls:"icon-pass",tooltip:lang("displayListOfApp"),text:lang("approveMeeting")},{handler:function(m,n){f.storeBar.storeType="unpass";f.store.load({params:f.storeBar})}.createDelegate(this),id:h,enableToggle:true,cls:"btn-blue3",allowDepress:false,toggleGroup:"MEETING_MGR_APPLY",iconCls:"icon-noPass",tooltip:lang("AccordingMeetingList"),text:lang("isNotThroughMeet")},{handler:function(m,n){f.storeBar.storeType="cancel";f.store.load({params:f.storeBar})}.createDelegate(this),id:d,enableToggle:true,allowDepress:false,toggleGroup:"MEETING_MGR_APPLY",iconCls:"icon-cancelMeet",tooltip:lang("accordingCancelMeet"),cls:"btn-gray1",text:lang("cancelMeet")},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:4001}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("meetName")+":",{xtype:"textfield",width:168,id:j},lang("meetTheme")+":",{xtype:"textfield",width:168,id:a},lang("meeting")+lang("startTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:i}]},lang("meeting")+lang("endTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:l}]},lang("meetRoom")+":",{xtype:"panel",border:false,layout:"fit",items:[new Ext.form.ComboBox({name:"mid",store:f.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",width:120,id:e,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(o,m,n){}.createDelegate(this)}})]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){f.storeBar.name=Ext.getCmp(j).getValue();f.storeBar.title=Ext.getCmp(a).getValue();f.storeBar.stime=Ext.getCmp(i).getRawValue();f.storeBar.etime=Ext.getCmp(l).getRawValue();f.storeBar.meetingroom=Ext.getCmp(e).getValue();f.store.load({params:f.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(j).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(i).setValue("");Ext.getCmp(l).setValue("");Ext.getCmp(e).setValue("");f.storeBar.name="";f.storeBar.title="";f.storeBar.stime="";f.storeBar.etime="";f.storeBar.meetingroom="";f.store.load({params:f.storeBar})}}]})});if(CNOA.meeting.mgr.apply.from=="pass"){Ext.getCmp(k).toggle();f.storeBar.storeType="pass";f.store.load({params:f.storeBar})}else{if(CNOA.meeting.mgr.apply.from=="unpass"){Ext.getCmp(h).toggle();f.storeBar.storeType="unpass";f.store.load({params:f.storeBar})}else{if(CNOA.meeting.mgr.apply.from=="cancel"){Ext.getCmp(d).toggle();f.storeBar.storeType="cancel";f.store.load({params:f.storeBar})}else{Ext.getCmp(g).toggle();f.store.load()}}}},window:function(f,e){var t=this;var m=Ext.id();var g=Ext.id();var v=Ext.id();var c=Ext.id();var j=Ext.id();var n=Ext.id();var d=Ext.id();var b=Ext.id();var p=Ext.id();var s=Ext.id();var o=Ext.id();var h=Ext.id();this.ID_MARKER_TEXT=Ext.id();this.content_start=1;var r=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:t.baseUrl+"&task=meetingroomType"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"name"}]})});r.load();t.getMeetingRoomListStore.load();t.getMeetingRoomCheckerStore.load();var i=[{xtype:"fieldset",title:lang("applicationMeet"),anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{name:"name",fieldLabel:lang("meetName"),inputType:"text",allowBlank:false,width:480},{name:"title",fieldLabel:lang("meetTheme"),inputType:"text",width:480},{xtype:"panel",layout:"form",border:false,items:[new CNOA.form.ComboBox({fieldLabel:lang("meetType"),name:"type",store:r,hiddenName:"type",valueField:"name",helpTip:lang("addMeetingType"),displayField:"name",mode:"local",width:230,allowBlank:false,triggerAction:"all",editable:true,listeners:{select:function(A,w,z){}.createDelegate(this)}})]},{xtype:"cnoa_textfield",fieldLabel:lang("estimatedNum"),name:"plan",regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt")},{xtype:"panel",layout:"form",border:false,items:[new CNOA.form.ComboBox({fieldLabel:lang("meetRoom"),name:"mid",allowBlank:false,store:t.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",helpTip:lang("ifYouHavePermission"),displayField:"name",mode:"local",width:230,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(z,w){var A=w.data.mid;t.getMeetingRoomMgrerStore.load({params:{mid:A}});t.getMeetingRoomEquipmentStore.load({params:{mid:A}});Ext.Ajax.request({url:this.baseUrl+"&task=getMeetingRoomDetails",method:"POST",params:{mid:A},success:function(C){var B=Ext.decode(C.responseText);if(B.success===true){Ext.getCmp(g).setValue(B.msg)}else{CNOA.msg.alert(B.msg)}}})}.createDelegate(this)}})]},{xtype:"displayfield",fieldLabel:lang("meetRoomDetails"),id:g},{xtype:"panel",layout:"form",id:p,border:false,items:[{xtype:"panel",layout:"table",fieldLabel:lang("startTime")+"<span class='cnoa_color_red'>*</span>",border:false,items:[{xtype:"datefield",width:150,allowBlank:false,name:"startdate",editable:false,format:"Y-m-d",value:new Date().format("Y-m-d")},{xtype:"timefield",width:80,allowBlank:false,increment:5,name:"starttime",editable:false,format:"H:i",editable:true,value:new Date().format("H:i")}]}]},{xtype:"panel",layout:"form",id:s,border:false,items:[{xtype:"panel",fieldLabel:lang("endTime")+"<span class='cnoa_color_red'>*</span>",layout:"table",border:false,items:[{xtype:"datefield",width:150,allowBlank:false,name:"enddate",editable:false,format:"Y-m-d"},{xtype:"timefield",width:80,allowBlank:false,increment:5,name:"endtime",editable:false,format:"H:i",editable:true}]}]},{xtype:"timefield",width:80,increment:60,name:"notice",editable:false,format:"H",fieldLabel:lang("aheadOfReminder")},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:125px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("after24Hours")}}),{xtype:"panel",layout:"form",border:false,items:[new CNOA.form.ComboBox({fieldLabel:lang("meetMgrPeople"),name:"mgruid",allowBlank:false,store:t.getMeetingRoomMgrerStore,hiddenName:"mgruid",valueField:"mgruid",helpTip:lang("meetRoomMgrFuZe"),displayField:"name",mode:"local",width:230,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(A,w,z){}.createDelegate(this)}})]},{xtype:"panel",layout:"form",border:false,items:[new CNOA.form.ComboBox({fieldLabel:lang("meetApprover"),name:"checkuid",allowBlank:false,store:t.getMeetingRoomCheckerStore,hiddenName:"checkuid",valueField:"checkuid",helpTip:lang("personResponsibleApp"),displayField:"name",mode:"local",width:230,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(A,w,z){}.createDelegate(this)}})]},{xtype:"userselectorfield",fieldLabel:lang("membersMinutes"),width:230,name:"markuid",multiSelect:false},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("whoAttended"),height:50,width:438,readOnly:true,name:"attender"}]},{xtype:"hidden",name:"attendUids"},{xtype:"btnForPoepleSelector",text:lang("select"),dataUrl:t.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:6px; margin-top:20px",listeners:{selected:function(A,B){var C=new Array();var z=new Array();if(B.length>0){for(var w=0;w<B.length;w++){C.push(B[w].uname);z.push(B[w].uid)}}t.formPanel.getForm().findField("attender").setValue(C.join(","));t.formPanel.getForm().findField("attendUids").setValue(z.join(","))},onrender:function(w){w.setSelectedUids(t.formPanel.getForm().findField("attendUids").getValue().split(","))}}},{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"checkbox",fieldLabel:lang("SMSattenPeople"),name:"sms"}]}]},{xtype:"textarea",fieldLabel:lang("otherPeople"),name:"otherattend",width:480,height:100},{xtype:"panel",id:t.ID_MARKER_TEXT,hideBorders:true,border:false,autoWidth:true,items:[{xtype:"panel",layout:"table",border:false,width:500,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("deviceName"),name:"equipment[0]",store:t.getMeetingRoomEquipmentStore,hiddenName:"equipment[0]",valueField:"eid",displayField:"name",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(A,w,z){}.createDelegate(this)}})]},{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;"+lang("quantity")+": "},{xtype:"cnoa_textfield",width:80,name:"quantity[0]",regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum")}]}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:125px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("canNotChooseDevice")}}),{xtype:"button",text:lang("applyMoreDevices"),autoWidth:true,style:"margin-left:125px;margin-top:5px;margin-bottom:5px",handler:function(z,B){var A=Ext.getCmp(t.ID_MARKER_TEXT);var D="CNOA_MEETING_EQUIPMENT_FORM_content_"+t.content_start;var w="equipment["+t.content_start+"]";var C="quantity["+t.content_start+"]";t.content_start++;A.add([{xtype:"panel",hideBorders:true,border:false,id:D,style:"margin-left:20px;margin-top:5px",layout:"table",width:500,layoutConfig:{columns:4},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("deviceName"),name:w,store:t.getMeetingRoomEquipmentStore,hiddenName:w,valueField:"eid",displayField:"name",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(G,E,F){}.createDelegate(this)}})]},{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;"+lang("quantity")+": "},{xtype:"cnoa_textfield",width:80,name:C,regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum")},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:"X",handler:function(E,F){A.remove(D)}.createDelegate(this)}]}]);A.doLayout()}.createDelegate(this),name:"content"},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("peopleToView"),height:50,width:438,readOnly:true,name:"viewer"}]},{xtype:"hidden",name:"viewerUids"},{xtype:"btnForPoepleSelector",text:lang("select"),dataUrl:t.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:6px; margin-top:20px",listeners:{selected:function(A,B){var C=new Array();var z=new Array();if(B.length>0){for(var w=0;w<B.length;w++){C.push(B[w].uname);z.push(B[w].uid)}}t.formPanel.getForm().findField("viewer").setValue(C.join(","));t.formPanel.getForm().findField("viewerUids").setValue(z.join(","))},onrender:function(w){w.setSelectedUids(t.formPanel.getForm().findField("viewerUids").getValue().split(","))}}}]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:125px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("seeToInformation")}}),{xtype:"textarea",fieldLabel:lang("meetDescription"),width:480,height:300,name:"descripts",value:""},{xtype:"flashfile",fieldLabel:lang("attach"),name:"attach",inputPre:"filesUpload"}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:120,labelAlign:"right",region:"center",autoScroll:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[i]}]});var q=[{name:"mid"},{name:"name"},{name:"address"},{name:"contain"},{name:"descripts"}];var k=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEmptyMeetingroom",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:q}),listeners:{exception:function(D,C,E,B,A,z){var w=Ext.decode(A.responseText);if(w.failure){CNOA.msg.alert(w.msg)}}}});var u=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var l=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"mid",dataIndex:"mid",hidden:true},{header:lang("meetRoom"),dataIndex:"name",width:200,sortable:true,menuDisabled:true,renderer:this.showMeetingroomDetails.createDelegate(this)},{header:lang("address"),dataIndex:"address",width:250,sortable:true,menuDisabled:true},{header:lang("seatingCapacity"),dataIndex:"contain",width:60,sortable:false,menuDisabled:true},{header:lang("description"),dataIndex:"descripts",width:230,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var a=new Ext.grid.GridPanel({region:"north",height:0,store:k,loadMask:{msg:lang("waiting")},cm:l,sm:u,stripeRows:true});this.applyWin=new Ext.Window({title:lang("meetRequest"),width:820,height:makeWindowHeight(450),modal:true,layout:"border",border:false,items:[a,t.formPanel],buttons:[{text:lang("saveToDrafts"),cls:"btn-blue4",handler:function(){t.submit(f,"draft")}},{text:lang("submitApp"),cls:"btn-blue4",handler:function(){CNOA.msg.cf(lang("sureSubmieApproval"),function(w){if(w=="yes"){t.submit(f,e)}})}},{text:lang("cancel"),handler:function(){t.applyWin.close()}}],tbar:new Ext.Toolbar({items:[{handler:function(w,z){k.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},lang("startTime"),{xtype:"datefield",width:100,format:"Y-m-d",allowBlank:false,id:v},{xtype:"timefield",width:80,increment:30,id:j,name:"endtime",editable:false,format:"H:i"},lang("endTime"),{xtype:"datefield",width:100,format:"Y-m-d",allowBlank:false,id:c},{xtype:"timefield",width:80,increment:5,id:n,name:"endtime",editable:false,format:"H:i"},lang("seatingCapacity"),{xtype:"textfield",width:40,id:d},lang("to"),{xtype:"textfield",width:40,id:b},{text:lang("search"),tooltip:lang("justCheckList"),style:"margin-left:5px",handler:function(C,E){var F=Ext.getCmp(v).getRawValue();var w=Ext.getCmp(c).getRawValue();var A=Ext.getCmp(j).getValue();var D=Ext.getCmp(n).getValue();var B=Ext.getCmp(d).getValue();var z=Ext.getCmp(b).getValue();if(F==""||w==""){CNOA.msg.alert(lang("youNeedToFill"))}else{k.load({params:{s_date:F,e_date:w,s_time:A,e_time:D,contain1:B,contain2:z}});a.setHeight(150);t.applyWin.doLayout();Ext.getCmp(h).toggle(true)}}},{text:lang("clear"),handler:function(w){Ext.getCmp(v).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(j).setValue("");Ext.getCmp(n).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");k.load({params:{s_date:"",e_date:"",s_time:"",e_time:"",contain1:"",contain2:""}})}},{text:lang("expand"),iconCls:"icon-expand-all",enableToggle:true,id:h,toggleHandler:function(w,z){if(z){w.setIconClass("icon-collapse-all");w.setText(lang("collapse"));a.setHeight(150);t.applyWin.doLayout()}else{w.setIconClass("icon-expand-all");w.setText(lang("expand"));a.setHeight(0);t.applyWin.doLayout()}}}]})}).show();if(e=="edit"){t.loadFormData(f);t.type="edit"}},loadFormData:function(a){var b=this;b.formPanel.getForm().load({url:b.baseUrl+"&task=loadFormData",method:"POST",params:{aid:a},success:function(e,f){b.getMeetingRoomEquipmentStore.load({params:{mid:f.result.data.mid}});b.getMeetingRoomMgrerStore.load({params:{mid:f.result.data.mid}});b.formData=f.result.data;var d=Ext.getCmp(b.ID_MARKER_TEXT);var g="";var c="";Ext.each(f.result.data.equipment.eids,function(k,i,j){if(i==0){}else{g="CNOA_MEETING_EQUIPMENT_FORM_content_"+b.content_start;var h="equipment["+b.content_start+"]";var l="quantity["+b.content_start+"]";b.content_start++;d.add([{xtype:"panel",hideBorders:true,border:false,id:g,style:"margin-left:20px;margin-top:5px",layout:"table",width:500,layoutConfig:{columns:4},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("deviceName"),name:h,store:b.getMeetingRoomEquipmentStore,hiddenName:h,valueField:"eid",displayField:"name",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(o,m,n){}.createDelegate(this)}})]},{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;"+lang("quantity")+": "},{xtype:"cnoa_textfield",width:80,name:l,regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum")},{xtype:"button",cls:"cnoa-margin-left-5",height:20,text:"X",handler:function(m,n){d.remove(g)}.createDelegate(this)}]}]);d.doLayout()}})},failure:function(c,d){CNOA.msg.alert(d.result.msg)}.createDelegate(this)})},submit:function(c,a){var d=this;var b=d.formPanel.getForm();if(d.formPanel.getForm().isValid()){d.formPanel.getForm().submit({url:d.baseUrl+"&task=submit&from="+a,waitMsg:lang("waiting"),method:"POST",params:{aid:c},success:function(e,f){CNOA.msg.notice(f.result.msg,lang("meetRoomMgr"));d.applyWin.close();d.store.reload()}.createDelegate(this),failure:function(e,f){CNOA.msg.alert(f.result.msg)}.createDelegate(this)})}else{CNOA.msg.alert(lang("youDidNotWZ"))}},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_apply.showDetailsWin("+a.data.aid+")'>"+e+"</a><br />"+a.data.plan+"人"},showDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomApplyDetails&aid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:570px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeApplicationDetail"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},showMeetingroomDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_apply.showMeetingroomDetailsWin("+a.data.mid+")'>"+e+"</a>"},formatTime:function(e,c,a,f,b,d){return a.data.stime+"<br />"+a.data.etime},formatCheck:function(e,c,a,f,b,d){return a.data.checkman+"<br />"+a.data.checktime},showMeetingroomDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomDetails&mid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("viewDetailsMeetingRoom"),width:800,height:makeWindowHeight(600),resizable:true,modal:true,items:[a]}).show()},operate:function(e,c,a,g,b,d){var f=this;if(f.storeBar.storeType=="waiting"){return"<a class='gridview' href='javascript:void(0)' onclick='CNOA_meeting_mgr_apply.showDetailsWin("+a.data.aid+")'>"+lang("view")+"</a><a href='javascript:void(0)' class='gridview2 jianju' onclick='CNOA_meeting_mgr_apply.deleteMeeting("+e+")'>删除</a>"}else{if(f.storeBar.storeType=="pass"){if(a.data.isovertime==1){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_apply.showDetailsWin("+a.data.aid+")'>"+lang("view")+"</a>"}else{return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_apply.showDetailsWin("+a.data.aid+")'>"+lang("view")+"</a><a href='javascript:void(0)' class='gridview2 jianju' onclick='CNOA_meeting_mgr_apply.cancelMeeting("+e+")'>取消</a>"}}else{if(f.storeBar.storeType=="cancel"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_apply.window("+e+', "edit")\'>'+lang("reapply")+"</a>"}else{if(f.storeBar.storeType=="draft"){return"<a href='javascript:void(0)' class='gridview4' onclick='CNOA_meeting_mgr_apply.window("+e+', "edit")\'>'+lang("modify")+"</a><a href='javascript:void(0)' class='gridview2 jianju' onclick='CNOA_meeting_mgr_apply.deleteMeeting("+e+")'>删除</a>"}else{return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_apply.cancelMeeting("+e+")'>"+lang("cancel")+"</a><a href='javascript:void(0)' class='gridview4 jianju' onclick='CNOA_meeting_mgr_apply.window("+e+', "edit")\'>重新申请</a>'}}}}},delay:function(){var b=this;var a=new Ext.Window({title:lang("meetDelayed"),width:420,height:350,modal:true,layout:"border",resizable:false,border:false,items:[grid,b.formPanel],buttons:[{text:lang("submit"),handler:function(){b.submit()}},{text:lang("cancel"),handler:function(){b.applyWin.close()}}]}).show()},cancelMeeting:function(a){var b=this;CNOA.msg.cf(lang("sureCancelMeeting"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=cancelMeeting",method:"POST",params:{aid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("meetRoomMgr"));b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},deleteMeeting:function(a){var b=this;CNOA.msg.cf(lang("sureDelMeeting"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteMeeting",method:"POST",params:{aid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("meetRoomMgr"));b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})}};var CNOA_meeting_mgr_control,CNOA_meeting_mgr_controlClass;CNOA_meeting_mgr_controlClass=CNOA.Class.create();CNOA_meeting_mgr_controlClass.prototype={init:function(){var b=this;this.edit_id=0;this.type="add";this.day=0;var a=Ext.id();b.baseUrl="index.php?app=meeting&func=mgr&action=control";this.fd=Ext.data.Record.create([{name:"name"},{name:"mid"},{name:"t0",mapping:"dt.t0"},{name:"t1",mapping:"dt.t1"},{name:"t2",mapping:"dt.t2"},{name:"t3",mapping:"dt.t3"},{name:"t4",mapping:"dt.t4"},{name:"t5",mapping:"dt.t5"},{name:"t6",mapping:"dt.t6"},{name:"t7",mapping:"dt.t7"},{name:"t8",mapping:"dt.t8"},{name:"t9",mapping:"dt.t9"},{name:"t10",mapping:"dt.t10"},{name:"t11",mapping:"dt.t11"},{name:"t12",mapping:"dt.t12"},{name:"t13",mapping:"dt.t13"},{name:"t14",mapping:"dt.t14"},{name:"t15",mapping:"dt.t15"},{name:"t16",mapping:"dt.t16"},{name:"t17",mapping:"dt.t17"},{name:"t18",mapping:"dt.t18"},{name:"t19",mapping:"dt.t19"},{name:"t20",mapping:"dt.t20"},{name:"t21",mapping:"dt.t21"},{name:"t22",mapping:"dt.t22"},{name:"t23",mapping:"dt.t23"},{name:"t24",mapping:"dt.t24"},{name:"t25",mapping:"dt.t25"},{name:"t26",mapping:"dt.t26"},{name:"t27",mapping:"dt.t27"},{name:"t28",mapping:"dt.t28"},{name:"t29",mapping:"dt.t29"},{name:"t30",mapping:"dt.t30"},{name:"t31",mapping:"dt.t31"},{name:"t32",mapping:"dt.t32"},{name:"t33",mapping:"dt.t33"},{name:"t34",mapping:"dt.t34"},{name:"t35",mapping:"dt.t35"},{name:"t36",mapping:"dt.t36"},{name:"t37",mapping:"dt.t37"},{name:"t38",mapping:"dt.t38"},{name:"t39",mapping:"dt.t39"},{name:"t40",mapping:"dt.t40"},{name:"t41",mapping:"dt.t41"},{name:"t42",mapping:"dt.t42"},{name:"t43",mapping:"dt.t43"},{name:"t44",mapping:"dt.t44"},{name:"t45",mapping:"dt.t45"},{name:"t46",mapping:"dt.t46"},{name:"t47",mapping:"dt.t47"}]);this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data"},this.fd),listeners:{load:function(e,c,d){Ext.getCmp(a).getEl().update(e.reader.jsonData.date)}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel({defaults:{header:"",menuDisabled:true,resizable:false,sortable:false,width:15},columns:[{header:"",width:140,dataIndex:"name",menuDisabled:true,resizable:false,sortable:false},{header:"",width:15,dataIndex:"t0",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t1",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t2",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t3",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t4",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t5",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t6",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t7",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t8",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t9",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t10",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t11",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t12",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t13",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t14",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t15",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t16",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t17",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t18",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t19",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t20",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t21",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t22",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t23",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t24",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t25",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t26",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t27",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t28",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t29",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t30",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t31",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t32",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t33",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t34",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t35",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t36",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t37",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t38",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t39",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t40",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t41",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t42",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t43",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t44",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t45",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t46",renderer:this.mkBG.createDelegate(this)},{header:"",width:15,dataIndex:"t47",renderer:this.mkBG.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]});this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,tbar:[{text:lang("prevDay"),handler:function(){b.day--;b.store.load({params:{day:b.day}})}},{text:lang("today"),handler:function(){b.day=0;b.store.load({params:{day:b.day}})}},{xtype:"box",id:a,autoEl:{tag:"div",html:""}},{text:lang("nextDay"),handler:function(){b.day++;b.store.load({params:{day:b.day}})}},{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(c,d){b.store.reload()}},"<span class='cnoa_color_gray'>"+lang("colorShuoMing")+":&nbsp;</span><span class='cnoa_car_a'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("pendingOfmr")+"&nbsp;</span><span class='cnoa_car_b'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("meetRoomAppTime")+"&nbsp;</span><span class='cnoa_car_c'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("appByTheMeeting")+"&nbsp;</span><span class='cnoa_car_d'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("meetRoomUse")+"&nbsp;</span>","->",{xtype:"cnoa_helpBtn",helpid:138}],plugins:[new Ext.ux.plugins.GroupHeaderGrid({rows:[[{header:lang("meetRoom")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;("+lang("hour")+")",colspan:1,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"0",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"1",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"2",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"3",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"4",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"5",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"6",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"7",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"8",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"9",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"10",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"11",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"12",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"13",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"14",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"15",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"16",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"17",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"18",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"19",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"20",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"21",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"22",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false},{header:"23",colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false}]],hierarchicalColMenu:true})],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list]})},addWindow:function(){var f=this;var d=Ext.id();var c=Ext.id();var b=Ext.id();var a=Ext.id();f.selectType=a;var e=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("vehicleInformation"),defaults:{style:{marginBottom:"-10px"},border:false},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",fieldLabel:lang("licensePalte"),name:"carnumber",width:230},{xtype:"cnoa_textfield",fieldLabel:lang("engineModel"),name:"actionnumber",width:230},{xtype:"cnoa_textfield",fieldLabel:lang("driver"),name:"driver",width:230},{xtype:"datefield",fieldLabel:lang("purchaseDate"),format:"Y-m-d",name:"date",width:230}]},{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",fieldLabel:lang("brandModel"),name:"companynumber",width:230},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("vehicelType"),name:"type",store:new Ext.data.SimpleStore({fields:["value","type"],data:[["7",lang("car1")],["6",lang("vans")],["5",lang("truck")],["4",lang("toolCar")],["3",lang("bus")],["2",lang("jeep")],["1",lang("suv")]]}),width:230,hiddenName:"type",valueField:"type",displayField:"type",mode:"local",triggerAction:"all"})]},{xtype:"cnoa_textfield",fieldLabel:lang("purchasePrice"),name:"price",width:230},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("nowStatus"),name:"status",store:new Ext.data.SimpleStore({fields:["value","status"],data:[["4",lang("available")],["3",lang("damage")],["2",lang("maintenance")],["1",lang("scrap")],["0"," "]]}),width:230,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i,g,h){}.createDelegate(this)}})]}]}]}]},{xtype:"fieldset",title:lang("otherInformatin"),defaults:{border:false},items:[{xtype:"field",fieldLabel:lang("addVehicle"),inputType:"file",name:"attach"},{xtype:"textarea",fieldLabel:lang("remark"),name:"notes",width:580}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,fileUpload:true,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:lang("addNewVehicleInfor"),width:760,height:makeWindowHeight(420),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.window.close()}}]}).show();if(this.type=="edit"){f.loadFormData()}},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("meetRoomMgr"));this.window.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editList",params:{id:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.window.close()})}.createDelegate(this)})},deleteList:function(a){var c=this;var b=this.list.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("id")+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("delMeetingRoom"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},carnumber:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_appointment.showappointment("+a.data.mid+")' ext:qtip='"+lang("viewVehicleReservation")+"'>"+e+"</a>"},showappointment:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=apply&cid="+a+"&day="+b.day,"appointment","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},mkBG:function(e,c,a,f,b,d){if(e==0||e==1||e==7){c.css="cnoa_bgc_F6F6F6"}else{if(e==2){c.css="cnoa_car_a"}else{if(e%2==0){c.css="cnoa_car_b"}else{if(e==3){c.css="cnoa_car_c"}else{if(e==5){c.css="cnoa_car_d"}}}}}}};var CNOA_meeting_mgr_join,CNOA_meeting_mgr_joinClass;var CNOA_meeting_mgr_joinMy,CNOA_meeting_mgr_joinMyClass;var CNOA_meeting_mgr_joinJiyao,CNOA_meeting_mgr_joinJiyaoClass;CNOA_meeting_mgr_joinClass=CNOA.Class.create();CNOA_meeting_mgr_joinClass.prototype={init:function(){var f=this;this.baseUrl="index.php?app=meeting&func=mgr&action=join";this.ID_BTN_NEED_JIYAO=Ext.id();var b=new CNOA_meeting_mgr_joinMyClass();var c=new CNOA_meeting_mgr_joinJiyaoClass();var e=b.mainPanel;var d=c.mainPanel;var a=CNOA.meeting.mgr.join.from;this.center=new Ext.Panel({layout:"card",activeItem:a=="pass"?1:0,border:false,hideBorders:true,items:[e,d]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"fit",autoScroll:false,items:[this.center],tbar:[{handler:function(g,h){f.center.getLayout().setActiveItem(0)}.createDelegate(this),iconCls:"icon-join-allMeeting",enableToggle:true,pressed:a=="pass"?false:true,allowDepress:false,toggleGroup:"project_proj_approve_type",tooltip:lang("displayPendingMeet"),cls:"btn-blue4",text:lang("joinAllMeeting")},{handler:function(g,h){f.center.getLayout().setActiveItem(1)}.createDelegate(this),id:this.ID_BTN_NEED_JIYAO,enableToggle:true,pressed:a=="pass"?true:false,allowDepress:false,toggleGroup:"project_proj_approve_type",iconCls:"icon-utils-s-edit",cls:"btn-red1",tooltip:lang("displayMeetingTrial"),text:lang("memberMinutes")},"->",{xtype:"cnoa_helpBtn",helpid:4005}]});if(CNOA.meeting.mgr.join.from=="notice"&&CNOA.meeting.mgr.join.did){this.discussview(CNOA.meeting.mgr.join.did)}},showDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomApplyDetails&aid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:560px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeApplicationDetail"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},showNotJoin:function(c,b){var f=this;var e=f.baseUrl+"&task=viewMessageNotJoinReason&aid="+c+"&uid="+b;var d=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:560px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+d+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(d).contentWindow.location.href=e}}});var d=new Ext.Window({title:"不参加原因",width:600,height:makeWindowHeight(400),resizable:false,modal:true,items:[a]}).show()},showMarkDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomApplyMarkDetails&aid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:560px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("viewDetailMinutes"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},marker:function(c,k){var j=this;var a=Ext.id();var e=Ext.id();var h=Ext.id();var f=Ext.id();var b=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px",labelWidth:100,labelAlign:"right",waitMsgTarget:true,items:[{xtype:"panel",border:false,layout:"form",id:h,hidden:true,items:[{xtype:"displayfield",name:"opinion",fieldLabel:lang("amendmentLeader")}]},{xtype:"htmleditor",name:"markdetail",allowBlank:false,id:e,fieldLabel:lang("minutesContent")},{xtype:"userselectorfield",fieldLabel:lang("minutesApprover"),width:180,allowBlank:false,name:"jiyaouid",multiSelect:false},{xtype:"flashfile",fieldLabel:lang("attach"),name:"attach",inputPre:"filesUpload"}]});var i=new Ext.Window({title:lang("theMinutes"),width:700,height:makeWindowHeight(475),modal:true,items:[b],autoScroll:true,buttons:[{text:"暂存",id:f,handler:function(){if(b.getForm().isValid()){b.getForm().submit({url:j.baseUrl+"&task=onceMark",method:"POST",params:{aid:c},success:function(m,n){var l=n.result;if(l.success===true){CNOA.msg.notice(l.msg,lang("minutesManagement"));CNOA_meeting_mgr_joinJiyao=new CNOA_meeting_mgr_joinJiyaoClass();CNOA_meeting_mgr_joinJiyao.store.reload();i.close()}else{CNOA.msg.alert(l.msg)}}})}}},{text:lang("submit"),id:a,handler:function(){CNOA.msg.cf(lang("sureSubmitApproval"),function(l){if(l=="yes"){d(c)}})}},{text:lang("close"),handler:function(){i.close()}}],listeners:{afterlayout:function(){if(k=="hide"){Ext.getCmp(a).hide();Ext.getCmp(f).hide()}else{if(k=="edit"){Ext.getCmp(h).show();Ext.getCmp(f).show()}}}}}).show();var g=function(){b.getForm().load({url:j.baseUrl+"&task=loadMarkFormData",method:"POST",params:{aid:c},success:function(l,m){},failure:function(l,m){CNOA.msg.alert(m.result.msg,function(){})}.createDelegate(this)})};g();var d=function(l){if(b.getForm().isValid()){b.getForm().submit({url:j.baseUrl+"&task=submitMark",method:"POST",params:{aid:l},success:function(n,o){var m=o.result;if(m.success===true){CNOA.msg.notice(m.msg,lang("minutesManagement"));CNOA_meeting_mgr_joinJiyao=new CNOA_meeting_mgr_joinJiyaoClass();CNOA_meeting_mgr_joinJiyao.store.reload();i.close()}else{CNOA.msg.alert(m.msg)}}})}}},discuss:function(a){var f=this;var g=[{name:"did"},{name:"title"},{name:"postname"},{name:"count"},{name:"posttime"},{name:"lastname"},{name:"lasttime"}];this.storediscuss=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=viewdiscusslist&aid="+a}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var h=function(n,m,k){var l=k.data;return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_join.discussview("+l.did+")'>"+n+"</a>"};var i=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"did",dataIndex:"did",hidden:true},{header:lang("title"),dataIndex:"title",width:270,sortable:true,menuDisabled:true,renderer:h},{header:lang("author"),dataIndex:"postname",width:100,sortable:true,menuDisabled:true},{header:lang("publish"),dataIndex:"posttime",width:120,sortable:true,menuDisabled:true},{header:lang("replies"),dataIndex:"count",width:120,sortable:true,menuDisabled:true},{header:lang("lastReplyPeople"),dataIndex:"lastname",width:80,sortable:true,menuDisabled:true},{header:lang("lastReplyTime"),dataIndex:"lasttime",width:120,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var j=new Ext.grid.GridPanel({border:false,store:f.storediscuss,loadMask:{msg:lang("waiting")},cm:i,sm:b,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(k,l){f.storediscuss.reload()}},{text:lang("post1"),iconCls:"icon-utils-s-edit",cls:"btn-blue4",handler:function(k,l){f.discussWin(a)}},"<span class='cnoa_color_gray'>"+lang("clickTheTitleEnter")+"</span>"]});var c=new Ext.Panel({region:"center",layout:"fit",items:[j]});var d=new Ext.Panel({collapsible:false,hideBorders:true,border:false,region:"center",layout:"border",autoScroll:false,items:[c]});var e=new Ext.Window({title:lang("meetRequest"),width:855,height:makeWindowHeight(650),modal:true,layout:"border",border:false,items:[c],buttons:[{text:lang("close"),handler:function(){e.close()}}]}).show()},discussview:function(b){var e=this;var a=new Ext.XTemplate('<div class="user_task_discuss_view">','  <div class="user_task_discuss_view_header">','    <div class="user_task_discuss_view_header_title">['+lang("discussTitle")+"]&nbsp;&nbsp;{title}&nbsp;&nbsp;</div>",'    <div class="user_task_discuss_view_header_from">&nbsp;'+lang("posters")+":&nbsp;&nbsp; {postname}&nbsp;&nbsp;&nbsp;&nbsp;"+lang("publish")+":{posttime}</div>","  </div>",'  <div class="user_task_discuss_view_body">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_body">','        <span><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{postname}</a>&nbsp;&nbsp;</div>','      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>",'  <tpl for="list">','  <div class="user_task_discuss_view_body">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_top"></div>','      <div class="user_task_discuss_view_body_left_body">','        <span><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{postname}</a>&nbsp;&nbsp;发表于&nbsp;{posttime}<div style="float:right; padding-right:5px"><a href="javascript:void(0)" onclick="CNOA_meeting_mgr_join.replydiscuss({did},{rid})">回复</a></div></div>','      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>","  </tpl>","</div>");e.readInfo=function(){d.getEl().mask(lang("waiting"));Ext.Ajax.request({url:e.baseUrl+"&task=getDiscussInfo",method:"POST",params:{did:b},success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){rd=f.data;a.overwrite(d.body,rd);d.getEl().unmask()}else{CNOA.msg.alert(f.msg)}}})};var d=new Ext.Panel({region:"center",layout:"fit",border:false,autoScroll:true,listeners:{render:function(){e.readInfo()}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.readInfo()}},{text:lang("reply"),iconCls:"icon-expand-members",handler:function(){e.replydiscuss(b,0)}}]})});var c=new Ext.Window({title:lang("viewDiscussWin"),width:800,height:makeWindowHeight(600),modal:true,layout:"border",items:[d],buttons:[{text:lang("close"),handler:function(){c.close()}}]}).show()},replydiscuss:function(c,a){var f=this;var d=function(){if(b.getForm().isValid()){b.getForm().submit({url:f.baseUrl+"&task=discussprojreply",waitMsg:lang("waiting"),method:"POST",params:{did:c,rid:a},success:function(g,h){CNOA.msg.notice(h.result.msg,lang("meetMgr"));e.close();f.readInfo()}.createDelegate(this),failure:function(g,h){CNOA.msg.alert(h.result.msg)}.createDelegate(this)})}};var b=new Ext.form.FormPanel({region:"center",border:false,labelWidth:60,labelAlign:"right",waitMsgTarget:true,items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",items:[{xtype:"textarea",name:"content",height:"180",allowBlank:false,fieldLabel:lang("replyContent"),width:"480"}]}]});var e=new Ext.Window({title:lang("postWindow"),width:600,height:300,modal:true,layout:"border",items:[b],buttons:[{text:lang("submit"),handler:function(){d()}},{text:lang("close"),handler:function(){e.close()}}]}).show()},discussWin:function(c){var e=this;var b=function(){if(a.getForm().isValid()){a.getForm().submit({url:e.baseUrl+"&task=discussprojadd",waitMsg:lang("waiting"),method:"POST",params:{aid:c},success:function(f,g){CNOA.msg.alert(g.result.msg,function(){d.close();e.storediscuss.reload()})}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg)}.createDelegate(this)})}};var a=new Ext.form.FormPanel({region:"center",border:false,labelWidth:50,labelAlign:"right",bodyStyle:"padding:10px",waitMsgTarget:true,items:[{xtype:"textfield",name:"title",fieldLabel:lang("title"),allowBlank:false,width:"480"},{xtype:"textarea",name:"content",fieldLabel:lang("content"),width:"480",height:"180"}]});var d=new Ext.Window({title:lang("postWindow"),width:600,height:330,modal:true,layout:"border",items:[a],buttons:[{text:lang("submit"),handler:function(){b()}},{text:lang("close"),handler:function(){d.close()}}]}).show()},fenfa:function(b){var d=this;var a=new Ext.form.FormPanel({region:"center",border:false,bodyStyle:"padding:10px",labelWidth:100,labelAlign:"top",layout:"fit",waitMsgTarget:true,items:[{xtype:"fieldset",title:lang("meetBasicInformation"),anchor:"99%",autoHeight:true,items:[{xtype:"panel",layout:"form",hideBorders:true,border:false,autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("distributedtoWho"),height:50,width:450,readOnly:true,allowBlank:false,name:"attender"}]},{xtype:"hidden",name:"attendUids"},{xtype:"btnForPoepleSelector",text:lang("select"),dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:415px; ",listeners:{selected:function(g,h){var j=new Array();var f=new Array();if(h.length>0){for(var e=0;e<h.length;e++){j.push(h[e].uname);f.push(h[e].uid)}}a.getForm().findField("attender").setValue(j.join(","));a.getForm().findField("attendUids").setValue(f.join(","))},onrender:function(e){e.setSelectedUids(a.getForm().findField("attendUids").getValue().split(","))}}},{xtype:"textarea",fieldLabel:lang("yjjy"),height:100,width:450,name:"opinion"}]}]});var c=new Ext.Window({title:lang("distribute"),width:510,height:380,modal:true,layout:"border",items:a,buttons:[{text:lang("distribute"),cls:"btn-blue4",handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=fenfa",waitMsg:lang("waiting"),method:"POST",params:{aid:b},success:function(e,f){CNOA.msg.notice(f.result.msg,lang("meetMgr"));c.close()}.createDelegate(this),failure:function(e,f){CNOA.msg.alert(f.result.msg)}.createDelegate(this)})}}},{text:lang("close"),handler:function(){c.close()}}]}).show()},isJoin:function(f){var d=this;var c=Ext.id();var b=Ext.id();var e=new Ext.form.FormPanel({border:false,padding:20,width:800,height:200,items:[{width:300,hideLabel:true,xtype:"radiogroup",items:[{boxLabel:"参加会议",name:"status",inputValue:1,checked:true},{boxLabel:"不参加会议",name:"status",inputValue:2}],listeners:{change:function(h,g){if(g.inputValue==1){Ext.getCmp(b).hide()}else{if(g.inputValue==2){Ext.getCmp(b).show()}else{Ext.getCmp(b).hide()}}}}},{xtype:"textarea",height:126,fieldLabel:"不参加理由",id:b,style:"margin-left:-10px;",width:600,name:"reason",hidden:true}]});var a=new Ext.Window({width:800,height:600,modal:true,title:"是否参加会议",items:[e],buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){if(e.getForm().isValid()){e.getForm().submit({url:d.baseUrl+"&task=updateStatus",method:"POST",params:{aid:f},success:function(g,h){CNOA.msg.notice2(h.result.msg);a.close()}.createDelegate(this),failure:function(g,h){CNOA.msg.alert(h.result.msg)}.createDelegate(this)})}else{CNOA.msg.alert(lang("youDidNotWZ"))}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){a.close()}}]}).show()}};CNOA_meeting_mgr_joinMyClass=CNOA.Class.create();CNOA_meeting_mgr_joinMyClass.prototype={init:function(){var f=this;var d=Ext.id();var c=Ext.id();var a=Ext.id();var b=Ext.id();var e=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=join";this.getMeetingRoomListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.storeBar={storeType:"all",name:"",title:"",stime:"",etime:"",meetingroom:""};this.fields=[{name:"aid"},{name:"name"},{name:"markname"},{name:"markdetail"},{name:"title"},{name:"meetingroom"},{name:"stime"},{name:"joinStatu"},{name:"etime"},{name:"statusname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(l,k,m,j,i,h){var g=Ext.decode(i.responseText);if(g.failure){CNOA.msg.alert(g.msg)}},load:function(h,g,i){try{Ext.getCmp(CNOA_meeting_mgr_join.ID_BTN_NEED_JIYAO).setText(lang("memberMinutes")+"(<span class='cnoa_color_white'>"+h.reader.jsonData.needjiyao+"</span>)")}catch(i){}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(g,h){if(f.storeBar.name!=""){h.name=f.storeBar.name}if(f.storeBar.title!=""){h.title=f.storeBar.title}if(f.storeBar.stime!=""){h.stime=f.storeBar.stime}if(f.storeBar.etime!=""){h.etime=f.storeBar.etime}if(f.storeBar.meetingroom!=""){h.meetingroom=f.storeBar.meetingroom}}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:100,sortable:true,menuDisabled:true,renderer:this.showDetails.createDelegate(this)},{header:lang("theme"),dataIndex:"title",width:100,sortable:true,menuDisabled:true},{header:lang("meetStatus"),dataIndex:"statusname",width:90,sortable:true,menuDisabled:true},{header:lang("meetRoom"),dataIndex:"meetingroom",width:100,sortable:true,menuDisabled:true},{header:lang("membersMinutes"),dataIndex:"markname",width:150,sortable:true,menuDisabled:true},{header:lang("minutesContent"),dataIndex:"markdetail",width:100,sortable:true,menuDisabled:true,renderer:function(g,i,h){if(g!=""){return'<a href="javascript:void(0)"  class="gridview" onclick="CNOA_meeting_mgr_join.showMarkDetailsWin('+h.data.aid+')">查看</a>'}}},{header:lang("startTime"),dataIndex:"stime",width:120,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:120,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"aid",width:200,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[lang("meeting")+lang("startTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:a}]},lang("meeting")+lang("endTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:b}]}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"fit",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){f.store.reload()}},lang("meetName")+":",{xtype:"textfield",width:168,id:d},lang("meetTheme")+":",{xtype:"textfield",width:168,id:c},lang("meetRoom")+":",{xtype:"panel",border:false,layout:"fit",items:[new Ext.form.ComboBox({name:"mid",store:f.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",width:120,id:e,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i,g,h){}.createDelegate(this)}})]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){f.storeBar.name=Ext.getCmp(d).getValue();f.storeBar.title=Ext.getCmp(c).getValue();f.storeBar.stime=Ext.getCmp(a).getRawValue();f.storeBar.etime=Ext.getCmp(b).getRawValue();f.storeBar.meetingroom=Ext.getCmp(e).getValue();f.store.load({params:f.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(d).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(e).setValue("");f.storeBar.name="";f.storeBar.title="";f.storeBar.stime="";f.storeBar.etime="";f.storeBar.meetingroom="";f.store.load({params:f.storeBar})}}]})})},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_join.showDetailsWin("+a.data.aid+")'>"+e+"</a>"},operate:function(f,d,b,h,c,e){var g=this;var a="<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.discuss("+b.data.aid+")'>讨论</a>";if(b.data.joinStatu=="1"){a+="&nbsp;&nbsp;&nbsp;<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.isJoin("+b.data.aid+")'>是否参加</a>"}else{a+=""}return a}};CNOA_meeting_mgr_joinJiyaoClass=CNOA.Class.create();CNOA_meeting_mgr_joinJiyaoClass.prototype={init:function(){var e=this;var i=Ext.id();var c=Ext.id();var h=Ext.id();var j=Ext.id();var d=Ext.id();var g=Ext.id();var b=Ext.id();var f=Ext.id();var a=CNOA.meeting.mgr.join.from;this.baseUrl="index.php?app=meeting&func=mgr&action=join";this.getMeetingRoomListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.storeBar={storeType:"all",name:"",title:"",stime:"",etime:"",meetingroom:""};this.fields=[{name:"aid"},{name:"name"},{name:"markname"},{name:"title"},{name:"meetingroom"},{name:"stime"},{name:"etime"},{name:"statusname"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJiyaoJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(p,o,q,n,m,l){var k=Ext.decode(m.responseText);if(k.failure){CNOA.msg.alert(k.msg)}},load:function(l,k,m){Ext.getCmp(g).setText(lang("iNeesMinutes")+"(<span class='cnoa_color_white'>"+l.reader.jsonData.all+"</span>)");Ext.getCmp(b).setText(lang("waitAppMinutes")+"(<span class='cnoa_color_white'>"+l.reader.jsonData.waiting+"</span>)");Ext.getCmp(f).setText(lang("minutesRewritten")+"(<span class='cnoa_color_white'>"+l.reader.jsonData.returnback+"</span>)")}}});if(a=="pass"){this.storeBar.storeType="pass"}this.store.load({params:this.storeBar});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(k,l){if(e.storeBar.name!=""){l.name=e.storeBar.name}if(e.storeBar.title!=""){l.title=e.storeBar.title}if(e.storeBar.stime!=""){l.stime=e.storeBar.stime}if(e.storeBar.etime!=""){l.etime=e.storeBar.etime}if(e.storeBar.meetingroom!=""){l.meetingroom=e.storeBar.meetingroom}}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:100,sortable:true,menuDisabled:true,renderer:this.showDetails.createDelegate(this)},{header:lang("theme"),dataIndex:"title",width:100,sortable:true,menuDisabled:true},{header:lang("meetStatus"),dataIndex:"statusname",width:90,sortable:true,menuDisabled:true},{header:lang("meetRoom"),dataIndex:"meetingroom",width:100,sortable:true,menuDisabled:true},{header:lang("membersMinutes"),dataIndex:"markname",width:150,sortable:true,menuDisabled:true},{header:lang("minutesContent"),dataIndex:"markdetail",width:100,sortable:true,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:120,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:120,sortable:true,menuDisabled:true},{header:lang("opt"),id:"autoExpand",dataIndex:"aid",width:120,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,autoExpandColumn:"autoExpand",tbar:[{handler:function(k,l){e.storeBar.storeType="all";e.store.load({params:e.storeBar})}.createDelegate(this),id:g,iconCls:"icon-roduction",enableToggle:true,cls:"btn-blue4",pressed:a=="pass"?false:true,allowDepress:false,toggleGroup:"MEETING_JIYAO_GROUP_BTN",text:lang("iNeesMinutes")},{handler:function(k,l){e.storeBar.storeType="waiting";e.store.load({params:e.storeBar})}.createDelegate(this),id:b,enableToggle:true,allowDepress:false,toggleGroup:"MEETING_JIYAO_GROUP_BTN",cls:"btn-blue3",iconCls:"icon-roduction",text:lang("waitAppMinutes")},{handler:function(k,l){e.storeBar.storeType="pass";e.store.load({params:e.storeBar})}.createDelegate(this),enableToggle:true,pressed:a=="pass"?true:false,allowDepress:false,cls:"btn-blue3",id:"ID_BTN_PASS_JIYAO",toggleGroup:"MEETING_JIYAO_GROUP_BTN",iconCls:"icon-roduction",text:lang("appByMinutes")},{handler:function(k,l){e.storeBar.storeType="returnback";e.store.load({params:e.storeBar})}.createDelegate(this),id:f,enableToggle:true,cls:"btn-blue3",allowDepress:false,toggleGroup:"MEETING_JIYAO_GROUP_BTN",iconCls:"icon-roduction",text:lang("minutesRewritten")},lang("meeting")+lang("startTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:h}]},lang("meeting")+lang("endTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:j}]}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"fit",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(k,l){e.store.reload()}},lang("meetName")+":",{xtype:"textfield",width:168,id:i},lang("meetTheme")+":",{xtype:"textfield",width:168,id:c},lang("meetRoom")+":",{xtype:"panel",border:false,layout:"fit",items:[new Ext.form.ComboBox({name:"mid",store:e.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",width:120,id:d,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(m,k,l){}.createDelegate(this)}})]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){e.storeBar.name=Ext.getCmp(i).getValue();e.storeBar.title=Ext.getCmp(c).getValue();e.storeBar.stime=Ext.getCmp(h).getRawValue();e.storeBar.etime=Ext.getCmp(j).getRawValue();e.storeBar.meetingroom=Ext.getCmp(d).getValue();e.store.load({params:e.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(i).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(h).setValue("");Ext.getCmp(j).setValue("");Ext.getCmp(d).setValue("");e.storeBar.name="";e.storeBar.title="";e.storeBar.stime="";e.storeBar.etime="";e.storeBar.meetingroom="";e.store.load({params:e.storeBar})}}]})})},operate:function(b,f,a){var e=this;if(e.storeBar.storeType=="all"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.marker("+a.data.aid+', "show")\'>'+lang("addEditMinutes")+"</a>"}else{if(e.storeBar.storeType=="waiting"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.marker("+a.data.aid+', "hide")\'>'+lang("viewDetailMinutes")+"</a>"}else{if(e.storeBar.storeType=="pass"){var d="<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.marker("+a.data.aid+', "hide")\'>'+lang("viewDetailMinutes")+"</a>";d+="<a href='javascript:void(0)' class='gridview3 jianju' onclick='CNOA_meeting_mgr_join.fenfa("+a.data.aid+")'>分发</a>";return d}else{if(e.storeBar.storeType=="unpass"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_join.marker("+a.data.aid+', "hide")\'>'+lang("viewDetailMinutes")+"</a>"}else{if(e.storeBar.storeType=="returnback"){return"<a href='javascript:void(0)' class='gridview4' onclick='CNOA_meeting_mgr_join.marker("+a.data.aid+', "edit")\'>'+lang("modifyMinutes")+"</a>"}}}}}},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_join.showDetailsWin("+a.data.aid+")'>"+e+"</a>"}};var CNOA_meeting_mgr_list,CNOA_meeting_mgr_listClass;CNOA_meeting_mgr_listClass=CNOA.Class.create();CNOA_meeting_mgr_listClass.prototype={init:function(){var f=this;var d=Ext.id();var c=Ext.id();var a=Ext.id();var b=Ext.id();var e=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=list";this.storeBar={storeType:"waiting",name:"",title:"",stime:"",etime:"",meetingroom:""};this.fields=[{name:"aid"},{name:"mid"},{name:"name"},{name:"title"},{name:"plan"},{name:"meetingroom"},{name:"stime"},{name:"etime"},{name:"checktime"},{name:"appman"},{name:"apptime"},{name:"status"}];this.getMeetingRoomListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.getMeetingRoomCheckerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingCheckerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"checkuid",mapping:"uid"},{name:"name"}]})});this.getMeetingRoomMgrerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getMeetingMgrerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mgruid",mapping:"uid"},{name:"name"}]})});this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(l,k,m,j,i,h){var g=Ext.decode(i.responseText);if(g.failure){CNOA.msg.alert(g.msg)}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(g,h){if(f.storeBar.storeType!=""){h.storeType=f.storeBar.storeType}if(f.storeBar.name!=""){h.name=f.storeBar.name}if(f.storeBar.title!=""){h.title=f.storeBar.title}if(f.storeBar.stime!=""){h.stime=f.storeBar.stime}if(f.storeBar.etime!=""){h.etime=f.storeBar.etime}if(f.storeBar.meetingroom!=""){h.meetingroom=f.storeBar.meetingroom}}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:100,sortable:true,menuDisabled:true,renderer:f.showDetails},{header:lang("theme"),dataIndex:"title",width:100,sortable:true,menuDisabled:true},{header:lang("meetRoom"),dataIndex:"meetingroom",width:100,sortable:true,menuDisabled:true},{header:lang("estimatedNum"),dataIndex:"plan",width:170,sortable:true,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:120,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:120,sortable:true,menuDisabled:true},{header:lang("proposer"),dataIndex:"appman",width:70,sortable:true,menuDisabled:true},{header:lang("appTime"),dataIndex:"apptime",width:120,sortable:true,menuDisabled:true},{header:lang("approvalTime"),dataIndex:"checktime",width:120,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"aid",width:100,sortable:true,menuDisabled:true,renderer:f.operate},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(g,h){}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){f.store.reload()}},{handler:function(g,h){f.storeBar.storeType="waiting";f.store.load({params:f.storeBar})}.createDelegate(this),iconCls:"icon-roduction",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayPendingMeet"),text:lang("pendingMeet")},{handler:function(g,h){f.storeBar.storeType="pass";f.store.load({params:f.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",iconCls:"icon-roduction",tooltip:lang("displayListOfApp"),text:lang("approveMeeting")},{handler:function(g,h){f.storeBar.storeType="unpass";f.store.load({params:f.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",iconCls:"icon-roduction",tooltip:lang("AccordingMeetingList"),text:lang("isNotThroughMeet")},{handler:function(g,h){f.storeBar.storeType="cancel";f.store.load({params:f.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",iconCls:"icon-roduction",tooltip:lang("displayMeetIsCanceled"),text:lang("meetWasCancel")},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:4002}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("meetName")+":",{xtype:"textfield",width:168,id:d},lang("meetTheme")+":",{xtype:"textfield",width:168,id:c},lang("meeting")+lang("startTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:a}]},lang("meeting")+lang("endTime")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"datefield",width:120,format:"Y-m-d",id:b}]},lang("meetRoom")+":",{xtype:"panel",border:false,layout:"fit",items:[new Ext.form.ComboBox({name:"mid",store:f.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",width:120,id:e,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i,g,h){}.createDelegate(this)}})]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){f.storeBar.name=Ext.getCmp(d).getValue();f.storeBar.title=Ext.getCmp(c).getValue();f.storeBar.stime=Ext.getCmp(a).getRawValue();f.storeBar.etime=Ext.getCmp(b).getRawValue();f.storeBar.meetingroom=Ext.getCmp(e).getValue();f.store.load({params:f.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(d).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(e).setValue("");f.storeBar.name="";f.storeBar.title="";f.storeBar.stime="";f.storeBar.etime="";f.storeBar.meetingroom="";f.store.load({params:f.storeBar})}}]})})},periodWin:function(){var e=this;this.periodStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPeriodJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(k,j,l,i,h,g){var f=Ext.decode(h.responseText);if(f.failure){CNOA.msg.alert(f.msg)}}}});var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),d,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:150,sortable:true,menuDisabled:true},{header:lang("meetRoom"),dataIndex:"meetingroom",width:150,sortable:true,menuDisabled:true},{header:lang("proposer"),dataIndex:"appman",width:100,sortable:true,menuDisabled:true},{header:lang("startTime"),dataIndex:"meetingroom",width:150,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"meetingroom",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var b=new Ext.grid.GridPanel({region:"center",border:false,store:this.periodStore,loadMask:{msg:lang("waiting")},cm:a,sm:d,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{text:lang("cancelRecurring"),iconCls:"icon-utils-s-delete"}]});var c=new Ext.Window({title:lang("mgrPeriodicallyMeet"),width:800,height:makeWindowHeight(580),modal:true,layout:"border",resizable:false,border:false,items:[b],buttons:[{text:lang("close"),handler:function(){c.close()}}]}).show()},operate:function(h,f,d,g,e,a){var i=d.data;var b=i.stime;var c=i.etime;if(i.status==1){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_list.comfirm("+h+", \"agree\")'><span class='cnoa_color_green'>"+lang("agree")+"</span></a><a href='javascript:void(0)' class='gridview2 jianju' onclick='CNOA_meeting_mgr_list.comfirm("+h+', "disagree")\'>'+lang("disagree")+"</a>"}else{if(i.status==2){return"<a href='javascript:void(0)' class='gridview2' onclick='CNOA_meeting_mgr_list.comfirm("+h+', "recell")\'>'+lang("recell")+"</a><a href='javascript:void(0)' class='gridview4 jianju' onclick='CNOA_meeting_mgr_list.editTime("+h+")'>"+lang("editTime")+"</a>"}else{return""}}},comfirm:function(d,a){var c=this;var b="";if(a=="agree"){b=lang("throughMeetingApply")}else{if(a=="recell"){b=lang("doRecellMeet")}else{b=lang("doNotApplyMeet")}}CNOA.msg.cf(b,function(e){if(e=="yes"){Ext.Ajax.request({url:c.baseUrl+"&task=comfirmAppMeetingroom",method:"POST",params:{aid:d,type:a},success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){CNOA.msg.notice(f.msg,lang("meetRoomAppMgr"));c.store.reload()}else{CNOA.msg.alert(f.msg)}}})}})},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_list.showDetailsWin("+a.data.aid+")'>"+e+"</a>"},showDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomApplyDetails&aid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:600px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeApplicationDetail"),width:800,height:makeWindowHeight(600),resizable:true,modal:true,items:[a]}).show()},showMeetingroomDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_list.showMeetingroomDetailsWin("+a.data.mid+")'>"+e+"</a>"},showMeetingroomDetailsWin:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoomDetails&mid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeApplicationDetail"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},editTime:function(f){var l=this;var b=Ext.id();var g=Ext.id();var i=Ext.id();var p=Ext.id();var h=Ext.id();var o=Ext.id();var e=Ext.id();var d=Ext.id();var c=Ext.id();var k=Ext.id();var j=Ext.id();var a=Ext.id();var n=new Ext.form.FormPanel({border:false,height:600,labelWidth:120,labelAlign:"right",region:"center",autoScroll:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[{items:[{fieldLabel:"会议名称",name:"facilitynum",allowBlank:false},{xtype:"panel",layout:"form",id:c,border:false,items:[{xtype:"panel",layout:"table",fieldLabel:lang("startTime")+"<span class='cnoa_color_red'>*</span>",border:false,items:[{xtype:"datefield",width:150,allowBlank:false,name:"startdate",editable:false,format:"Y-m-d",value:new Date().format("Y-m-d")},{xtype:"timefield",width:80,allowBlank:false,increment:5,name:"starttime",editable:false,format:"H:i",editable:true,value:new Date().format("H:i")}]}]},{xtype:"panel",layout:"form",id:k,border:false,items:[{xtype:"panel",fieldLabel:lang("endTime")+"<span class='cnoa_color_red'>*</span>",layout:"table",border:false,items:[{xtype:"datefield",width:150,allowBlank:false,name:"enddate",editable:false,format:"Y-m-d"},{xtype:"timefield",width:80,allowBlank:false,increment:5,name:"endtime",editable:false,format:"H:i",editable:true}]}]}]}]});var m=new Ext.Window({width:800,height:600,modal:true,title:lang("editTime"),items:[n],buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){if(n.getForm().isValid()){n.getForm().submit({url:l.baseUrl+"&task=updateTime",waitMsg:lang("waiting"),method:"POST",params:{aid:f},success:function(q,r){m.close();l.store.reload()}.createDelegate(this),failure:function(q,r){CNOA.msg.alert(r.result.msg)}.createDelegate(this)})}else{CNOA.msg.alert(lang("youDidNotWZ"))}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){m.close()}}]}).show()}};var CNOA_meeting_mgr_person,CNOA_meeting_mgr_personClass;CNOA_meeting_mgr_personClass=CNOA.Class.create();CNOA_meeting_mgr_personClass.prototype={init:function(){var e=this;var d=Ext.id();var c=Ext.id();var a=Ext.id();var b=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=person";this.storeBar={storeType:"all",name:"",number:"",scount:"",ecount:""};this.fields=[{name:"eid"},{name:"name"},{name:"number"},{name:"descripts"},{name:"status"},{name:"quantity"},{name:"unquantity"},{name:"meetingroom"}];this.getMeetingRoomListStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getMeetingRoomList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mid"},{name:"name"}]})});this.getMeetingRoomListStore.load();this.getMeetingRoomCheckerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getMeetingCheckerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"checkuid",mapping:"uid"},{name:"name"}]})});this.getMeetingRoomMgrerStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getMeetingMgrerList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"mgruid",mapping:"uid"},{name:"name"}]})});this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(k,j,l,i,h,g){var f=Ext.decode(h.responseText);if(f.failure){CNOA.msg.alert(f.msg)}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(f,g){if(e.storeBar.storeType!=""){g.storeType=e.storeBar.storeType}if(e.tasksearch.name!=""){g.name=e.storeBar.name}if(e.tasksearch.number!=""){g.number=e.storeBar.number}if(e.tasksearch.scount!=""){g.scount=e.storeBar.scount}if(e.tasksearch.ecount!=""){g.ecount=e.storeBar.ecount}}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"eid",dataIndex:"eid",hidden:true},{header:lang("deviceNum"),dataIndex:"number",width:100,sortable:true,menuDisabled:true},{header:lang("deviceName"),dataIndex:"name",width:140,sortable:true,menuDisabled:true,renderer:this.viewDetail.createDelegate(this)},{header:lang("quantityOfDevice"),dataIndex:"quantity",width:160,sortable:true,menuDisabled:true},{header:lang("deviceCanNot"),dataIndex:"unquantity",width:160,sortable:true,menuDisabled:true},{header:lang("belongMeetRoom"),dataIndex:"meetingroom",width:145,sortable:true,menuDisabled:true},{header:lang("deviceDescription"),dataIndex:"descripts",width:250,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"eid",width:190,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{text:lang("addDevice"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){e.equipmentWin(0,"add")}},{text:lang("managementDevice"),iconCls:"icon-system-setup",cls:"btn-yellow1",handler:function(){e.equipmentRecord()}},{handler:function(f,g){e.storeBar.storeType="all";e.store.load({params:e.storeBar})}.createDelegate(this),iconCls:"icon-doc-list",cls:"btn-red1",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"meeting_room_check",text:lang("listOfAllDevice")},{handler:function(f,g){e.storeBar.storeType="lesstwenty";e.store.load({params:e.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",text:lang("numberLessEqual20")},{handler:function(f,g){e.storeBar.storeType="lessfifty";e.store.load({params:e.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_check",text:lang("equal40AndMore20")},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:4004}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("deviceNum")+":",{xtype:"textfield",width:140,id:c},lang("deviceName")+":",{xtype:"textfield",width:140,id:d},lang("deviceFrom")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"textfield",width:100,format:"Y-m-d",regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum"),id:a}]},lang("to")+":",{xtype:"panel",border:false,layout:"fit",items:[{xtype:"textfield",width:100,format:"Y-m-d",regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum"),id:b}]},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){e.storeBar.name=Ext.getCmp(d).getValue();e.storeBar.number=Ext.getCmp(c).getValue();e.storeBar.scount=Ext.getCmp(a).getRawValue();e.storeBar.ecount=Ext.getCmp(b).getRawValue();e.store.load({params:e.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(d).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");e.storeBar.name="";e.storeBar.number="";e.storeBar.scount="";e.storeBar.ecount="";e.store.load({params:e.storeBar})}}]})})},equipmentWin:function(a,c){var d=this;if(c=="edit"){title=lang("editMeetDevice")}else{title=lang("addmeetDevice")}var b=[{xtype:"cnoa_textfield",name:"number",width:200,fieldLabel:lang("deviceNum")},{xtype:"cnoa_textfield",name:"name",width:200,fieldLabel:lang("deviceName"),allowBlank:false},{xtype:"panel",border:false,layout:"fit",fieldLabel:lang("bindMeetRoom"),width:200,items:[new CNOA.form.ComboBox({name:"mid",store:d.getMeetingRoomListStore,hiddenName:"mid",valueField:"mid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(g,e,f){}.createDelegate(this)}})]},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:75px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("reminderMeetDevice")}}),{xtype:"cnoa_textfield",name:"quantity",width:200,fieldLabel:lang("numDevice"),regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum"),allowBlank:false},{xtype:"cnoa_textfield",name:"unit",width:200,fieldLabel:lang("unit"),allowBlank:false},{xtype:"textarea",name:"descripts",width:200,height:100,fieldLabel:lang("deviceDescription")}];this.formEquipmentPanel=new Ext.form.FormPanel({border:false,labelWidth:80,labelAlign:"right",region:"center",autoScroll:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[b]}]});this.equipmentWindow=new Ext.Window({title:title,width:380,height:makeWindowHeight(420),modal:true,layout:"border",resizable:false,border:false,items:[d.formEquipmentPanel],buttons:[{text:lang("submit"),handler:function(){d.submitEquipment(a,c)}},{text:lang("cancel"),handler:function(){d.equipmentWindow.close()}}]}).show();if(c=="edit"){d.loadFormData(a)}},loadFormData:function(a){var b=this;b.formEquipmentPanel.getForm().load({url:b.baseUrl+"&task=loadFormData",params:{eid:a},method:"POST",success:function(c,d){},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){b.equipmentWindow.close()})}.createDelegate(this)})},submitEquipment:function(a,b){var c=this;if(c.formEquipmentPanel.getForm().isValid()){c.formEquipmentPanel.getForm().submit({url:c.baseUrl+"&task=submitEquipment&from="+b,waitMsg:lang("waiting"),params:{eid:a},method:"POST",success:function(d,e){CNOA.msg.notice(e.result.msg,lang("meetRoomDevMGR"));c.equipmentWindow.close();c.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}},equipmentRecord:function(){var g=this;this.storeRecordBar={storeType:"waiting"};var a=[{name:"rid"},{name:"name"},{name:"meetingroom"},{name:"quantity"},{name:"takeper"},{name:"taketime"},{name:"returntime"},{name:"appdetails"}];this.equipmentRecordStore=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEquipmentRecordJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),sortInfo:{field:"rid",direction:"ASC"},groupOnSort:false,groupField:"appdetails",sortData:function(){},listeners:{exception:function(m,l,n,k,j,i){var h=Ext.decode(j.responseText);if(h.failure){CNOA.msg.alert(h.msg)}}}});var f=new Ext.PagingToolbar({displayInfo:true,store:this.equipmentRecordStore,pageSize:15});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"rid",dataIndex:"rid",hidden:true},{header:lang("meetName"),dataIndex:"appdetails",hidden:true},{header:lang("deviceName"),dataIndex:"name",width:150,sortable:true,menuDisabled:true},{header:lang("meetRoom"),dataIndex:"meetingroom",width:150,sortable:true,menuDisabled:true},{header:lang("retrievalAmount"),dataIndex:"quantity",width:150,sortable:true,menuDisabled:true},{header:lang("deviceExtracePerple"),dataIndex:"takeper",width:150,sortable:true,menuDisabled:true},{header:lang("extractionTime"),dataIndex:"taketime",width:120,sortable:true,menuDisabled:true},{header:lang("returnTime"),dataIndex:"returntime",width:100,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"rid",width:120,sortable:true,menuDisabled:true,renderer:this.confirm.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var c=new Ext.grid.GridPanel({region:"center",border:false,store:g.equipmentRecordStore,loadMask:{msg:lang("waiting")},cm:b,sm:e,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(h,i){g.equipmentRecordStore.reload()}},{text:lang("waitDeviceList"),cls:"btn-red1",iconCls:"icon-doc-list",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"meeting_room_equipment",handler:function(){g.storeRecordBar.storeType="waiting";g.equipmentRecordStore.load({params:g.storeRecordBar})}},{text:lang("needReturnDevice"),iconCls:"icon-doc-list",cls:"btn-blue4",enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_equipment",handler:function(){g.storeRecordBar.storeType="return";g.equipmentRecordStore.load({params:g.storeRecordBar})}},{text:lang("historyList"),iconCls:"icon-doc-list",cls:"btn-gray1",enableToggle:true,allowDepress:false,toggleGroup:"meeting_room_equipment",handler:function(){g.storeRecordBar.storeType="history";g.equipmentRecordStore.load({params:g.storeRecordBar})}}],bbar:f,view:new Ext.grid.GroupingView({forceFit:false,startCollapsed:true})});var d=new Ext.Window({title:lang("managementDevice"),width:1000,height:makeWindowHeight(625),modal:true,layout:"border",resizable:false,border:false,items:[c],buttons:[{text:lang("close"),handler:function(){d.close()}}]}).show()},operate:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_person.operateWin("+e+", \"use\")' ext:qtip='"+lang("setNumOfAvailable")+"'>"+lang("available")+"</a> / <a href='javascript:void(0)' onclick='CNOA_meeting_mgr_person.operateWin("+e+", \"unuse\")' ext:qtip='"+lang("setUnavailable")+"'>"+lang("unAvailable")+"</a> / <a href='javascript:void(0)' onclick='CNOA_meeting_mgr_person.operateWin("+e+", \"add\")' ext:qtip='"+lang("addNumberDevices")+"'><span class='cnoa_color_green'>"+lang("add")+"</span></a> / <a href='javascript:void(0)' onclick='CNOA_meeting_mgr_person.equipmentWin("+e+', "edit")\'>'+lang("modify")+"</a> / <a href='javascript:void(0)' onclick='CNOA_meeting_mgr_person.deleteEquipment("+e+")'><span class='cnoa_color_red'>"+lang("del")+"</span></a>"},viewDetail:function(f,d,a,g,c,e){var b=a.data.eid;return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_person.viewDetailWin("+b+")'>"+f+"</a>"},viewDetailWin:function(b){var e=this;var d=e.baseUrl+"&task=viewEquipmentDetails&eid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:230px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("seeMeetDeviceDetail"),width:720,height:240,resizable:false,modal:true,items:[a]}).show()},deleteEquipment:function(a){var b=this;CNOA.msg.cf(lang("sureRemoveDevice"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteEquipment",method:"POST",params:{eid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("delMeetRoomDevice"));b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},operateWin:function(a,b){if(b=="use"){title=lang("setOfAvailable")}else{if(b=="unuse"){title=lang("setDevUnavailable")}else{if(b=="add"){title=lang("addNumberDevices")}}}this.operateWinow=new Ext.MessageBox.promptWindow({title:title,multiline:false,txCfg:{allowBlank:false,regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum")},listeners:{submit:function(c,d){this.operateSubmit(d,a,b)}.createDelegate(this)}}).show()},operateSubmit:function(c,a,b){var d=this;Ext.Ajax.request({url:this.baseUrl+"&task=operateSubmit",method:"POST",params:{quantity:c,eid:a,type:b},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){d.operateWinow.close();d.store.reload()}else{CNOA.msg.alert(e.msg)}}})},confirm:function(e,c,a,g,b,d){var f=this;if(f.storeRecordBar.storeType=="waiting"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_person.confirmWin("+e+", \"need\")'><span ext:qtip='"+lang("setNeedReturn")+"'>"+lang("needReturn")+"</span></a><a href='javascript:void(0)' class='gridview3 jianju' onclick='CNOA_meeting_mgr_person.confirmWin("+e+", \"noneed\")'><span ext:qtip='"+lang("setDevNotRerurn")+"'>"+lang("doNotNeedReturn")+"</span></a>"}else{if(f.storeRecordBar.storeType=="return"){return"<a href='javascript:void(0)' class='gridview3' onclick='CNOA_meeting_mgr_person.confirmReturn("+e+")'>"+lang("devBeenReturn")+"</a>"}}},confirmWin:function(b,a){var c=this;var b=b;var a=a;if(a=="need"){title=lang("identifiReturnDev")}else{if(a=="noneed"){title=lang("doNotNeedReturnChange")}}CNOA.msg.cf(title,function(d){if(d=="yes"){Ext.Ajax.request({url:c.baseUrl+"&task=confirmsubmit",method:"POST",params:{rid:b,type:a},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){c.equipmentRecordStore.load()}else{CNOA.msg.alert(e.msg)}}})}})},confirmReturn:function(a){var b=this;CNOA.msg.cf(lang("deviceHasReturn"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=confirmReturn",method:"POST",params:{rid:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.equipmentRecordStore.load()}else{CNOA.msg.alert(d.msg)}}})}})}};var CNOA_meeting_mgr_setting,CNOA_meeting_mgr_settingClass;CNOA_meeting_mgr_settingClass=CNOA.Class.create();CNOA_meeting_mgr_settingClass.prototype={init:function(){var f=this;var e=Ext.id();var c=Ext.id();var a=Ext.id();var d=Ext.id();var b=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=setting";this.storeBar={storeType:"waiting",name:"",min:"",max:"",address:""};this.fields=[{name:"mid"},{name:"name"},{name:"contain"},{name:"address"},{name:"equipment"},{name:"descripts"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(l,k,m,j,i,h){var g=Ext.decode(i.responseText);if(g.failure){CNOA.msg.alert(g.msg)}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(g,h){if(f.storeBar.title!=""){h.name=f.storeBar.name}if(f.storeBar.stime!=""){h.min=f.storeBar.min}if(f.storeBar.etime!=""){h.max=f.storeBar.max}if(f.storeBar.people!=""){h.address=f.storeBar.address}h.storeType=f.storeBar.storeType}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"mid",dataIndex:"mid",hidden:true},{header:lang("meetRoom"),dataIndex:"name",width:120,sortable:true,menuDisabled:true,renderer:this.meetingroom.createDelegate(this)},{header:lang("meetRoom"),dataIndex:"contain",width:100,sortable:true,menuDisabled:true},{header:lang("meetRoomAddress"),dataIndex:"address",width:250,sortable:true,menuDisabled:true},{header:lang("meetRoomDev"),dataIndex:"equipment",width:250,sortable:true,menuDisabled:true},{header:lang("meetRoomDescription"),dataIndex:"descripts",width:240,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(g,h){var i=f.list.getSelectionModel().getSelections();if(i.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{f.type="edit";mid=i[0].get("mid");f.showmeetingroom(mid)}}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){f.store.reload()}},{text:lang("addMeetRoom"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){f.window("add",0)}},{text:lang("editMeetRoom"),iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(h,i){var j=f.list.getSelectionModel().getSelections();if(j.length==0){CNOA.miniMsg.alertShowAt(h,lang("mustSelectOneRow"))}else{var g=j[0].get("mid");f.window("edit",g)}}},{text:lang("delMeetRoom"),iconCls:"icon-utils-s-delete",cls:"btn-gray1",handler:function(g,h){var i=f.list.getSelectionModel().getSelections();if(i.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(k){if(k=="yes"){if(i){var l="";for(var j=0;j<i.length;j++){l+=i[j].get("mid")+",";var m=i[j];f.store.remove(m)}f.deleteData(l)}}})}}},{text:lang("meetApprover"),iconCls:"icon-channel-loginSet",cls:"btn-blue3",handler:function(g,h){f.checkWindow()}},{text:lang("addMeetCategory"),cls:"btn-blue3",iconCls:"icon-utils-s-add",handler:function(g,h){f.typeWindow()}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:4003}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.list],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("meetName")+":",{xtype:"textfield",width:168,id:e},lang("meetPeopleFrom")+":",{xtype:"textfield",width:168,regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt"),id:a},lang("to")+":",{xtype:"textfield",width:168,regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt"),id:d},lang("meetingAddress")+":",{xtype:"textfield",width:168,id:b},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){f.storeBar.name=Ext.getCmp(e).getValue();f.storeBar.min=Ext.getCmp(a).getRawValue();f.storeBar.max=Ext.getCmp(d).getRawValue();f.storeBar.address=Ext.getCmp(b).getValue();f.store.load({params:f.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(e).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");f.storeBar.name="";f.storeBar.min="";f.storeBar.max="";f.storeBar.address="";f.store.load({params:f.storeBar})}}]})})},loadFormData:function(a){var b=this;b.formPanel.getForm().load({url:b.baseUrl+"&task=loadFormData",method:"POST",params:{mid:a},success:function(c,d){},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){})}.createDelegate(this)})},window:function(c,a){var d=this;var b=[{xtype:"fieldset",title:lang("meetRoomInformation"),anchor:"99%",autoHeight:true,defaults:{xtype:"textfield"},items:[{fieldLabel:lang("meetRoom"),name:"name",inputType:"text",allowBlank:false,maxLength:200,width:480},{xtype:"textarea",width:480,height:50,readOnly:true,style:"margin-top:5px;",fieldLabel:lang("applyPermission"),blankText:lang("selectApplicant"),name:"applyers"},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:120px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("noteApplyPermission")}}),{xtype:"hidden",name:"applyIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:125px;margin-bottom:8px",text:lang("select"),listeners:{selected:function(g,h){var j=new Array();var f=new Array();if(h.length>0){for(var e=0;e<h.length;e++){j.push(h[e].uname);f.push(h[e].uid)}}d.formPanel.getForm().findField("applyers").setValue(j.join(","));d.formPanel.getForm().findField("applyIDs").setValue(f.join(","))},onrender:function(e){e.setSelectedUids(d.formPanel.getForm().findField("applyIDs").getValue().split(","))}}},{xtype:"textarea",width:480,height:50,readOnly:true,style:"margin-top:5px;",fieldLabel:lang("permit4Mgr"),allowBlank:false,blankText:lang("selectMGR"),name:"mgrers"},{xtype:"hidden",name:"mgrIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:125px;margin-bottom:8px",text:lang("select"),listeners:{selected:function(g,h){var j=new Array();var f=new Array();if(h.length>0){for(var e=0;e<h.length;e++){j.push(h[e].uname);f.push(h[e].uid)}}d.formPanel.getForm().findField("mgrers").setValue(j.join(","));d.formPanel.getForm().findField("mgrIDs").setValue(f.join(","))},onrender:function(e){e.setSelectedUids(d.formPanel.getForm().findField("mgrIDs").getValue().split(","))}}},{xtype:"textfield",name:"address",width:480,fieldLabel:lang("meetRoomAddress"),allowBlank:false},{xtype:"textfield",name:"contain",width:230,fieldLabel:lang("capacity"),regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt"),allowBlank:false},{xtype:"textarea",name:"equipment",width:480,height:80,fieldLabel:lang("devDescription")},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:125px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("hYSSBTJ")}}),{xtype:"textarea",name:"descripts",width:480,height:100,fieldLabel:lang("meetRoomDescription")},{xtype:"textarea",name:"notes",width:480,height:250,fieldLabel:lang("meetRoomMgrSys")},{xtype:"flashfile",fieldLabel:lang("attach"),name:"attach",inputPre:"filesUpload"}]}];this.formPanel=new Ext.form.FormPanel({border:false,labelWidth:120,labelAlign:"right",region:"center",autoScroll:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[b]}]});this.applyWin=new Ext.Window({title:lang("addMeetRoom"),width:800,height:makeWindowHeight(580),modal:true,layout:"border",resizable:false,border:false,items:[d.formPanel],buttons:[{text:lang("submit"),handler:function(){d.submit(c,a)}},{text:lang("cancel"),handler:function(){d.applyWin.close()}}]}).show();if(c=="edit"){d.loadFormData(a)}},submit:function(b,a){var c=this;if(c.formPanel.getForm().isValid()){c.formPanel.getForm().submit({url:c.baseUrl+"&task=submit&from="+b,params:{mid:a},waitMsg:lang("waiting"),method:"POST",success:function(d,e){CNOA.msg.notice(e.result.msg,lang("addMeetRoom"));c.applyWin.close();c.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}},loadCheckForm:function(){var a=this;a.formCheckPanel.getForm().load({url:a.baseUrl+"&task=loadCheckFormData",method:"POST",success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}.createDelegate(this)})},checkWindow:function(){var b=this;var a=[{xtype:"textarea",width:380,height:50,readOnly:true,style:"margin-top:5px;",fieldLabel:lang("approvalAuthority"),allowBlank:false,blankText:lang("selectMeetApprover"),name:"checkers"},{xtype:"hidden",name:"checkerIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,dataUrl:b.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:105px;margin-bottom:8px",text:lang("select"),listeners:{selected:function(e,f){var g=new Array();var d=new Array();if(f.length>0){for(var c=0;c<f.length;c++){g.push(f[c].uname);d.push(f[c].uid)}}b.formCheckPanel.getForm().findField("checkers").setValue(g.join(","));b.formCheckPanel.getForm().findField("checkerIDs").setValue(d.join(","))},onrender:function(c){c.setSelectedUids(b.formCheckPanel.getForm().findField("checkerIDs").getValue().split(","))}}}];this.formCheckPanel=new Ext.form.FormPanel({border:false,labelWidth:100,labelAlign:"right",region:"center",autoScroll:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 10px 10px;",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[a]}]});this.checkWin=new Ext.Window({title:lang("addMeetApprover"),width:600,height:220,modal:true,layout:"border",resizable:false,border:false,items:[b.formCheckPanel],buttons:[{text:lang("submit"),handler:function(){b.submitCheck()}},{text:lang("cancel"),handler:function(){b.checkWin.close()}}]}).show();this.loadCheckForm()},submitCheck:function(){var a=this;if(a.formCheckPanel.getForm().isValid()){a.formCheckPanel.getForm().submit({url:a.baseUrl+"&task=submitCheck",waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("meetRoomAppMgr"));a.checkWin.close()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},typeWindow:function(){var h=this;var e=Ext.data.Record.create([{name:"name",type:"string"}]);var b=[{name:"tid"},{name:"name"}];this.typeStore=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getTypeList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b}),listeners:{update:function(l,i,k){var j=i.data;if(k==Ext.data.Record.EDIT){h.submitType(j)}}}});var d=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=[new Ext.grid.RowNumberer(),g,{header:"",dataIndex:"tid",hidden:true},{header:lang("categoryName"),dataIndex:"name",width:400,sortable:true,editor:{xtype:"textfield",allowBlank:false}}];var c=new Ext.grid.GridPanel({store:h.typeStore,width:600,plain:false,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,plugins:[d],columns:a,stripeRows:true,view:new Ext.grid.GroupingView({markDirty:false}),tbar:[{handler:function(i,j){h.typeStore.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{iconCls:"icon-utils-s-add",text:lang("add"),tooltip:lang("addNewMeetType"),handler:function(){var i=new e({name:""});d.stopEditing();h.typeStore.insert(0,i);c.getView().refresh();c.getSelectionModel().selectRow(0);d.startEditing(0)}},{iconCls:"icon-utils-s-delete",text:lang("del"),tooltip:lang("delRecord"),handler:function(i){d.stopEditing();var j=c.getSelectionModel().getSelections();if(j.length==0){CNOA.miniMsg.alertShowAt(i,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("delWantMeet"),function(l){if(l=="yes"){if(j){var m="";for(var k=0;k<j.length;k++){m+=j[k].get("tid")+",";var n=j[k];h.typeStore.remove(n)}h.deleteTypeData(m)}}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>"]});var f=new Ext.Window({title:lang("addMeetCategory"),width:800,height:makeWindowHeight(580),modal:true,layout:"border",resizable:false,border:false,items:[c],buttons:[{text:lang("close"),handler:function(){f.close()}}]}).show()},submitType:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=submitType",method:"POST",params:a,success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("addMeetCategories"));b.typeStore.reload()}else{CNOA.msg.alert(c.msg)}}})},deleteTypeData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteTypeData",method:"POST",params:{tids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("delMeetRoomCate"));b.typeStore.reload()}else{CNOA.msg.alert(c.msg)}}})},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteMeetingRoom",method:"POST",params:{mids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("delMeetingRoom"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},meetingroom:function(f,d,a,g,b,e){var c=a.data;return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_setting.showmeetingroom("+c.mid+");'>"+f+"</a>"},showmeetingroom:function(b){var e=this;var d=e.baseUrl+"&task=viewMeetingRoom&mid="+b;var c=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:570px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+c+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(c).contentWindow.location.href=d}}});var c=new Ext.Window({title:lang("viewMeetInformation"),width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a]}).show()},meetingaddress:function(e,c,a,f,b,d){},meetingequitment:function(e,c,a,f,b,d){},meetingdescripts:function(e,c,a,f,b,d){}};var CNOA_meeting_mgr_meetingClass,CNOA_meeting_mgr_meeting;CNOA_meeting_mgr_meetingClass=CNOA.Class.create();CNOA_meeting_mgr_meetingClass.prototype={init:function(){var e=this;var c=Ext.id();var d=Ext.id();var a=Ext.id();var b=Ext.id();this.baseUrl="index.php?app=meeting&func=mgr&action=meeting";this.storeBar={storeType:"waiting",title:"",name:"",stime:"",etime:""};this.fields=[{name:"rid"},{name:"aid"},{name:"name"},{name:"markname"},{name:"title"},{name:"stime"},{name:"etime"},{name:"statusname"},{name:"appname"},{name:"checktime"},{name:"opinion"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(k,j,l,i,h,g){var f=Ext.decode(h.responseText);if(f.failure){CNOA.msg.alert(f.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(f,g){Ext.apply(g,e.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"rid",dataIndex:"rid",hidden:true},{header:lang("meetName"),dataIndex:"name",width:100,sortable:true,menuDisabled:true,renderer:this.showDetails.createDelegate(this)},{header:lang("theme"),dataIndex:"title",width:200,sortable:true,menuDisabled:true},{header:lang("meetStartTime"),dataIndex:"stime",width:120,sortable:true,menuDisabled:true},{header:lang("meetEndTime"),dataIndex:"etime",width:120,sortable:true,menuDisabled:true},{header:lang("distributeOpinions"),dataIndex:"opinion",width:200,sortable:true,menuDisabled:true,renderer:this.opinion.createDelegate(this)},{header:lang("opt"),dataIndex:"aid",width:120,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{handler:function(f,g){e.storeBar.storeType="waiting";e.store.load({params:e.storeBar})}.createDelegate(this),iconCls:"icon-waitRead",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayDocRead"),cls:"btn-blue4",text:lang("waitRead")},{handler:function(f,g){e.storeBar.storeType="readed";e.store.load({params:e.storeBar})}.createDelegate(this),iconCls:"icon-haveRead",enableToggle:true,cls:"btn-red1",allowDepress:false,toggleGroup:"meeting_room_check",tooltip:lang("displayHasBeenRead"),text:lang("haveRead")},"->",{xtype:"cnoa_helpBtn",helpid:4002}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid],tbar:[lang("meetName")+": ",{xtype:"textfield",width:100,id:d},lang("theme")+": ",{xtype:"textfield",width:100,id:c},lang("meetStartTime")+": ",{xtype:"datefield",width:150,format:"Y-m-d",id:a},lang("meetEndTime")+": ",{xtype:"datefield",width:150,format:"Y-m-d",id:b},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){e.storeBar.title=Ext.getCmp(c).getValue();e.storeBar.name=Ext.getCmp(d).getValue();e.storeBar.stime=Ext.getCmp(a).getRawValue();e.storeBar.etime=Ext.getCmp(b).getRawValue();e.store.load({params:e.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(c).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");e.storeBar.title="";e.storeBar.name="";e.storeBar.stime="";e.storeBar.etime="";e.store.load({params:e.storeBar})}}]})},showDetails:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_meeting.showDetailsWin("+a.data.rid+", "+a.data.aid+")'>"+e+"</a>"},showDetailsWin:function(b,c){var f=this;if(f.storeBar.storeType=="waiting"){Ext.Ajax.request({url:this.baseUrl+"&task=readed",method:"POST",params:{rid:b},success:function(h){var g=Ext.decode(h.responseText);if(g.success===true){}else{CNOA.msg.alert(g.msg)}}})}var e=f.baseUrl+"&task=viewMeetingRoomApplyDetails&aid="+c;var d=Ext.id();var a=new Ext.Panel({border:false,html:'<div style="width:100%;height:570px;"><iframe scrolling=auto frameborder=0 width=100% height=100% id="'+d+'"></iframe></div>',listeners:{afterrender:function(){Ext.getDom(d).contentWindow.location.href=e}}});var d=new Ext.Window({title:"查看会议详细信息",width:800,height:makeWindowHeight(600),resizable:false,modal:true,items:[a],buttons:[{text:lang("close"),handler:function(g,h){if(f.storeBar.storeType=="waiting"){CNOA.msg.alert("您阅读的会议信息已经转移到已阅读列表中,可在已阅读列表中查看",function(){d.close()})}else{d.close()}}}],listeners:{beforeclose:function(g){if(f.storeBar.storeType=="waiting"){f.store.reload()}}}}).show()},operate:function(b,d,a){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_meeting_mgr_meeting.read("+a.data.aid+")'>阅读情况</a>"},opinion:function(b,e,a){var d=this;return"<a href='javascript:void(0)' onclick='CNOA_meeting_mgr_meeting.viewopinion(\""+b+"\")'>"+b+"</a>"},viewopinion:function(a){var b=this;CNOA.msg.alert(a)},read:function(e){var h=this;var a=[{name:"deptname"},{name:"name"},{name:"readtime"}];var c=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getReaderList&aid="+e,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});c.load();var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var d=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"所属部门",dataIndex:"deptname",width:100,sortable:true,menuDisabled:true},{header:"名字",dataIndex:"name",width:100,sortable:false,menuDisabled:true},{header:"阅读日期",dataIndex:"readtime",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var b=new Ext.grid.GridPanel({stripeRows:true,store:c,region:"center",layout:"fit",loadMask:{msg:lang("waiting")},cm:d,sm:g,hideBorders:true,border:false,viewConfig:{forceFit:true}});var f=new Ext.Window({title:"阅读情况",layout:"border",width:600,height:makeWindowHeight(500),resizable:false,modal:true,items:[b],buttons:[{text:lang("close"),handler:function(){f.close()}}]}).show()}};var sm_user_meeting=1;
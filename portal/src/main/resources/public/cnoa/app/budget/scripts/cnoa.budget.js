var CNOA_budget_setting_deptClass,CNOA_budget_setting_dept;CNOA_budget_setting_deptClass=CNOA.Class.create();CNOA_budget_setting_deptClass.prototype={init:function(){var a=this;a.countSum_ID=Ext.id();a.baseUrl="index.php?app=budget&func=setting&action=dept";this.mainPanel=new Ext.ux.tree.TreeGrid({border:false,animate:false,dataUrl:this.baseUrl+"&task=loadList",columns:[{header:lang("department"),width:410,dataIndex:"text"},{header:lang("budgetAmountYuan"),dataIndex:"total",width:100},{header:lang("useAmounYuan"),dataIndex:"usedSum",width:100},{header:lang("usableAmountYuan"),dataIndex:"balance",width:100},{header:lang("budgetSet"),dataIndex:"deptId",width:100,tpl:new Ext.XTemplate("{deptId:this.formatOpera}",{formatOpera:function(b){if(b.length<=0){return""}var c="<a class='gridview' onclick=\"CNOA_budget_setting_dept.settingBudget("+b+", 'update')\">"+lang("increment")+"</a>";c+="<a  class='gridview2 jianju' onclick=\"CNOA_budget_setting_dept.settingBudget("+b+", 'reset')\">"+lang("reset")+"</a>";return c}})}],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){a.mainPanel.root.reload();a.getTotalSum()}},{xtype:"box",id:a.countSum_ID,style:"margin-left:10px;color:red",autoEl:{tag:"b"}}]})});a.getTotalSum();this.mainPanel.loader.on("load",function(e,d,f){d.expand(true)})},getTotalSum:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=getTotalSum",success:function(b){var c=parseFloat(Ext.decode(b.responseText),10)||0;Ext.getCmp(a.countSum_ID).update(lang("allBudget")+"："+c)}})},settingBudget:function(d,b){var c=this;var a=new Ext.form.FormPanel({labelAlign:"right",padding:20,border:false,items:[{xtype:"numberfield",fieldLabel:lang("budgetAmount"),name:"total",allowBlank:false}]}),e=function(){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=updateBudget",method:"POST",params:{deptId:d,opt:b},waitMsg:lang("notice"),success:function(f,g){CNOA.msg.notice2(g.result.msg);c.mainPanel.root.reload();c.getTotalSum();win.close()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};win=new Ext.Window({title:lang("budgetSet"),modal:true,layout:"fit",width:300,height:150,items:a,buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:e},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){win.close()}}]}).show()}};var CNOA_budget_setting_projClass,CNOA_budget_setting_proj;CNOA_budget_setting_projClass=CNOA.Class.create();CNOA_budget_setting_projClass.prototype={init:function(){var a=this;a.countSum_ID=Ext.id();a.baseUrl="index.php?app=budget&func=setting&action=proj";this.mainPanel=new Ext.ux.tree.TreeGrid({border:false,animate:false,dataUrl:this.baseUrl+"&task=loadList",columns:[{header:lang("department"),width:410,dataIndex:"text"},{header:lang("opt"),dataIndex:"deptId",width:100,tpl:new Ext.XTemplate("{deptId:this.formatOpera}",{formatOpera:function(b){if(b.length<=0){return""}var c="<a  class='gridview' href='javascript:void(0);' onclick=\"CNOA_budget_setting_proj.projectList("+b+')">項目列表</a>';return c}})}],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){a.mainPanel.root.reload();a.getTotalSum()}},{xtype:"box",id:a.countSum_ID,style:"margin-left:10px;color:red",autoEl:{tag:"b"}}]})});a.getTotalSum();this.mainPanel.loader.on("load",function(e,d,f){d.expand(true)})},getTotalSum:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=getTotalSum",success:function(b){var c=parseFloat(Ext.decode(b.responseText),10)||0;Ext.getCmp(a.countSum_ID).update(lang("allBudget")+"："+c)}})},projectList:function(g){var f=this;var c=[{name:"projId"},{name:"name"},{name:"total"},{name:"usedSum"},{name:"balance"}];this.projStore=new Ext.data.Store({autoLoad:{params:{deptId:g}},proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=projectList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c}),listeners:{update:function(j,i,k){if(k==Ext.data.Record.EDIT){Ext.Ajax.request({url:f.baseUrl+"&task=editProject",params:{deptId:g,name:i.get("name"),projId:i.get("projId")},success:function(l){var m=Ext.decode(l.responseText);if(m.success==true){CNOA.msg.notice2(m.msg)}else{if(m.failure==true){CNOA.msg.alert(m.msg)}}f.projStore.reload()}})}}}});var b=function(l,k,i){if(i.json){var m=i.json.projId;var j="<a  class='cnoa_selector_item' onclick=\"CNOA_budget_setting_proj.settingBudget("+m+", 'update')\">"+lang("increment")+"</a><a  class='cnoa_selector_item' onclick=\"CNOA_budget_setting_proj.settingBudget("+m+", 'reset')\">"+lang("reset")+"</a><a  class='cnoa_selector_item' onclick=\"CNOA_budget_setting_proj.delProj("+m+')">'+lang("del")+"</a>";return j}};var a=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),{header:"projId",dataIndex:"projId",hidden:true},{header:lang("projectName"),dataIndex:"name",width:390,editor:true},{header:lang("budgetAmountYuan"),dataIndex:"total",width:100},{header:lang("useAmounYuan"),dataIndex:"usedSum",width:90},{header:lang("usableAmountYuan"),dataIndex:"balance",width:90},{header:lang("budgetSet"),dataIndex:"",width:140,renderer:b}]});var e=new Ext.ux.grid.RowEditor({saveText:lang("ok"),cancelText:lang("cancel")});var d=new Ext.grid.EditorGridPanel({border:false,cm:a,autoScroll:true,store:f.projStore,plugins:[e],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.projStore.reload()}},{text:lang("add")+lang("project"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){var i=new f.projStore.recordType({projId:"",name:""});e.stopEditing();d.store.insert(0,i);e.startEditing(0)}}]})});var h=new Ext.Window({border:false,layout:"fit",width:860,height:400,modal:true,items:[d]});h.show()},settingBudget:function(c,b){var d=this;var a=new Ext.form.FormPanel({labelAlign:"right",padding:20,border:false,items:[{xtype:"numberfield",fieldLabel:lang("budgetAmount"),name:"total",allowBlank:false}]}),e=function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=updateBudget",method:"POST",params:{projId:c,opt:b},waitMsg:lang("notice"),success:function(f,g){CNOA.msg.notice2(g.result.msg);d.projStore.reload();win.close()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};win=new Ext.Window({title:lang("budgetSet"),modal:true,layout:"fit",width:300,height:150,items:a,buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:e},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){win.close()}}]}).show()},delProj:function(a){var b=this;CNOA.msg.cf("确定要删除该项目吗?",function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=delBudgetProj",method:"POST",params:{projId:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.projStore.reload()}else{CNOA.msg.alert(d.msg)}}})}})}};var CNOA_budget_record_applyClass,CNOA_budget_record_apply;CNOA_budget_record_applyClass=CNOA.Class.create();CNOA_budget_record_applyClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=budget&func=record&action=apply";this.model="dept";a.mainPanel=a.getRecordPanel()},getRecordPanel:function(){var f=this;var m={},c=Ext.id(),h=Ext.id(),b=Ext.id(),a=Ext.id(),g=Ext.id(),l=Ext.id(),e=Ext.id(),k=Ext.id();ID_search_projName=Ext.id();var d=[{name:"id"},{name:"deptName"},{name:"truename"},{name:"sum"},{name:"applyTime"},{name:"activateTime"}],j=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getApplyRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})}),i=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("name")+"("+lang("department")+"/"+lang("project")+")",dataIndex:"deptName",width:170},{header:lang("proposer"),dataIndex:"truename"},{header:lang("amountRequestYuan"),dataIndex:"sum"},{header:lang("appTime"),dataIndex:"applyTime"},{header:lang("enableTime"),dataIndex:"activateTime"}]});return new Ext.grid.PageGridPanel({border:false,hideBorders:true,loadMask:{msg:lang("waiting")},store:j,cm:i,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){j.reload()}},{text:lang("department"),enableToggle:true,allowDepress:false,toggleGroup:"GROUP_BTN_STEP",pressed:true,handler:function(){f.model="dept";Ext.getCmp(ID_search_projName).setValue("");Ext.getCmp(h).show();Ext.getCmp(ID_search_projName).hide();j.reload({params:{model:f.model}})}},{text:lang("project"),enableToggle:true,allowDepress:false,toggleGroup:"GROUP_BTN_STEP",handler:function(){f.model="project";Ext.getCmp(c).setValue("");Ext.getCmp(h).hide();Ext.getCmp(ID_search_projName).show();j.reload({params:{model:f.model}})}},lang("name"),{xtype:"textfield",id:h,readOnly:true,width:100,listeners:{render:function(n){n.to=c},focus:function(n){people_selector("dept",n,false,false)}}},{xtype:"hidden",id:c},{xtype:"textfield",name:"projectName",width:100,hidden:true,id:ID_search_projName},lang("proposer"),{xtype:"textfield",id:b,readOnly:true,width:100,listeners:{render:function(n){n.to=a},focus:function(n){people_selector("user",n,false,false)}}},{xtype:"hidden",id:a},lang("appTime"),{xtype:"datefield",id:g,format:"Y-m-d"},lang("to"),{xtype:"datefield",id:l,format:"Y-m-d"},lang("enableTime"),{xtype:"datefield",id:e,format:"Y-m-d"},lang("to"),{xtype:"datefield",id:k,format:"Y-m-d"},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){if(f.model=="dept"){m.deptId=Ext.getCmp(c).getValue()}else{if(f.model=="project"){m.projectName=Ext.getCmp(ID_search_projName).getValue()}}m.model=f.model;m.applyUid=Ext.getCmp(a).getValue();m.applyStime=Ext.getCmp(g).getRawValue();m.applyEtime=Ext.getCmp(l).getRawValue();m.activateStime=Ext.getCmp(e).getRawValue();m.activateEtime=Ext.getCmp(k).getRawValue();j.load({params:m})}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){Ext.getCmp(c).setValue("");Ext.getCmp(h).setValue("");Ext.getCmp(ID_search_projName).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(g).setValue("");Ext.getCmp(l).setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(k).setValue("");m={};m.model=f.model;j.load({params:m})}}]})})}};var CNOA_budget_record_setClass,CNOA_budget_record_set;CNOA_budget_record_setClass=CNOA.Class.create();CNOA_budget_record_setClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=budget&func=record&action=set";this.model="dept";a.mainPanel=a.getRecordPanel()},getRecordPanel:function(){var d=this;var j={},c=Ext.id(),a=Ext.id(),e=Ext.id(),f=Ext.id(),i=Ext.id();ID_search_projName=Ext.id();var b=[{name:"id"},{name:"type"},{name:"deptName"},{name:"sum"},{name:"posttime"},{name:"truename"}],h=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getSetRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})}),g=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("editType"),dataIndex:"type",renderer:function(k){return k==1?lang("increment"):lang("reset")}},{header:lang("name")+"("+lang("department")+"/"+lang("project")+")",dataIndex:"deptName"},{header:lang("editAmountYuan"),dataIndex:"sum"},{header:lang("editTime"),dataIndex:"posttime",width:120},{header:lang("editBy"),dataIndex:"truename"}]});return new Ext.grid.PageGridPanel({border:false,hideBorders:true,loadMask:{msg:lang("waiting")},store:h,cm:g,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){h.reload()}},{text:lang("department"),enableToggle:true,allowDepress:false,toggleGroup:"GROUP_BTN_STEP",pressed:true,handler:function(){d.model="dept";Ext.getCmp(ID_search_projName).setValue("");Ext.getCmp(e).show();Ext.getCmp(ID_search_projName).hide();h.reload({params:{model:d.model}})}},{text:lang("project"),enableToggle:true,allowDepress:false,toggleGroup:"GROUP_BTN_STEP",handler:function(){d.model="project";Ext.getCmp(a).setValue("");Ext.getCmp(e).hide();Ext.getCmp(ID_search_projName).show();h.reload({params:{model:d.model}})}},lang("type"),{xtype:"combo",id:c,valueField:"id",displayField:"type",mode:"local",width:100,triggerAction:"all",forceSelection:true,editable:false,store:new Ext.data.ArrayStore({fields:["id","type"],data:[[1,lang("increment")],[2,lang("reset")]]})},lang("name"),{xtype:"textfield",id:e,readOnly:true,width:100,listeners:{render:function(k){k.to=a},focus:function(k){people_selector("dept",k,false,false)}}},{xtype:"hidden",id:a},{xtype:"textfield",name:"projectName",width:100,hidden:true,id:ID_search_projName},lang("editTime"),{xtype:"datefield",id:f,format:"Y-m-d"},lang("to"),{xtype:"datefield",id:i,format:"Y-m-d"},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){if(d.model=="dept"){j.deptId=Ext.getCmp(a).getValue()}else{if(d.model=="project"){j.projectName=Ext.getCmp(ID_search_projName).getValue()}}j.model=d.model;j.type=Ext.getCmp(c).getValue();j.stime=Ext.getCmp(f).getRawValue();j.etime=Ext.getCmp(i).getRawValue();h.load({params:j})}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(ID_search_projName).setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(f).setValue("");Ext.getCmp(i).setValue("");j={};j.model=d.model;h.load({params:j})}}]})})}};var sm_budget_mgr=1;
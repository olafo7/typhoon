var CNOA_communication_message_index_draftsClass,CNOA_communication_message_index_drafts;CNOA_communication_message_index_draftsClass=CNOA.Class.create();CNOA_communication_message_index_draftsClass.prototype={init:function(){var a=this;this.actionFolder="inbox";this.baseUrl="index.php?app=communication&func=message&action=index";this.ID_grid_drafts=Ext.id();this.ID_btn_delete_drafts=Ext.id();this.fieldsDrafts=[{name:"id"},{name:"attach"},{name:"receiver"},{name:"title"},{name:"content"},{name:"posttime"}];this.storeDrafts=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listDrafts"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsDrafts})});this.storeDrafts.load();this.smDrafts=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModelDrafts=new Ext.grid.ColumnModel([this.smDrafts,{header:"id",dataIndex:"id",width:20,sortable:true,hidden:true},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attach",width:34,sortable:true,menuDisabled:true,resizable:false,renderer:this.attachCheck,tooltip:lang("attach")},{header:lang("receiver"),dataIndex:"receiver",width:100,sortable:false,menuDisabled:true},{header:lang("title"),dataIndex:"title",width:180,sortable:false,menuDisabled:true},{header:lang("content"),dataIndex:"content",width:340,sortable:false,menuDisabled:true},{header:lang("posttime"),dataIndex:"posttime",width:120,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBarDrafts=new Ext.PagingToolbar({displayInfo:true,plugins:[new Ext.grid.plugins.ComboPageSize()],store:this.storeDrafts,pageSize:15,listeners:{beforechange:function(b,c){c.task="list";c.folder="outbox"}}});this.gridDrafts=new Ext.grid.GridPanel({stripeRows:true,id:this.ID_grid_drafts,store:this.storeDrafts,loadMask:{msg:lang("waiting")},cm:this.colModelDrafts,sm:this.smDrafts,hideBorders:true,border:false,viewConfig:{forceFit:true},listeners:{rowdblclick:function(b,c){},rowclick:function(b,d,c){},cellclick:function(c,g,d,f){var b=c.getStore().getAt(g);if(d!=0){a.draftsLoad()}}},tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(b,c){a.storeDrafts.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:a.ID_btn_delete_drafts,text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){a.deleteMessage()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:3}]}),bbar:this.pagingBarDrafts});this.centerPanel=new Ext.Panel({border:false,region:"center",layout:"fit",items:[this.gridDrafts]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},attachCheck:function(a){if(a==1){return'<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}else{return""}},deleteMessage:function(){var h=this;var e="drafts";var g,c;var g=h.ID_btn_delete_drafts;var c=h.gridDrafts;var a=Ext.getCmp(g).getEl().getBox();a=[a.x+12,a.y+26];var f=c.getSelectionModel().getSelections();if(f.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var d=new Array();for(var b=0;b<f.length;b++){d.push(f[b].get("id"))}CNOA.miniMsg.show({msg:lang("confirmToDelete"),xy:a,modal:false,fn:function(i){if(i=="confirm"){Ext.Ajax.request({url:h.baseUrl,method:"POST",params:{ids:d.join(","),task:"delete",folder:e},success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){CNOA.msg.notice2(j.msg);c.store.reload()}else{CNOA.msg.alert(j.msg)}}})}}})}},draftsLoad:function(){var c=this;var a=c.gridDrafts.getSelectionModel().getSelections();var b=a[0].get("id");mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_NEW");mainPanel.loadClass("index.php?app=communication&func=message&action=newMessage&job=loadDrafts&id="+b,"CNOA_MENU_COMMUNICATION_MESSAGE_NEW",lang("sendMsg"),"icon-new-sms")}};var CNOA_communication_message_index_inboxClass,CNOA_communication_message_index_inbox;CNOA_communication_message_index_inboxClass=CNOA.Class.create();CNOA_communication_message_index_inboxClass.prototype={init:function(){try{resetDocumentTitle()}catch(a){}var b=this;this.actionFolder="inbox";this.baseUrl="index.php?app=communication&func=message&action=index";this.ID_grid_inbox=Ext.id();this.ID_btn_delete_inbox=Ext.id();this.ID_COMBOX_SMSFOLDERLIST=Ext.id();this.ID_text_title=Ext.id();this.storeBar={srcmail:0,folder:0,title:"",senderId:"",content:""};this.fieldsInbox=[{name:"id"},{name:"sid"},{name:"smstype"},{name:"isread"},{name:"attach"},{name:"sender"},{name:"title"},{name:"content"},{name:"posttime"}];this.smsFolderStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSmsFolderList&from=combo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"fid"},{name:"name"}]}),listeners:{load:function(e,c,d){}}});this.storeInbox=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listInBox",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsInbox})});this.storeInbox.load();this.smInbox=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModelInbox=new Ext.grid.ColumnModel([this.smInbox,{header:"id",dataIndex:"id",hidden:true},{header:"sid",dataIndex:"sid",hidden:true},{header:"smstype",dataIndex:"smstype",hidden:true},{header:'<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />',dataIndex:"isread",width:34,sortable:true,menuDisabled:true,renderer:this.statusCheck.createDelegate(this)},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attach",width:34,sortable:true,menuDisabled:true,resizable:false,renderer:this.attachCheck,tooltip:lang("attach")},{header:lang("sender"),dataIndex:"sender",width:200,sortable:false,menuDisabled:true,renderer:this.contentCheck.createDelegate(this)},{header:lang("title"),dataIndex:"title",width:180,sortable:false,menuDisabled:true,renderer:this.contentCheck.createDelegate(this)},{header:lang("content"),dataIndex:"content",width:340,sortable:false,menuDisabled:true,renderer:this.contentCheck.createDelegate(this)},{header:lang("posttime"),dataIndex:"posttime",width:120,sortable:false,menuDisabled:true,renderer:this.contentCheck.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBarInbox=new Ext.PagingToolbar({displayInfo:true,plugins:[new Ext.grid.plugins.ComboPageSize()],store:this.storeInbox,pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.storeBar)}}});this.gridInbox=new Ext.grid.GridPanel({stripeRows:true,id:this.ID_grid_inbox,store:this.storeInbox,loadMask:{msg:lang("waiting")},cm:this.colModelInbox,sm:this.smInbox,hideBorders:true,border:false,viewConfig:{forceFit:true},listeners:{cellclick:function(d,i,f,g){var c=d.getStore().getAt(i);b.rowClick(d,c);if(f!=0){var h=c.data.smstype=="sys"?c.data.sid:c.data.id;b.view(h,c.data.smstype)}}},tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(c,d){b.storeInbox.load()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:b.ID_btn_delete_inbox,text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c,d){b.deleteMessage()}.createDelegate(this)},{text:lang("unreadEmail"),cls:"btn-yellow1",iconCls:"icon-email-unread",handler:function(){b.storeInbox.load({params:{notRead:1}})}},new Ext.form.ComboBox({style:"margin-left:3px;",id:this.ID_COMBOX_SMSFOLDERLIST,store:this.smsFolderStore,emptyText:lang("moveTO"),valueField:"fid",displayField:"name",hiddenName:"folder",mode:"local",width:180,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,c,d){var g=b.gridInbox.getSelectionModel().getSelections();if(g.length==0){CNOA.miniMsg.alertShowAt(h,lang("mustSelectOneRow"))}else{var f=new Array();for(var e=0;e<g.length;e++){f.push(g[e].get("id"))}b.moveSmsListTo(c.data.fid,f)}h.clearValue()}}})]}),bbar:this.pagingBarInbox});this.ID_text_sender=Ext.id();this.ID_text_senderId=Ext.id();this.ID_text_content=Ext.id();this.centerPanel=new Ext.Panel({border:false,region:"center",layout:"fit",items:[this.gridInbox],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("title")+":",{xtype:"textfield",width:123,name:"title",id:b.ID_text_title},lang("sender")+":",{xtype:"textfield",width:123,name:"sender",id:b.ID_text_sender,listeners:{focus:function(c){var d="input[name="+c.name+"]";$(d).attr("to",b.ID_text_senderId);wf_selector("user",d,true)}}},{xtype:"hidden",id:b.ID_text_senderId,name:"senderId"},lang("content")+":",{xtype:"textfield",name:"content",id:b.ID_text_content},{text:lang("search"),handler:function(){b.storeBar.title=Ext.getCmp(b.ID_text_title).getValue();b.storeBar.senderId=Ext.getCmp(b.ID_text_senderId).getValue();b.storeBar.content=Ext.getCmp(b.ID_text_content).getValue();b.storeInbox.load({params:b.storeBar})}},{text:lang("clear"),handler:function(){Ext.getCmp(b.ID_text_title).setValue("");Ext.getCmp(b.ID_text_senderId).setValue("");Ext.getCmp(b.ID_text_sender).setValue("");Ext.getCmp(b.ID_text_content).setValue("");b.storeBar.title="";b.storeBar.senderId="";b.storeBar.content="";b.storeInbox.load()}}]})});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("folder"),expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSmsFolderTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){}.createDelegate(this)}});this.folderTree=new Ext.tree.TreePanel({rootVisible:false,split:true,region:"west",width:120,hideBorders:true,border:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,bodyStyle:"border-right-width:1px;",listeners:{click:function(c){b.storeBar.folder=c.attributes.fid;b.storeInbox.load({params:b.storeBar})}},tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(c,d){this.treeRoot.reload()}.createDelegate(this),tooltip:lang("refresh"),text:lang("refresh")},"->",lang("folder")]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.folderTree,this.centerPanel]})},moveSmsListTo:function(b,a){var c=this;Ext.Ajax.request({url:c.baseUrl,method:"POST",params:{ids:a.join(","),task:"moveToSmsFolder",folder:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);c.storeInbox.reload();c.treeRoot.reload()}else{CNOA.msg.alert(d.msg)}}})},attachCheck:function(a){if(a==1){return'<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}else{return""}},rowClick:function(d,b){var a=d.getEl().query("span[gridid="+this.actionFolder+"_"+b.data.id+"]");for(var c=0;c<a.length;c++){a[c].style.fontWeight="normal"}try{var g=d.getEl().query("img[gridid="+this.actionFolder+"_"+b.data.id+"]");g[0].src="./resources/images/icons/sms-readed.gif"}catch(f){}},contentCheck:function(c,f,b){var a="";try{c=c.replace(new RegExp("<br />","g"),"\n");c=c.replace(/<\/div>(.*)$/gi,"")}catch(d){c=lang("userNotExists")}if(b.data.isread==0){a="font-weight: bold;"}return String.format('<span style="{1}"" gridid="{3}_{2}">{0}</span>',c,a,b.data.id,this.actionFolder)},statusCheck:function(b,c,a){if(b==1){return'<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />'}else{return'<img src="./resources/images/icons/sms-unread.gif" width="16" height="16" gridid="'+this.actionFolder+"_"+a.data.id+'" />'}},deleteMessage:function(){var h=this;var e="inbox";var g,c;var g=h.ID_btn_delete_inbox;var c=h.gridInbox;var a=Ext.getCmp(g).getEl().getBox();a=[a.x+12,a.y+26];var f=c.getSelectionModel().getSelections();if(f.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var d=new Array();for(var b=0;b<f.length;b++){d.push(f[b].get("id"))}CNOA.miniMsg.show({msg:lang("confirmToDelete"),xy:a,modal:false,fn:function(i){if(i=="confirm"){Ext.Ajax.request({url:h.baseUrl,method:"POST",params:{ids:d.join(","),task:"delete",folder:e},success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){CNOA.msg.notice2(j.msg);c.store.reload()}else{CNOA.msg.alert(j.msg)}}})}}})}},view:function(c,a){var b=CNOA_USER_UID;mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_VIEW");mainPanel.loadClass("index.php?app=communication&func=message&action=index&task=loadPage&from=view&folder=inbox&smstype="+a+"&id="+c+"&uid="+b+"&isMonitor=0","CNOA_MENU_COMMUNICATION_MESSAGE_VIEW",lang("viewMsg"),"icon-cnoa-mail")}};var CNOA_communication_message_index_outboxClass,CNOA_communication_message_index_outbox;CNOA_communication_message_index_outboxClass=CNOA.Class.create();CNOA_communication_message_index_outboxClass.prototype={init:function(){var a=this;this.actionFolder="inbox";this.baseUrl="index.php?app=communication&func=message&action=index";this.ID_grid_outbox=Ext.id();this.ID_btn_delete_outbox=Ext.id();this.ID_text_title=Ext.id();this.storeBar={title:"",receiverId:"",content:""};this.fieldsOutbox=[{name:"id"},{name:"attach"},{name:"receiver"},{name:"title"},{name:"content"},{name:"posttime"},{name:"readed"}];this.storeOutbox=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listOutBox"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsOutbox})});this.storeOutbox.load();this.smOutbox=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModelOutbox=new Ext.grid.ColumnModel([this.smOutbox,{header:"id",dataIndex:"id",width:20,sortable:true,hidden:true},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attach",width:34,sortable:true,menuDisabled:true,resizable:false,renderer:this.attachCheck,tooltip:lang("attach")},{header:lang("receiver"),dataIndex:"receiver",width:200,sortable:false,menuDisabled:true},{header:lang("title"),dataIndex:"title",width:180,sortable:false,menuDisabled:true},{header:lang("content"),dataIndex:"content",width:340,sortable:false,menuDisabled:true},{header:lang("receiverReadNum"),dataIndex:"readed",width:80,sortable:false,menuDisabled:true,renderer:this.reader.createDelegate(this)},{header:lang("posttime"),dataIndex:"posttime",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"id",width:120,sortable:false,menuDisabled:true,renderer:function(b){return'<a href="javascript:void(0)" class="gridview2" onclick="CNOA_communication_message_index_outbox.operate('+b+')">'+lang("recell")+"</a>"}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBarOutbox=new Ext.PagingToolbar({displayInfo:true,plugins:[new Ext.grid.plugins.ComboPageSize()],store:this.storeOutbox,pageSize:15,listeners:{beforechange:function(b,c){c.task="list";c.folder="outbox"}}});this.gridOutbox=new Ext.grid.GridPanel({stripeRows:true,id:this.ID_grid_outbox,store:this.storeOutbox,loadMask:{msg:lang("waiting")},cm:this.colModelOutbox,sm:this.smOutbox,hideBorders:true,border:false,viewConfig:{forceFit:true},listeners:{rowdblclick:function(b,c){},cellclick:function(c,h,d,f){var b=c.getStore().getAt(h);if(d!=0&&d!=6&&d!=8){var g=b.data.smstype=="sys"?b.data.sid:b.data.id;a.view(g,b.data.smstype)}}},tbar:new Ext.Toolbar({items:[{id:this.ID_btn_refreshList,handler:function(b,c){a.storeOutbox.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{id:a.ID_btn_delete_outbox,text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){a.deleteMessage()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:5}]}),bbar:this.pagingBarOutbox});this.ID_text_conent=Ext.id();this.ID_text_receiver=Ext.id();a.ID_text_receiverId=Ext.id();this.centerPanel=new Ext.Panel({border:false,region:"center",layout:"fit",items:[this.gridOutbox],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("title")+":",{xtype:"textfield",width:123,name:"title",id:a.ID_text_title},lang("receiver")+":",{xtype:"textfield",width:123,name:"receiver",id:a.ID_text_receiver,listeners:{focus:function(b){var c="input[name="+b.name+"]";$(c).attr("to",a.ID_text_receiverId);wf_selector("user",c,true)}}},{xtype:"hidden",id:a.ID_text_receiverId,name:"receiverId"},lang("content")+":",{xtype:"textfield",width:123,name:"content",id:a.ID_text_conent},{text:lang("search"),handler:function(){a.storeBar.title=Ext.getCmp(a.ID_text_title).getValue();a.storeBar.content=Ext.getCmp(a.ID_text_conent).getValue();a.storeBar.receiver=Ext.getCmp(a.ID_text_receiverId).getValue();a.storeOutbox.load({params:a.storeBar})}},{text:lang("clear"),handler:function(){Ext.getCmp(a.ID_text_title).setValue("");Ext.getCmp(a.ID_text_conent).setValue("");Ext.getCmp(a.ID_text_receiver).setValue("");Ext.getCmp(a.ID_text_receiverId).setValue("");a.storeBar.title="";a.storeBar.content="";a.storeBar.receiverId="";a.storeOutbox.load()}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},operate:function(a){var b=this;CNOA.msg.cf(lang("recellMSgNotice"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=cancelmail",method:"POST",params:{fromId:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(lang("recellSucess"))}else{CNOA.msg.alert(d.msg,function(){})}}})}})},attachCheck:function(a){if(a==1){return'<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}else{return""}},rowClick:function(d,b){var a=d.getEl().query("span[gridid="+this.actionFolder+"_"+b.data.id+"]");for(var c=0;c<a.length;c++){a[c].style.fontWeight="normal"}try{var g=d.getEl().query("img[gridid="+this.actionFolder+"_"+b.data.id+"]");g[0].src="./resources/images/icons/sms-readed.gif"}catch(f){}},contentCheck:function(c,f,b){var a="";try{c=c.replace(new RegExp("<br />","g"),"\n");c=c.replace(/<\/div>(.*)$/gi,"")}catch(d){c=lang("userNotExists")}if(b.data.isread==0){a="font-weight: bold;"}return String.format('<span style="{1}"" gridid="{3}_{2}">{0}</span>',c,a,b.data.id,this.actionFolder)},statusCheck:function(b,c,a){if(b==1){return'<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />'}else{return'<img src="./resources/images/icons/sms-unread.gif" width="16" height="16" gridid="'+this.actionFolder+"_"+a.data.id+'" />'}},deleteMessage:function(){var h=this;var e="outbox";var g,c;var g=h.ID_btn_delete_outbox;var c=h.gridOutbox;var a=Ext.getCmp(g).getEl().getBox();a=[a.x+12,a.y+26];var f=c.getSelectionModel().getSelections();if(f.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var d=new Array();for(var b=0;b<f.length;b++){d.push(f[b].get("id"))}CNOA.miniMsg.show({msg:lang("confirmToDelete"),xy:a,modal:false,fn:function(i){if(i=="confirm"){Ext.Ajax.request({url:h.baseUrl,method:"POST",params:{ids:d.join(","),task:"delete",folder:e},success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){CNOA.msg.notice2(j.msg);c.store.reload()}else{CNOA.msg.alert(j.msg)}}})}}})}},view:function(c,a){var b=CNOA_USER_UID;mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_VIEW");mainPanel.loadClass("index.php?app=communication&func=message&action=index&task=loadPage&from=view&folder=outbox&smstype="+a+"&id="+c+"&uid="+b+"&isMonitor=0","CNOA_MENU_COMMUNICATION_MESSAGE_VIEW",lang("viewMsg"),"icon-cnoa-mail")},reader:function(b,c,a){return"<a href='javascript:void()', onclick='CNOA_communication_message_index_outbox.readView("+a.data.id+")'>"+b+"</a>"},readView:function(h){var g=this;var a=[{name:"id"},{name:"truename"},{name:"isread"},{name:"readtime"}];var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getReaderList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});b.load({params:{id:h}});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var c=new Ext.grid.ColumnModel([f,{header:"id",dataIndex:"id",width:20,sortable:true,hidden:true},{header:"readed",dataIndex:"isread",width:20,sortable:true,hidden:true},{header:lang("reader"),dataIndex:"truename",width:100,sortable:false,menuDisabled:true,renderer:g.truenameColor},{header:lang("firstReadTime"),dataIndex:"readtime",width:180,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var d=new Ext.grid.GridPanel({stripeRows:true,region:"center",layout:"fit",store:b,loadMask:{msg:lang("waiting")},cm:c,sm:f,hideBorders:true,border:false,tbar:new Ext.Toolbar({items:[{handler:function(i,j){b.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},lang("ReaderMarkNotice")]})});var e=new Ext.Window({title:lang("readerStatus"),width:500,height:makeWindowHeight(500),modal:true,layout:"border",items:[d],buttons:[{text:lang("close"),handler:function(){e.close()}}]}).show()},truenameColor:function(c,d,a){var b=a.data.isread;if(b==1){return"<span class='cnoa_color_red'>"+c+"</span>"}else{return"<span class='cnoa_color_gray'>"+c+"</span>"}}};var CNOA_communication_message_newMessageClass,CNOA_communication_message_newMessage;CNOA_communication_message_newMessageClass=CNOA.Class.create();CNOA_communication_message_newMessageClass.prototype={init:function(){var d=this;this.job=CNOA.communication.message.newMessage.job;this.edit_id=CNOA.communication.message.newMessage.id;this.actionFolder=CNOA.communication.message.newMessage.actionFolder;this.baseUrl="index.php?app=communication&func=message&action=index";this.baseUrl2="index.php?app=communication&func=message&action=newMessage";this.ID_saveStatusBar=Ext.id();this.ID_flash_upload=Ext.id();this.ID_content=Ext.id();this.ID_receiverUids=Ext.id();this.ID_ccUids=Ext.id();this.ID_bccuids=Ext.id();this.ID_emails=Ext.id();this.ID_btn_emails=Ext.id();this.saveStatusBar=new Ext.BoxComponent({id:this.ID_saveStatusBar,autoEl:{tag:"div",style:"margin-left:20px;color:#676767;",html:""}});var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"index.php?app=communication&func=message&action=newMessage&task=getEmailAccountList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"accountid"},{name:"account"}]}),listeners:{load:function(g,e,f){if(g.getCount()>0){c.setDisabled(false);Ext.getCmp(d.ID_btn_emails).setDisabled(false);d.centerPanel.getForm().findField("toEmails").setDisabled(false);c.setValue(e[0].get("accountid"))}else{}}}});b.load();var c=new Ext.form.ComboBox({fieldLabel:lang("emailAccount"),name:"fromEmail",store:b,hiddenName:"fromEmail",valueField:"accountid",displayField:"account",allowBlank:true,mode:"local",width:280,triggerAction:"all",forceSelection:true,editable:false,listeners:{focus:function(e){if(e.store.getCount()<1){CNOA.msg.alert(lang("setEmailNotice"))}}.createDelegate(this),change:function(){}.createDelegate(this)}});var a;this.centerPanel=new Ext.form.FormPanel({plain:false,region:"center",border:false,autoScroll:true,bodyStyle:"padding: 10px;background-color:#F8F8F8;",labelWidth:50,labelAlign:"right",waitMsgTarget:true,defaults:{},items:[{xtype:"textarea",height:35,anchor:"-20",readOnly:true,fieldLabel:lang("receiveMan"),emptyText:lang("selectReceiveMan"),allowBlank:false,blankText:lang("selectReceiveMan"),name:"receiverNames",listeners:{render:function(e){e.to=d.ID_receiverUids},focus:function(e){people_selector("user",e,true,false,d.baseUrl2+"&task=getSelectorData")}}},{xtype:"hidden",id:this.ID_receiverUids,name:"receiverUids"},{xtype:"textarea",height:35,anchor:"-20",readOnly:true,fieldLabel:lang("copyTo"),blankText:lang("selectCopyTo"),name:"ccNames",listeners:{render:function(e){e.to=d.ID_ccUids},focus:function(e){people_selector("user",e,true,false,d.baseUrl2+"&task=getSelectorData")}}},{xtype:"hidden",id:this.ID_ccUids,name:"ccUids"},{xtype:"textarea",height:35,anchor:"-20",readOnly:true,fieldLabel:lang("bcc"),blankText:lang("selectBCC"),name:"bccNames",listeners:{render:function(e){e.to=d.ID_bccuids},focus:function(e){people_selector("user",e,true,false,d.baseUrl2+"&task=getSelectorData")}}},{xtype:"hidden",id:this.ID_bccuids,name:"bccuids"},{xtype:"compositefield",items:[c,{xtype:"button",text:lang("emailAccount"),id:d.ID_btn_emails,disabled:true,handler:function(){var e=d.centerPanel.getForm().findField("toEmails");if(!a){a=email_selector("addressBook",e,true)}a.show()}}]},{xtype:"textarea",name:"toEmails",allowBlank:"true",height:35,disabled:true,anchor:"-20",fieldLabel:lang("emailAccount")},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",inputPre:"filesUpload"},{xtype:"textfield",fieldLabel:lang("title"),anchor:"-20",allowBlank:false,name:"title"},{items:[{xtype:"ueditor",toolType:"mini",name:"content",id:d.ID_content,zIndex:200,height:300}],fieldLabel:lang("articleContent"),border:false,height:360}],tbar:new Ext.Toolbar({style:"border-top-width:0;",items:[{handler:function(e,f){this.sendMessage()}.createDelegate(this),iconCls:"icon-send-sms",cls:"btn-green1",text:lang("send")},{handler:function(e,f){d.saveMessage()},iconCls:"icon-win-save",cls:"btn-blue4",text:lang("save")},{handler:function(e,f){this.centerPanel.getForm().reset()}.createDelegate(this),iconCls:"icon-system-reset",cls:"btn-yellow1",text:lang("reset")},{text:lang("close"),iconCls:"icon-noPass",cls:"btn-gray1",handler:function(){d.closeTab()}.createDelegate(this)},{xtype:"signatureBtn",url:this.baseUrl,iconCls:"icon-person-sign",cls:"btn-red1",autoToTargetEl:this.job=="loadDrafts"?false:true,targetEl:d.ID_content},this.saveStatusBar]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel],listeners:{beforedestroy:function(){if(a){a.destroy()}}}});if(this.job=="loadDrafts"){setTimeout(function(){d.draftsLoad()},100)}if(this.job=="replayLoad"){setTimeout(function(){d.replayLoad()},100)}if(this.job=="transmitLoad"){setTimeout(function(){d.transmitLoad()},100)}if(this.job=="replayAll"){setTimeout(function(){d.replayAll()},100)}this.stv=setInterval(function(){try{d.saveMessage()}catch(f){}},60*1*1000)},replayLoad:function(){var b=this;var a=this.edit_id;b.centerPanel.getForm().load({url:"index.php?app=communication&func=message&action=newMessage",params:{edit_id:a,task:"replayLoad"},method:"POST",waitTitle:lang("notice"),success:function(c,d){b.edit_id=0;b.centerPanel.getForm().findField("content").focus()},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){})}})},replayAll:function(){var a=this;var b=this.edit_id;a.centerPanel.getForm().load({url:"index.php?app=communication&func=message&action=newMessage",params:{id:b,task:"replayAll"},method:"POST",watiTitle:lang("notice"),success:function(c,d){a.edit_id=0;a.centerPanel.getForm().findField("content").focus()},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})},transmitLoad:function(){var c=this;var b=this.edit_id;var a=this.actionFolder;c.centerPanel.getForm().load({url:"index.php?app=communication&func=message&action=newMessage",params:{edit_id:b,task:"transmitLoad",actionFolder:a},method:"POST",waitTitle:lang("notice"),success:function(d,e){c.edit_id=0;c.centerPanel.getForm().findField("content").focus()},failure:function(d,e){CNOA.msg.alert(e.result.msg,function(){})}})},draftsLoad:function(){var a=this;a.centerPanel.getForm().load({url:"index.php?app=communication&func=message&action=newMessage",params:{edit_id:this.edit_id,task:"draftsLoad"},method:"POST",waitTitle:lang("notice"),success:function(b,c){a.edit_id=c.result.data.id;a.centerPanel.getForm().findField("content").focus()},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}})},replayLoad:function(){var a=this;a.centerPanel.getForm().load({url:"index.php?app=communication&func=message&action=newMessage",params:{edit_id:this.edit_id,task:"replayLoad"},method:"POST",waitTitle:lang("notice"),success:function(b,c){a.edit_id=0;a.centerPanel.getForm().findField("content").focus()},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}})},sendMessage:function(){var d=this;var b=d.centerPanel.getForm();if(b.findField("files").isUploading()){CNOA.msg.notice2("正在上传中，请稍等...");return}var a=b.findField("receiverNames");var c=b.findField("title");a.allowBlank=false;a.validationEvent=true;c.allowBlank=false;c.validationEvent=true;if(b.isValid()){b.submit({url:"index.php?app=communication&func=message&action=newMessage",method:"POST",waitMsg:lang("waiting"),params:{task:"send",edit_id:d.edit_id},success:function(f,g){CNOA.msg.notice2(lang("msgSended"));try{CNOA_communication_message_index_drafts.storeDrafts.reload()}catch(h){}try{CNOA_communication_message_index_inbox.storeInbox.reload()}catch(h){}try{CNOA_communication_message_index_outbox.storeOutbox.reload()}catch(h){}d.closeTab()}.createDelegate(this),failure:function(e,f){CNOA.msg.alert(f.result.msg)}.createDelegate(this)})}else{}},saveMessage:function(){var d=this;var b=d.centerPanel.getForm();var a=b.findField("receiverNames");var c=b.findField("title");if(b.findField("files").isUploading()){return}a.allowBlank=true;a.validationEvent=false;a.clearInvalid();c.allowBlank=true;c.validationEvent=false;c.clearInvalid();if(b.isValid()){b.submit({url:"index.php?app=communication&func=message&action=newMessage",method:"POST",waitMsg:lang("waiting"),params:{task:"save",edit_id:d.edit_id},success:function(e,f){d.edit_id=parseInt(f.result.data.edit_id);Ext.getCmp(d.ID_saveStatusBar).getEl().update(lang("savedToDrafts")+"("+f.result.data.updateTime+")");e.findField("files").setValue("");e.findField("files").setValue(f.result.data.filesList)}.createDelegate(this),failure:function(e,f){CNOA.msg.alert(f.result.msg)}.createDelegate(this)})}else{}},closeTab:function(){mainPanel.closeTab(CNOA.communication.message.newMessage.parentID.replace("docs-",""))}};var CNOA_communication_message_viewClass,CNOA_communication_message_view;CNOA_communication_message_viewClass=CNOA.Class.create();CNOA_communication_message_viewClass.prototype={init:function(){try{resetDocumentTitle()}catch(a){}var b=this;this.actionFolder=CNOA.communication.message.view.folder;this.id=CNOA.communication.message.view.id;this.smstype=CNOA.communication.message.view.smstype;this.uid=CNOA.communication.message.view.uid;this.isMonitor=CNOA.communication.message.view.isMonitor;this.baseUrl="index.php?app=communication&func=message&action=index";this.previewPanel=new Ext.Panel({border:false,listeners:{render:function(){b.preview()}}});this.centerPanel=new Ext.Panel({region:"center",border:false,autoScroll:true,items:[this.previewPanel],tbar:new Ext.Toolbar({items:[{text:lang("del"),hidden:this.smstype=="sys"?true:false,iconCls:"icon-utils-s-delete",handler:function(c){CNOA.miniMsg.cfShowAt(c,lang("confirmToDelete"),function(){b.deleteMsg()})}.createDelegate(this)},{text:lang("reply"),hidden:(this.smstype=="sys"||this.isMonitor==1)?true:(this.actionFolder=="outbox"?true:false),iconCls:"icon-btn-sms-reply",handler:function(){b.replayLoad()}.createDelegate(this)},{text:lang("replyAll"),hidden:(this.smstype=="sys"||this.isMonitor==1)?true:(this.actionFolder=="outbox"?true:false),iconCls:"icon-btn-sms-reply",handler:function(){b.replayAll()}},{text:lang("transmit"),hidden:(this.smstype=="sys"||this.isMonitor==1)?true:false,iconCls:"icon-tab-inbox",handler:function(){b.transmitLoad()}.createDelegate(this)},{text:lang("print"),iconCls:"icon-print",handler:function(){b.print()}},{text:lang("close"),handler:function(c){b.closeTab()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:77}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},preview:function(){var b=this;var a=new Ext.XTemplate('<div style="margin: 5px;">','	<div style="background-color:#F5F5F5;padding:3px 10px;border-bottom:1px solid #D9D9D9;">','		<div style="font-size:14px;font-weight:bold;line-height:22px;">{title}</div>','		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("sender")+":{sender}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("time")+":{posttime}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("receiver")+":{receiver}</div>","		<div >{receiver2}</div>","		<div >{receiver3}</div>","	</div>",'	<div class="content news_news_view_content" style="font-size:12px;margin:5px 0 0 15px;">{content}</div>','	<tpl if="attachCount &gt; 0">','	<div style="border:2px solid #E6E6E6;height:auto;margin-top:100px;">','		<div style="height:32px;background-color:#E6E6E6;line-height:32px;">','			<img src="./resources/images/icons/attach.gif">','			<span style="font-size:14px;font-weight:bold;">'+lang("attach")+"</span>({attachCount}"+lang("ge")+")","		</div>","		{attach}","	</div>","	</tpl>","</div>");b.previewPanel.getEl().mask(lang("waiting"));b.previewPanel.body.update("");Ext.Ajax.request({url:b.baseUrl+"&task=view",method:"POST",params:{id:b.id,folder:b.actionFolder,smstype:b.smstype,uid:this.uid},success:function(e){var c=Ext.decode(e.responseText);var d=parseInt(c.data.unreadcount);a.overwrite(b.previewPanel.body,c.data);b.previewPanel.getEl().unmask()}})},closeTab:function(){mainPanel.closeTab(CNOA.communication.message.view.parentID.replace("docs-",""))},replayLoad:function(){mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_NEW");mainPanel.loadClass("index.php?app=communication&func=message&action=newMessage&job=replayLoad&id="+this.id,"CNOA_MENU_COMMUNICATION_MESSAGE_NEW",lang("replyMsg"),"icon-new-sms")},replayAll:function(){mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_NEW");mainPanel.loadClass("index.php?app=communication&func=message&action=newMessage&job=replayAll&id="+this.id,"CNOA_MENU_COMMUNICATION_MESSAGE_NEW",lang("replyMsg"),"icon-new-sms")},transmitLoad:function(){mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_NEW");mainPanel.loadClass("index.php?app=communication&func=message&action=newMessage&job=transmitLoad&id="+this.id+"&actionFolder="+this.actionFolder,"CNOA_MENU_COMMUNICATION_MESSAGE_NEW",lang("transmitMessage"),"icon-new-sms")},deleteMsg:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{ids:this.id,task:"delete",folder:this.actionFolder},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice2(b.msg);try{CNOA_communication_message_index_inbox.storeInbox.reload()}catch(d){}try{CNOA_communication_message_index_outbox.storeOutbox.reload()}catch(d){}a.closeTab()}else{CNOA.msg.alert(b.msg)}}})},print:function(){window.open("index.php?app=communication&func=message&action=index&task=print&id="+this.id+"&actionFolder="+this.actionFolder,"noticept","width=740,height="+(screen.availHeight-120)+",left="+((screen.availWidth-740)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")}};var CNOA_communication_message_index_recycleClass,CNOA_communication_message_index_recycle;CNOA_communication_message_index_recycleClass=CNOA.Class.create();CNOA_communication_message_index_recycleClass.prototype={init:function(){var f=this;this.baseUrl="index.php?app=communication&func=message&action=index";this.storeBar={type:"",title:"",content:"",stime:"",etime:""};this.fields=[{name:"id"},{name:"type"},{name:"title"},{name:"content"},{name:"posttime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=recycle",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"num",dataIndex:"id",hidden:true},{header:lang("type"),dataIndex:"type",width:110,sortable:true,menuDisabled:true},{header:lang("title"),dataIndex:"title",width:180,sortable:true,menuDisabled:true},{header:lang("content"),dataIndex:"content",id:"content",width:200,sortable:true,menuDisabled:true},{header:lang("delTime"),dataIndex:"posttime",width:130,sortable:true,menuDisabled:true}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:30,listeners:{beforechange:function(g,h){Ext.apply(h,f.storeBar)}}});this.ID_btn_recover=Ext.id();this.ID_btn_del=Ext.id();this.ID_btn_empty=Ext.id();this.gridRecycle=new Ext.grid.GridPanel({loadMask:{msg:lang("waiting")},layout:"fit",border:false,store:this.store,sm:this.sm,cm:this.colModel,autoExpandColumn:"content",tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}.createDelegate(this)},{text:lang("recover"),iconCls:"icon-arrow-redo",cls:"btn-yellow1",id:f.ID_btn_recover,handler:function(){f.recover()}},{text:lang("del"),iconCls:"icon-utils-s-delete",id:f.ID_btn_del,handler:function(){f.delRecord()}},{text:lang("cleanrecycle"),id:f.ID_btn_empty,handler:function(){f.emptyRecycle()}},"","<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:3006}]}),bbar:this.pagingBar});var e=Ext.id();var d=Ext.id();var b=Ext.id();var a=Ext.id();var c=Ext.id();this.mainPanel=new Ext.Panel({collapsible:false,border:false,layout:"fit",items:[this.gridRecycle],tbar:new Ext.Toolbar({items:[lang("type")+":",{xtype:"combo",width:110,id:e,mode:"local",triggerAction:"all",store:new Ext.data.ArrayStore({fields:["id","type"],data:[[1,lang("inbox")],[2,lang("sendBox")]]}),valueField:"id",displayField:"type"},(lang("title")+":"),{xtype:"textfield",id:d},lang("content")+":",{xtype:"textfield",id:b},lang("delTimeFrom")+":",{xtype:"datefield",format:"Y-m-d",id:a},lang("to"),{xtype:"datefield",format:"Y-m-d",id:c},{text:lang("search"),iconCls:"icon-hr-search",handler:function(){f.storeBar.type=Ext.getCmp(e).getValue();f.storeBar.title=Ext.getCmp(d).getValue();f.storeBar.content=Ext.getCmp(b).getValue();f.storeBar.stime=Ext.getCmp(a).getRawValue();f.storeBar.etime=Ext.getCmp(c).getRawValue();f.store.load({params:f.storeBar})}},{text:lang("clear"),handler:function(){Ext.getCmp(e).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(c).setValue("");f.storeBar={type:"",title:"",content:"",stime:"",etime:""};f.store.load()}}]})})},recover:function(){var g=this;var f=g.ID_btn_recover;var c=g.gridRecycle;var a=Ext.getCmp(f).getEl().getBox();a=[a.x+12,a.y+26];var e=c.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var d=new Array();for(var b=0;b<e.length;b++){d.push(e[b].get("id"))}CNOA.miniMsg.show({msg:lang("confirmToRecover"),xy:a,modal:true,fn:function(h){if(h=="confirm"){Ext.Ajax.request({url:g.baseUrl+"&task=recover",method:"POST",params:{ids:d.join(",")},success:function(j){var i=Ext.decode(j.responseText);c.store.reload()},failure:function(i){}})}}})}},delRecord:function(){var g=this;var f=g.ID_btn_del;var c=g.gridRecycle;var a=Ext.getCmp(f).getEl().getBox();a=[a.x+12,a.y+26];var e=c.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{var d=new Array();for(var b=0;b<e.length;b++){d.push(e[b].get("id"))}CNOA.miniMsg.show({msg:lang("confirmToDelete"),xy:a,modal:true,fn:function(h){if(h=="confirm"){Ext.Ajax.request({url:g.baseUrl+"&task=delRecord",method:"POST",params:{ids:d.join(",")},success:function(i){g.store.reload()}})}}})}},emptyRecycle:function(){var b=this;var a=b.gridRecycle;Ext.MessageBox.confirm(lang("notice"),lang("confirmClearRecycle"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=delRecord&from=all",method:"POST",success:function(d){b.store.reload()}})}})}};var CNOA_communication_message_insideFolderClass,CNOA_communication_message_insideFolder;CNOA_communication_message_insideFolderClass=CNOA.Class.create();CNOA_communication_message_insideFolderClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=communication&func=message&action=insideFolder";this.fields=[{name:"fid"},{name:"name"},{name:"rule"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSmsFolderList&from=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([this.sm,{header:"id",dataIndex:"fid",hidden:true},{header:lang("name"),dataIndex:"name",width:260,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,listeners:{rowdblclick:function(b,c){a.showAddEditWindow("edit")},cellclick:function(b,f,c,d){}},tbar:new Ext.Toolbar({items:[{handler:function(b,c){this.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{handler:function(b,c){a.showAddEditWindow("add")}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{handler:function(b,c){a.showAddEditWindow("edit",b)}.createDelegate(this),iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b,c){a.deleteList(b)}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:125}]})});this.centerPanel=new Ext.Panel({border:false,region:"center",layout:"fit",items:[this.grid]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},deleteList:function(a){var c=this;var b=this.grid.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("deleteFolder"),function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("fid")+","}Ext.Ajax.request({url:c.baseUrl+"&task=deleteFolder",method:"POST",params:{ids:f,btn:e},success:function(h){var g=Ext.decode(h.responseText);if(g.success===true){CNOA.msg.notice2(g.msg);c.store.reload()}else{CNOA.msg.alert(g.msg)}}})}}})}},showAddEditWindow:function(d,c){var g=this;var f=0,b="";if(d=="edit"){var e=this.grid.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"));return}f=e[0].get("fid");b=e[0].get("name")}this.baseField=[{xtype:"fieldset",defaults:{border:false},items:[{xtype:"textfield",width:238,name:"name",allowBlank:false,fieldLabel:lang("folderName"),value:d=="edit"?b:""}]}];this.formPanel=new Ext.form.FormPanel({border:false,monitorResize:true,labelWidth:60,labelAlign:"right",waitMsgTarget:true,items:[{xtype:"panel",border:false,bodyStyle:"padding:10px;",items:this.baseField}]});var a=function(){if(g.formPanel.getForm().isValid()){g.formPanel.getForm().submit({url:g.baseUrl+"&task=saveSettingFolder",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{fid:f,type:d},success:function(h,i){g.store.reload();g.addEditWindow.close()},failure:function(h,i){CNOA.msg.alert(i.result.msg,function(){})}})}};this.addEditWindow=new Ext.Window({title:lang("addOrEditFolder"),width:360,height:156,resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.formPanel],plain:true,layout:"fit",buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){a()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){g.addEditWindow.close()}}]});this.addEditWindow.show()}};var sm_communication_message=1;
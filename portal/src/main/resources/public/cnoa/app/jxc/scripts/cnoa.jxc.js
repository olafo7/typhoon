var CNOA_jxc_base_bindflowClass,CNOA_jxc_base_bindflow;CNOA_jxc_base_bindflowClass=CNOA.Class.create();CNOA_jxc_base_bindflowClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=base&action=bindflow";a.mainPanel=a.getBindflowPanel()},getBindflowPanel:function(){var d=this;var a=[{name:"id"},{name:"name"},{name:"fromName"},{name:"flowName"},{name:"status"}],b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getBindFlowList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),c=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:lang("flowName"),dataIndex:"name"},{header:lang("belongFunction"),dataIndex:"fromName",width:120},{header:lang("bindWorkFlow"),dataIndex:"flowName",width:120},{header:lang("opt"),dataIndex:"id",width:200,renderer:function(k,g,e){var j=e.json,f="";var i="<a href='javascript:void(0);' class='gridview' onclick='CNOA_jxc_base_bindflow.editBindflow("+k+',"'+j.name+'",'+j.mid+","+j.flowId+")'>"+lang("modify");i+="<a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_jxc_base_bindflow.bindWidget("+k+")'>"+lang("bindingControls");i+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_jxc_base_bindflow.deleteBindflow("+k+")'>"+lang("del")+"</a>";return i}}]});return new Ext.grid.GridPanel({border:false,hideBorders:true,loadMask:{msg:lang("waiting")},store:b,cm:c,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.editBindflow()}}]})})},editBindflow:function(c,b,k,a){var i=this;var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getFlowList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"flowId"},{name:"name"}]}),listeners:{load:function(){e.getForm().setValues({name:b,mid:k,flowId:a})}}}),e=new Ext.form.FormPanel({border:false,labelWidth:60,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px",items:[{xtype:"textfield",fieldLabel:lang("flowName"),name:"name",width:400,allowBlank:false},{xtype:"combo",fieldLabel:lang("belongFunction"),hiddenName:"mid",valueField:"id",displayField:"name",mode:"local",editable:false,triggerAction:"all",width:400,allowBlank:false,store:new Ext.data.ArrayStore({fields:["id","name"],data:[[3,lang("warehousing")],[4,lang("outbound")]]})},{xtype:"combo",fieldLabel:lang("bindFlow"),hiddenName:"flowId",store:d,valueField:"flowId",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,width:400,allowBlank:false}]}),h=function(){e.getForm().submit({url:i.baseUrl+"&task=submitBindFlow",method:"POST",waitMsg:lang("waiting"),params:f,success:function(l,m){CNOA.msg.notice(m.result.msg);g.close();i.mainPanel.store.load()},failure:function(l,m){CNOA.msg.alert(m.result.msg)}})},j=lang("addFlowBind"),f={};if(c){j=lang("editFlowBind");f.id=c}var g=new Ext.Window({title:j,width:492,height:180,modal:true,resizable:false,layout:"fit",items:e,buttons:[{text:lang("save"),handler:function(l){h()}},{text:lang("close"),handler:function(l){g.close()}}]}).show()},deleteBindflow:function(b){var a=this;CNOA.msg.cf(lang("delFlowBind"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delBindflow",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);a.mainPanel.store.load()}else{CNOA.msg.notice2(d.msg)}}})}})},setStatus:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=setStatus",method:"POST",params:{id:c},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);b.mainPanel.store.load()}else{CNOA.msg.notice2(d.msg)}}})},bindWidget:function(d){var i=this;var f=[{name:"fieldId"},{name:"fieldname"},{name:"type"},{name:"widgetId"}],b=new Ext.data.GroupingStore({baseParams:{id:d},proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getBindFieldList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})}),e=new Ext.data.Store({autoLoad:true,baseParams:{id:d},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getFlowFields"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]}),listeners:{load:function(m,k,l){b.load()}}}),c=new Ext.form.ComboBox({width:150,autoLoad:true,triggerAction:"all",selectOnFocus:true,editable:false,store:e,valueField:"id",displayField:"name",mode:"local",forceSelection:true}),j=[new Ext.grid.RowNumberer(),{header:"",hidden:true,dataIndex:"fieldid"},{header:lang("inputBox"),sortable:true,dataIndex:"fieldname",width:200,menuDisabled:true},{header:lang("flowControls"),sortable:true,dataIndex:"widgetId",width:200,menuDisabled:true,editor:c,renderer:function(l){var k;e.each(function(m){if(m.get("id")==l){k=m;return}});return k==null?lang("unselectControls"):k.get("name")}}],h=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("ok"),errorSummary:false}),a=new Ext.grid.GridPanel({store:b,stripeRows:true,loadMask:{msg:lang("waiting")},border:false,autoScroll:true,columns:j,plugins:h,view:new Ext.grid.GroupingView({markDirty:false})}),g=new Ext.Window({title:lang("bindFlowControls"),width:700,height:550,resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:lang("save"),handler:function(k){var l=[];Ext.each(b.data.items,function(m,n){l.push(m.data)});Ext.Ajax.request({url:i.baseUrl+"&task=submitBindFlowField",method:"POST",params:{data:Ext.encode(l),id:d},success:function(n){var m=Ext.decode(n.responseText);if(m.success===true){CNOA.msg.notice2(m.msg);g.close()}else{CNOA.msg.alert(m.msg)}}})}},{text:lang("close"),handler:function(){g.close()}}]}).show()}};var CNOA_jxc_base_goodsClass,CNOA_jxc_base_goods;CNOA_jxc_base_goodsClass=CNOA.Class.create();CNOA_jxc_base_goodsClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=base&action=goods",a.items=[];a.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:130,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[a.getGoodsPanel(),a.getTypePanel()]})},getTypePanel:function(){var e=this;var a=[{name:"id"},{name:"name"},{name:"order"}],b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getGoodsSorts",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{update:function(j,i,k){if(k==Ext.data.Record.EDIT){Ext.Ajax.request({url:e.baseUrl+"&task=editGoodsSorts",params:{id:i.get("id"),name:i.get("name"),order:i.get("order")},success:function(l){var m=Ext.decode(l.responseText);CNOA.msg.notice2(m.msg)}})}}}}),c=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("sellerCategory"),width:135,dataIndex:"name",sortable:true,menuDisabled:true,editor:new Ext.form.TextField({allowBlank:false})},{header:lang("order"),dataIndex:"order",sortable:true,menuDisabled:true,editor:new Ext.form.NumberField({})}]),d=new Ext.ux.grid.RowEditor({saveText:lang("ok"),cancelText:lang("cancel")}),h=new Ext.grid.PageGridPanel({title:lang("seller"),border:false,hideBorders:true,loadMask:{msg:lang("waiting")},store:b,cm:c,plugins:[d],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:g},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:f}]})});e.goodsSortStore=b;function g(){var i=new b.recordType({id:"",name:"",order:0});d.stopEditing();h.store.insert(0,i);d.startEditing(0)}function f(){var i=h.getSelectionModel().getSelected();if(!i){return false}Ext.Ajax.request({url:e.baseUrl+"&task=delGoodsSorts",params:{id:i.get("id")},success:function(j){b.remove(i);var k=Ext.decode(j.responseText);CNOA.msg.notice2(k.msg)}})}return h},getGoodsPanel:function(){var c=this,a=c.getSearchPanel(),b=c.getGoodsGridPanel();c.goodsGridPanel=b,c.searchPanel=a;return new Ext.Panel({title:lang("goodsMgr"),border:false,layout:"border",items:[a,b],tbar:new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(e){if(a.isVisible()){e.setText(lang("expandSearch"));a.hide()}else{e.setText(lang("foldSearch"));if(a.items.length<=0){var d=Ext.CustomSearchPanel.getCustomColumns(b.customColumns,c.baseUrl,c.searchPanel);a.add(d)}a.show()}c.mainPanel.doLayout()}},{text:lang("search"),handler:function(d){b.store.baseParams=a.getForm().getValues();b.store.load()}},{text:lang("clear"),style:"margin-left:5px",handler:function(d){Ext.each(a.getForm().items.items,function(f,e){if(f.xtype=="compositefield"){Ext.each(f.items.items,function(g){g.setValue("")})}else{f.setValue("")}});b.store.baseParams="";b.store.load()}}]})})},getSearchPanel:function(){var b=this;var a=new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}});return a},getGoodsGridPanel:function(){var a=this;var b=new Ext.grid.CustomGridPanel({region:"center",border:false,customFiledUrl:a.baseUrl+"&task=getGoodsCustomField",storeUrl:a.baseUrl+"&task=getGoodsList",loadMask:{msg:lang("waiting")},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){a.editGoods(b.store)}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(c){var d=b.getSelectionModel().getSelections();if(d.length!=1){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{a.editGoods(b.store,d[0].json)}}},{xtype:"importButton",browseTitle:"导入货品",cls:"btn-blue3",url:a.baseUrl+"&task=import_goods"},{text:lang("export2"),cls:"btn-blue3",iconCls:"icon-excel",handler:function(c){CNOA.miniMsg.cfShowAt(c,"选择会导出选择的数据，<br/ >不选择则导出查询的数据",function(){var f=b.getSelectionModel().getSelections();var e=[];var g=new Object();if(f.length==0){g=a.searchPanel.getForm().getValues()}else{Ext.each(f,function(j,h){e.push(j.json.id)});g.ids=e.join(",")}var d=new Ext.LoadMask(Ext.getBody(),{msg:"正在导出，请稍后...",removeMask:true});d.show();Ext.Ajax.request({url:a.baseUrl+"&task=exportExcel&step=1",waitMsg:lang("waiting"),params:g,method:"POST",success:function(h){d.hide();var i=Ext.decode(h.responseText);ajaxDownload(a.baseUrl+"&task=exportExcel&file="+i.msg+"&step=2")}})})}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c){var d=b.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(c,lang("sureDel"),function(){var e=[];Ext.each(d,function(g,f){e.push(g.json.id)});a.delGoods(e.join(","),b.store)})}}}]})});return b},delGoods:function(b,a){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=delGoods",params:{ids:b},success:function(d){var e=Ext.decode(d.responseText);CNOA.msg.notice2(e.msg);a.reload()}})},editGoods:function(a,b){var d=this,h=lang("addGoods"),g={},f;if(b){g={id:b.id};h=lang("editGoods")}var e=function(i){if(i.getForm().isValid()){i.getForm().submit({url:d.baseUrl+"&task=editGoods",method:"POST",params:g,waitMsg:lang("notice"),success:function(j,k){CNOA.msg.notice2(k.result.msg);a.reload();f.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};f=new Ext.CustomWindow({title:h,baseUrl:d.baseUrl,customColumns:d.goodsGridPanel.customColumns,submit:e}).show();if(b){var c=f.items.items[0];c.getForm().setValues(b)}}};var CNOA_jxc_base_storageClass,CNOA_jxc_base_storage;CNOA_jxc_base_storageClass=CNOA.Class.create();CNOA_jxc_base_storageClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=base&action=storage",a.items=[];a.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:125,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[a.getStoragePanel()]})},getStoragePanel:function(){var a=this;var b=new Ext.grid.CustomGridPanel({title:lang("houseSetting"),customFiledUrl:a.baseUrl+"&task=getStorageCustomField",storeUrl:a.baseUrl+"&task=getStorageList",loadMask:{msg:lang("waiting")},columnConfig:{storagename:{width:150},managerName:{width:180},sortNames:{width:250}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){a.editStorage(b.store)}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(c){var d=b.getSelectionModel().getSelections();if(d.length!=1){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{a.editStorage(b.store,d[0].json)}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c){var d=b.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(c,lang("sureDel"),function(){var e=[];Ext.each(d,function(g,f){e.push(g.json.id)});a.delStorage(e.join(","),b.store)})}}}]})});return b},editStorage:function(a,b){var c=this;c.goodsSorts=[];Ext.Ajax.request({url:c.baseUrl+"&task=getGoodsSorts",success:function(e){var f=Ext.decode(e.responseText),d=b?false:true;if(f.failure==true){CNOA.msg.alert(f.msg)}else{Ext.each(f,function(h,g){c.goodsSorts.push({boxLabel:h.name,name:"sid_"+h.id,checked:d})});c.editStorageWin(a,b)}}})},editStorageWin:function(store,json){var me=this,title=lang("addHouser"),params={},columns=me.mainPanel.getItem(0).customColumns,length=columns.length;if(json){title=lang("editHouse");params={id:json.id}}for(var i=0;i<length;i++){if(columns[i].field=="sortNames"){columns[i]={field:"sid",fieldname:lang("invertoryType"),show:columns[i].show,add:columns[i].add,type:"fix",xtype:"checkboxgroup",columns:1,items:me.goodsSorts}}}var submit=function(formPanel){if(formPanel.getForm().isValid()){formPanel.getForm().submit({url:me.baseUrl+"&task=editStorage",method:"POST",params:params,waitMsg:lang("notice"),success:function(form,action){CNOA.msg.notice2(action.result.msg);store.reload();win.close()}})}};var win=new Ext.CustomWindow({title:title,baseUrl:me.baseUrl,isCheck:"isCheck",customColumns:columns,submit:submit}).show();if(json){var sids=json.sids.split(","),len=sids.length,i=0;for(;i<len;i++){eval("json.sid_"+sids[i]+"=1")}var form=win.items.items[0];form.getForm().setValues(json)}},delStorage:function(b,a){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=delStorage",params:{ids:b},success:function(d){var e=Ext.decode(d.responseText);CNOA.msg.notice2(e.msg);a.reload()}})}};var CNOA_jxc_stock_chukuClass,CNOA_jxc_stock_chuku;CNOA_jxc_stock_chukuClass=CNOA.Class.create();CNOA_jxc_stock_chukuClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=stock&action=chuku";this.searchPanel=a.getSearchPanel();this.orderPanel=a.getOrderPanel();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.searchPanel,this.orderPanel],tbar:new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(c){if(a.searchPanel.isVisible()){c.setText(lang("expandSearch"));a.searchPanel.hide()}else{c.setText(lang("foldSearch"));if(a.searchPanel.items.length<=0){var b=Ext.CustomSearchPanel.getCustomColumns(a.orderPanel.customColumns,a.baseUrl,a.searchPanel);a.searchPanel.add(b)}a.searchPanel.show()}a.mainPanel.doLayout()}},{text:lang("search"),handler:function(b){searchParams={};searchParams=a.searchPanel.getForm().getValues();a.orderPanel.store.reload({params:searchParams})}},{text:lang("clear"),style:"margin-left:5px",handler:function(b){searchParams={};Ext.each(a.searchPanel.getForm().items.items,function(d,c){if(d.xtype=="compositefield"){Ext.each(d.items.items,function(e){e.setValue("")})}else{d.setValue("")}});a.orderPanel.store.reload({params:{}})}}]})})},getOrderPanel:function(){var a=this;var b=new Ext.grid.CustomGridPanel({region:"center",border:false,storeUrl:a.baseUrl+"&task=getChukuList",customFiledUrl:a.baseUrl+"&task=getChukuCustomField",otherField:[{header:lang("opt"),dataIndex:"status",renderer:function(f,d,c){var e=c.json;return e.status==0?"":'<a href="javascript:void(0)" class="gridview" onclick="CNOA_jxc_stock_chuku.viewFlow('+e.uFlowId+')">'+lang("viewProcess")+"</a>"}},{header:lang("status"),dataIndex:"status",renderer:function(e,d,c){switch(c.json.status){case"0":return'<span style="color:green;">'+lang("beingModerate")+"</span>";case"1":return'<span style="color:red;">'+lang("endApp")+"</span>"}}}],loadMask:{msg:lang("waiting")},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){getFlowId4Engine("jxcChuku",function(d,c){d()})}}]})});return b},getSearchPanel:function(){var b=this;var a=new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}});return a},viewFlow:function(a){getFlowId4Engine("jxcRuku",function(c,b){b(a)})}};var CNOA_jxc_stock_detailClass,CNOA_jxc_stock_detail;CNOA_jxc_stock_detailClass=CNOA.Class.create();CNOA_jxc_stock_detailClass.prototype={init:function(){var h=this;h.baseUrl="index.php?app=jxc&func=stock&action=report";var k=CNOA.jxc.stock.detail.storageId,f=CNOA.jxc.stock.detail.goodsId,d=CNOA.jxc.stock.detail.mode,b=CNOA.jxc.stock.detail.stime,c=CNOA.jxc.stock.detail.etime;var e=[{name:"id"},{name:"indentnumber"},{name:"type"},{name:"posttime"},{name:"goodsname"},{name:"quantity"},{name:"price"},{name:"sum"}],j=new Ext.data.Store({autoLoad:true,baseParams:{storageId:k,goodsId:f,stime:b,etime:c,mode:d},proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getGoodsStockDetail",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})}),a=new Ext.grid.CheckboxSelectionModel({singleSelect:true}),i=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),a,{header:"id",dataIndex:"id",hidden:true},{header:lang("orderNum"),dataIndex:"indentnumber",width:150},{header:lang("type"),dataIndex:"type",renderer:function(l){return l==1?lang("storeInHouse"):l==2?lang("outHouse"):""}},{header:lang("outStorageTime"),dataIndex:"posttime"},{header:lang("productName"),dataIndex:"goodsname"},{header:lang("quantity"),dataIndex:"quantity"},{header:lang("unitPrice"),dataIndex:"price"},{header:lang("totalAmount"),dataIndex:"sum"}]}),g=new Ext.grid.GridPanel({border:false,loadMask:{msg:lang("waiting")},store:j,cm:i,sm:a,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){j.load()}}]})});h.mainPanel=g}};var CNOA_jxc_stock_reportClass,CNOA_jxc_stock_report;CNOA_jxc_stock_reportClass=CNOA.Class.create();CNOA_jxc_stock_reportClass.prototype={init:function(){var b=this,c,a,d={};b.baseUrl="index.php?app=jxc&func=stock&action=report";c=new Ext.grid.CustomGridPanel({border:false,region:"center",storeUrl:b.baseUrl+"&task=getReportList",customFiledUrl:b.baseUrl+"&task=getReportCustomField",page:false,otherField:[{header:lang("detail"),width:80,renderer:function(h,f,e){var g=e.json;return'<a class="gridview" onclick="CNOA_jxc_stock_report.viewStockDetail('+g.storageId+","+g.goodsId+')">'+lang("detail")+"<a>"}}],loadMask:{msg:lang("waiting")},tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(e,f){c.store.reload()}}]}),listeners:{afterrender:function(f){var e=setInterval(function(){if(f.customColumns){clearInterval(e);var g=Ext.CustomSearchPanel.getCustomColumns(f.customColumns,b.baseUrl,a);a.add(g)}},500)}}});a=b.getSearchPanel();b.mainPanel=new Ext.Panel({border:false,layout:"border",items:[a,c],tbar:new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(e){if(a.isVisible()){e.setText(lang("expandSearch"));a.hide()}else{e.setText(lang("foldSearch"));a.show()}b.mainPanel.doLayout()}},{text:lang("search"),handler:function(f){d={};d=a.getForm().getValues();var e=Ext.getCmp(b.ID_search_time);d.stime=e.getSTime();d.etime=e.getETime();c.store.reload({params:d})}},{text:lang("clear"),style:"margin-left:5px",handler:function(e){d={};Ext.each(a.getForm().items.items,function(g,f){g.setValue("")});c.store.reload({params:{}})}}]})})},getSearchPanel:function(){var b=this;this.ID_search_time=Ext.id();var a=new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",autoScroll:true,split:true,padding:5,defaults:{xtype:"textfield"},items:[{xtype:"combo",hiddenName:"storageid",fieldLabel:lang("housr"),editable:false,displayField:"storagename",valueField:"storageid",mode:"local",typeAhead:true,triggerAction:"all",store:new Ext.data.Store({autoLoad:true,baseParams:{key:"storagename"},proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=getComboStore",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"storagename"},{name:"storageid"}]})})},{xtype:"timeinterval",id:this.ID_search_time,fieldLabel:lang("statisticsTime"),season:false,year:false}]});return a},viewStockDetail:function(c,b){var a=Ext.getCmp(this.ID_search_time);stime=a.getSTime();etime=a.getETime();mainPanel.closeTab("CNOA_JXC_STOCK_DETAIL");mainPanel.loadClass("index.php?app=jxc&func=stock&action=report&task=loadPage&from=detail&storageId="+c+"&goodsId="+b+"&stime="+stime+"&etime="+etime,"CNOA_JXC_STOCK_DETAIL","库存明细","icon-table-insert")}};var CNOA_jxc_stock_rukuClass,CNOA_jxc_stock_ruku;CNOA_jxc_stock_rukuClass=CNOA.Class.create();CNOA_jxc_stock_rukuClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=stock&action=ruku";this.searchPanel=a.getSearchPanel();this.orderPanel=a.getOrderPanel();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.searchPanel,this.orderPanel],tbar:new Ext.Toolbar({items:[{text:lang("expandSearch"),handler:function(c){if(a.searchPanel.isVisible()){c.setText(lang("expandSearch"));a.searchPanel.hide()}else{c.setText(lang("foldSearch"));if(a.searchPanel.items.length<=0){var b=Ext.CustomSearchPanel.getCustomColumns(a.orderPanel.customColumns,a.baseUrl,a.searchPanel);a.searchPanel.add(b)}a.searchPanel.show()}a.mainPanel.doLayout()}},{text:lang("search"),handler:function(b){searchParams={};searchParams=a.searchPanel.getForm().getValues();a.orderPanel.store.reload({params:searchParams})}},{text:lang("clear"),style:"margin-left:5px",handler:function(b){searchParams={};Ext.each(a.searchPanel.getForm().items.items,function(d,c){if(d.xtype=="compositefield"){Ext.each(d.items.items,function(e){e.setValue("")})}else{d.setValue("")}});a.orderPanel.store.reload({params:{}})}}]})})},getOrderPanel:function(){var b=this;var a=new Ext.grid.CustomGridPanel({region:"center",border:false,storeUrl:b.baseUrl+"&task=getRukuList",customFiledUrl:b.baseUrl+"&task=getRukuCustomField",otherField:[{header:lang("opt"),dataIndex:"status",renderer:function(f,d,c){var e=c.json;return e.status==0?"":'<a href="javascript:void(0)" class="gridview" onclick="CNOA_jxc_stock_ruku.viewFlow('+e.uFlowId+')">'+lang("viewProcess")+"</a>"}},{header:lang("status"),dataIndex:"status",renderer:function(e,d,c){switch(c.json.status){case"0":return'<span style="color:green;">'+lang("beingModerate")+"</span>";case"1":return'<span style="color:red;">'+lang("endApp")+"</span>"}}}],loadMask:{msg:lang("waiting")},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){a.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){getFlowId4Engine("jxcRuku",function(d,c){d()})}}]})});return a},getSearchPanel:function(){var b=this;var a=new Ext.form.FormPanel({border:false,height:150,hidden:true,region:"north",labelAlign:"right",padding:5,autoScroll:true,split:true,defaults:{xtype:"textfield"}});return a},viewFlow:function(a){getFlowId4Engine("jxcRuku",function(c,b){b(a)})}};var CNOA_jxc_base_outputtypeClass,CNOA_jxc_base_outputtype;CNOA_jxc_base_outputtypeClass=CNOA.Class.create();CNOA_jxc_base_outputtypeClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=jxc&func=base&action=outputtype";a.mainPanel=a.getOutputtypePanel()},getOutputtypePanel:function(){var d=this;var a=[{name:"id"},{name:"name"},{name:"outputtype"}],b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getOutputtypeList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})}),c=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"名称",dataIndex:"name"},{header:"类型",dataIndex:"outputtype",width:120},{header:lang("opt"),dataIndex:"id",width:100,renderer:function(k,g,e){var j=e.json,f="";var i="<a href='javascript:void(0);' class='gridview' onclick='CNOA_jxc_base_outputtype.editOutputtype("+k+',"'+j.name+'",'+j.mid+")'>"+lang("modify")+"</a>";i+=" <a href='javascript:void(0);' class='gridview4' onclick='CNOA_jxc_base_outputtype.deleteOutputtype("+k+")'>"+lang("del")+"</a>";return i}}]});return new Ext.grid.GridPanel({border:false,hideBorders:true,loadMask:{msg:lang("waiting")},store:b,cm:c,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.editOutputtype()}}]})})},editOutputtype:function(e,b,a){var c=this;form=new Ext.form.FormPanel({border:false,labelWidth:60,autoWidth:true,waitMsgTarget:true,bodyStyle:"padding:5px",items:[{xtype:"textfield",fieldLabel:"名称",name:"name",width:400,allowBlank:false},{xtype:"combo",fieldLabel:lang("belongFunction"),hiddenName:"mid",valueField:"id",displayField:"name",mode:"local",editable:false,triggerAction:"all",width:400,allowBlank:false,store:new Ext.data.ArrayStore({fields:["id","name"],data:[[3,lang("warehousing")],[4,lang("outbound")]]})}]}),submit=function(){form.getForm().submit({url:c.baseUrl+"&task=submitOutputtype",method:"POST",waitMsg:lang("waiting"),params:params,success:function(f,g){CNOA.msg.notice(g.result.msg);d.close();c.mainPanel.store.load()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})},title="增加出入库类型",params={};if(e){title="修改出入库类型";params.id=e;form.getForm().findField("mid").setValue(a);form.getForm().findField("name").setValue(b)}var d=new Ext.Window({title:title,width:492,height:180,modal:true,resizable:false,layout:"fit",items:form,buttons:[{text:lang("save"),handler:function(f){submit()}},{text:lang("close"),handler:function(f){d.close()}}]}).show()},deleteOutputtype:function(b){var a=this;CNOA.msg.cf("确定删除？",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delOutputtype",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);a.mainPanel.store.load()}else{CNOA.msg.notice2(d.msg)}}})}})}};var sm_jxc_mgr=1;
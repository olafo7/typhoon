var CNOA_oltest_oltest_inspect,CNOA_oltest_oltest_inspectClass;CNOA_oltest_oltest_inspectClass=CNOA.Class.create();CNOA_oltest_oltest_inspectClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=inspect";this.searchParams={record_id:"",user_id:""};this.paperTree=this.testPaper();this.usersTree=this.testUsers();this.mainpanel=this.titleList();this.westPanel=new Ext.Panel({border:false,region:"west",layout:"border",width:500,items:[this.paperTree,this.usersTree]});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.westPanel,this.mainpanel]})},testPaper:function(){var d=this;var b=new Ext.tree.AsyncTreeNode({expanded:true});var c=new Ext.tree.TreeLoader({dataUrl:d.baseUrl+"&task=getPaperList"});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:300,minWidth:220,maxWidth:500,rootVisible:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:c,root:b,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:["考卷"]}),listeners:{click:function(e){d.searchParams.record_id=e.attributes.id;d.usersRoot.reload()}}});return a},testUsers:function(){var c=this;this.usersRoot=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({baseParams:c.searchParams,dataUrl:c.baseUrl+"&task=getUsersList"});var a=new Ext.tree.TreePanel({border:false,region:"center",width:200,minWidth:50,maxWidth:320,rootVisible:false,autoScroll:true,bodyStyle:"border-left-width:1px;",loader:b,root:c.usersRoot,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("attendee")]}),listeners:{click:function(d){c.searchParams.user_id=d.attributes.id;$(d.getUI().elNode).find("a>span").css("color","red");c.store.reload()}}});return a},titleList:function(){var g=this;var b=[{name:"id"},{name:"paper"},{name:"qid"},{name:"answer"},{name:"titleScore"},{name:"score"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getTitleList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});makeOperate=function(k,j,h){var l=h.json.id,i=h.json.titleScore;return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_oltest_oltest_inspect.giveScore("+l+","+i+");'>打分</a>"};var e=function(i,h){h.attr='style="white-space:pre-wrap;"';return i};var a=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("testPaper"),dataIndex:"paper",width:220},{header:lang("qid"),dataIndex:"qid",width:60},{header:lang("answer"),dataIndex:"answer",width:400,renderer:e},{header:"得分",dataIndex:"score",width:60},{header:"总分",dataIndex:"titleScore",hidden:true},{header:lang("opt"),dataIndex:"",width:120,renderer:makeOperate}]});var f=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:g.store,pageSize:15});var d=new Ext.grid.GridPanel({border:false,store:g.store,cm:a,bbar:f,tbar:new Ext.Toolbar({items:[{xtype:"button",text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.store.reload()}}]})});var c=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[d]});return c},giveScore:function(f,a){var e=this;if(!a){a=""}var b=new Ext.form.FormPanel({border:false,padding:10,labelWidth:100,labelAlign:"right",padding:10,autoScroll:true,buttonAlign:"right",items:[{xtype:"displayfield",style:"color: red",name:"refAnswer",autoScroll:true,fieldLabel:"参考答案("+a+"分)"},{xtype:"displayfield",name:"userAnswer",autoScroll:true,fieldLabel:"考生答案"},{xtype:"textfield",fieldLabel:"分数",allowBlank:false,name:"giveScore"}]});b.getForm().load({url:e.baseUrl+"&task=loadForm",method:"POST",params:{id:f}});var d=new Ext.Window({width:500,height:350,layout:"fit",items:[b],buttons:[{text:lang("ok"),handler:function(){var g=b.getForm().findField("giveScore").getValue();if(g>a){CNOA.msg.alert("分数不能大于题目总分");return}c()}},{text:lang("cancel"),handler:function(){d.close()}}]});var c=function(){if(!b.getForm().isValid()){return}b.getForm().submit({url:e.baseUrl+"&task=submit",method:"POST",params:{id:f,titleScore:a},success:function(g,h){d.close();e.store.reload();CNOA.msg.notice2(h.result.msg)},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})};d.show()}};var CNOA_oltest_oltest_invigilation,CNOA_oltest_oltest_invigilationClass;CNOA_oltest_oltest_invigilationClass=CNOA.Class.create();CNOA_oltest_oltest_invigilationClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=invigilation";this.searchParams={searchName:""};this.mypanel=a.myPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.mypanel]})},myPanel:function(){var g=this;var f=[{name:"id"},{name:"paper"},{name:"persons"},{name:"stime"},{name:"etime"},{name:"ttime"},{name:"status"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getJsonData"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var i=function(l,k){k.attr='style="white-space:pre-wrap;"';return l};var h=function(n,l,k){var p=k.json.id,o=k.json.stimeStr,m=k.json.nowtime;if(m<o){return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_oltest_oltest_invigilation.updateTime("+p+");'>时间调整</a><a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_oltest_oltest_invigilation.testOperate("+p+");'>取消考试</a>"}};var d=new Ext.grid.CheckboxSelectionModel();var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:"试卷",dataIndex:"paper",width:320},{header:"参加考试人员",dataIndex:"persons",width:300,renderer:i},{header:"开考时间",dataIndex:"stime",width:150},{header:"结束时间",dataIndex:"etime",width:150},{header:"总时间(分钟)",dataIndex:"ttime",width:80},{header:lang("status"),dataIndex:"status",width:80},{header:lang("opt"),dataIndex:"",width:165,renderer:h}]});var e=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:this.gridstore,cm:j,sm:d,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(k){var l=b.getSelectionModel().getSelections();if(l.length==0){CNOA.miniMsg.alertShowAt(k,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(m){if(m=="yes"){var n=[];Ext.each(l,function(p,o){n.push(p.json.id)});g.delRecord(n.join(","))}})}}},c,{text:lang("search"),iconCls:"icon-search",listeners:{click:function(k){g.searchParams.searchName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",items:[b]});return a},testOperate:function(b){var a=this;CNOA.msg.cf("您确定要取消考试吗？",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=testOperate",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.gridstore.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},updateTime:function(e){var d=this;var a=new Ext.form.FormPanel({border:false,padding:10,labelAlign:"right",labelWidth:70,items:[{xtype:"datetimefield",allowBlank:false,name:"stime",format:"Y-m-d H:i:s",editable:false,fieldLabel:lang("startTime"),minValue:new Date(),id:"ID_STARTTIME",listeners:{select:function(i,j){var f=Ext.getCmp("ID_STARTTIME").getValue().valueOf();var h=Ext.getCmp("ID_ENDTIME").getValue().valueOf();if(h){if(h<f){CNOA.msg.alert(lang("StimeGreaterThanEtime"));Ext.getCmp("ID_STARTTIME").setValue("");Ext.getCmp("ID_ENDTIME").setValue("");return}var g=parseInt((h-f)/1000/60);Ext.getCmp("ID_TOTALTIME").setValue(g+lang("minute"))}}}},{xtype:"datetimefield",allowBlank:false,name:"etime",editable:false,format:"Y-m-d H:i:s",id:"ID_ENDTIME",fieldLabel:lang("endTime"),minValue:new Date(),listeners:{select:function(i,j){var f=Ext.getCmp("ID_STARTTIME").getValue().valueOf();var h=Ext.getCmp("ID_ENDTIME").getValue().valueOf();if(f){if(h<f){CNOA.msg.alert(lang("StimeGreaterThanEtime"));Ext.getCmp("ID_STARTTIME").setValue("");Ext.getCmp("ID_ENDTIME").setValue("");return}var g=parseInt((h-f)/1000/60);Ext.getCmp("ID_TOTALTIME").setValue(g+lang("minute"))}}}},{xtype:"displayfield",fieldLabel:"总时间",id:"ID_TOTALTIME"}]});var b=new Ext.Window({width:300,height:180,modal:true,layout:"fit",items:[a],buttons:[{text:lang("modify"),handler:function(){c()}},{text:lang("close"),handler:function(){b.close()}}]});var c=function(){if(!a.getForm().isValid()){return}a.getForm().submit({url:d.baseUrl+"&task=updateTime",method:"POST",params:{record_id:e},success:function(f,g){b.close();d.gridstore.reload();CNOA.msg.notice2(g.result.msg)},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})};b.show()},delRecord:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delRecord",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.notice2(d.msg);b.gridstore.reload()}else{CNOA.msg.alert(d.msg)}}})}};var CNOA_oltest_oltest_mgr,CNOA_oltest_oltest_mgrClass;CNOA_oltest_oltest_mgrClass=CNOA.Class.create();CNOA_oltest_oltest_mgrClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=mgr";this.TYPE_RADIO=1;this.TYPE_CHECKBOX=2;this.TYPE_JUDGE=3;this.TYPE_SUBJECTIVE=4;this.ID_container=Ext.id();this.ID_judgeContainer=Ext.id();this.ID_UPLOAD=Ext.id();this.ID_TITLE_SCORE=Ext.id();this.ID_paper_sort=Ext.id();this.ID_paper_sortName=Ext.id();this.paperSort=0;this.searchParams={paper:"",searchName:""};this.panelTree=this.treePanel();this.mainpanel=this.main();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.panelTree,this.mainpanel]})},treePanel:function(){var c=this;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getPaperList"});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:250,minWidth:220,maxWidth:320,rootVisible:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:b,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("testPaper")]}),listeners:{click:function(d){c.searchParams.paper=c.treeId=d.attributes.id;c.treeText=d.attributes.text;c.store.load()}}});return a},main:function(){var g=this;var f=[{name:"id"},{name:"type"},{name:"paper"},{name:"qid"},{name:"title"},{name:"score"},{name:"addtime"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{load:function(){if(g.treeId){Ext.Ajax.request({url:g.baseUrl+"&task=titleScore",method:"POST",params:{paperId:g.treeId},success:function(j){var l=Ext.decode(j.responseText);var k="单选题: "+l.danxuan+" 分   多选题: "+l.duoxuan+" 分   判断题: "+l.panduan+" 分   主观题: "+l.zhuguan+" 分";Ext.getCmp(g.ID_TITLE_SCORE).setValue(k)}})}}}});makeOperate=function(l,k,j){var n=j.json.id,m=j.json.title;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_oltest_oltest_mgr.titleImg("+n+");'>"+lang("picture")+"</a><a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_oltest_oltest_mgr.viewAnswer("+n+");'>答案设置</a>"};var h=function(k,j){j.attr='style="white-space:pre-wrap;"';return k};var d=new Ext.grid.CheckboxSelectionModel();var i=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("qid"),dataIndex:"qid",width:60,editor:true},{header:lang("topic"),dataIndex:"title",width:500,editor:new Ext.form.TextArea({height:100,allowBlank:false}),renderer:h},{header:lang("score"),dataIndex:"score",width:60,editor:true},{header:lang("testPaper"),dataIndex:"paper",width:220},{header:lang("titleType"),dataIndex:"type",width:80},{header:lang("addTime"),dataIndex:"addtime",width:120},{header:lang("opt"),dataIndex:"",width:135,renderer:makeOperate}]});var e=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:g.store,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.EditorGridPanel({border:false,store:g.store,sm:d,cm:i,bbar:e,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{xtype:"button",text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){g.addEditWin()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=b.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){var m=[];Ext.each(k,function(o,n){m.push(o.json.id)});g.delTitle(m.join(","))}})}}},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),c,{text:lang("search"),listeners:{click:function(j){g.searchParams.searchName=c.getValue();g.store.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.store.reload()}},{text:"生成新试卷",cls:"btn-blue3",handler:function(j){var l=b.getSelectionModel().getSelections();if(l.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{var k=[];Ext.each(l,function(n,m){k.push(n.json.id)});g.newPaper(k.join(","))}}},{xtype:"displayfield",id:g.ID_TITLE_SCORE}]}),listeners:{afteredit:function(m){var l=m.field,j=m.record.get("id"),k=m.value;if(j!=""&&k!=""){Ext.Ajax.request({url:g.baseUrl+"&task=editTitle",method:"POST",params:{title_id:j,value:k,field:l},success:function(n){var o=Ext.decode(n.responseText);if(o.success){g.store.reload();CNOA.msg.notice2(o.msg)}else{g.store.reload();CNOA.msg.alert(o.msg)}}})}}}});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},addEditWin:function(){var d=this;this.optionCount=0;this.optionsField=new Ext.Panel({layout:"form",labelWidth:20,border:false,items:[]});this.addOption("");var a=new Ext.form.FormPanel({border:false,padding:10,labelAlign:"right",autoScroll:true,items:[{xtype:"fieldset",title:lang("add"),defaults:{width:192},items:[{xtype:"hidden",name:"title_id"},{xtype:"textarea",fieldLabel:lang("topic"),width:260,allowBlank:false,name:"title"},{xtype:"numberfield",fieldLabel:lang("qid"),allowBlank:false,name:"qid"},{xtype:"combo",editable:false,allowBlank:false,fieldLabel:lang("testPaper"),typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",hiddenName:"paperId",valueField:"paperId",displayField:"paperName",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getPaperCombo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["paperId","paperName"]})})},{xtype:"combo",allowBlank:false,editable:false,fieldLabel:lang("titleType"),typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",hiddenName:"typeId",valueField:"typeId",displayField:"typeName",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getTypeCombo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["typeId","typeName"]})}),listeners:{select:function(g,e,f){d.paperSort=e.data.typeId%4+1;if(d.paperSort==d.TYPE_JUDGE){Ext.getCmp(d.ID_container).hide();Ext.getCmp("ID_SUB").hide();Ext.getCmp("ID_RIGHT").enable();Ext.getCmp("ID_WRONG").enable();Ext.getCmp(d.ID_judgeContainer).show()}else{if(d.paperSort==d.TYPE_SUBJECTIVE){Ext.getCmp(d.ID_container).hide();Ext.getCmp("ID_RIGHT").setDisabled(true);Ext.getCmp("ID_WRONG").setDisabled(true);Ext.getCmp(d.ID_judgeContainer).hide();Ext.getCmp("ID_SUB").show()}else{Ext.getCmp("ID_RIGHT").setDisabled(true);Ext.getCmp("ID_WRONG").setDisabled(true);Ext.getCmp("ID_SUB").hide();Ext.getCmp(d.ID_judgeContainer).hide();Ext.getCmp(d.ID_container).show()}}}}},{xtype:"numberfield",allowBlank:false,fieldLabel:lang("score"),name:"score"},{xtype:"displayfield",html:'<span style="color: #777;font-size: 10px;">只能上传jpg、png、gif格式(2MB以内)</span>'},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",id:this.ID_UPLOAD,inputPre:"filesUpload"},{xtype:"container",border:false,width:400,id:this.ID_container,fieldLabel:lang("answerOptions"),items:[d.optionsField,{xtype:"button",text:lang("add")+lang("answerOptions"),handler:function(){d.addOption()}}]},{xtype:"container",border:false,width:400,hidden:true,id:this.ID_judgeContainer,fieldLabel:lang("answerOptions"),items:[new Ext.Panel({border:false,layout:"form",labelWidth:20,items:[{xtype:"textfield",width:167,name:"judge[]",fieldLabel:"1",id:"ID_RIGHT",readOnly:true,value:lang("right")},{xtype:"textfield",width:167,fieldLabel:"2",id:"ID_WRONG",name:"judge[]",readOnly:true,value:lang("mistake")}]})]},{xtype:"textarea",border:false,width:260,hidden:true,name:"subjective",id:"ID_SUB",fieldLabel:lang("answersFor")}]}]});var c=new Ext.Window({width:500,modal:true,height:600,layout:"fit",items:[a],buttons:[{text:lang("save"),handler:function(){b(false)}},{text:lang("saveAndClose"),cls:"btn-blue4",handler:function(){b(true)}},{text:lang("close"),handler:function(){c.close()}}],listeners:{afterrender:function(){if(d.treeId&&d.treeText){a.getForm().findField("paperId").setValue(d.treeId);a.getForm().findField("paperId").setRawValue(d.treeText)}}}});var b=function(e){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=submit",method:"POST",success:function(f,g){Ext.getCmp(d.ID_UPLOAD).setValue("");d.store.reload();if(e){c.close()}CNOA.msg.notice2(g.result.msg)},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};c.show()},createOption:function(a){return new Ext.form.TextField({width:167,name:"options[]",fieldLabel:this.optionCount,inputType:"text",value:a})},addOption:function(e){e=e||"";if(typeof(e)=="object"&&e.length){var b=[];for(var c=0,a=e.length;c<a;c++){this.optionCount+=1;b.push(this.createOption(e[c].optionName))}this.optionsField.add(b)}else{this.optionCount+=1;var d=this.createOption(e);this.optionsField.add(d)}this.optionsField.doLayout()},delTitle:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delTitle",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.notice2(d.msg);b.store.reload()}else{CNOA.msg.alert(d.msg)}}})},sortTree:function(){var c=this;this.root=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false,listeners:{load:function(d){c.root.expand(true)}}});var a=new Ext.tree.TreePanel({border:false,animate:false,autoScroll:true,containerScroll:true,rootVisible:false,lines:true,checkModel:"single",loader:b,root:this.root,bodyStyle:"background-color: #FFF;",tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand2,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(d,e){if(e){d.setIconClass("icon-expand-all");d.setText(lang("expand"));d.setTooltip(lang("expandMenuTip"));c.root.collapse(true);c.root.firstChild.expand()}else{d.setIconClass("icon-collapse-all");d.setText(lang("collapse"));d.setTooltip(lang("collapseMenuTip"));c.root.expand(true)}}}]}),listeners:{checkchange:function(g,f){if(f){var d=a.getChecked();if(d&&d.length){for(var e=0;e<d.length;e++){if(d[e].id!=g.id){d[e].getUI().toggleCheck(false);d[e].attributes.checked=false}}}c.nodeId=g.id;c.nodeText=g.text}else{c.nodeId="";c.nodeText=""}}}});this.TreeWin=new Ext.Window({border:false,width:400,height:500,layout:"fit",modal:true,buttonAlign:"right",buttons:[{text:lang("ok"),handler:function(){if(c.nodeId){Ext.getCmp(c.ID_paper_sort).setValue(c.nodeId);Ext.getCmp(c.ID_paper_sortName).setValue(c.nodeText);c.TreeWin.close()}}},{text:lang("cancel"),handler:function(){c.root.reload();c.TreeWin.close()}}],items:[a]});this.TreeWin.show()},newPaper:function(b){var d=this;paperForm=new Ext.FormPanel({border:false,padding:20,labelWidth:60,labelAlign:"right",items:[{xtype:"hidden",name:"sortId",id:d.ID_paper_sort},{xtype:"textfield",fieldLabel:"试卷分类",id:d.ID_paper_sortName,name:"sortName",allowBlank:false,listeners:{focus:function(f,e){d.sortTree()}}},{xtype:"textfield",fieldLabel:"试卷名称",allowBlank:false,name:"newPaperName"}]});var a=new Ext.Window({title:"生成新试卷",width:300,modal:true,height:200,layout:"fit",items:[paperForm],buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){c()}}]});var c=function(){if(!paperForm.getForm().isValid()){return}paperForm.getForm().submit({url:d.baseUrl+"&task=saveNewPaper",method:"POST",params:{ids:b},success:function(e,f){a.close();d.store.reload();d.treeRoot.reload();CNOA.msg.notice2(f.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg)}})};a.show()},viewAnswer:function(b){var f=this;var c=[{name:"id"},{name:"answer"},{name:"status"},{name:"statusText"}];this.answerStore=new Ext.data.Store({autoLoad:{params:{id:b}},proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getAnswerList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c})});var i=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var d=function(m,l,k){var n=k.json.id,j=k.json.status;if(j==1){return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_oltest_oltest_mgr.setAnswer("+n+","+j+");'>设置为错误</a>"}else{if(j==0){return"<a class='gridview2' href='javascript:void(0);' onclick='CNOA_oltest_oltest_mgr.setAnswer("+n+","+j+");'>设置为正确</a>"}}};var g=function(k,j){j.attr='style="white-space:pre-wrap;"';return k};var e=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),i,{header:"id",dataIndex:"id",hidden:true},{header:"答案",dataIndex:"answer",width:300,editor:new Ext.form.TextArea({allowBlank:false}),renderer:g},{header:"status",dataIndex:"status",hidden:true},{header:lang("status"),dataIndex:"statusText",width:120},{header:lang("opt"),dataIndex:"",width:120,renderer:d}]});var h=new Ext.grid.EditorGridPanel({border:false,store:this.answerStore,sm:i,cm:e,listeners:{afteredit:function(l){var j=l.record.get("id"),k=l.value;if(j!=""&&k!=""){Ext.Ajax.request({url:f.baseUrl+"&task=editAnswer",method:"POST",params:{answer_id:j,value:k},success:function(m){var n=Ext.decode(m.responseText);if(n.success){f.answerStore.reload();CNOA.msg.notice2(n.msg)}else{f.answerStore.reload();CNOA.msg.alert(n.msg)}}})}}}});var a=new Ext.Window({width:650,height:450,modal:true,layout:"fit",tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){var j=new Ext.Window({title:"添加新答案",width:300,modal:true,layout:"fit",height:180,items:[new Ext.Panel({layout:"form",labelWidth:50,padding:10,border:false,items:[{xtype:"textarea",width:200,allowBlank:false,id:"newAnswer",fieldLabel:"新答案"}]})],buttons:[{text:lang("save"),handler:function(){var k=Ext.getCmp("newAnswer").getValue();if(k){Ext.Ajax.request({url:f.baseUrl+"&task=addNewAnswer",method:"POST",params:{title_id:b,newAnswer:k},success:function(l){var m=Ext.decode(l.responseText);if(m.success==true){f.answerStore.reload();j.close();CNOA.msg.notice2(m.msg)}else{CNOA.msg.alert(m.msg)}}})}}}]});j.show()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=h.getSelectionModel().getSelected().data.id;if(k){Ext.Ajax.request({url:f.baseUrl+"&task=delAnswer",params:{answerId:k},success:function(l){var m=Ext.decode(l.responseText);if(m.success==true){f.answerStore.reload();CNOA.msg.notice2(m.msg)}else{CNOA.msg.alert(m.msg)}}})}}},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>")]}),buttons:[{text:"关闭",handler:function(){a.close()}}],items:[h]});a.show()},setAnswer:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=setAnswer",params:{id:c,status:a},method:"POST",success:function(e){var d=Ext.decode(e.responseText);if(d.success==true){b.answerStore.reload();CNOA.msg.notice2(lang("successopt"))}else{if(d.failure==true){CNOA.msg.alert(d.msg)}}}})},titleImg:function(f){var e=this;var a=[{name:"id"},{name:"oldName"}];this.photoStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getImgList&id="+f}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var b=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"oldName",width:320}]});this.photoGrid=new Ext.grid.GridPanel({columnWidth:0.6,height:300,border:false,store:this.photoStore,cm:c,sm:b,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.photoGrid.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.updatePhoto(f)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=e.photoGrid.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(i){if(i=="yes"){var j=[];Ext.each(h,function(l,k){j.push(l.json.id)});e.delImages(j.join(","))}})}}}],listeners:{rowclick:function(h,k,j){var i=h.getSelectionModel().getSelected();var g=i.id;e.getOneImg(g)}}});var d=new Ext.Window({title:lang("picture"),width:720,height:400,layout:"fit",border:false,modal:true,items:[new Ext.Panel({layout:"column",items:[this.photoGrid,new Ext.Panel({border:false,height:400,bodyStyle:"padding: 50px 0px 0px 0px;border-left: 1px solid #99BBE8",columnWidth:0.4,items:[{border:false,html:'<div style="width:273px;height:206px;padding:3px;display: table-cell;vertical-align: middle;text-align: center;"><img style="max-width: 267px; max-height: 200px; border: 0px;overflow:hidden;" src="" id="CNOA_OLTEST_INFO_IMAGES"></div>'}]})]})]}).show()},updatePhoto:function(b){var a=this;this.FACE_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"images",allowBlank:false,blankText:lang("updateFaceBlankText"),buttonCfg:{text:lang("browse")},hideLabel:true,width:370}],buttons:[{text:lang("save"),handler:function(){if(this.FACE_WINDOW_FORMPANEL.getForm().isValid()){this.FACE_WINDOW_FORMPANEL.getForm().submit({url:a.baseUrl+"&task=addImages",waitMsg:lang("waiting"),params:{id:b},success:function(c,d){Ext.fly("CNOA_OLTEST_INFO_IMAGES").dom.src=d.result.msg;a.photoStore.reload();a.FACE_WINDOW.close()},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.FACE_WINDOW.close()})}})}}.createDelegate(this)},{text:lang("close"),handler:function(){a.FACE_WINDOW.close()}}]});this.FACE_WINDOW=new Ext.Window({width:398,height:130,autoScroll:false,modal:true,resizable:false,title:lang("upload")+lang("photo"),items:[this.FACE_WINDOW_FORMPANEL]}).show()},getOneImg:function(a){var b=this;if(!a){return}Ext.Ajax.request({url:b.baseUrl+"&task=getOneImg",params:{id:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);Ext.fly("CNOA_OLTEST_INFO_IMAGES").dom.src=d.msg}})},delImages:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delImages",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.alert(d.msg);b.photoGrid.store.reload()}}})}};var CNOA_oltest_oltest_mytest,CNOA_oltest_oltest_mytestClass;CNOA_oltest_oltest_mytestClass=CNOA.Class.create();CNOA_oltest_oltest_mytestClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=mytest";this.searchParams={searchName:""};this.myPanel=this.myTestPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.myPanel]})},myTestPanel:function(){var g=this;var f=[{name:"id"},{name:"status"},{name:"paper"},{name:"proctor"},{name:"stime"},{name:"etime"},{name:"radioScore"},{name:"checkboxScore"},{name:"judgeScore"},{name:"subScore"},{name:"totalScore"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=myTestList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.grid.CheckboxSelectionModel();var h=function(l,k,j){var m=j.json.id;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_oltest_oltest_mytest.viewTest("+m+");'>查看</a>"};var i=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:"考卷",dataIndex:"paper",width:300},{header:"监考人",dataIndex:"proctor",width:100},{header:"开始时间",dataIndex:"stime",width:150},{header:"结束时间",dataIndex:"etime",width:150},{header:"单选题(分)",dataIndex:"radioScore",width:80},{header:"多选题(分)",dataIndex:"checkboxScore",width:80},{header:"判断题(分)",dataIndex:"judgeScore",width:80},{header:"主观题(分)",dataIndex:"subScore",width:80},{header:"(总分)",dataIndex:"totalScore",width:80},{header:lang("opt"),dataIndex:"",renderer:h}]});var e=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:this.gridstore,cm:i,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},c,{text:lang("search"),listeners:{click:function(j){g.searchParams.searchName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",items:[b]});return a},viewTest:function(b){var a=this;window.open(a.baseUrl+"&task=viewTest&id="+b,"viewTest","width=1600, height="+(screen.availHeight-200)+",left="+((screen.availWidth-1600)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")}};var CNOA_oltest_oltest_paper,CNOA_oltest_oltest_paperClass;CNOA_oltest_oltest_paperClass=CNOA.Class.create();CNOA_oltest_oltest_paperClass.prototype={init:function(){var a=this;this.ID_text_name=Ext.id();this.ID_text_fid=Ext.id();this.ID_text_fname=Ext.id();this.ID_text_order=Ext.id();this.ID_text_sort=Ext.id();this.ID_paper_sort=Ext.id();this.ID_paper_sortName=Ext.id();this.ID_paper_name=Ext.id();this.ID_attendUids=Ext.id();this.ID_proctor=Ext.id();this.ID_inspector=Ext.id();this.baseUrl="index.php?app=oltest&func=oltest&action=paper";this.searchParams={sort:"",searchName:""};this.treepanel=this.treePanel();this.panel=this.mPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.treepanel,this.panel]})},treePanel:function(){var b=this;this.ID_btn_collapseExpand=Ext.id();this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:b.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){b.treeRoot.expand(true)}}});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:250,minWidth:220,maxWidth:320,rootVisible:false,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:this.treeLoader,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(c,d){if(d){c.setText(lang("expand"));c.setTooltip(lang("expandMenuTip"));b.treeRoot.collapse(true);b.treeRoot.firstChild.expand()}else{c.setText(lang("collapse"));c.setTooltip(lang("collapseMenuTip"));b.treeRoot.expand(true)}}},"->",{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){b.addSortWin();Ext.getCmp(b.ID_text_sort).setValue("");Ext.getCmp(b.ID_text_name).setValue("");Ext.getCmp(b.ID_text_fid).setValue("");Ext.getCmp(b.ID_text_order).setValue("");Ext.getCmp(b.ID_text_fname).setValue("");Ext.getCmp(b.ID_text_fname).enable();if(b.sort&&b.sortText){Ext.getCmp(b.ID_text_fid).setValue(b.sort);Ext.getCmp(b.ID_text_fname).setValue(b.sortText)}}},{handler:function(c,d){b.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},("<span style='color:#999'>右键可编辑</span>")]}),contextMenu:new Ext.menu.Menu({items:[{iconCls:"edit",text:lang("modify")},{iconCls:"delete",text:lang("del")}],listeners:{itemclick:function(e){var d=e.parentMenu.contextNode.attributes;var c=e.parentMenu.contextNode.parentNode;switch(e.iconCls){case"edit":b.updateTree(d,c);break;case"delete":b.deleteTree(d);break}e.parentMenu.hide()}}}),listeners:{click:function(c){b.searchParams.sort=b.sort=c.attributes.id;b.sortText=c.attributes.text;b.gridstore.reload()},contextmenu:function(f,g){appContextmenu=false;f.select();var d=f.getOwnerTree();var h=d.contextMenu;h.contextNode=f;h.showAt(g.getXY())}}});return a},sortTree:function(c){var d=this;this.root=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:d.baseUrl+"&task=getSortList&type=combo",preloadChildren:true,clearOnLoad:false,listeners:{load:function(e){d.root.expand(true)}}});var a=new Ext.tree.TreePanel({border:false,animate:false,autoScroll:true,containerScroll:true,rootVisible:false,lines:true,checkModel:"single",loader:b,root:this.root,bodyStyle:"background-color: #FFF;",tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:this.ID_btn_collapseExpand2,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(e,f){if(f){e.setText(lang("expand"));e.setTooltip(lang("expandMenuTip"));d.root.collapse(true);d.root.firstChild.expand()}else{e.setText(lang("collapse"));e.setTooltip(lang("collapseMenuTip"));d.root.expand(true)}}}]}),listeners:{checkchange:function(h,g){if(g){var e=a.getChecked();if(e&&e.length){for(var f=0;f<e.length;f++){if(e[f].id!=h.id){e[f].getUI().toggleCheck(false);e[f].attributes.checked=false}}}d.nodeId=h.id;d.nodeText=h.text}else{d.nodeId="";d.nodeText=""}}}});this.TreeWin=new Ext.Window({border:false,width:400,height:500,layout:"fit",modal:true,buttonAlign:"right",buttons:[{text:lang("ok"),handler:function(){if(d.nodeId){if(c){Ext.getCmp(d.ID_text_fid).setValue(d.nodeId);Ext.getCmp(d.ID_text_fname).setValue(d.nodeText)}else{Ext.getCmp(d.ID_paper_sort).setValue(d.nodeId);Ext.getCmp(d.ID_paper_sortName).setValue(d.nodeText)}d.TreeWin.close()}}},{text:lang("cancel"),handler:function(){d.root.reload();d.TreeWin.close()}}],items:[a]});this.TreeWin.show()},addSortWin:function(){var a=this;this.formPanel=new Ext.FormPanel({padding:10,labelWidth:80,labelAlign:"right",items:[{xtype:"hidden",id:this.ID_text_sort},{xtype:"textfield",fieldLabel:lang("sortName"),name:"name",id:this.ID_text_name,allowBlank:false},{xtype:"hidden",name:"fid",id:this.ID_text_fid},{xtype:"textfield",fieldLabel:lang("sort2"),name:"fname",editable:false,allowBlank:false,id:this.ID_text_fname,listeners:{focus:function(c,b){a.sortTree(win=true)}}},{xtype:"numberfield",fieldLabel:lang("order"),name:"order",id:this.ID_text_order}],listeners:{beforerender:function(b){a.treeLength=a.treeRoot.childNodes.length;if(a.treeLength==0){Ext.getCmp(a.ID_text_fname).disable();Ext.getCmp(a.ID_text_fname).allowBlank=true;Ext.getCmp(a.ID_text_fname).hide()}}}});this.SortWin=new Ext.Window({border:false,width:300,height:200,modal:true,title:lang("addSort"),layout:"fit",buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){a.submitForm()}}],items:[a.formPanel]});this.SortWin.show()},mPanel:function(){var g=this;var f=[{name:"id"},{name:"sort"},{name:"sort_id"},{name:"name"},{name:"totalpoints"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.grid.CheckboxSelectionModel();var h=function(m,l,k){var n=k.json.id,j=k.json.totalpoints;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_oltest_oltest_paper.startUsing("+n+","+j+");'>设置考试</a><a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_oltest_oltest_paper.preview("+n+");'>预览试卷</a>"};var i=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:"试卷名称",dataIndex:"name",width:400},{header:"sort_id",dataIndex:"sort_id",hidden:true},{header:"分类",dataIndex:"sort",width:150},{header:"总分",dataIndex:"totalpoints",width:60},{header:lang("opt"),dataIndex:"",renderer:h,width:200}]});var e=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:g.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:g.gridstore,cm:i,sm:d,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){g.addPaperWin(lang("add"));Ext.getCmp(g.ID_paper_sort).setValue("");Ext.getCmp(g.ID_paper_sortName).setValue("");Ext.getCmp(g.ID_paper_name).setValue("");g.paper_id="";if(g.sort&&g.sortText){g.paperForm.getForm().findField("sortId").setValue(g.sort);g.paperForm.getForm().findField("sortName").setValue(g.sortText)}}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(j){var k=b.getSelectionModel().getSelected();if(k){g.addPaperWin(lang("modify"));g.paper_id=k.data.id;Ext.getCmp(g.ID_paper_sort).setValue(k.data.sort_id);Ext.getCmp(g.ID_paper_sortName).setValue(k.data.sort);Ext.getCmp(g.ID_paper_name).setValue(k.data.name)}else{CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=b.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){var m=[];Ext.each(k,function(o,n){m.push(o.json.id)});g.delPaper(m.join(","))}})}}},c,{text:lang("search"),listeners:{click:function(j){g.searchParams.searchName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},submitForm:function(){var a=this;if(!a.formPanel.getForm().isValid()){return}this.formPanel.getForm().submit({url:a.baseUrl+"&task=submit",method:"POST",params:{id:a.sort_id},success:function(b,c){Ext.getCmp(a.ID_text_fname).show();a.treeRoot.reload();a.SortWin.close();CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},submitForm2:function(){var a=this;if(!a.paperForm.getForm().isValid()){return}a.paperForm.getForm().submit({url:a.baseUrl+"&task=submit2",method:"POST",params:{paper_id:a.paper_id},success:function(b,c){a.addPaper.close();a.gridstore.reload();CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},updateTree:function(d,b){var h=this;var g=d.id,c=d.text,e=d.fid,a=d.order,f=b.text;h.sort_id=g;h.addSortWin();Ext.getCmp(h.ID_text_sort).setValue(g);Ext.getCmp(h.ID_text_name).setValue(c);Ext.getCmp(h.ID_text_fid).setValue(e);Ext.getCmp(h.ID_text_order).setValue(a);Ext.getCmp(h.ID_text_fname).setValue(f);Ext.getCmp(h.ID_text_fname).disable()},deleteTree:function(a){var b=this;if(a.children){CNOA.msg.alert("请先删除子节点");return}CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteSort",method:"POST",params:{id:a.id},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.sort="";b.sortText="";b.treeRoot.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},addPaperWin:function(a){var b=this;b.paperForm=new Ext.FormPanel({border:false,padding:20,labelWidth:60,labelAlign:"right",items:[{xtype:"hidden",name:"sortId",id:b.ID_paper_sort},{xtype:"textfield",fieldLabel:"试卷分类",id:b.ID_paper_sortName,name:"sortName",allowBlank:false,listeners:{focus:function(d,c){b.sortTree(win=false)}}},{xtype:"textfield",fieldLabel:"试卷名称",allowBlank:false,id:b.ID_paper_name,name:"paperName"}]});b.addPaper=new Ext.Window({title:a,width:300,modal:true,height:200,layout:"fit",items:[b.paperForm],buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){b.submitForm2()}}]});b.addPaper.show()},delPaper:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delPaper",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.notice2(d.msg);b.gridstore.reload()}else{CNOA.msg.alert(d.msg)}}})},startUsing:function(f,b){var e=this;var c=new Ext.form.FormPanel({border:false,padding:10,labelWidth:100,labelAlign:"right",items:[{xtype:"textarea",height:150,anchor:"-20",readOnly:true,fieldLabel:"参加考试人员",emptyText:"请选择参加考试人员",allowBlank:false,blankText:"请选择参加考试人员",name:"attendNames",listeners:{render:function(g){g.to=e.ID_attendUids},focus:function(g){people_selector("user",g,true,false)}}},{xtype:"hidden",id:this.ID_attendUids,name:"attendUids"},{xtype:"textfield",fieldLabel:"监考人",allowBlank:false,listeners:{render:function(g){g.to=e.ID_proctor},focus:function(g){people_selector("user",g,false,false)}}},{xtype:"hidden",id:e.ID_proctor,name:"proctor"},{xtype:"textfield",fieldLabel:"评审人",allowBlank:false,listeners:{render:function(g){g.to=e.ID_inspector},focus:function(g){people_selector("user",g,false,false)}}},{xtype:"hidden",id:e.ID_inspector,name:"inspector"},{xtype:"datetimefield",allowBlank:false,name:"stime",format:"Y-m-d H:i:s",editable:false,fieldLabel:lang("startTime"),minValue:new Date(),id:"ID_STARTTIME",listeners:{select:function(j,k){var g=Ext.getCmp("ID_STARTTIME").getValue().valueOf();var i=Ext.getCmp("ID_ENDTIME").getValue().valueOf();if(i){if(i<g){CNOA.msg.alert(lang("StimeGreaterThanEtime"));Ext.getCmp("ID_STARTTIME").setValue("");Ext.getCmp("ID_ENDTIME").setValue("");return}var h=parseInt((i-g)/1000/60);Ext.getCmp("ID_TOTALTIME").setValue(h+lang("minute"))}}}},{xtype:"datetimefield",allowBlank:false,name:"etime",editable:false,format:"Y-m-d H:i:s",id:"ID_ENDTIME",fieldLabel:lang("endTime"),minValue:new Date(),listeners:{select:function(j,k){var g=Ext.getCmp("ID_STARTTIME").getValue().valueOf();var i=Ext.getCmp("ID_ENDTIME").getValue().valueOf();if(g){if(i<g){CNOA.msg.alert(lang("StimeGreaterThanEtime"));Ext.getCmp("ID_STARTTIME").setValue("");Ext.getCmp("ID_ENDTIME").setValue("");return}var h=parseInt((i-g)/1000/60);Ext.getCmp("ID_TOTALTIME").setValue(h+lang("minute"))}}}},{xtype:"displayfield",fieldLabel:"总时间",id:"ID_TOTALTIME"}]});var a=new Ext.Window({width:570,height:360,modal:true,layout:"fit",items:[c],buttons:[{text:lang("save"),handler:function(){d(f)}},{text:lang("cancel"),handler:function(){a.close()}}]});var d=function(g){if(!c.getForm().isValid()){return}c.getForm().submit({url:e.baseUrl+"&task=saveSubmit",method:"POST",params:{paper_id:g,totalpoints:b},success:function(h,i){a.close();CNOA.msg.notice2(i.result.msg)},failure:function(h,i){CNOA.msg.alert(i.result.msg)}})};a.show()},preview:function(b){var a=this;window.open("index.php?app=oltest&func=oltest&action=test&task=loadOltest&id="+b,"viewTest","width=1600, height="+(screen.availHeight-200)+",left="+((screen.availWidth-1600)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")}};var CNOA_oltest_oltest_summary,CNOA_oltest_oltest_summaryClass;CNOA_oltest_oltest_summaryClass=CNOA.Class.create();CNOA_oltest_oltest_summaryClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=summary";this.searchParams={record_id:"",searchName:""};a.mainpanel=this.panel();a.paperList=this.paperPanel();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[a.paperList,a.mainpanel]})},paperPanel:function(){var d=this;var b=new Ext.tree.AsyncTreeNode({expanded:true});var a=new Ext.tree.TreeLoader({dataUrl:d.baseUrl+"&task=getPaperList",preloadChildren:true,clearOnLoad:false,listeners:{load:function(e){b.expand(true)}}});var c=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:280,minWidth:220,maxWidth:380,rootVisible:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:a,root:b,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:["考卷"]}),listeners:{click:function(e){d.searchParams.record_id=e.attributes.id;d.gridstore.reload()}}});return c},panel:function(){var e=this;var d=[{name:"id"},{name:"paper"},{name:"userName"},{name:"grade"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:e.searchParams,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var f=function(n,m,j){var k=j.json.recordid,l=j.json.uid;return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_oltest_oltest_summary.viewTest("+k+","+l+");'>查看考卷</a>"};var h=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"试卷",dataIndex:"paper",sortable:true,width:400},{header:"姓名",dataIndex:"userName",sortable:true,width:120},{header:"总分",dataIndex:"grade",sortable:true,width:60},{header:lang("opt"),dataIndex:"",width:80,renderer:f}]});var c=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:e.gridstore,pageSize:15});var b=Ext.id();var g=Ext.id();var a=new Ext.grid.GridPanel({border:false,store:e.gridstore,cm:h,bbar:c,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.gridstore.reload()}},{text:"生成圆形报表",iconCls:"icon-YXBB",cls:"btn-blue3",handler:function(){if(e.searchParams.record_id){e.chart(e.searchParams.record_id,1)}else{CNOA.msg.alert("请选择一张考卷");return}}},{text:"生成柱形报表",cls:"btn-blue3",iconCls:"icon-ZXBB",handler:function(){if(e.searchParams.record_id){e.chart(e.searchParams.record_id,2)}else{CNOA.msg.alert("请选择一张考卷");return}}},"姓名:",{xtype:"hidden",name:"selectName",id:b},{xtype:"textfield",width:130,id:g,readOnly:true,listeners:{render:function(j){j.to=b},focus:function(j){people_selector("user",j,false,false)}}},{text:lang("search"),listeners:{click:function(j){e.searchParams.searchName=Ext.getCmp(b).getValue();e.gridstore.reload({params:e.searchParams})}}},{text:lang("clear2"),handler:function(){e.searchParams.searchName="";Ext.getCmp(b).setValue("");Ext.getCmp(g).setValue("");e.gridstore.reload()}}]});var i=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[a]});return i},chart:function(a,b){var c=this;window.open(c.baseUrl+"&task=chart&record_id="+a+"&type="+b,"chart","width=700, height="+(screen.availHeight-430)+",left="+((screen.availWidth-700)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")},viewTest:function(a,b){window.open("index.php?app=oltest&func=oltest&action=mytest&task=viewTest&id="+a+"&uid="+b,"viewTest","width=800, height="+(screen.availHeight-300)+",left="+((screen.availWidth-700)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")}};var CNOA_oltest_oltest_test,CNOA_oltest_oltest_testClass;CNOA_oltest_oltest_testClass=CNOA.Class.create();CNOA_oltest_oltest_testClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=oltest&action=test";this.mainPanel=new Ext.Panel({border:false,html:'<iframe scrolling="auto" name="iframe" src="index.php?app=oltest&func=oltest&action=test&task=loadOltest" frameborder="0" width="100%" height="100%"></iframe>'})}};var CNOA_oltest_qt_list,CNOA_oltest_qt_listClass;CNOA_oltest_qt_listClass=CNOA.Class.create();CNOA_oltest_qt_listClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=qt&action=qtlist";this.searchParams={searchName:""};this.test=this.test();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.test]})},test:function(){var e=this;var c=[{name:"id"},{name:"name"},{name:"s_time"},{name:"e_time"},{name:"status"}];var b=function(k,i,h){var l=h.json.id,j=h.json.state;if(j==1){return"<a class='gridview' href='javascript:void(0);' style='text-decoration:none; ' onclick='CNOA_oltest_qt_list.getList("+l+");'>参与问卷</a>"}};var g=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel({border:false,defaults:{sortable:true,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"bid",hidden:true},{header:lang("nameOfQt"),dataIndex:"name",width:300},{header:lang("startTime"),dataIndex:"s_time",width:160},{header:lang("endTime"),dataIndex:"e_time",width:160},{header:lang("status"),dataIndex:"status",width:80},{header:lang("opt"),dataIndex:"",renderer:b}]});this.paperStore=new Ext.data.Store({autoLoad:true,baseParams:e.searchParams,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getUnderwayList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c})});var f=new Ext.PagingToolbar({displayInfo:true,store:e.paperStore,pageSize:15});var d=new Ext.form.TextField({width:130});this.grid=new Ext.grid.EditorGridPanel({border:false,store:e.paperStore,region:"center",sm:g,cm:a,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.paperStore.reload()}},lang("nameOfQt"),d,{text:lang("search"),listeners:{click:function(h){e.searchParams.searchName=d.getValue();e.paperStore.reload({params:e.searchParams})}}},{text:lang("clear2"),handler:function(){e.searchParams.searchName="";d.setValue("");e.paperStore.reload()}}],bbar:f});return this.grid},getList:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=check",params:{pid:b},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.failure==true){CNOA.msg.alert(d.msg)}else{mainPanel.closeTab("CNOA_MENU_OLTEST_QTSTART");mainPanel.loadClass("index.php?app=oltest&func=qt&action=qtlist&task=qtStart&id="+b,"CNOA_MENU_OLTEST_QTSTART",lang("questionnaire"),"icon-page-list")}}})}};var CNOA_oltest_qt_mgr,CNOA_oltest_qt_mgrClass;CNOA_oltest_qt_mgrClass=CNOA.Class.create();CNOA_oltest_qt_mgrClass.prototype={init:function(){var a=this;this.ID_text_name=Ext.id();this.ID_text_fid=Ext.id();this.ID_text_fname=Ext.id();this.ID_text_order=Ext.id();this.ID_text_sort=Ext.id();this.ID_paper_sort=Ext.id();this.ID_paper_sortName=Ext.id();this.ID_paper_name=Ext.id();this.ID_attendUids=Ext.id();this.ID_proctor=Ext.id();this.ID_inspector=Ext.id();this.baseUrl="index.php?app=oltest&func=qt&action=qtmgr";this.searchParams={sort:"",paperName:""};this.treepanel=this.treePanel();this.panel=this.mPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.treepanel,this.panel]})},treePanel:function(){var b=this;this.ID_btn_collapseExpand=Ext.id();this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:b.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(c){b.treeRoot.expand(true)}}});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:250,minWidth:220,maxWidth:320,rootVisible:false,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:this.treeLoader,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){b.addSortWin();Ext.getCmp(b.ID_text_sort).setValue("");Ext.getCmp(b.ID_text_name).setValue("");Ext.getCmp(b.ID_text_fid).setValue("");Ext.getCmp(b.ID_text_order).setValue("");Ext.getCmp(b.ID_text_fname).setValue("");Ext.getCmp(b.ID_text_fname).enable();if(b.sort&&b.sortText){Ext.getCmp(b.ID_text_fid).setValue(b.sort);Ext.getCmp(b.ID_text_fname).setValue(b.sortText)}}},("<span style='color:#999'>右键可编辑</span>"),{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(c,d){if(d){c.setText(lang("expand"));c.setTooltip(lang("expandMenuTip"));b.treeRoot.collapse(true);b.treeRoot.firstChild.expand()}else{c.setText(lang("collapse"));c.setTooltip(lang("collapseMenuTip"));b.treeRoot.expand(true)}}},"->",{handler:function(c,d){b.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]}),contextMenu:new Ext.menu.Menu({items:[{iconCls:"edit",text:lang("modify")},{iconCls:"delete",text:lang("del")}],listeners:{itemclick:function(e){var d=e.parentMenu.contextNode.attributes;var c=e.parentMenu.contextNode.parentNode;switch(e.iconCls){case"edit":b.updateTree(d,c);break;case"delete":b.deleteTree(d);break}e.parentMenu.hide()}}}),listeners:{click:function(c){b.searchParams.sort=b.sort=c.attributes.id;b.sortText=c.attributes.text;b.gridstore.reload()},contextmenu:function(f,g){appContextmenu=false;f.select();var d=f.getOwnerTree();var h=d.contextMenu;h.contextNode=f;h.showAt(g.getXY())}}});return a},sortTree:function(c){var d=this;this.root=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:d.baseUrl+"&task=getSortList&type=combo",preloadChildren:true,clearOnLoad:false,listeners:{load:function(e){d.root.expand(true)}}});var a=new Ext.tree.TreePanel({border:false,animate:false,autoScroll:true,containerScroll:true,rootVisible:false,lines:true,checkModel:"single",loader:b,root:this.root,bodyStyle:"background-color: #FFF;",tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),iconCls:"icon-expand-all",id:this.ID_btn_collapseExpand2,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(e,f){if(f){e.setIconClass("icon-expand-all");e.setText(lang("expand"));e.setTooltip(lang("expandMenuTip"));d.root.collapse(true);d.root.firstChild.expand()}else{e.setIconClass("icon-collapse-all");e.setText(lang("collapse"));e.setTooltip(lang("collapseMenuTip"));d.root.expand(true)}}}]}),listeners:{checkchange:function(h,g){if(g){var e=a.getChecked();if(e&&e.length){for(var f=0;f<e.length;f++){if(e[f].id!=h.id){e[f].getUI().toggleCheck(false);e[f].attributes.checked=false}}}d.nodeId=h.id;d.nodeText=h.text}else{d.nodeId="";d.nodeText=""}}}});this.TreeWin=new Ext.Window({border:false,width:400,height:500,layout:"fit",modal:true,buttonAlign:"right",buttons:[{text:lang("ok"),handler:function(){if(d.nodeId){if(c){Ext.getCmp(d.ID_text_fid).setValue(d.nodeId);Ext.getCmp(d.ID_text_fname).setValue(d.nodeText)}else{Ext.getCmp(d.ID_paper_sort).setValue(d.nodeId);Ext.getCmp(d.ID_paper_sortName).setValue(d.nodeText)}d.TreeWin.close()}}},{text:lang("cancel"),handler:function(){d.root.reload();d.TreeWin.close()}}],items:[a]});this.TreeWin.show()},addSortWin:function(){var a=this;this.formPanel=new Ext.FormPanel({padding:10,labelWidth:80,labelAlign:"right",items:[{xtype:"hidden",id:this.ID_text_sort},{xtype:"textfield",fieldLabel:lang("sortName"),name:"name",id:this.ID_text_name,allowBlank:false},{xtype:"hidden",name:"fid",id:this.ID_text_fid},{xtype:"textfield",fieldLabel:lang("sort2"),name:"fname",editable:false,allowBlank:false,id:this.ID_text_fname,listeners:{focus:function(c,b){a.sortTree(win=true)}}},{xtype:"numberfield",fieldLabel:lang("order"),name:"order",id:this.ID_text_order}],listeners:{beforerender:function(b){a.treeLength=a.treeRoot.childNodes.length;if(a.treeLength==0){Ext.getCmp(a.ID_text_fname).disable();Ext.getCmp(a.ID_text_fname).allowBlank=true;Ext.getCmp(a.ID_text_fname).hide()}}}});this.SortWin=new Ext.Window({border:false,width:300,height:200,modal:true,title:lang("addSort"),layout:"fit",buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){a.submitForm()}}],items:[a.formPanel]});this.SortWin.show()},mPanel:function(){var g=this;var f=[{name:"id"},{name:"sort"},{name:"sort_id"},{name:"name"},{name:"s_time"},{name:"e_time"},{name:"status"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.grid.CheckboxSelectionModel();var h=function(m,k,j){var n=j.json.id,l=j.json.state;if(l!=1&&l!=2){return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_oltest_qt_mgr.setTing("+n+");'>"+lang("setquest")+"</a>"}};var i=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("nameOfQt"),dataIndex:"name",width:400},{header:"sort_id",dataIndex:"sort_id",hidden:true},{header:lang("categorie"),dataIndex:"sort",width:150},{header:lang("enableTime"),dataIndex:"s_time",width:150},{header:lang("endTime"),dataIndex:"e_time",width:150},{header:lang("status"),dataIndex:"status",width:80},{header:lang("opt"),dataIndex:"",renderer:h,width:150}]});var e=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:g.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:g.gridstore,cm:i,sm:d,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){g.addPaperWin(lang("add"));Ext.getCmp(g.ID_paper_sort).setValue("");Ext.getCmp(g.ID_paper_sortName).setValue("");Ext.getCmp(g.ID_paper_name).setValue("");g.paper_id="";if(g.sort&&g.sortText){g.paperForm.getForm().findField("sortId").setValue(g.sort);g.paperForm.getForm().findField("sortName").setValue(g.sortText)}}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(j){var k=b.getSelectionModel().getSelected();if(k){g.addPaperWin(lang("modify"));g.paper_id=k.data.id;Ext.getCmp(g.ID_paper_sort).setValue(k.data.sort_id);Ext.getCmp(g.ID_paper_sortName).setValue(k.data.sort);Ext.getCmp(g.ID_paper_name).setValue(k.data.name)}else{CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=b.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){var m=[];Ext.each(k,function(o,n){m.push(o.json.id)});g.delPaper(m.join(","))}})}}},c,{text:lang("search"),iconCls:"icon-search",listeners:{click:function(j){g.searchParams.paperName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.paperName="";c.setValue("");g.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},submitForm:function(){var a=this;if(!a.formPanel.getForm().isValid()){return}this.formPanel.getForm().submit({url:a.baseUrl+"&task=submit",method:"POST",params:{id:a.sort_id},success:function(b,c){Ext.getCmp(a.ID_text_fname).show();a.treeRoot.reload();a.SortWin.close();CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},submitForm2:function(){var a=this;if(!a.paperForm.getForm().isValid()){return}a.paperForm.getForm().submit({url:a.baseUrl+"&task=submit2",method:"POST",params:{paper_id:a.paper_id},success:function(b,c){a.addPaper.close();a.gridstore.reload();CNOA.msg.notice2(c.result.msg)},failure:function(b,c){CNOA.msg.alert(c.result.msg)}})},updateTree:function(d,b){var h=this;var g=d.id,c=d.text,e=d.fid,a=d.order,f=b.text;h.sort_id=g;h.addSortWin();Ext.getCmp(h.ID_text_sort).setValue(g);Ext.getCmp(h.ID_text_name).setValue(c);Ext.getCmp(h.ID_text_fid).setValue(e);Ext.getCmp(h.ID_text_order).setValue(a);Ext.getCmp(h.ID_text_fname).setValue(f);Ext.getCmp(h.ID_text_fname).disable()},deleteTree:function(a){var b=this;if(a.children){CNOA.msg.alert("请先删除子节点");return}CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteSort",method:"POST",params:{id:a.id},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.treeRoot.reload();b.sort="";b.sortText="";CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},addPaperWin:function(a){var b=this;b.paperForm=new Ext.FormPanel({border:false,padding:20,labelWidth:60,labelAlign:"right",items:[{xtype:"hidden",name:"sortId",id:b.ID_paper_sort},{xtype:"textfield",fieldLabel:lang("categorie"),id:b.ID_paper_sortName,name:"sortName",allowBlank:false,listeners:{focus:function(d,c){b.sortTree(win=false)}}},{xtype:"textfield",fieldLabel:lang("nameOfQt"),allowBlank:false,id:b.ID_paper_name,name:"paperName"}]});b.addPaper=new Ext.Window({title:a,width:300,modal:true,height:200,layout:"fit",items:[b.paperForm],buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){b.submitForm2()}}]});b.addPaper.show()},delPaper:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delPaper",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.notice2(d.msg);b.gridstore.reload()}else{CNOA.msg.alert(d.msg)}}})},setTing:function(e){var d=this;var b=new Ext.form.FormPanel({border:false,padding:10,labelAlign:"right",labelWidth:80,items:[{xtype:"textarea",height:50,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("attendee"),name:"uNames",listeners:{afterrender:function(f){f.mon(f.el,"click",function(){var g=b.getForm().findField("uids").getValue();new_selector("user",b.getForm().findField("uNames"),b.getForm().findField("uids"),true,d.baseUrl+"&task=selector&target=user",g)})}}},{xtype:"hidden",name:"uids"},{xtype:"textarea",height:50,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("department"),name:"deptNames",listeners:{afterrender:function(f){f.mon(f.el,"click",function(){var g=b.getForm().findField("deptIds").getValue();new_selector("dept",b.getForm().findField("deptNames"),b.getForm().findField("deptIds"),true,d.baseUrl+"&task=selector&target=dept",g)})}}},{xtype:"hidden",name:"deptIds"},{xtype:"displayfield",value:lang("blankSendAll")},{xtype:"checkbox",fieldLabel:lang("sendReminderQt"),name:"send_notice"},{xtype:"datetimefield",allowBlank:false,name:"stime",format:"Y-m-d H:i:s",fieldLabel:lang("enableTime"),minValue:new Date()},{xtype:"datetimefield",name:"etime",format:"Y-m-d H:i:s",fieldLabel:lang("endTime"),minValue:new Date()},{xtype:"displayfield",value:"说明:当结束时间为空时,一直有效;否则只在规定的时间内有效."}]});var a=new Ext.Window({border:false,width:550,height:400,layout:"fit",modal:true,items:[b],buttons:[{text:lang("save"),handler:function(){c()}},{text:lang("cancel"),handler:function(){a.close()}}]});var c=function(){if(!b.getForm().isValid()){return}b.getForm().submit({url:d.baseUrl+"&task=saveSubmit",method:"POST",params:{paper_id:e},success:function(f,g){a.close();d.gridstore.reload();CNOA.msg.notice2(g.result.msg)},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})};b.getForm().load({url:d.baseUrl+"&task=loadFormData",params:{paper_id:e},method:"POST"});a.show()}};var CNOA_oltest_qt_paper,CNOA_oltest_qt_paperClass;CNOA_oltest_qt_paperClass=CNOA.Class.create();CNOA_oltest_qt_paperClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=qt&action=qtpaper";this.ID_UPLOAD=Ext.id();this.searchParams={sort:"",searchName:""};this.mgr=this.mgr();this.treePanel=this.treePanel();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.treePanel,this.mgr]})},treePanel:function(){var a=this;this.treeRoot=new Ext.tree.AsyncTreeNode({iconCls:"icon-tree-root-cnoa",id:"0",expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:a.baseUrl+"&task=getPaperList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){a.sortTree.selectPath(a.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,width:180,rootVisible:true,lines:true,rootVisible:false,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.searchParams.sort=a.treeId=b.attributes.id;a.treeText=b.attributes.text;a.paperStore.reload()}}});this.sortPanel=new Ext.Panel({border:false,region:"west",layout:"fit",split:true,width:250,minWidth:180,maxWidth:320,animate:false,rootVisible:false,autoScroll:true,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:["问卷列表","->",{handler:function(b,c){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});return a.sortPanel},mgr:function(){var h=this;var f=[{name:"bid"},{name:"title"},{name:"type"},{name:"tihao"},{name:"addtime"},{name:"name"}];var g=function(n,m,j){var k=j.json.bid;var l=j.json.type;var o="";o="<a href='javascript:void(0);' class='gridview' style='text-decoration:none; ' onclick='CNOA_oltest_qt_paper.titleImg("+k+");'>"+lang("picture")+"</a>";if(l=="1"||l=="2"){o+=" <a href='javascript:void(0);' class='gridview3 jianju' style='text-decoration:none;' onclick='CNOA_oltest_qt_paper.editAnswer("+k+");'>修改答案</a>"}return o};var c=function(j){if(j=="1"){j="单选题"}else{if(j=="2"){j="多选题"}else{if(j=="3"){j="主观题"}}}return j};var d=function(k,j){j.attr='style="white-space:pre-wrap;"';return k};var b=new Ext.grid.CheckboxSelectionModel();var i=new Ext.grid.ColumnModel({border:false,defaults:{sortable:true,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"bid",hidden:true},{header:lang("qid"),dataIndex:"tihao",width:80,editor:new Ext.form.TextArea({width:50,height:22,allowBlank:false}),renderer:function(k,j){j.attr='style="white-space:normal;"';return k}},{header:lang("topic"),dataIndex:"title",width:350,editor:new Ext.form.TextArea({allowBlank:false}),renderer:function(k,j){j.attr='style="white-space:normal;"';return k}},{header:lang("subToQt"),dataIndex:"name",renderer:d,width:200},{header:lang("questionTypes"),dataIndex:"type",renderer:c},{header:lang("addTime"),dataIndex:"addtime",width:160},{header:lang("opt"),dataIndex:"",renderer:g,width:140}]});this.paperStore=new Ext.data.Store({autoLoad:true,baseParams:h.searchParams,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getBankList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var e=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:h.paperStore,pageSize:15});var a=new Ext.form.TextField({width:130});this.grid=new Ext.grid.EditorGridPanel({border:false,store:h.paperStore,region:"center",sm:b,cm:i,bodyStyle:"border-left-width:1px;",bbar:e,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){h.paperStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){h.setWin(0,"addBank")}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=h.grid.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){var m=[];Ext.each(k,function(o,n){m.push(o.json.bid)});h.delTitle(m.join(","))}})}}},("<span style='color:#999'>双击题目可编辑题目和题号</span>"),a,{text:lang("search"),listeners:{click:function(j){h.searchParams.searchName=a.getValue();h.paperStore.reload({params:h.searchParams})}}},{text:lang("clear2"),handler:function(j){h.searchParams.searchName="";a.setValue("");h.paperStore.reload()}}]}),listeners:{afteredit:function(l){var j=l.field,k=l.value;bid=l.record.get("bid");if(j=="title"){Ext.Ajax.request({url:h.baseUrl+"&task=editTitle",method:"POST",params:{bid:bid,title:k},success:function(m){var n=Ext.decode(m.responseText);if(n.success){CNOA.msg.notice2(n.msg)}else{CNOA.msg.alert(n.msg)}h.paperStore.reload()}})}else{if(j=="tihao"){if(k==0){CNOA.msg.alert(lang("QidNot0"))}Ext.Ajax.request({url:h.baseUrl+"&task=editTihao",method:"POST",params:{bid:bid,value:k},success:function(m){var n=Ext.decode(m.responseText);if(n.success){CNOA.msg.notice2(n.msg)}else{CNOA.msg.alert(n.msg)}h.paperStore.reload()}})}}}}});return this.grid},setWin:function(c,b){var e=this;this.ID_container=new Ext.id();this.optionCount=0;this.optionsField=new Ext.Panel({layout:"form",labelWidth:20,border:false,items:[]});this.addOption("");var a=[{name:"bid"},{name:"title"},{name:"s_id"},{name:"tihao"},{name:"type"}];this.choose=new Ext.Container({border:false,hidden:true,width:300,fieldLabel:lang("answerOptions"),items:[this.optionsField,{xtype:"button",text:"添加选项",handler:function(){e.addOption()}}]});var d=new Ext.form.FormPanel({border:false,labelAlign:"right",autoScroll:true,labelWidth:80,padding:10,items:[{xtype:"fieldset",width:450,items:[{xtype:"textarea",fieldLabel:lang("topic"),width:300,allowBlank:false,name:"title"},{xtype:"combo",editable:false,allowBlank:false,fieldLabel:lang("categorie"),typeAhead:true,width:240,triggerAction:"all",lazyRender:true,mode:"local",hiddenName:"s_id",valueField:"s_id",displayField:"name",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getPaperCombo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["s_id","name"]})})},{width:275,fieldLabel:lang("questionTypes"),xtype:"radiogroup",items:[{boxLabel:"单选题",name:"status",inputValue:1,checked:true},{boxLabel:"多选题",name:"status",inputValue:2},{boxLabel:"主观题",name:"status",inputValue:3}],listeners:{change:function(i,h){if(h.inputValue==1||h.inputValue==2){e.choose.show()}else{e.choose.hide()}},render:function(){e.choose.show()}}},{xtype:"numberfield",fieldLabel:lang("qid"),width:240,name:"tihao",enableKeyEvents:true,allowBlank:false},{xtype:"displayfield",html:'<span style="color: #777;font-size: 10px;">只能上传jpg、png、gif格式(2MB以内)</span>'},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",id:this.ID_UPLOAD,inputPre:"filesUpload"},e.choose]}]});var g=new Ext.Window({width:500,height:400,layout:"fit",title:lang("add"),modal:true,items:[d],buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){f(c,b)}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}}],listeners:{afterrender:function(){if(e.treeId&&e.treeText){d.getForm().findField("s_id").setValue(e.treeId);d.getForm().findField("s_id").setRawValue(e.treeText)}}}});g.show();var f=function(i,h){if(d.getForm().isValid()){d.getForm().submit({url:e.baseUrl+"&task=addBank",params:{bid:i,task:h},method:"POST",success:function(j,k){CNOA.msg.notice2(lang("successopt"));e.paperStore.reload();g.close()},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}}},createOption:function(a){return new Ext.form.TextField({width:215,name:"options[]",fieldLabel:this.optionCount,inputType:"text",value:a})},addOption:function(f){var e=this;f=f||"";if(typeof(f)=="object"&&f.length){var b=[];for(var c=0,a=f.length;c<a;c++){this.optionCount+=1;b.push(this.createOption(f[c].optionName))}this.optionsField.add(b)}else{this.optionCount+=1;var d=this.createOption(f);this.optionsField.add(d)}this.optionsField.doLayout()},searchBar:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=getBankList",params:{id:b},method:"POST"})},editAnswer:function(c){var e=this;var b=[{name:"aid"},{name:"answer"}];this.answerStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getAnswerList&title_id="+c}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var g=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),g,{header:"aid",dataIndex:"aid",hidden:true},{header:lang("answersFor"),dataIndex:"answer",editor:new Ext.form.TextArea({allowBlank:false}),renderer:function(i,h){h.attr='style="white-space:normal;"';return i}}]});var d=new Ext.grid.EditorGridPanel({height:300,border:false,store:e.answerStore,cm:a,sm:g,viewConfig:{forceFit:true},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.answerStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.addAnswer(c,0)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(h){var i=d.getSelectionModel().getSelections();if(i.length==0){CNOA.miniMsg.alertShowAt(h,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(j){if(j=="yes"){var k=[];Ext.each(i,function(m,l){k.push(m.json.aid)});e.delAnswer(k.join(","))}})}}}],listeners:{afteredit:function(j){var h=j.field,i=j.value;aid=j.record.get("aid");if(h=="answer"){Ext.Ajax.request({url:e.baseUrl+"&task=addAnswer",method:"POST",params:{id:aid,answer:i},success:function(k){var l=Ext.decode(k.responseText);if(l.success){CNOA.msg.notice2(l.msg)}else{CNOA.msg.alert(l.msg)}e.paperStore.reload()}})}}}});var f=new Ext.Window({modal:true,width:500,layout:"fit",height:400,items:[d],buttons:[{text:lang("close"),handler:function(){f.close()}}]});f.show()},addAnswer:function(a,f){var d=this;var c=new Ext.form.FormPanel({border:false,labelAlign:"right",autoHeight:true,labelWidth:75,padding:10,items:[{xtype:"textarea",fieldLabel:lang("answersFor"),width:200,allowBlank:false,name:"answer"}]});var e=function(g,h){if(c.getForm().isValid()){c.getForm().submit({url:d.baseUrl+"&task=addAnswer",params:{bid:g,id:h},method:"POST",success:function(i,j){CNOA.msg.notice2(lang("successopt"));d.answerStore.reload();b.close()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};var b=new Ext.Window({modal:true,layout:"fit",width:350,autoHeight:true,items:[c],buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){e(a,f)}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}}]});b.show()},delTitle:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delTitle",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){b.paperStore.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})},delAnswer:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delAnswer",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){b.answerStore.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})},titleImg:function(f){var e=this;var a=[{name:"id"},{name:"oldName"}];this.photoStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getImgList&id="+f}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var b=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"oldName",width:320}]});this.photoGrid=new Ext.grid.GridPanel({columnWidth:0.6,height:300,border:false,store:this.photoStore,cm:c,sm:b,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.photoGrid.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.updatePhoto(f)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=e.photoGrid.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(i){if(i=="yes"){var j=[];Ext.each(h,function(l,k){j.push(l.json.id)});e.delImages(j.join(","))}})}}}],listeners:{rowclick:function(h,k,j){var i=h.getSelectionModel().getSelected();var g=i.id;e.getOneImg(g)}}});var d=new Ext.Window({title:lang("picture"),width:720,height:400,layout:"fit",border:false,modal:true,items:[new Ext.Panel({layout:"column",items:[this.photoGrid,new Ext.Panel({border:false,height:400,bodyStyle:"padding: 50px 0px 0px 0px;border-left: 1px solid #99BBE8",columnWidth:0.4,items:[{border:false,html:'<div style="width:273px;height:206px;padding:3px;display: table-cell;vertical-align: middle;text-align: center;"><img style="max-width: 267px; max-height: 200px; border: 0px;overflow:hidden;" src="" id="CNOA_OLTEST_INFO_IMAGES"></div>'}]})]})]}).show()},updatePhoto:function(b){var a=this;this.FACE_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"images",allowBlank:false,blankText:lang("updateFaceBlankText"),buttonCfg:{text:lang("browse")},hideLabel:true,width:370}],buttons:[{text:lang("save"),handler:function(){if(this.FACE_WINDOW_FORMPANEL.getForm().isValid()){this.FACE_WINDOW_FORMPANEL.getForm().submit({url:a.baseUrl+"&task=addImages",waitMsg:lang("waiting"),params:{id:b},success:function(c,d){Ext.fly("CNOA_OLTEST_INFO_IMAGES").dom.src=d.result.msg;a.photoStore.reload();a.FACE_WINDOW.close()},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.FACE_WINDOW.close()})}})}}.createDelegate(this)},{text:lang("close"),handler:function(){a.FACE_WINDOW.close()}}]});this.FACE_WINDOW=new Ext.Window({width:398,height:130,autoScroll:false,modal:true,resizable:false,title:lang("upload")+lang("photo"),items:[this.FACE_WINDOW_FORMPANEL]}).show()},getOneImg:function(a){var b=this;if(!a){return}Ext.Ajax.request({url:b.baseUrl+"&task=getOneImg",params:{id:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);Ext.fly("CNOA_OLTEST_INFO_IMAGES").dom.src=d.msg}})},delImages:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delImages",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.alert(d.msg);b.photoGrid.store.reload()}}})}};var CNOA_oltest_qt_qtstart,CNOA_oltest_qt_qtstartClass;CNOA_oltest_qt_qtstartClass=CNOA.Class.create();CNOA_oltest_qt_qtstartClass.prototype={init:function(){var b=this;this.baseUrl="index.php?app=oltest&func=qt&action=qtlist";var a=CNOA.oltest.qt.qtstart.id;this.mainPanel=new Ext.Panel({border:false,html:'<iframe scrolling="auto" src="index.php?app=oltest&func=qt&action=qtlist&task=loadFormData&id='+a+'"frameborder="0" width="100%" height="100%"></iframe>'})}};var CNOA_oltest_qt_stat,CNOA_oltest_qt_statClass;CNOA_oltest_qt_statClass=CNOA.Class.create();CNOA_oltest_qt_statClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=oltest&func=qt&action=qtstat";this.searchParams={paperName:""};this.stat=this.stat();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.stat]})},stat:function(){var g=this;var f=[{name:"id"},{name:"name"},{name:"s_time"},{name:"e_time"},{name:"status"}];var j=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.grid.CheckboxSelectionModel();var h=function(n,l,k){var o=k.json.id,m=k.json.state;return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_oltest_qt_stat.view("+o+");'>"+lang("result")+"</a>"};var i=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("name"),dataIndex:"name",width:400},{header:lang("enableTime"),dataIndex:"s_time",width:180},{header:lang("endTime"),dataIndex:"e_time",width:180},{header:lang("status"),dataIndex:"status"},{header:lang("opt"),dataIndex:"",renderer:h}]});var e=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:j,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:j,cm:i,sm:d,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){j.reload()}},c,{text:lang("search"),listeners:{click:function(k){g.searchParams.paperName=c.getValue();j.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.paperName="";c.setValue("");j.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",items:[b]});return a},view:function(a){mainPanel.closeTab("CNOA_MENU_OLTEST_VIEW");mainPanel.loadClass("index.php?app=oltest&func=qt&action=qtstat&task=result&id="+a,"CNOA_MENU_OLTEST_VIEW","调查结果","")}};var sm_oltest_oltest=1;
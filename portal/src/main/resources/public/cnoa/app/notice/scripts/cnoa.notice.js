var CNOA_notice_notice_todoClass,CNOA_notice_notice_todo;CNOA_notice_notice_todoClass=new CNOA.Class.create();CNOA_notice_notice_todoClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=notice&func=notice&action=todo";this.IndexPage=5;this.PagePage=30;this.mod="index";this.searchStore={storeType:"todo",content:"",stime:0,etime:0,module:0};this.ID_PAGE=Ext.id();var a=[{name:"nid"}];this.listStore=new Ext.data.Store({baseParams:this.searchStore,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTodoList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{load:function(g,f,h){d.pagingBar.show();Ext.getCmp(d.ID_BTN_CANCEL).show();d.todoPanel.body.dom.innerHTML=d.createListHTML(g.reader.jsonData.data);$("#"+d.ID_BTN_TODO).text(g.reader.jsonData.todoTotal);d.PagePage=g.reader.jsonData.limit;d.pagingBar.pageSize=d.PagePage;Ext.getCmp(d.ID_PAGE).setValue(d.PagePage)},exception:function(g,f,i,h){d.pagingBar.show();Ext.getCmp(d.ID_BTN_CANCEL).show();d.todoPanel.body.dom.innerHTML=d.createListHTML([]);$("#"+d.ID_BTN_TODO).text(0)}}});window.pppp=this.pagingBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.PagePage,store:this.listStore,hidden:true,listeners:{beforechange:function(f,g){g.limit=d.PagePage}}});var e=new Ext.form.TextField({width:100}),b=new Ext.form.DateField({format:"Y-m-d"}),c=new Ext.form.DateField({format:"Y-m-d"});this.todoPanel=this.getTodoPanel();this.mainPanel=new Ext.Panel({border:false,layout:"fit",items:this.todoPanel,tbar:new Ext.Toolbar({items:[lang("title"),e,lang("startTime"),b,lang("endTime"),c,{text:lang("search"),handler:function(){d.searchStore.content=e.getValue();d.searchStore.stime=b.getRawValue();d.searchStore.etime=c.getRawValue();d.reload()}},{text:lang("clear"),handler:function(){d.searchStore.content="";d.searchStore.stime=0;d.searchStore.etime=0;e.setValue("");b.setValue("");c.setValue("");d.reload()}}]}),bbar:this.pagingBar});Ext.getCmp(CNOA.notice.notice.todo.parentID).on("activate",function(){d.reload()})},getTodoPanel:function(){this.ID_TOOLBAR=Ext.id();this.ID_BTN_TODO=Ext.id();this.ID_BTN_CANCEL=Ext.id();var b=this;var a=new Ext.Panel({border:false,layout:"fit",autoScroll:true,tbar:new Ext.Toolbar({id:this.ID_TOOLBAR,items:[{text:lang("goBack"),id:this.ID_BTN_CANCEL,hidden:true,cls:"icon-btn-arrow-left",handler:function(c,d){b.reload(0)}},{text:lang("setListBtn"),cls:"btn-green1",handler:function(c,d){b.setTodoModule()}},{text:lang("toDo")+'(<span id="'+b.ID_BTN_TODO+'" class="cnoa_color_white">0</span>)',iconCls:"icon-roduction",cls:"btn-red1",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"SYSTEM_NOTICE_GROUP_BTN",tooltip:lang("showAllTodo"),handler:function(c,d){b.searchStore.storeType="todo";b.reload()}},{text:lang("done"),enableToggle:true,allowDepress:false,toggleGroup:"SYSTEM_NOTICE_GROUP_BTN",cls:"btn-gray1",iconCls:"icon-done",tooltip:lang("showAllDone"),handler:function(c,d){b.searchStore.storeType="done";b.reload()}},"->",{xtype:"combo",width:70,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",id:this.ID_PAGE,editable:false,store:new Ext.data.ArrayStore({fields:["rows","text"],data:[[5,"5"+lang("tiao")],[15,"15"+lang("tiao")],[30,"30"+lang("tiao")],[50,"50"+lang("tiao")]]}),valueField:"rows",displayField:"text",value:this.IndexPage,listeners:{select:function(d,c){var e=d.getValue();if(b.mod=="index"){b.IndexPage=e;setPageSize("noticeIndex",e,function(){b.reload()})}else{b.PagePage=e;setPageSize("noticePage",e,function(){b.reload()})}b.pagingBar.pageSize=e}}}]}),listeners:{afterrender:function(){b.reload(0);b.getAllMenuData()}}});return a},reload:function(a){var b=this;if(typeof(a)!="undefined"){this.searchStore.module=a}if(this.searchStore.module==0){Ext.getCmp(b.ID_PAGE).setValue(b.IndexPage);this.mod="index";Ext.Ajax.request({url:b.baseUrl+"&task=getTodoList",method:"POST",params:b.searchStore,success:function(c){var d=Ext.decode(c.responseText);b.pagingBar.hide();Ext.getCmp(b.ID_BTN_CANCEL).hide();b.todoPanel.body.dom.innerHTML=b.createIndexHTML(d.data,d.orderby);$("#"+b.ID_BTN_TODO).text(d.todoTotal);b.mainPanel.doLayout();b.IndexPage=d.limit;Ext.getCmp(b.ID_PAGE).setValue(b.IndexPage)}})}else{Ext.getCmp(b.ID_PAGE).setValue(b.PagePage);this.mod="page";this.listStore.load()}this.refreshTodoTotal()},createIndexHTML:function(a,e){if(a.length==0){return""}var d,g,h;var c=['<table style="width:98%;margin:10px;" class="custom-grid" border="0" cellspacing="0" cellpadding="0">'];if(e){e=e.split(",");for(var b=0,j=e.length;b<j;b++){if(a[e[b]]){c=c.concat(this.createListModuleHTML(e[b],a[e[b]]))}}}else{for(var f in a){c=c.concat(this.createListModuleHTML(f,a[f]))}}c.push("</tabel>");return c.join("")},createListModuleHTML:function(d,e){var a=e.length,g;var c=['<tr class="x-grid3-header x-grid3-hd-row custom-grid-hear">','<td style="border-left:1px solid #CBCBCB;" width="180">'+lang("type")+"</td><td>"+lang("content")+'</td><td width="100">'+lang("stayTime")+'</td><td width="170">'+lang("opt")+"</td></tr>"];for(var b=0;b<a;b++){g=e[b];c.push('<tr class="custom-grid-row'+(b%2==1?" custom-grid-row-alt":"")+' custom-grid-row-data">');if(b==0){var f=this.IndexPage>a?(a+1):a;c=c.concat(['<td style="height:180px;cursor:pointer;" class="first" onclick="CNOA_notice_notice_todo.reload('+d+", '"+g.module+'\')" rowspan="'+f+'" align="center">','<img width="100" height="100" src="resources/images/todo_icon/icon_'+d+'.png" />','<div class="daibantitle">'+g.module+"</div>","</td>"])}c=c.concat(['<td class="second">'+g.content+"</td>","<td>"+g.dwell+"</td>",'<td class="last">'+this.readOperate(g)+"</td></tr>"])}if(this.IndexPage>a){c.push('<tr class="custom-grid-row"><td class="second last" colspan="3"></td></tr>')}c=c.concat(['<tr class="custom-grid-row more" style="cursor:pointer;font-size:14px;">','<td class="first last" style="background-color:#ECECEC" colspan="4" align="center" onclick="CNOA_notice_notice_todo.reload('+d+", '"+g.module+"')\"><b>"+lang("more")+"...</b></td>",'</tr><tr height="20"></tr>']);return c},createListHTML:function(d){var a=d.length,e;var c=['<table class="custom-grid" border="0" cellspacing="0" cellpadding="0">','<tr class="x-grid3-header x-grid3-hd-row custom-grid-hear">','<td width="40"></td><td>内容</td><td width="100">'+lang("stayTime")+'</td><td width="170">'+lang("opt")+'</td><td width="20"></td></tr>'];for(var b=0;b<a;b++){e=d[b];c=c.concat(['<tr class="custom-grid-row'+(b%2==1?" custom-grid-row-alt":"")+'">',"<td>"+(b+1)+"</td>",'<td class="first">'+e.content+"</td>","<td>"+e.dwell+"</td>",'<td class="last">'+this.readOperate(e)+"</td></tr>"])}c.push("</tabel>");return c.join("")},readOperate:function(b){b.content=b.content.replace('<span style="color:red;">　[非常重要]</span>',"");b.content=b.content.replace('<span style="color:orange;">　[重要]</span>',"");var c=(this.searchStore.storeType=="done")?lang("view"):lang("deal");var a='<a href="javascript:void(0)" class="gridview" onclick="CNOA_notice_notice_todo.calendar('+b.nid+", '"+b.content+"')\">"+lang("schedule")+"</a>";a+='<a href="javascript:void(0)" class="gridview3 jianju" onclick="CNOA_notice_notice_todo.viewNotice('+b.nid+","+b.from+",'"+b.href+"')\">"+lang("deal")+"</a>";a+='<a href="javascript:void(0)" class="gridview2 jianju" onclick="CNOA_notice_notice_todo.deleteNotice('+b.nid+')">'+lang("del")+"</a>";return a},deleteNotice:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=deleteTodo",method:"POST",params:{nid:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);a.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},viewNotice:function(d,c,a){var b=new CNOA.noticeWindow(d,c,{title:"",content:"",href:a,opentype:1}).goView()},calendar:function(b,a){var d=this;Ext.MessageBox.show({title:lang("toToCalendar"),msg:lang("todoToCalendarNotice"),buttons:{cancel:lang("cancel"),yes:lang("putIn"),no:lang("setTime")},fn:c,animEl:"mb4",icon:Ext.MessageBox.QUESTION});function c(e){if(e=="no"){d.setCalendar(b,a)}else{if(e=="yes"){d.setDirect(b,a)}}}},setDirect:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=setDirect",method:"POST",params:{nid:c,title:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg,function(){})}}})},setCalendar:function(a,g){var d=this;var f=Ext.id();var e=function(){if(b.getForm().isValid()){b.getForm().submit({url:d.baseUrl+"&task=addCalendar",method:"POST",params:{nid:a,type:"add"},waitMsg:lang("waiting"),success:function(j,k){if(k.result.success==true){CNOA.msg.notice2(k.result.msg);c.close()}else{CNOA.msg.alert(k.result.msg)}},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};var h=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getColorData"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"colorid"},{name:"name"}]}),listeners:{load:function(k,j,l){Ext.getCmp(f).setValue(j[0].data.colorid)}}});var i=[{xtype:"fieldset",title:lang("setTime"),width:490,items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,style:"margin-bottom : 10px",layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,style:"margin-top: 4px",layout:"form",items:[{xtype:"datefield",fieldLabel:lang("timeFrom"),format:"Y-m-d",name:"sdate",width:100,allowBlank:false,value:new Date()}]},{xtype:"panel",border:false,style:"margin-bottom: 1px",items:[{xtype:"timefield",width:80,format:"H:i",name:"stime",increment:30,value:new Date()}]}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;到:<span class='cnoa_color_red'>*</span>",width:35},{xtype:"datefield",format:"Y-m-d",name:"edate",width:100,allowBlank:false,value:new Date()},{xtype:"timefield",width:80,format:"H:i",name:"etime",increment:30,value:"18:00"}]}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,style:"margin-bottom : 10px",layoutConfig:{columns:2},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",items:[{xtype:"numberfield",name:"early",fieldLabel:lang("aheadOfTime"),width:80,value:2}]},{xtype:"displayfield",value:lang("hoursNoticeMe")}]},{xtype:"panel",style:"margin-left : 50px",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"checkbox",name:"cellphone"},{xtype:"displayfield",value:lang("ifMobileNotice")}]}]}]},{xtype:"fieldset",title:lang("setContent"),width:490,items:[{xtype:"panel",layout:"table",border:false,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",border:false,items:[{xtype:"textfield",name:"title",fieldLabel:lang("title"),width:255,allowBlank:false,value:g}]},{xtype:"displayfield",style:"margin-bottom : 5px",value:"&nbsp;&nbsp;"+lang("sort")+":&nbsp;"},new Ext.form.ComboBox({id:f,style:"margin-bottom : 5px",store:h,width:100,hiddenName:"colorid",valueField:"colorid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]},{xtype:"textarea",name:"content",fieldLabel:lang("content"),width:395},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:70px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("setSortNotice")}})]},{xtype:"fieldset",title:lang("setShare"),width:490,collapsible:true,collapsed:true,items:[{xtype:"textarea",width:395,readOnly:true,fieldLabel:lang("shareUser"),blankText:lang("selectShareUser"),name:"signInNames"},{xtype:"hidden",name:"signInIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-10",dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:65px; margin-bottom:4px; margin-top:5px;",text:lang("select"),listeners:{selected:function(l,m){var n=new Array();var k=new Array();if(m.length>0){for(var j=0;j<m.length;j++){n.push(m[j].uname);k.push(m[j].uid)}}b.getForm().findField("signInNames").setValue(n.join(","));b.getForm().findField("signInIDs").setValue(k.join(","))},onrender:function(j){j.setSelectedUids(b.getForm().findField("signInIDs").getValue().split(","))}}},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:70px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("shareCalendarNotice")}})]}];var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:60,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding : 10px;",autoScroll:true,items:[{xtype:"panel",border:false,layout:"form",items:i}]});var c=new Ext.Window({title:lang("addSchedule"),width:550,height:makeWindowHeight(420),resizable:false,modal:true,layout:"fit",items:b,autoScroll:true,buttons:[{text:lang("add"),handler:function(){e()}},{text:lang("close"),handler:function(){c.close()}}]}).show()},setTodoModule:function(){var d=this;var b=new Ext.data.ArrayStore({data:[],fields:["name","mid"]});Ext.Ajax.request({url:this.baseUrl+"&task=getModuleList",success:function(g){var f=Ext.decode(g.responseText);var h=[];Ext.each(f,function(k,j){h.push([k.name,k.mid])});b.loadData(h)}});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:90,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding : 10px;",items:[{xtype:"displayfield",value:"拖动名称可以进行排序",hideLabel:true},{xtype:"multiselect",name:"mids",width:234,height:340,ddReorder:true,hideLabel:true,store:b,displayField:"name",valueField:"mid"}]});var c=function(){var f=[];b.each(function(h,g){f.push(h.get("mid"))});Ext.Ajax.request({url:d.baseUrl+"&task=saveTodoModel",method:"POST",params:{mids:f.join(",")},success:function(h){var g=Ext.decode(h.responseText);if(g.success===true){CNOA.msg.notice2(g.msg);e.close();d.reload()}else{CNOA.msg.alert(g.msg)}}})};var e=new Ext.Window({title:lang("setBtnOrder"),width:270,height:480,resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:lang("save"),handler:function(){c()}},{text:lang("close"),handler:function(){e.close()}}]}).show()},getAllMenuData:function(){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=getAllMenuList",method:"POST",success:function(e){var b=Ext.decode(e.responseText);if(b.success===true){var d=[],g=[];Ext.each(b.data,function(j,h){if(h<4){var k=j.name+'(<span id="TODO_MODULE_'+j.mid+'" class="cnoa_color_white">'+j.total+"</span>)";d.push({text:k,iconCls:j.iconCls,cls:"btn-blue3",enableToggle:true,allowDepress:false,toggleGroup:"SYSTEM_NOTICE_GROUP_BTN",handler:function(){a.reload(j.mid)}})}else{var k=j.name+'(<span id="TODO_MODULE_'+j.mid+'" class="cnoa_color_red">'+j.total+"</span>)";g.push({text:k,iconCls:j.iconCls,cls:"btn-blue3",handler:function(){a.reload(j.mid)}})}});if(g.length>0){d.push({text:lang("more"),enableToggle:true,cls:"btn-blue4",allowDepress:false,toggleGroup:"SYSTEM_NOTICE_GROUP_BTN",menu:{items:g}})}var f=new Ext.ButtonGroup({defaults:{scale:"small"},items:d});var c=Ext.getCmp(a.ID_TOOLBAR);c.insert(7,f);c.doLayout()}else{CNOA.msg.alert(b.msg)}}})},refreshTodoTotal:function(){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=refreshTodoTotal",method:"POST",success:function(c){var b=Ext.decode(c.responseText),e=b.data;for(var d in e){$("#TODO_MODULE_"+d).text(e[d])}}})}};var CNOA_notice_notice_calendarClass,CNOA_notice_notice_calendar;CNOA_notice_notice_calendarClass=CNOA.Class.create();CNOA_notice_notice_calendarClass.prototype={init:function(){var c=this;this.uid="";this.baseUrl="index.php?app=notice&func=notice&action=calendar";this.lhcFlowId=CNOA.notice.notice.calendar.flowId;if(this.lhcFlowId){var b=new Date();Ext.Ajax.request({url:c.baseUrl+"&task=lhcGetFlow",method:"POST",params:{lhcFlowId:c.lhcFlowId},success:function(e){var d=Ext.decode(e.responseText);c.flowNameComp.setValue(d.data.name)}});c.showDetailWin("add",b)}this.ID_CONFIRM_DAY=Ext.id();this.ID_tree_treeRoot=Ext.id();Ext.calendar.EventMappings.StartDate.type="string";Ext.calendar.EventMappings.EndDate.type="string";this.fields=[{name:"cid"},{name:"title"},{name:"StartDate"},{name:"EndDate"},{name:"pid"}];this.eventstore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:Ext.calendar.EventRecord.prototype.fields.getRange()}),sortInfo:{field:"StartDate",direction:"ASC"}});this.calendar=new Ext.calendar.CalendarPanel({eventStore:this.eventstore,style:"border-left-width:1px",weekText:lang("weekView"),monthText:lang("monthView"),dayText:lang("dateView"),showTime:true,region:"center",activeItem:0,dayViewCfg:{todayText:lang("today"),showHeader:true,showWeekLinks:true,showWeekNumbers:true},weekViewCfg:{todayText:lang("today"),showHeader:true,showWeekLinks:true,showWeekNumbers:true},monthViewCfg:{todayText:lang("today"),showHeader:true,showWeekLinks:true,showWeekNumbers:true},listeners:{afterrender:function(){if(CNOA.notice.notice.calendar.from=="notice"){var e=new Date();e.setTime(CNOA.notice.notice.calendar.time);c.calendar.setStartDate(e,"my")}else{c.eventstore.load()}},eventclick:function(m,g,f){var k=g.data.EndDate;var e=g.data.StartDate;var j=g.json.cid;var l=g.json.title;var i=g.json.content;var n=g.json.share;var h=g.json.pid;c.viewCal(j,e,k,j,l,i,n,h);function d(o){if(o=="yes"){c.showDetailWin("edit",e,k,j,l,i)}else{if(o=="ok"){c.showDetailWin("add",e)}else{if(o=="no"){CNOA.msg.cf(lang("confirmToDelete"),function(p){if(p=="yes"){Ext.Ajax.request({url:c.baseUrl+"&task=deleteCid",method:"POST",params:{cid:j},success:function(s){var q=Ext.decode(s.responseText);if(q.success===true){CNOA.msg.notice(q.msg,lang("scheduleMgr"));c.eventstore.reload()}else{CNOA.msg.alert(q.msg,function(){c.eventstore.reload()})}}})}})}}}}},dayclick:{fn:function(g,f,e,d){c.showDetailWin("add",f)},scope:this},eventmove:{fn:function(g,i){var d=i.data.EndDate;var f=i.data.StartDate;var j=i.json.cid;var h=i.json.title;var e=i.json.content;c.resizeDate(d,j,f)},scope:this},eventresize:{fn:function(g,i){var d=i.data.EndDate;var f=i.data.StartDate;var j=i.json.cid;var h=i.json.title;var e=i.json.content;c.resizeDate(d,j)},scope:this},rangeselect:function(f,e,d){c.showDetailWin("add",e.StartDate,e.EndDate)}}});var a=Ext.id();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.calendar],tbar:[{text:lang("typeSet"),iconCls:"icon-system-setup",cls:"btn-green1",handler:function(){c.settingWin()}},{text:lang("mySchedule"),cls:"btn-blue4",iconCls:"icon-thisMonth",handler:function(){c.calendar.setStartDate(new Date(),"my");Ext.getCmp(a).setValue("")}},lang("selectUserCalendar")+":",{xtype:"triggerForPeople",id:a,dataUrl:c.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,listeners:{selected:function(f,e,d){c.uid=e;c.calendar.setStartDate(new Date(),e);if(c.calendar.getActiveView().title==lang("dateView")){c.calendar.onDayClick()}else{if(c.calendar.getActiveView().title==lang("weekView")){c.calendar.onWeekClick()}else{c.calendar.onMonthClick()}}}}},"&nbsp;&nbsp;<span class='cnoa_color_gray'>"+lang("colorSY")+":</span>","<span style='background-color:#E1E1E1; border : 1px solid #fff;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>"+lang("calendarPassed")+"</span>","<span style='background-color:#FFB878; border : 1px solid #fff;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>"+lang("calendarSharToMe")+"</span>","->",lang("selectDate"),{xtype:"datefield",width:"100",format:"Y-m-d",minValue:new Date(),value:new Date(),listeners:{select:function(e,d){c.calendar.setStartDate(d,c.uid)}}}]})},viewCal:function(j,e,k,j,m,i,p,f){var h=this;var b=h.baseUrl+"&task=loadpage&from=viewDetail&cid="+j;var g=Ext.id();var o=true;var a=new Ext.Panel({border:false,html:'<iframe scrolling="auto" frameborder=0 width=100% height=100% id="'+g+'"></iframe>',listeners:{afterrender:function(){if(o){Ext.getDom(g).contentWindow.location.href=b;o=false}}}});var n=Ext.id();var c=Ext.id();var l=Ext.id();var d=Ext.id();var g=new Ext.Window({title:lang("viewCalendar"),width:800,height:300,layout:"fit",resizable:true,modal:true,items:[a],listeners:{afterrender:function(q){if(p==1){Ext.getCmp(n).hide();Ext.getCmp(c).hide();Ext.getCmp(l).hide()}}},buttons:[{text:lang("add"),id:n,handler:function(){g.close();h.showDetailWin("add",e)}},{text:lang("edit"),hidden:f!=0?true:false,id:c,handler:function(){g.close();h.showDetailWin("edit",e,k,j,m,i)}},{text:lang("del"),id:l,handler:function(){CNOA.msg.cf(lang("confirmToDelete"),function(q){if(q=="yes"){Ext.Ajax.request({url:h.baseUrl+"&task=deleteCid",method:"POST",params:{cid:j},success:function(t){var s=Ext.decode(t.responseText);if(s.success===true){CNOA.msg.notice2(s.msg);h.eventstore.reload();g.close()}else{CNOA.msg.alert(s.msg,function(){h.eventstore.reload()})}}})}})}},{text:lang("close"),handler:function(){g.close()}}]}).show();mainPanel.lhcWin=g},settingWin:function(){var h=this;var c=[{name:"colorid"},{name:"name"},{name:"order"}];var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getColorData"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c})});var b=new Ext.grid.ColumnModel([{header:lang("color"),dataIndex:"colorid",width:50,renderer:this.color.createDelegate(this)},{header:lang("name"),dataIndex:"name",width:200,editor:{xtype:"textfield"},renderer:this.colorName.createDelegate(this)},{header:lang("order"),dataIndex:"order",width:100,editor:{xtype:"textfield",regex:/^\+?[1-9][0-9]*$/i,regexText:lang("mustBeInt")},renderer:this.colorOrder.createDelegate(this)}]);var e=new Ext.grid.EditorGridPanel({border:true,region:"center",layout:"fit",store:d,cm:b,stripeRows:true,width:360,height:150,frame:false,clicksToEdit:1});var f=[{xtype:"fieldset",title:lang("cusColor"),autoHeight:true,defaults:{xtype:"textfield"},items:[e,new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:0px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("cusColorNotice")}})]}];var a=new Ext.form.FormPanel({region:"center",border:false,hideBorders:true,autoScroll:true,labelWidth:80,labelAlign:"top",waitMsgTarget:true,bodyStyle:"padding : 10px;",items:[{xtype:"panel",border:false,layout:"form",region:"center",autoScroll:true,items:[f]}]});var g=new Ext.Window({title:lang("setCalendar"),width:420,height:335,resizable:false,modal:true,layout:"border",items:a,buttons:[{text:lang("save"),handler:function(i,j){a.getForm().submit({url:h.baseUrl+"&task=updateColorType",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),success:function(k,l){CNOA.msg.notice2(l.result.msg);d.reload()},failure:function(k,l){CNOA.msg.alert(l.result.msg)}.createDelegate(this)})}},{text:lang("close"),handler:function(i,j){g.close()}}]}).show()},colorName:function(b,d,a){return"<input type='hidden' name='colorName["+a.data.colorid+"]' value='"+b+"'/>"+b},colorOrder:function(b,d,a){return"<input type='hidden' name='colorOrder["+a.data.colorid+"]' value='"+b+"'/>"+b},color:function(d,f,a){var e=this;var b="red";switch(d){case"1":b="#306da6";break;case"2":b="#86a723";break;case"3":b="#b6a980";break;case"4":b="#D06B64";break;case"5":b="#7AE7BF";break;case"6":b="#DBADFF";break;case"7":b="#FBD75B";break;case"8":b="#FFB878";break;case"9":b="#46D6DB";break;case"10":b="#bababa";break}return"<span style='background-color : "+b+" '>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>"},resizeDate:function(a,d,b){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=resizeDate",method:"POST",params:{cid:d,endT:a,dt:b},success:function(f){var e=Ext.decode(f.responseText);if(e.success===true){CNOA.msg.notice2(e.msg);c.eventstore.reload()}else{CNOA.msg.alert(e.msg)}}})},showDetailWin:function(b,g,k,h,n,o){var p=this;var a=Ext.id();var m=Ext.id();var r=lang("addSchedule");var j=lang("add");if(b=="edit"){r=lang("editSchedule");j=lang("ok")}var l=function(s){if(d.getForm().isValid()){d.getForm().submit({url:p.baseUrl+"&task=addCalendar",waitTitle:lang("notice"),method:"POST",params:{type:b,cid:h,flowId:s},waitMsg:lang("waiting"),success:function(t,u){if(u.result.success==true){CNOA.msg.notice2(u.result.msg);c.close();p.eventstore.reload()}else{CNOA.msg.alert(u.result.msg)}}.createDelegate(this),failure:function(t,u){CNOA.msg.alert(u.result.msg,function(){}.createDelegate(this))}.createDelegate(this)})}};var i=function(){d.getForm().load({url:p.baseUrl+"&task=loadEditData",method:"POST",params:{cid:h},waitTitle:lang("notice"),success:function(t,u){p.flowId=u.result.data.flowId;p.pid=u.result.data.pid;var s=u.result.data.title;Ext.getCmp(m).setValue(s)},failure:function(s,t){CNOA.msg.alert(t.result.msg,function(){})}})};var q=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:p.baseUrl+"&task=getColorData"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"colorid"},{name:"name"}]}),listeners:{load:function(t,s,u){if(b!="edit"){Ext.getCmp(a).setValue(s[0].data.colorid)}else{i()}}}});this.flowId="";this.lhcID=Ext.id();this.flowNameComp=new Ext.form.TextField({readOnly:true,width:255,name:"flowName",id:p.lhcID});var f=Ext.id();var e=[{xtype:"fieldset",title:lang("setTime"),items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,style:"margin-bottom : 10px",layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,style:"margin-top: 4px",layout:"form",items:[{xtype:"datefield",fieldLabel:lang("timeFrom"),format:"Y-m-d",name:"sdate",width:100,allowBlank:false,value:g}]},{xtype:"panel",border:false,items:[{xtype:"timefield",width:80,format:"H:i",name:"stime",increment:30,value:g}]}]},{xtype:"panel",width:300,hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:3},items:[{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;"+lang("to")+":<span class='cnoa_color_red'>*</span>",width:35},{xtype:"datefield",format:"Y-m-d",name:"edate",minValue:new Date(),width:100,allowBlank:false,value:k},{xtype:"timefield",width:80,format:"H:i",name:"etime",increment:30,value:k}]}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,style:"margin-bottom : 10px",layoutConfig:{columns:2},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",items:[{xtype:"numberfield",name:"early",fieldLabel:lang("aheadOfTime"),width:80,value:2}]},{xtype:"displayfield",value:lang("hoursNoticeMe")}]},{xtype:"panel",style:"margin-left : 50px",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"checkbox",name:"cellphone"},{xtype:"displayfield",value:lang("ifMobileNotice")}]}]}]},{xtype:"fieldset",title:"设置流程提醒",items:[{xtype:"compositefield",labelWidth:80,fieldLabel:"流程提醒",items:[this.flowNameComp,{xtype:"button",text:"选择流程",handler:function(){p.showSelectFlowWindow()}}]}]},{xtype:"fieldset",title:lang("setContent"),items:[{xtype:"panel",layout:"table",border:false,layoutConfig:{columns:3},items:[{xtype:"panel",layout:"form",border:false,items:[{xtype:"textfield",name:"title",fieldLabel:lang("title"),width:255,id:m,allowBlank:false,value:n}]},{xtype:"displayfield",style:"margin-bottom : 5px",value:"&nbsp;&nbsp;"+lang("sort")+":&nbsp;"},new Ext.form.ComboBox({id:a,style:"margin-bottom : 5px",store:q,width:100,hiddenName:"colorid",valueField:"colorid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]},{xtype:"textarea",name:"content",fieldLabel:lang("content"),width:395,value:o},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:70px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("setSortNotice")}})]},{xtype:"periodNotice",id:f,shide:true,allowBlank:true,hidden:b=="edit"?true:false,time1:g,periodDataUrl:p.baseUrl+"&task=getAllUserListsInPermitDeptTree",periodWidth:380,btnStyle:"margin-left:105px; margin-top:10px"},{xtype:"fieldset",title:lang("setShare"),collapsible:true,collapsed:true,items:[{xtype:"textarea",width:395,readOnly:true,fieldLabel:lang("shareUser"),blankText:lang("selectShareUser"),name:"signInNames"},{xtype:"hidden",name:"signInIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-10",dataUrl:p.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:65px; margin-bottom:4px; margin-top:5px;",text:lang("select"),listeners:{selected:function(u,v){var w=new Array();var t=new Array();if(v.length>0){for(var s=0;s<v.length;s++){w.push(v[s].uname);t.push(v[s].uid)}}d.getForm().findField("signInNames").setValue(w.join(","));d.getForm().findField("signInIDs").setValue(t.join(","))},onrender:function(s){s.setSelectedUids(d.getForm().findField("signInIDs").getValue().split(","))}}},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:70px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("shareCalendarNotice")}})]}];var d=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:60,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding : 10px;",autoScroll:true,items:[{xtype:"panel",border:false,layout:"form",items:[e]}]});var c=new Ext.Window({title:r,width:540,height:makeWindowHeight(420),resizable:false,modal:true,layout:"fit",items:d,listeners:{close:function(){p.calendar.items.items[0].items.items[0].dropZone.clearShims()}},buttons:[{text:j,handler:function(){var s=p.flowId;if(p.lhcFlowId&&s==""){s=p.lhcFlowId}var t=Ext.getCmp(p.lhcID).getValue();if(t==""){s=t}l(s)}},{text:lang("close"),handler:function(){c.close()}}]}).show()},showSelectFlowWindow:function(){var f=this;var g={sortId:0};var d=[{name:"flowId"},{name:"name"}];var j=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getFlowListInSort"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var i=new Ext.grid.ColumnModel([b,{header:"flowId",dataIndex:"flowId",hidden:true},{header:"流程名称",dataIndex:"name",id:"name"}]);var a=new Ext.grid.GridPanel({bodyStyle:"border-left-width:1px;",border:false,store:j,loadMask:{msg:lang("waiting")},cm:i,sm:b,region:"center",stripeRows:true,hideBorders:true,autoExpandColumn:"name"});var c=new Ext.tree.AsyncTreeNode({text:"所有分类",sortId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var h=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortTree",preloadChildren:true,clearOnLoad:false});var k=new Ext.tree.TreePanel({region:"west",width:150,minWidth:80,maxWidth:380,hideBorders:true,border:false,rootVisible:true,split:true,bodyStyle:"border-right-width:1px;",lines:true,animCollapse:false,animate:false,loader:h,root:c,autoScroll:true,listeners:{click:function(l){g.sortId=l.attributes.sortId;j.load({params:g})}}});var e=new Ext.Window({title:"选择流程",width:500,height:400,layout:"border",modal:true,autoScroll:true,maximizable:false,resizable:false,items:[a,k],buttons:[{text:lang("ok"),iconCls:"icon-order-s-accept",handler:function(l){var n=a.getSelectionModel().getSelections();if(n.length==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{var m=n[0];f.flowNameComp.setValue(m.get("name"));f.flowId=m.get("flowId");e.close()}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()}};var CNOA_notice_notice_listClass;CNOA_notice_notice_listClass=CNOA.Class.create();CNOA_notice_notice_listClass.prototype={init:function(g){var f=this;this.baseUrl="index.php?app=notice&func=notice&action=list";this.from=g;this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_tree_treeRoot=Ext.id();var c=Ext.id();var e=Ext.id();this.storeBar={storeType:"",title:"",stime:0,etime:0};this.fields=[{name:"id"},{name:"isread"},{name:"title"},{name:"content"},{name:"opentype"},{name:"noticetime"},{name:"href"},{name:"from"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getListJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields,unread:"unread"}),listeners:{load:function(i,h,j){f.updateMainMenu(i.reader.jsonData.unread)}},sortInfo:{field:"noticetime",direction:"DESC"}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("title"),dataIndex:"title",id:"title",width:180,sortable:false,menuDisabled:true},{header:lang("content"),dataIndex:"content",id:"content",width:250,sortable:false,menuDisabled:true},{header:lang("noticeTime"),dataIndex:"noticetime",width:112,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(h,i){Ext.apply(i,f.storeBar)}}});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",stripeRows:true,autoExpandColumn:"content",listeners:{cellclick:function(i,l,j,k){if(j!=8&&j!=1&&j!=0){var h=i.getStore().getAt(l);f.viewNotice(h)}}},tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(h,i){f.store.reload()}.createDelegate(this)},{text:lang("markedAsRead"),iconCls:"icon-sms-readed",cls:"btn-red1",id:c,handler:function(j,n){var m=f.grid.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(j,lang("noSelect"))}else{if(m){var k="";for(var h=0;h<m.length;h++){k+=m[h].get("id")+",";var l=m[h]}f.setReader(k,"read")}}}},{text:lang("markedAsUnread"),iconCls:"icon-noRead",cls:"btn-red1",id:e,hidden:true,handler:function(j,n){var m=f.grid.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(j,lang("noSelect"))}else{if(m){var k="";for(var h=0;h<m.length;h++){k+=m[h].get("id")+",";var l=m[h]}f.setReader(k,"unread")}}}},{handler:function(h,i){Ext.getCmp(c).show();Ext.getCmp(e).hide();f.storeBar.storeType="wait";f.store.load({params:f.storeBar})}.createDelegate(this),iconCls:"icon-noRead",cls:"btn-blue4",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"NOTICE_BTN_GROUP",text:lang("unreadNotice")},{handler:function(h,i){Ext.getCmp(c).hide();Ext.getCmp(e).show();f.storeBar.storeType="read";f.store.load({params:f.storeBar})}.createDelegate(this),enableToggle:true,allowDepress:false,toggleGroup:"NOTICE_BTN_GROUP",iconCls:"icon-remind-readed",cls:"btn-blue3",text:lang("readedNotice")},{handler:function(h,i){f.delNotice()},iconCls:"icon-utils-s-delete",text:lang("del")},"->",{xtype:"cnoa_helpBtn",helpid:46}]}),bbar:this.pagingBar});var b=Ext.id();var a=Ext.id();var d=Ext.id();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid],tbar:[(lang("title")+":"),{xtype:"textfield",width:120,id:b},lang("startTime")+": ",{xtype:"datefield",format:"Y-m-d",width:100,id:a},lang("endTime")+": ",{xtype:"datefield",format:"Y-m-d",width:100,id:d},{text:lang("search"),handler:function(){f.storeBar.title=Ext.getCmp(b).getValue();f.storeBar.stime=Ext.getCmp(a).getRawValue();f.storeBar.etime=Ext.getCmp(d).getRawValue();f.store.load({params:f.storeBar})}},{text:lang("clear"),handler:function(){f.storeBar.title="";f.storeBar.stime="";f.storeBar.etime="";Ext.getCmp(b).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");f.store.load({params:f.storeBar})}}]})},delNotice:function(){var c=this;var a=c.grid.getSelectionModel();var b=a.getSelections();if(b.length==0){CNOA.msg.alert(lang("selectItemToDel"));return false}Ext.Msg.confirm(lang("warning"),lang("areYouDelete"),function(e){if(e=="yes"){var f="";for(var d=0;d<b.length;d++){f+=b[d].data.id;if(d<b.length-1){f+=","}}Ext.Ajax.request({url:c.baseUrl,params:{task:"deleteNotice",id:f},method:"POST",success:function(h){var g=Ext.decode(h.responseText);if(g.success==true){CNOA.msg.alert(g.msg);c.store.reload()}}})}})},setReader:function(b,a){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=signAllRead",method:"POST",params:{ids:b,type:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);c.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})},makeUnread:function(e,c,a,f,b,d){if(e=="1"){return"<img src='./resources/images/icons/sms-readed.gif' ext:qtip='"+lang("readed")+"' />"}else{return"<img src='./resources/images/icons/sms-unread.gif' ext:qtip='"+lang("unread")+"' />"}},makeView:function(b){var a="<div style='margin-top:2px;'><a href='javascript:void(0);'>"+lang("view")+"</a>";a+="</div>";return a},makeDelete:function(f,d,a,g,c,e){var b="<div style='margin-top:2px;'><a href='javascript:void(0);' onclick='CNOA_notice_notice_list_"+this.from+".deleteNotice("+f+", "+g+");'>"+lang("del")+"</a>";b+="</div>";return b},makeFrom:function(b,f,a,i,d,g){var c=CNOA_APP_NOTICE_FROMTYPE[b].name;var e=a.data;if(e.isread=="0"){c="<b>"+c+"</b>"}return c},makeContent:function(b,e,a,g,c,f){var d=a.data;if(d.isread=="0"){b="<b>"+b+"</b>"}return b},deleteNotice:function(c,b){var a=this;a.deleteNoticeAjax(c)},deleteNoticeAjax:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deleteNotice",params:{id:b},method:"POST",success:function(f){a.store.reload();try{var d=Ext.getCmp("CNOA_MENU_SYSTEM_NOTICE").getNodeById("CNOA_MENU_SYSTEM_NOTICE_UNREAD");var c=d.text.replace(/.*\(.*>([0-9]{1,})<.*\)/g,"$1");a.updateMainMenu(--c)}catch(g){}}.createDelegate(this)})},updateMainMenu:function(a){var g=this;var f="";f="CNOA_MENU_SYSTEM_NOTICE_UNREAD";try{var b=Ext.getCmp("CNOA_MENU_SYSTEM_NOTICE").getNodeById(f);var d=b.text.replace(/\(.*\)/g,"");if(a>0){b.setText(d+"(<span style='color:red'>"+a+"</span>)")}else{b.setText(d)}}catch(c){}},viewNotice:function(a){this.updateIsread(a);var d=this;var c=a.data;var b=new CNOA.noticeWindow(c.id,c.from,{title:c.title,content:c.content,href:c.href,opentype:c.opentype}).goView()},updateIsread:function(a){var b=this;if(a.get("isread")==1){return null}b.store.reload();Ext.Ajax.request({url:b.baseUrl+"&task=updateIsread",params:{id:a.get("id")},method:"POST",success:function(f){a.set("isread","1");a.commit();try{var d=Ext.getCmp("CNOA_MENU_SYSTEM_NOTICE").getNodeById("CNOA_MENU_SYSTEM_NOTICE_UNREAD");var c=d.text.replace(/.*\(.*>([0-9]{1,})<.*\)/g,"$1");b.updateMainMenu(--c)}catch(g){}}.createDelegate(this)})}};var sm_notice_notice=1;
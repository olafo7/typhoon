var CNOA_adm_articles_transportIndexClass,CNOA_adm_articles_transportIndex;CNOA_adm_articles_transportIndexClass=CNOA.Class.create();CNOA_adm_articles_transportIndexClass.prototype={init:function(){var a=this;a.baseUrl="index.php?app=adm&func=articles&action=transport";this.searchPar={storeType:""};this.fields=[{name:"id"},{name:"libraryName"},{name:"typeName"},{name:"productID"},{name:"productName"},{name:"type"},{name:"status"},{name:"quantity"},{name:"checkName"},{name:"signInName"},{name:"transportStatus"},{name:"signInStatus"},{name:"finishTime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"productID",dataIndex:"productID",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("supLi"),dataIndex:"libraryName",width:100,sortable:true,menuDisabled:true},{header:lang("suppCategory"),dataIndex:"typeName",width:100,sortable:true,menuDisabled:true},{header:lang("supName"),dataIndex:"productName",width:100,sortable:true,menuDisabled:true},{header:lang("type"),dataIndex:"type",width:80,sortable:true,menuDisabled:true},{header:lang("quantity"),dataIndex:"quantity",width:80,sortable:true,menuDisabled:true},{header:lang("opt"),dataIndex:"transportStatus",width:100,sortable:true,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("libiraryAdm"),dataIndex:"checkName",width:80,sortable:true,menuDisabled:true},{header:lang("itemRegister"),dataIndex:"signInName",width:80,sortable:true,menuDisabled:true},{header:lang("registerStatus"),dataIndex:"signInStatus",width:100,sortable:true,menuDisabled:true,renderer:this.signInStatus.createDelegate(this)},{header:lang("timeGetGoods"),dataIndex:"finishTime",width:100,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(b,c){Ext.apply(c,a.searchPar)}}});this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(b,c){var d=a.list.getSelectionModel().getSelections()}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{text:lang("borrowList"),iconCls:"icon-borrowList",pressed:true,cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"ARTICLES_TRANSPORT",tooltip:lang("displayBorrowList"),handler:function(b,c){a.searchPar.storeType="borrow";a.store.load({params:a.searchPar})}},{text:lang("recipientList"),iconCls:"icon-utils-s-add",enableToggle:true,allowDepress:false,cls:"btn-blue4",toggleGroup:"ARTICLES_TRANSPORT",tooltip:lang("displayRequeisitSupList"),handler:function(b,c){a.searchPar.storeType="lead";a.store.load({params:a.searchPar})}},{text:lang("returnList"),iconCls:"icon-returnList",enableToggle:true,allowDepress:false,cls:"btn-blue2",toggleGroup:"ARTICLES_TRANSPORT",tooltip:lang("displayReturnList"),handler:function(b,c){a.searchPar.storeType="return";a.store.load({params:a.searchPar})}},"->",{xtype:"cnoa_helpBtn",helpid:131}],bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},signInStatus:function(e,c,a,f,b,d){if(e==1){if(a.data.status==3){return lang("hasAlreadyRectived")}else{return lang("alreadyReceiveReturn")}}else{if(a.data.status==3){return lang("weiLQ")}else{return lang("weiLQreturn")}}},operation:function(e,c,a,f,b,d){if(e==1){return"<span class='cnoa_color_green'>"+lang("inScheduling")+"</span>"}else{if(e==2){return"<span class='cnoa_color_gray'>"+lang("schedulBeenComplete")+"</span>"}else{return"<a href='javascript:void(0)' onclick='CNOA_adm_articles_transportIndex.finishTask("+a.data.id+","+a.data.productID+","+a.data.quantity+","+a.data.status+")'>"+lang("hasGotGoods")+"</a>"}}},finishTask:function(c,b,d,a){var e=this;CNOA.msg.cf(lang("areYouSureDoThis"),function(f){if(f=="yes"){Ext.Ajax.request({url:e.baseUrl+"&task=finishTask",method:"POST",params:{id:c,productID:b,quantity:d,status:a},success:function(h){var g=Ext.decode(h.responseText);if(g.success===true){CNOA.msg.notice(g.msg,lang("admSuppMgr"));e.store.reload()}else{CNOA.msg.alert(g.msg)}}})}})}};var CNOA_adm_articles_settingLibraryClass,CNOA_adm_articles_settingLibrary;CNOA_adm_articles_settingLibraryClass=CNOA.Class.create();CNOA_adm_articles_settingLibraryClass.prototype={init:function(){var a=this;this.edit_id=0;this.type="add";a.baseUrl="index.php?app=adm&func=articles&action=library";this.fields=[{name:"id"},{name:"name"},{name:"typeName"},{name:"deptName"},{name:"adminNames"},{name:"transportNames"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel();this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("supLi"),dataIndex:"name",width:100,sortable:true,menuDisabled:true},{header:lang("suppCategory"),dataIndex:"typeName",width:300,sortable:true,menuDisabled:true},{header:lang("belongDept"),dataIndex:"deptName",width:100,sortable:true,menuDisabled:true},{header:lang("warehouseMgr"),dataIndex:"adminNames",width:140,sortable:true,menuDisabled:true},{header:lang("itemDispatcher"),dataIndex:"transportNames",width:140,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.list=new Ext.grid.GridPanel({border:false,store:this.store,stripeRows:true,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,listeners:{rowdblclick:function(b,c){var d=a.list.getSelectionModel().getSelections();a.type="edit";a.edit_id=d[0].get("id");a.newLibrary()}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{text:lang("addNewLibSup"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){a.type="add";a.newLibrary()}},{text:lang("editLibrary"),iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(b,c){var d=a.list.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{a.type="edit";a.edit_id=d[0].get("id");a.newLibrary()}}.createDelegate(this)},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){a.deleteList(b)}},"->",{xtype:"cnoa_helpBtn",helpid:130}]}),bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({bodyStyle:"border-left-width:1px;",title:lang("supLibSet"),collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},newLibrary:function(){var c=this;var a=Ext.id();var b=Ext.id();this.ID_textarea_deptNames=Ext.id();this.ID_button_deptNames=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("addNewLibSup"),defaults:{style:{marginBottom:"0px"},border:false},items:[{xtype:"panel",layout:"form",width:550,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",fieldLabel:lang("libName"),allowBlank:false,name:"name",width:450},{xtype:"departmentselectorfield",fieldLabel:lang("belongDept"),width:450,allowBlank:false,name:"deptID",multiSelect:false},{xtype:"textarea",width:450,readOnly:true,fieldLabel:lang("libiraryAdm"),allowBlank:false,blankText:lang("pleaseSelectKuAdmin"),name:"adminNames"},{xtype:"hidden",name:"adminIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-10",dataUrl:c.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:85px;margin-bottom:4px;margin-top:-10px;",text:lang("select"),listeners:{selected:function(f,g){var h=new Array();var e=new Array();if(g.length>0){for(var d=0;d<g.length;d++){h.push(g[d].uname);e.push(g[d].uid)}}c.formPanel.getForm().findField("adminNames").setValue(h.join(","));c.formPanel.getForm().findField("adminIDs").setValue(e.join(","))},onrender:function(d){d.setSelectedUids(c.formPanel.getForm().findField("adminIDs").getValue().split(","))}}},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:80px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("noteSuchAs")}}),{xtype:"textarea",height:45,width:450,readOnly:true,fieldLabel:lang("itemDispatcher"),allowBlank:false,blankText:lang("selectItemDispatcher"),name:"transportNames"},{xtype:"hidden",name:"transportIDs"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-10",dataUrl:c.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:85px;margin-bottom:4px;margin-top:-10px;",text:lang("select"),listeners:{selected:function(f,g){var h=new Array();var e=new Array();if(g.length>0){for(var d=0;d<g.length;d++){h.push(g[d].uname);e.push(g[d].uid)}}c.formPanel.getForm().findField("transportNames").setValue(h.join(","));c.formPanel.getForm().findField("transportIDs").setValue(e.join(","))},onrender:function(d){d.setSelectedUids(c.formPanel.getForm().findField("transportIDs").getValue().split(","))}}},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:80px;margin-top:5px;margin-bottom:5px;color:#676767;",html:lang("noteSuppliesSelectDispatcher")}})]}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.addWindow=new Ext.Window({title:lang("addNewLibSup"),width:620,height:makeWindowHeight(510),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){c.submitForm()}},{text:lang("close"),cls:"btn-red1",iconCls:"icon-dialog-cancel",handler:function(){c.addWindow.close()}}]}).show();if(this.type=="edit"){c.loadFormData()}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=list&edit=edit",params:{id:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.addWindow.close()})}.createDelegate(this)})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("admSuppMgr"));a.addWindow.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},deleteList:function(a){var c=this;var b=this.list.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(d){if(d=="yes"){c.deleteData(b[0].get("id"))}})}},deleteData:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("admSuppMgr"));a.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_adm_articles_settingTypeClass,CNOA_adm_articles_settingType;CNOA_adm_articles_settingTypeClass=CNOA.Class.create();CNOA_adm_articles_settingTypeClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=adm&func=articles&action=library";this.libraryComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:a.baseUrl+"&task=getArticlesLibraryList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"libraryID",mapping:"id"},{name:"name"}]})});this.libraryComboBoxDataStore.load();this.sortStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getArticlesLibraryList",method:"POST"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"libraryID",mapping:"id"},{name:"name"}]})});this.sortStore.load();this.sortCombo=new Ext.form.ComboBox({autoLoad:true,triggerAction:"all",selectOnFocus:true,editable:false,store:this.sortStore,valueField:"libraryID",hiddenName:"libraryID",displayField:"name",allowBlank:false,mode:"local",forceSelection:true});this.fields=[{name:"id"},{name:"libraryID"},{name:"libraryName"},{name:"name"}];this.store=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=typeList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{update:function(d,b,c){var e=b.data;if(c==Ext.data.Record.EDIT){a.submit(e)}}},sortInfo:{field:"id",direction:"DESC"}});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.editor=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});this.sm=new Ext.grid.CheckboxSelectionModel();this.cm=[new Ext.grid.RowNumberer(),this.sm,{header:"",dataIndex:"id",hidden:true},{header:"",dataIndex:"libraryID",hidden:true},{header:lang("sortName"),dataIndex:"name",width:200,sortable:true,editor:{xtype:"textfield",allowBlank:false}},{id:"libraryName",header:lang("belongLibraryName"),dataIndex:"libraryName",width:250,sortable:true,editor:this.sortCombo,renderer:function(b){var c;a.sortStore.each(function(d){if(d.get("libraryID")==b){c=d;return}});return c==null?b:c.get("name")}}];this.grid=new Ext.grid.GridPanel({store:this.store,width:600,plain:false,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,stripeRows:true,plugins:[this.editor],columns:this.cm,sm:this.sm,view:new Ext.grid.GroupingView({markDirty:false}),tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("addSuppliesType"),cls:"btn-blue4",iconCls:"icon-utils-s-add",handler:function(){a.libraryComboBoxDataStore.load();a.newType()}},{iconCls:"icon-utils-s-delete",text:lang("del"),tooltip:lang("delRecord"),handler:function(b){a.editor.stopEditing();var c=a.grid.getSelectionModel().getSelections();if(c.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("sureWantDelType"),function(d){if(d=="yes"){a.deleteList(c[0].get("id"))}})}}},"<span class='cnoa_color_gray'>"+lang("dblclickToEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:129}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({bodyStyle:"border-left-width:1px;",title:lang("supCateSet"),collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},newType:function(){var a=this;this.baseField=[{xtype:"fieldset",title:lang("addNewCategories"),defaults:{style:{marginBottom:"-10px"},border:false},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("supLi"),name:"libraryID",allowBlank:false,store:a.libraryComboBoxDataStore,hiddenName:"libraryID",valueField:"libraryID",displayField:"name",mode:"local",width:230,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(d,b,c){}.createDelegate(this),change:function(){}.createDelegate(this)}})]},{xtype:"cnoa_textfield",fieldLabel:lang("cetegoryName"),allowBlank:false,name:"name",width:230}]}]}];this.typeFormPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.newTypeWindow=new Ext.Window({title:lang("addNewType"),width:420,height:220,modal:true,layout:"fit",resizable:false,border:false,items:[this.typeFormPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){a.typeSubmitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.newTypeWindow.close()}}]}).show()},typeSubmitForm:function(){var a=this;if(a.typeFormPanel.getForm().isValid()){a.typeFormPanel.getForm().submit({url:a.baseUrl+"&task=typeAdd",waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("admSuppliesType"));a.store.reload();this.newTypeWindow.close()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},submit:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=editTypeData",params:a,method:"POST",success:function(e,d){var c=Ext.decode(e.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("admSuppliesType"))}else{CNOA.msg.alert(c.msg,function(){b.store.reload();CNOA_adm_articles_settingLibrary.store.reload()})}},failure:function(c,d){CNOA.msg.alert(result.msg,function(){b.store.reload()})}})},deleteList:function(b){var a=this;Ext.Ajax.request({url:this.baseUrl+"&task=deleteType",method:"POST",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.alert(c.msg,function(){a.store.reload();CNOA_adm_articles_settingLibrary.store.reload()})}else{CNOA.msg.alert(c.msg)}}})}};var CNOA_adm_articles_settingClass,CNOA_adm_articles_setting;CNOA_adm_articles_settingClass=CNOA.Class.create();CNOA_adm_articles_settingClass.prototype={init:function(){var a=this;this.edit_id=0;this.type="add";a.baseUrl="index.php?app=adm&func=articles&action=library";CNOA_adm_articles_settingLibrary=new CNOA_adm_articles_settingLibraryClass();CNOA_adm_articles_settingType=new CNOA_adm_articles_settingTypeClass();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[CNOA_adm_articles_settingLibrary.mainPanel,CNOA_adm_articles_settingType.mainPanel]})}};var CNOA_adm_articles_personApplyClass,CNOA_adm_articles_personApply;CNOA_adm_articles_personApplyClass=CNOA.Class.create();CNOA_adm_articles_personApplyClass.prototype={init:function(){var k=this;this.edit_id=0;this.type="add";k.baseUrl="index.php?app=adm&func=articles&action=personRegister";var p=Ext.id();var f=Ext.id();var m=Ext.id();var l=Ext.id();var n=Ext.id();var c=Ext.id();var h=Ext.id();var j=Ext.id();var e=Ext.id();var g=Ext.id();var a=Ext.id();var i=Ext.id();var d=Ext.id();var b=Ext.id();this.searchPar={storeType:"waiting",name:"",signstime:"",signetime:"",signpeople:"",transstime:"",transetime:"",transpeople:"",sortType:""};this.libraryComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:k.baseUrl+"&task=getArticlesLibraryList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"libraryID",mapping:"id"},{name:"name"}]})});this.typeComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:k.baseUrl+"&task=getArticlesTypelList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"typeID"},{name:"name"}]})});this.productComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:k.baseUrl+"&task=getArticlesProductlList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"productID"},{name:"name"}]})});this.fields=[{name:"id"},{name:"name"},{name:"number"},{name:"type"},{name:"quantity"},{name:"status"},{name:"transportName"},{name:"checkName"},{name:"statusName"},{name:"signInStatus"},{name:"transportStatus"},{name:"signInTime"},{name:"transportTime"},{name:"explain"},{name:"typect"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(q,r){Ext.apply(r,k.searchPar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("goodCode"),dataIndex:"number",width:100,sortable:true,menuDisabled:true},{header:lang("supName"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("appType"),dataIndex:"type",width:80,sortable:true,menuDisabled:true},{header:lang("quantity"),dataIndex:"quantity",width:80,sortable:true,menuDisabled:true},{header:lang("auditUser"),dataIndex:"checkName",width:100,sortable:false,menuDisabled:true},{header:lang("itemDispatcher"),dataIndex:"transportName",width:100,sortable:false,menuDisabled:true},{header:lang("scheduStatus"),dataIndex:"transportStatus",width:100,sortable:false,menuDisabled:true,renderer:this.transportStatus.createDelegate(this)},{header:lang("opt"),dataIndex:"signInStatus",width:100,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("registerTime"),dataIndex:"signInTime",width:100,sortable:false,menuDisabled:true},{header:lang("byTimeAudit"),dataIndex:"transportTime",width:100,sortable:false,menuDisabled:true},{header:lang("description"),dataIndex:"explain",width:100,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(q,r){var s=k.list.getSelectionModel().getSelections();k.edit_id=s[0].get("id")}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(q,r){k.store.reload()}},{text:lang("regSup"),iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(){k.type="add";k.newRegisterWindow()}},{text:lang("obsolete"),iconCls:"icon-utils-s-delete",cls:"btn-gray1",handler:function(q,r){var s=k.list.getSelectionModel().getSelections();if(s.length==0){CNOA.miniMsg.alertShowAt(q,lang("mustSelectOneRow"))}else{status=s[0].get("status");if(status=="2"){CNOA.msg.alert(lang("supBeenAppNotSet"))}else{if(status=="3"){CNOA.msg.alert(lang("supAlreadySetAside"))}else{id=s[0].get("id");k.deleteApplic(id)}}}}.createDelegate(this)},{text:lang("showQuery"),iconCls:"icon-search",enableToggle:true,cls:"btn-blue4",allowDepress:true,toggleHandler:function(q,r){if(r){Ext.getCmp(d).show();Ext.getCmp(b).show();q.setText(lang("closeQuery"));k.mainPanel.doLayout()}else{Ext.getCmp(d).hide();Ext.getCmp(b).hide();q.setText(lang("showQuery"));k.mainPanel.doLayout()}}}],bbar:this.pagingBar});this.center2=new Ext.Panel({layout:"fit",border:false,hideBorders:false,items:this.list,tbar:new Ext.Toolbar({items:[{text:lang("NoApprovalList"),iconCls:"icon-doc-list",pressed:true,cls:"btn-yellow1",enableToggle:true,allowDepress:false,toggleGroup:"ARTICLES_REG_GROUP",tooltip:lang("displaySupList"),id:a,handler:function(q,r){k.searchPar.storeType="waiting";k.store.load({params:k.searchPar})}},{text:lang("appByList"),iconCls:"icon-pass",cls:"btn-blue3",enableToggle:true,allowDepress:false,toggleGroup:"ARTICLES_REG_GROUP",tooltip:lang("displayListApp"),handler:function(q,r){k.searchPar.storeType="pass";k.store.load({params:k.searchPar})}},{text:lang("appNotPass"),iconCls:"icon-noPass",enableToggle:true,allowDepress:false,cls:"btn-blue2",toggleGroup:"ARTICLES_REG_GROUP",tooltip:lang("displayListApp"),handler:function(q,r){k.searchPar.storeType="unpass";k.store.load({params:k.searchPar})}},{text:lang("dispatchList"),iconCls:"icon-order",enableToggle:true,allowDepress:false,cls:"btn-blue3",toggleGroup:"ARTICLES_REG_GROUP",tooltip:lang("displayListBeingDD"),id:g,handler:function(q,r){k.searchPar.storeType="transing";k.store.load({params:k.searchPar})}},{text:lang("bosoleteList"),iconCls:"icon-utils-s-delete",enableToggle:true,allowDepress:false,cls:"btn-gray1",toggleGroup:"ARTICLES_REG_GROUP",tooltip:lang("displayItemVoid"),handler:function(q,r){k.searchPar.storeType="drop";k.store.load({params:k.searchPar})}}]})});this.center=new Ext.Panel({region:"center",layout:"fit",border:false,hideBorders:false,items:this.center2,tbar:new Ext.Toolbar({id:b,hidden:true,items:[lang("ddStime")+":",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:c}]},"~",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:h}]},lang("itemDispatcher")+":",{xtype:"hidden",id:j},{xtype:"panel",border:false,items:[{xtype:"triggerForPeople",dataUrl:k.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:e,listeners:{selected:function(s,r,q){Ext.getCmp(j).setValue(r)}}}]},lang("receiveBorrow")+":",{xtype:"panel",border:false,items:[new Ext.form.ComboBox({name:"sortType",id:i,store:new Ext.data.SimpleStore({fields:["value","sortType"],data:[["all",lang("All")],["borrow",lang("borrowing")],["lead",lang("consuming")],["return",lang("restitution")]]}),hiddenName:"sortType",valueField:"value",displayField:"sortType",mode:"local",width:60,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,value:"all"})]},{text:lang("search"),iconCls:"icon-hr-search",handler:function(q){k.searchPar.sortType=Ext.getCmp(i).getValue();k.searchPar.name=Ext.getCmp(p).getValue();k.searchPar.signstime=Ext.getCmp(f).getRawValue();k.searchPar.signetime=Ext.getCmp(m).getRawValue();k.searchPar.signpeople=Ext.getCmp(l).getValue();k.searchPar.transstime=Ext.getCmp(c).getRawValue();k.searchPar.transetime=Ext.getCmp(h).getRawValue();k.searchPar.transpeople=Ext.getCmp(j).getValue();k.store.load({params:k.searchPar})}},{text:lang("clear"),handler:function(q){Ext.getCmp(p).setValue("");Ext.getCmp(f).setValue("");Ext.getCmp(m).setValue("");Ext.getCmp(l).setValue("");Ext.getCmp(n).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(h).setValue("");Ext.getCmp(j).setValue("");Ext.getCmp(e).setValue("");k.searchPar.name="";k.searchPar.signstime="";k.searchPar.signetime="";k.searchPar.signpeople="";k.searchPar.transstime="";k.searchPar.transetime="";k.searchPar.transpeople="";k.store.load({params:k.searchPar})}},"->",{xtype:"cnoa_helpBtn",helpid:132}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center],tbar:new Ext.Toolbar({id:d,hidden:true,items:[lang("supName")+":",{xtype:"panel",border:false,items:[{xtype:"cnoa_textfield",width:100,id:p}]},lang("startTime")+":",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:f}]},"~:",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:m}]},lang("registrant")+":",{xtype:"hidden",id:l},{xtype:"panel",border:false,items:[{xtype:"triggerForPeople",dataUrl:k.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:n,listeners:{selected:function(s,r,q){Ext.getCmp(l).setValue(r)}}}]}]})});var o=CNOA.adm.articles.personApply.from;if(o=="transport"){Ext.getCmp(a).toggle();Ext.getCmp(g).toggle();k.searchPar.storeType="transing";k.store.load({params:k.searchPar})}else{this.store.load()}},newRegisterWindow:function(){var e=this;var c=Ext.id();var a=Ext.id();var b=Ext.id();var d=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("appSupBasicXX"),defaults:{style:{marginBottom:"10px"},width:300,xtype:"combo"},layout:"form",items:[{xtype:"combo",fieldLabel:lang("registerType"),name:"type",allowBlank:false,id:c,store:new Ext.data.SimpleStore({fields:["value","type"],data:[["3",lang("consuming")],["2",lang("borrowing")],["1",lang("restitution")]]}),hiddenName:"type",valueField:"value",displayField:"type",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.libraryComboBoxDataStore.load()}.createDelegate(this),change:function(h,f,g){Ext.getCmp(a).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.productComboBoxDataStore.removeAll()}.createDelegate(this)}},{fieldLabel:lang("supLi"),name:"libraryID",allowBlank:false,id:a,store:e.libraryComboBoxDataStore,hiddenName:"libraryID",valueField:"libraryID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.typeComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this),change:function(h,f,g){Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.productComboBoxDataStore.removeAll();e.typeComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this)}},{fieldLabel:lang("suppCategory"),name:"typeID",allowBlank:false,id:b,store:e.typeComboBoxDataStore,hiddenName:"typeID",valueField:"typeID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");libraryID=Ext.getCmp(a).getValue();applyType=Ext.getCmp(c).getValue();e.productComboBoxDataStore.load({params:{typeID:h.getValue(),libraryID:libraryID,applyType:applyType}})}.createDelegate(this)}},{fieldLabel:lang("article"),name:"productID",allowBlank:false,id:d,store:e.productComboBoxDataStore,hiddenName:"productID",valueField:"productID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){}.createDelegate(this),change:function(){}.createDelegate(this)}},{xtype:"cnoa_textfield",fieldLabel:lang("quantity"),allowBlank:false,regex:/^([0-9]{1,}\.[0-9]{1,}|[0-9]{1,})$/i,regexText:lang("mustSetPureNum"),name:"quantity"},{xtype:"textarea",fieldLabel:lang("remark"),name:"notes"}]}];this.formPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,layout:"fit",labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px",items:this.baseField});this.window=new Ext.Window({title:lang("appForPersonItem"),width:480,height:makeWindowHeight(490),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",cls:"btn-blue4",handler:function(){e.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.window.close()}}]}).show()},transportStatus:function(a){if(a==1){return lang("inScheduling")}else{if(a==2){return lang("schedulBeenComplete")}else{return lang("notToGetSup")}}},operation:function(f,d,a,h,c,e){var g=this;var b=a.data.typect;if(f==1){if(b==3){return"<span class='cnoa_color_gray'>"+lang("hasAlreadyRectived")+"</span>"}else{return"<span class='cnoa_color_gray'>"+lang("alreadyReceiveReturn")+"</span>"}}else{if(a.data.status==2&&a.data.transportStatus==1){if(b==3){return"<a href='javascript:void(0)' onclick='CNOA_adm_articles_personApply.finishTask("+a.data.id+")'>"+lang("hasAlreadyRectived")+"</a>"}else{return"<a href='javascript:void(0)' onclick='CNOA_adm_articles_personApply.finishTask("+a.data.id+")'>"+lang("alreadyReceiveReturn")+"</a>"}}else{return"-----"}}},finishTask:function(a){var b=this;CNOA.msg.cf(lang("areYouSureDoThis"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=finishTask",method:"POST",params:{id:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("admSupApply"));b.store.reload()}else{CNOA.msg.alert(d.msg)}}})}})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task=add",waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("admSupApply"));this.window.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},deleteApplic:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deleteApplic",waitMsg:lang("waiting"),method:"POST",params:{id:b},success:function(c){CNOA.msg.notice(Ext.decode(c.responseText).msg,lang("admSupApply"));a.store.load()}.createDelegate(this),failure:function(c,d){CNOA.msg.alert(d.result.msg)}.createDelegate(this)})}};CNOA_adm_articles_personChoiceClass=CNOA.Class.create();CNOA_adm_articles_personChoiceClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=adm&func=articles&action=personRegister";this.fields=[{name:"id"},{name:"name"},{name:"number"},{name:"type"},{name:"quantity"},{name:"status"},{name:"transportName"},{name:"checkName"},{name:"statusName"},{name:"signInStatus"},{name:"transportStatus"},{name:"signInTime"},{name:"transportTime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=myProductList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(b,c){Ext.apply(c,a.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("goodCode"),dataIndex:"number",width:100,sortable:true,menuDisabled:true},{header:lang("supName"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("suppCategory"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("supLi"),dataIndex:"name",width:120,sortable:true,menuDisabled:true},{header:lang("auditUser"),dataIndex:"checkName",width:100,sortable:false,menuDisabled:true,renderer:this.checkName.createDelegate(this)},{header:lang("itemDispatcher"),dataIndex:"transportName",width:100,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({layout:"fit",region:"center",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",items:this.list})},mkTip:function(a){new Ext.ToolTip({target:a,width:200,autoLoad:{url:"ajax-tip.html"},dismissDelay:15000})},checkName:function(b,d,a){return"<a href='javascript:void(0)' ext:qtipajax='aaa'>"+b+"</a>"}};CNOA_adm_articles_personRegisterManageClass=CNOA.Class.create();CNOA_adm_articles_personRegisterManageClass.prototype={init:function(){var e=this;var d=new CNOA_adm_articles_personChoiceClass();var b=d.mainPanel;var c=new CNOA_adm_articles_personApplyClass();var a=c.mainPanel;this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"card",activeItem:0,autoScroll:true,items:[b,a],tbar:[{text:lang("chooseItem"),enableToggle:true,allowDepress:false,toggleGroup:"ADM_APPLY_LIST",iconCls:"icon-roduction",pressed:true,handler:function(){e.mainPanel.getLayout().setActiveItem(0)}},{text:lang("appInterface"),enableToggle:true,allowDepress:false,toggleGroup:"ADM_APPLY_LIST",iconCls:"icon-roduction",handler:function(){e.mainPanel.getLayout().setActiveItem(1)}}]})}};var CNOA_adm_articles_registerManageIndexClass,CNOA_adm_articles_registerManageIndex;CNOA_adm_articles_registerManageIndexClass=CNOA.Class.create();CNOA_adm_articles_registerManageIndexClass.prototype={init:function(){var i=this;this.id=0;this.type=0;this.quantity=0;var m=Ext.id();var e=Ext.id();var k=Ext.id();var j=Ext.id();var l=Ext.id();var b=Ext.id();var f=Ext.id();var h=Ext.id();var d=Ext.id();var g=Ext.id();var c=Ext.id();var a=Ext.id();this.baseUrl="index.php?app=adm&func=articles&action=register";this.searchPar={name:"",signstime:"",signetime:"",signpeople:"",transstime:"",transetime:"",transpeople:"",storeType:"waiting",sortType:""};this.libraryComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getArticlesLibraryList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"libraryID",mapping:"id"},{name:"name"}]})});this.libraryComboBoxDataStore.load();this.typeComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getArticlesTypelList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"typeID"},{name:"name"}]})});this.productComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getArticlesProductlList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"productID"},{name:"name"}]})});this.transportComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getArticlesTransportlList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"transportID"},{name:"transportName"}]})});this.fields=[{name:"id"},{name:"type"},{name:"name"},{name:"productID"},{name:"number"},{name:"typeTake"},{name:"quantity"},{name:"transportName"},{name:"libraryID"},{name:"libraryName"},{name:"typeName"},{name:"stock"},{name:"notes"},{name:"checkName"},{name:"status"},{name:"statusName"},{name:"signInName"},{name:"signInTime"},{name:"transportTime"},{name:"explain"},{name:"finishTime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:"没有数据显示",displayMsg:"显示第{0}--{1}条数据，共{2}条",store:this.store,pageSize:15,listeners:{beforechange:function(n,o){Ext.apply(o,i.searchPar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:"type",dataIndex:"type",hidden:true},{header:"libraryID",dataIndex:"libraryID",hidden:true},{header:"productID",dataIndex:"productID",hidden:true},{header:lang("supName")+" / "+lang("bianHao"),dataIndex:"name",width:120,sortable:true,menuDisabled:true,renderer:this.nameMult.createDelegate(this)},{header:lang("suppCategory")+" / "+lang("supLi"),dataIndex:"typeName",width:150,sortable:true,menuDisabled:true,renderer:this.typeMult.createDelegate(this)},{header:lang("type"),dataIndex:"typeTake",width:60,sortable:true,menuDisabled:true},{header:lang("numOfApply")+" / "+lang("minInitNotDY"),dataIndex:"quantity",width:120,sortable:true,menuDisabled:true,renderer:this.quantityMult.createDelegate(this)},{header:lang("registerUser"),dataIndex:"signInName",width:80,sortable:false,menuDisabled:true},{header:lang("registerTime"),dataIndex:"signInTime",width:120,sortable:true,menuDisabled:true},{header:lang("registerTime"),dataIndex:"transportName",width:80,sortable:false,menuDisabled:true},{header:lang("schedulingStart")+" / "+lang("finishTime"),dataIndex:"transportTime",width:120,sortable:true,menuDisabled:true,renderer:this.timeMult.createDelegate(this)},{header:lang("remark"),dataIndex:"notes",width:100,sortable:true,menuDisabled:true,renderer:this.notes.createDelegate(this)},{header:lang("description"),dataIndex:"explain",width:120,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(n,o){var p=i.list.getSelectionModel().getSelections();i.edit_id=p[0].get("id")}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(n,o){i.store.reload()}},{text:lang("appRegister"),iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(n,o){var p=i.list.getSelectionModel().getSelections();if(p.length==0){CNOA.miniMsg.alertShowAt(n,lang("selectMessageApp"))}else{if(p[0].get("status")==2){CNOA.msg.alert(lang("supHaveBeenNotEdit"))}else{if(p[0].get("status")==3){CNOA.msg.alert(lang("supBeenSetAside"))}else{i.id=p[0].get("id");i.type=p[0].get("type");i.quantity=p[0].get("quantity");i.productID=p[0].get("productID");libraryID=p[0].get("libraryID");i.transportComboBoxDataStore.load({params:{id:libraryID}});i.check()}}}}.createDelegate(this)},{text:lang("showQuery"),enableToggle:true,iconCls:"icon-search",cls:"btn-blue3",allowDepress:true,toggleHandler:function(n,o){if(o){Ext.getCmp(c).show();Ext.getCmp(a).show();n.setText(lang("closeQuery"));i.mainPanel.doLayout()}else{Ext.getCmp(c).hide();Ext.getCmp(a).hide();n.setText(lang("showQuery"));i.mainPanel.doLayout()}}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>"],bbar:this.pagingBar});this.center2=new Ext.Panel({layout:"fit",border:false,hideBorders:false,items:this.list,tbar:[{text:lang("NoApprovalList"),iconCls:"icon-doc-list",enableToggle:true,pressed:true,allowDepress:false,cls:"btn-yellow1",toggleGroup:"project_proj_myproj_type",tooltip:lang("displayNeedAppList"),handler:function(n,o){i.searchPar.storeType="waiting";i.store.load({params:i.searchPar})}},{text:lang("appByList"),iconCls:"icon-pass",enableToggle:true,allowDepress:false,cls:"btn-blue3",toggleGroup:"project_proj_myproj_type",tooltip:lang("displayListApp"),handler:function(n,o){i.searchPar.storeType="pass";i.store.load({params:i.searchPar})}},{text:lang("appNotPass"),iconCls:"icon-noPass",cls:"btn-blue2",enableToggle:true,allowDepress:false,toggleGroup:"project_proj_myproj_type",tooltip:lang("displaySPnotTGlist"),handler:function(n,o){i.searchPar.storeType="unpass";i.store.load({params:i.searchPar})}},{text:lang("dispatchList"),iconCls:"icon-order",enableToggle:true,cls:"btn-blue3",allowDepress:false,toggleGroup:"project_proj_myproj_type",tooltip:lang("displaySPnotTGlist"),handler:function(n,o){i.searchPar.storeType="transing";i.store.load({params:i.searchPar})}},{text:lang("bosoleteList"),iconCls:"icon-utils-s-delete",enableToggle:true,cls:"btn-gray1",allowDepress:false,toggleGroup:"project_proj_myproj_type",tooltip:lang("displaySupList"),handler:function(n,o){i.searchPar.storeType="drop";i.store.load({params:i.searchPar})}}]});this.center=new Ext.Panel({region:"center",layout:"fit",border:false,hideBorders:false,items:this.center2,tbar:new Ext.Toolbar({id:c,hidden:true,items:[lang("ddStime")+":",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:b}]},"~:",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:f}]},lang("dispatcher")+":",{xtype:"hidden",id:h},{xtype:"panel",border:false,items:[{xtype:"triggerForPeople",dataUrl:i.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:d,listeners:{selected:function(p,o,n){Ext.getCmp(h).setValue(o)}}}]},lang("receiveBorrow")+":",{xtype:"panel",border:false,items:[new Ext.form.ComboBox({name:"sortType",id:g,store:new Ext.data.SimpleStore({fields:["value","sortType"],data:[["all",lang("All")],["borrow",lang("borrowing")],["lead",lang("consuming")],["return",lang("restitution")]]}),hiddenName:"sortType",valueField:"value",displayField:"sortType",mode:"local",width:60,allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,value:"all"})]},{text:lang("search"),iconCls:"icon-hr-search",handler:function(n){i.searchPar.sortType=Ext.getCmp(g).getValue();i.searchPar.name=Ext.getCmp(m).getValue();i.searchPar.signstime=Ext.getCmp(e).getRawValue();i.searchPar.signetime=Ext.getCmp(k).getRawValue();i.searchPar.signpeople=Ext.getCmp(j).getValue();i.searchPar.transstime=Ext.getCmp(b).getRawValue();i.searchPar.transetime=Ext.getCmp(f).getRawValue();i.searchPar.transpeople=Ext.getCmp(h).getValue();i.store.load({params:i.searchPar})}},{text:lang("clear"),handler:function(n){Ext.getCmp(m).setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(k).setValue("");Ext.getCmp(j).setValue("");Ext.getCmp(l).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(f).setValue("");Ext.getCmp(h).setValue("");Ext.getCmp(d).setValue("");i.searchPar.name="";i.searchPar.signstime="";i.searchPar.signetime="";i.searchPar.signpeople="";i.searchPar.transstime="";i.searchPar.transetime="";i.searchPar.transpeople="";i.store.load({params:i.searchPar})}}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center],tbar:new Ext.Toolbar({id:a,hidden:true,items:[lang("supName")+":",{xtype:"panel",border:false,items:[{xtype:"cnoa_textfield",width:100,id:m}]},lang("startTime")+":",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:e}]},"~:",{xtype:"panel",border:false,items:[{xtype:"datefield",width:100,format:"Y-m-d",id:k}]},lang("registrant")+":",{xtype:"hidden",id:j},{xtype:"panel",border:false,items:[{xtype:"triggerForPeople",dataUrl:i.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:l,listeners:{selected:function(p,o,n){Ext.getCmp(j).setValue(o)}}}]}]})})},notes:function(a){return"<a href='javascript:void(0)' onclick='CNOA_adm_articles_registerManageIndex.shownotes(\""+a+"\")'>"+a+"</a>"},shownotes:function(a){CNOA.msg.alert(a)},check:function(){var c=this;var a=Ext.id();var b=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("auditSup"),defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("auditType"),name:"status",allowBlank:false,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["2",lang("pass")],["1",lang("unPass")]]}),width:300,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(f,d,e){if(f.getValue()==1){Ext.getCmp(b).hide();Ext.getCmp(a).show()}else{Ext.getCmp(a).hide();Ext.getCmp(b).show()}}.createDelegate(this)}})]},{xtype:"panel",hidden:true,layout:"form",border:false,id:a,items:[{xtype:"textarea",fieldLabel:lang("notByReason"),name:"unPass",width:300}]},{xtype:"panel",layout:"form",border:false,id:b,hidden:true,items:[new Ext.form.ComboBox({fieldLabel:lang("dispatcher"),name:"transportID",allowBlank:false,store:c.transportComboBoxDataStore,hiddenName:"transportID",valueField:"transportID",displayField:"transportName",mode:"local",width:300,triggerAction:"all",forceSelection:true,editable:false})]}]}];this.checkFormPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.checkWindow=new Ext.Window({title:lang("appSup"),width:480,height:250,modal:true,layout:"fit",resizable:false,border:false,items:[this.checkFormPanel],buttons:[{text:lang("submit"),iconCls:"icon-flow-entrust",handler:function(){c.checkSubmitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.checkWindow.close()}}]}).show()},checkSubmitForm:function(){var e=this;var c=this.checkFormPanel.getForm();var a=c.findField("status");var d=c.findField("unPass");var b=c.findField("transportID");if(a.getValue()==1){b.allowBlank=true;b.validationEvent=false;b.clearInvalid()}if(a.getValue()==2){b.allowBlank=false;b.validationEvent=true}if(e.checkFormPanel.getForm().isValid()){e.checkFormPanel.getForm().submit({url:e.baseUrl+"&task=check",waitMsg:lang("waiting"),method:"POST",params:{id:e.id,type:e.type,quantity:e.quantity,productID:e.productID},success:function(f,g){CNOA.msg.notice(g.result.msg,lang("admSuppMgr"));e.checkWindow.close();e.store.load()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg)}.createDelegate(this)})}},addNewArticles:function(){var e=this;var b=Ext.id();var d=Ext.id();var c=Ext.id();var a=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("regNewInvertory"),defaults:{style:{marginBottom:"0px"},border:false},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("registerType"),name:"type",allowBlank:false,store:new Ext.data.SimpleStore({fields:["value","type"],data:[["3",lang("purchaseStorage")],["2",lang("maintenance1")],["1",lang("scrap")]]}),width:260,hiddenName:"type",valueField:"value",displayField:"type",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){if(h.getValue()==2){Ext.getCmp(c).show();Ext.getCmp(a).show()}else{Ext.getCmp(c).hide();Ext.getCmp(a).hide()}}.createDelegate(this)}})]},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("supLi"),name:"libraryID",allowBlank:false,store:e.libraryComboBoxDataStore,hiddenName:"libraryID",valueField:"libraryID",displayField:"name",mode:"local",width:260,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.typeComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this)}})]},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("suppCategory"),name:"typeID",allowBlank:false,id:b,store:e.typeComboBoxDataStore,hiddenName:"typeID",valueField:"typeID",displayField:"name",mode:"local",width:260,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");e.productComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this)}})]},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("article"),name:"productID",allowBlank:false,id:d,store:e.productComboBoxDataStore,hiddenName:"productID",valueField:"productID",displayField:"name",mode:"local",width:260,triggerAction:"all",forceSelection:true,editable:false})]},{xtype:"cnoa_textfield",fieldLabel:lang("quantity"),allowBlank:false,regex:/^\d{1,}$/i,regexText:lang("mustPureNumbers"),name:"quantity",width:260},{xtype:"panel",layout:"form",border:false,id:c,hidden:true,items:[{xtype:"datefield",fieldLabel:lang("maintainTime"),format:"Y-m-d",allowBlank:false,name:"repair",width:260}]},{xtype:"panel",layout:"form",border:false,id:a,hidden:true,items:[{xtype:"datefield",fieldLabel:lang("noticeTime"),format:"Y-m-d",allowBlank:false,name:"notice",width:260}]}]}]}];this.addFormPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.addWindow=new Ext.Window({title:lang("suppliesStockReg"),width:420,height:370,modal:true,layout:"fit",resizable:false,border:false,items:[this.addFormPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){e.addSubmitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.addWindow.close();e.typeComboBoxDataStore.load({params:{id:0}});e.productComboBoxDataStore.load({params:{id:0}})}}]}).show()},doSearch:function(){var a=this;this.baseField=[{xtype:"fieldset",title:lang("findArticle"),defaults:{style:{marginBottom:"-10px"},border:false},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",fieldLabel:lang("supName"),name:"name",width:230},{xtype:"cnoa_textfield",fieldLabel:lang("goodCode"),name:"number",width:230}]}]}];this.searchform=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}],listeners:{afterrender:function(){this.getForm().findField("name").setValue(a.searchPar.name);this.getForm().findField("number").setValue(a.searchPar.number)}}});this.searchWindow=new Ext.Window({title:lang("querySup"),width:420,height:200,modal:true,layout:"fit",resizable:false,border:false,items:[this.searchform],buttons:[{text:lang("clear"),handler:function(){a.searchRessetForm()}},{text:lang("search"),iconCls:"icon-hr-search",handler:function(){a.searchSubmitForm();a.searchWindow.close()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.searchWindow.close()}}]}).show()},addSubmitForm:function(){var e=this;var c=this.addFormPanel.getForm();var a=c.findField("type");var d=c.findField("repair");var b=c.findField("notice");if(a.getValue()!=2){d.allowBlank=true;d.validationEvent=false;d.clearInvalid();b.allowBlank=true;b.validationEvent=false;b.clearInvalid()}if(e.addFormPanel.getForm().isValid()){e.addFormPanel.getForm().submit({url:e.baseUrl+"&task=add",waitMsg:lang("waiting"),method:"POST",success:function(f,g){CNOA.msg.notice(g.result.msg,lang("admSuppMgr"));this.addWindow.close();e.typeComboBoxDataStore.load({params:{id:0}});e.productComboBoxDataStore.load({params:{id:0}});e.store.load()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg)}.createDelegate(this)})}},searchSubmitForm:function(){var a=this;a.searchPar={name:a.searchform.getForm().findField("name").getValue(),number:a.searchform.getForm().findField("number").getValue()};a.store.load({params:a.searchPar})},searchRessetForm:function(){var a=this;a.searchform.getForm().findField("name").setValue("");a.searchform.getForm().findField("number").setValue("")},typeMult:function(e,c,a,f,b,d){return"<span>"+e+"</span><br /><span>"+a.data.libraryName+"</span>"},nameMult:function(e,c,a,f,b,d){return"<span>"+e+"</span><br /><span>"+a.data.number+"</span>"},timeMult:function(e,c,a,f,b,d){return"<span>"+e+"</span><br /><span>"+a.data.finishTime+"</span>"},quantityMult:function(e,c,a,f,b,d){return"<span>"+e+"</span><br /><span>"+a.data.stock+"</span>"}};var CNOA_adm_articles_infoManageIndexClass,CNOA_adm_articles_infoManageIndex;CNOA_adm_articles_infoManageIndexClass=CNOA.Class.create();CNOA_adm_articles_infoManageIndexClass.prototype={init:function(){var e=this;this.edit_id=0;this.type="add";var c=Ext.id();var a=Ext.id();var b=Ext.id();var d=Ext.id();this.baseUrl="index.php?app=adm&func=articles&action=info";this.searchPar={name:"",number:"",begin:0,end:0};this.fields=[{name:"id"},{name:"name"},{name:"number"},{name:"libraryName"},{name:"typeName"},{name:"standard"},{name:"stock"},{name:"lowerStock"},{name:"heightStock"},{name:"checkName"},{name:"signInNames"},{name:"truename"},{name:"typeTake"},{name:"price"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(k,j,l,i,h,g){var f=Ext.decode(h.responseText);if(f.failure){CNOA.msg.alert(f.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.libraryComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getArticlesLibraryList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"libraryID",mapping:"id"},{name:"name"}]})});this.libraryComboBoxDataStore.load();this.typeComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getArticlesTypelList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"typeID"},{name:"name"}]})});this.productComboBoxDataStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getArticlesProductlList"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"productID"},{name:"name"}]})});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(f,g){g.name=e.searchPar.name;g.number=e.searchPar.number;g.begin=e.searchPar.begin;g.end=e.searchPar.end}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("goodCode"),dataIndex:"number",width:100,sortable:true,menuDisabled:true},{header:lang("supName"),dataIndex:"name",width:120,sortable:true,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("supLi"),dataIndex:"libraryName",width:100,sortable:true,menuDisabled:true},{header:lang("suppCategory"),dataIndex:"typeName",width:100,sortable:true,menuDisabled:true},{header:lang("spec"),dataIndex:"standard",width:100,sortable:true,menuDisabled:true},{header:lang("unitPrice"),dataIndex:"price",width:100,sortable:true,menuDisabled:true},{header:lang("currentInventory"),dataIndex:"stock",width:80,sortable:true,menuDisabled:true},{header:lang("lowStockAlert"),dataIndex:"lowerStock",width:100,sortable:true,menuDisabled:true},{header:lang("highAlertStock"),dataIndex:"heightStock",width:100,sortable:false,menuDisabled:true},{header:lang("approvalAuthority"),dataIndex:"checkName",width:100,sortable:false,menuDisabled:true},{header:lang("registerPermit"),dataIndex:"signInNames",width:100,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(f,g){var h=e.list.getSelectionModel().getSelections();e.edit_id=h[0].get("id");e.viewDetails(e.edit_id)}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{text:lang("addSup"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){e.type="add";e.libraryComboBoxDataStore.load();e.newArticles()}},{text:lang("modifySup"),iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(f,g){var h=e.list.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(f,lang("mustSelectOneRow"))}else{e.type="edit";e.edit_id=h[0].get("id");e.libraryComboBoxDataStore.load();e.newArticles()}}.createDelegate(this)},{text:lang("del"),iconCls:"icon-utils-s-delete",cls:"btn-gray1",handler:function(f){e.deleteList(f)}},{text:lang("stockRegister"),iconCls:"icon-calendar",cls:"btn-blue3",handler:function(f,g){e.addNewStock()}},{xtype:"hidden",name:"signInIDs"},{xtype:"btnForPoepleSelector",cls:"btn-blue3",iconCls:"icon-batch-changeRegister",dataUrl:e.baseUrl+"&task=getAllUserListsInPermitDeptTree",text:lang("batchChangeRegister"),listeners:{selected:function(h,k){var l=new Array();var g=new Array();if(k.length>0){for(var f=0;f<k.length;f++){l.push(k[f].uname);g.push(k[f].uid)}}var j=e.list.getSelectionModel().getSelections();if(j.length==0){CNOA.msg.alert(lang("youDidNotChooseEditData"))}else{CNOA.msg.cf(lang("sureWantBatchEdit"),function(n){if(n=="yes"){if(j){var o="";for(var m=0;m<j.length;m++){o+=j[m].get("id")+","}Ext.Ajax.request({url:e.baseUrl+"&task=batchChange",method:"POST",params:{ids:o,uids:g.join(",")},success:function(p){var i=Ext.decode(p.responseText);if(i.success===true){CNOA.msg.alert(i.msg,function(){e.store.reload()})}else{CNOA.msg.alert(i.msg)}}})}}})}},onrender:function(f){}}},"<span class='cnoa_color_gray'>"+lang("dblClickToView")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:128}],bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list],tbar:[lang("supName")+":",{xtype:"textfield",id:c,width:200},lang("goodCode")+":",{xtype:"textfield",id:a,width:200},lang("currentInventory"),{xtype:"textfield",id:b,width:100},"~",{xtype:"textfield",id:d,width:100},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){e.searchPar.name=Ext.getCmp(c).getValue();e.searchPar.number=Ext.getCmp(a).getValue();e.searchPar.begin=Ext.getCmp(b).getValue();e.searchPar.end=Ext.getCmp(d).getRawValue();e.store.load({params:e.searchPar})}},{xtype:"button",text:lang("clear"),handler:function(){Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(d).setValue("");e.searchPar={name:"",number:"",begin:0,end:0};e.store.load({params:e.searchPar})}}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},newArticles:function(){var g=this;var d=Ext.id();var c=Ext.id();var b=Ext.id();var a=Ext.id();var e=Ext.id();g.selectType=a;var f=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("suppliesBasicXX"),items:[{xtype:"panel",hideBorders:true,border:false,layout:"column",autoWidth:true,layoutConfig:{columns:2},items:[{layout:"form",columnWidth:0.5,defaults:{style:{marginBottom:"10px"},xtype:"cnoa_textfield",width:230},items:[{fieldLabel:lang("supName"),allowBlank:false,name:"name"},{fieldLabel:lang("uniteMeasure"),name:"unit"},{fieldLabel:lang("supplier"),name:"supplies"},{xtype:"numberfield",fieldLabel:lang("lowStockAlert"),helpTip:lang("currentKCremindAdmin"),regexText:lang("mustSetPureNum"),name:"lowerStock"},{xtype:"combo",fieldLabel:lang("supLi"),name:"libraryID",allowBlank:false,store:g.libraryComboBoxDataStore,hiddenName:"libraryID",valueField:"libraryID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,helpTip:lang("adminShowName"),listeners:{select:function(j,h,i){Ext.getCmp(a).setValue("");g.typeComboBoxDataStore.load({params:{id:j.getValue()}})}.createDelegate(this)}},{xtype:"combo",fieldLabel:lang("suppCategory"),name:"typeID",allowBlank:false,id:a,store:g.typeComboBoxDataStore,hiddenName:"typeID",valueField:"typeID",displayField:"name",mode:"local",helpTip:lang("selectKuOtherEmpey"),triggerAction:"all",forceSelection:true,editable:false}]},{layout:"form",columnWidth:0.5,defaults:{style:{marginBottom:"10px"},xtype:"cnoa_textfield",width:230},items:[{fieldLabel:lang("goodCode"),name:"number"},{fieldLabel:lang("spec"),name:"standard"},{fieldLabel:lang("unitPrice"),name:"price"},{xtype:"numberfield",fieldLabel:lang("highAlertStock"),name:"heightStock",helpTip:lang("currentKChighReminAdmin"),regexText:lang("mustSetPureNum"),format:"Y-m-d"},{xtype:"combo",fieldLabel:lang("belongTypeApp"),name:"applyType",allowBlank:false,store:new Ext.data.SimpleStore({fields:["applyType","typeTake"],data:[["3",lang("consuming")],["2",lang("borrowing")]]}),hiddenName:"applyType",valueField:"applyType",displayField:"typeTake",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]}]},{xtype:"textarea",fieldLabel:lang("goodsDesciption"),name:"description",style:{marginBottom:"0"},width:"94%"}]},{xtype:"fieldset",title:lang("mgrXX"),defaults:{style:{marginBottom:"10px"}},items:[{xtype:"hidden",name:"checkID",id:d},{xtype:"textfield",readOnly:true,fieldLabel:lang("approvalor"),name:"checkName",emptyText:lang("clickSelectPerson"),allowBlank:false,listeners:{render:function(h){h.to=d},focus:function(h){people_selector("user",h,false,false)}}},{xtype:"textarea",height:45,width:580,readOnly:true,fieldLabel:lang("itemRegister"),name:"signInNames",emptyText:lang("clickSelectPerson"),style:{marginBottom:"3px"},listeners:{render:function(h){h.to=e},focus:function(h){people_selector("user",h,true,false)}}},{xtype:"hidden",name:"signInIDs",id:e},new Ext.BoxComponent({autoEl:{tag:"div",style:"margin-left:105px;margin-bottom:5px;color:#676767;",html:lang("ifSupplieRegEmpty")}})]}];this.formPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,bodyStyle:"padding:10px",autoScroll:true,labelWidth:100,labelAlign:"right",items:[this.baseField]});this.newArticlesWindow=new Ext.Window({title:lang("addNewArticle"),width:800,height:makeWindowHeight(610),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){g.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){g.newArticlesWindow.close()}}]}).show();if(this.type=="edit"){g.loadFormData()}},addNewStock:function(){var e=this;var b=Ext.id();var d=Ext.id();var c=Ext.id();var a=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("regNewInvertory"),defaults:{style:{marginBottom:"10px"},xtype:"combo",width:230},width:370,layout:"form",items:[{fieldLabel:lang("registerType"),name:"type",allowBlank:false,store:new Ext.data.SimpleStore({fields:["value","type"],data:[["3",lang("purchaseStorage")],["2",lang("maintenance1")],["1",lang("scrap")]]}),hiddenName:"type",valueField:"value",displayField:"type",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){if(h.getValue()==2){Ext.getCmp(c).show();Ext.getCmp(a).show()}else{Ext.getCmp(c).hide();Ext.getCmp(a).hide()}}.createDelegate(this)}},{fieldLabel:lang("supLi"),name:"libraryID",allowBlank:false,store:e.libraryComboBoxDataStore,hiddenName:"libraryID",valueField:"libraryID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");Ext.getCmp(b).setValue("");e.typeComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this)}},{fieldLabel:lang("suppCategory"),name:"typeID",allowBlank:false,id:b,store:e.typeComboBoxDataStore,hiddenName:"typeID",valueField:"typeID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(h,f,g){Ext.getCmp(d).setValue("");e.productComboBoxDataStore.load({params:{id:h.getValue()}})}.createDelegate(this)}},{fieldLabel:lang("article"),name:"productID",allowBlank:false,id:d,store:e.productComboBoxDataStore,hiddenName:"productID",valueField:"productID",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false},{xtype:"numberfield",fieldLabel:lang("quantity"),allowBlank:false,regexText:lang("mustSetPureNum"),name:"quantity"},{xtype:"datefield",fieldLabel:lang("maintainTime"),id:c,hidden:true,format:"Y-m-d",allowBlank:false,name:"repair"},{xtype:"datefield",fieldLabel:lang("noticeTime"),id:a,hidden:true,format:"Y-m-d",allowBlank:false,name:"notice"},{xtype:"textarea",fieldLabel:lang("remark"),name:"notes"}]}];this.addFormPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,bodyStyle:"padding:10px",autoScroll:true,labelWidth:80,labelAlign:"right",items:[this.baseField]});this.addWindow=new Ext.Window({title:lang("suppliesStockReg"),width:420,height:makeWindowHeight(415),modal:true,layout:"fit",resizable:false,border:false,items:[this.addFormPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){e.addSubmitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.addWindow.close()}}]}).show()},addSubmitForm:function(){var e=this;var c=this.addFormPanel.getForm();var a=c.findField("type");var d=c.findField("repair");var b=c.findField("notice");if(a.getValue()!=2){d.allowBlank=true;d.validationEvent=false;d.clearInvalid();b.allowBlank=true;b.validationEvent=false;b.clearInvalid()}if(e.addFormPanel.getForm().isValid()){e.addFormPanel.getForm().submit({url:e.baseUrl+"&task=library",waitMsg:lang("waiting"),method:"POST",success:function(f,g){CNOA.msg.notice(g.result.msg,lang("admSuppMgr"));this.addWindow.close();e.typeComboBoxDataStore.load({params:{id:0}});e.productComboBoxDataStore.load({params:{id:0}});e.store.load()}.createDelegate(this),failure:function(f,g){CNOA.msg.alert(g.result.msg)}.createDelegate(this)})}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editList",params:{id:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){b.findField("typeID").setValue("");a.typeComboBoxDataStore.load({params:{id:c.result.data.libraryID}});a.typeComboBoxDataStore.on("load",function(){Ext.getCmp(a.selectType).setValue(c.result.data.typeID)})},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.newArticlesWindow.close()})}.createDelegate(this)})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("admSuppMgr"));this.newArticlesWindow.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},operation:function(d,e,a){var b=a.data;return"<a href='javascript:void(0)' onclick='CNOA_adm_articles_infoManageIndex.viewDetails("+b.id+")'>"+d+"</a>"},viewDetails:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=viewDetails&ID="+a,"articlesView","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},searchSubmitForm:function(){var a=this;a.searchPar={name:a.searchform.getForm().findField("name").getValue(),number:a.searchform.getForm().findField("number").getValue()};a.store.load({params:a.searchPar})},searchRessetForm:function(){var a=this;a.searchform.getForm().findField("name").setValue("");a.searchform.getForm().findField("number").setValue("")},deleteList:function(a){var c=this;var b=this.list.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("id")+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("admSuppMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})}};var sm_articles_manage=1;
var CNOA_adm_car_driverClass,CNOA_adm_car_driver;CNOA_adm_car_driverClass=CNOA.Class.create();CNOA_adm_car_driverClass.prototype={init:function(a){var b=this;this.edit_id=0;this.type=a=="edit"?"edit":"add";this.title=a=="edit"?lang("editDriverXX"):lang("addDriverXX");this.baseUrl="index.php?app=adm&func=car&action=driver";this.ID_SEARCH_NAME=Ext.id();this.ID_SEARCH_CARNUMBER=Ext.id();this.searchParams={name:"",cid:""};this.fields=[{name:"did"},{name:"carnumber"},{name:"name"},{name:"sex"},{name:"age"},{name:"mobile"},{name:"cid"},{name:"tall"},{name:"experience"},{name:"rank"},{name:"address"}];this.carnumberStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=getcarnumber"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"cid"},{name:"carnumber"}]})});this.carnumberStore.load();this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({});this.cm=[new Ext.grid.RowNumberer(),this.sm,{header:"did",dataIndex:"did",hidden:true},{header:lang("driverName"),dataIndex:"name",width:120,sortable:false},{header:lang("licensePalte"),dataIndex:"carnumber",width:90,sortable:true,menuDisabled:true},{header:lang("mobile"),dataIndex:"mobile",width:90,sortable:true,menuDisabled:true},{header:lang("sex"),dataIndex:"sex",width:90,sortable:true,menuDisabled:true},{header:lang("age"),dataIndex:"age",width:90,sortable:true,menuDisabled:true},{header:lang("height1"),dataIndex:"tall",width:90,sortable:true,menuDisabled:true},{header:lang("driverLicenseRating"),dataIndex:"rank",width:90,sortable:true,menuDisabled:true},{header:lang("driverExp"),dataIndex:"experience",width:120,sortable:true,menuDisabled:true},{header:lang("homeAddress"),dataIndex:"address",width:90,sortable:true,menuDisabled:true},{header:lang("viewDetail1"),dataIndex:"aid",width:80,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}];this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(c,d){Ext.apply(d,b.searchParams)}}});this.grid=new Ext.grid.GridPanel({sm:b.sm,store:b.store,width:600,plain:false,loadMask:{msg:lang("waiting")},region:"center",border:false,autoScroll:true,stripeRows:true,columns:b.cm,stripeRows:true,listeners:{rowdblclick:function(c,d){var e=b.grid.getSelectionModel().getSelections();b.type="edit";b.edit_id=e[0].get("did");b.addDriverInfo()}},tbar:[{handler:function(c,d){b.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(c,d){b.type="add";b.addDriverInfo()}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{iconCls:"icon-utils-s-edit",text:lang("modify"),handler:function(c,d){var e=b.grid.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{b.type="edit";b.edit_id=e[0].get("did");b.addDriverInfo()}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(c,d){var e=b.grid.getSelectionModel().getSelections();if(e.length==0){CNOA.miniMsg.alertShowAt(c,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(c,lang("wantDelRecord"),function(){if(e){var g="";for(var f=0;f<e.length;f++){g+=e[f].get("did")+","}b.deleteList(g)}})}}},"<span class='cnoa_color_gray'>"+lang("doubleClickEdit")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:5002}],bbar:b.pagingBar});this.mainPanel=new Ext.Panel({layout:"border",hideborder:true,border:false,autoScroll:true,collapsible:false,items:[this.grid],tbar:new Ext.Toolbar({items:[lang("driverName"),{xtype:"textfield",id:b.ID_SEARCH_NAME,name:"name",width:150},"&nbsp"+lang("licensePalte"),{xtype:"textfield",id:b.ID_SEARCH_CARNUMBER,name:"carnumber",width:150},{xtype:"button",text:lang("search"),handler:function(){b.searchParams.name=Ext.getCmp(b.ID_SEARCH_NAME).getValue();b.searchParams.carnumber=Ext.getCmp(b.ID_SEARCH_CARNUMBER).getValue();b.store.load({params:b.searchParams})}},{xtype:"button",text:lang("clear"),handler:function(){b.searchParams.name=Ext.getCmp(b.ID_SEARCH_NAME).setValue("");b.searchParams.carnumber=Ext.getCmp(b.ID_SEARCH_CARNUMBER).setValue("");b.searchParams={name:"",carnumber:""};b.store.load({params:b.searchParams})}}]})})},addDriverInfo:function(){var a=this;this.baseField=[{xtype:"fieldset",title:lang("driverXX"),items:[{xtype:"panel",hideborder:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"textfield",name:"name",width:150,fieldLabel:lang("driverName"),allowBlank:false}]},{xtype:"panel",border:false,layout:"form",items:[{xtype:"combo",fieldLabel:lang("bindingVehicle"),name:"cid",allowBlank:false,store:a.carnumberStore,hiddenName:"cid",valueField:"cid",displayField:"carnumber",mode:"local",width:150,triggerAction:"all",forceSelection:true,editable:false}]}]},{xtype:"panel",hideborder:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"numberfield",name:"age",tooltip:"aaa",width:150,fieldLabel:lang("age")}]},{xtype:"panel",layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:lang("sex"),name:"sex",store:new Ext.data.SimpleStore({fields:["value","sex"],data:[["1",lang("male")],["2",lang("female")]]}),width:150,value:1,hiddenName:"sex",valueField:"value",displayField:"sex",mode:"local",triggerAction:"all",forceSelection:true,editable:false})]}]},{xtype:"panel",hideborder:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"textfield",name:"mobile",width:150,fieldLabel:lang("tel")}]},{xtype:"panel",border:false,layout:"form",items:[{xtype:"combo",fieldLabel:lang("height1"),width:150,mode:"local",triggerAction:"all",store:new Ext.data.SimpleStore({fields:["value","tall"],data:[[1,lang("above185")],[2,"175-180CM"],[3,"170-175CM"],[4,"165-170CM"],[5,"160-165CM"],[6,"155-160CM"],[7,"150-155CM"],[8,lang("follow150")]]}),valueField:"value",displayField:"tall",editable:false,hiddenName:"tall",name:"tall"}]}]},{xtype:"panel",hideborder:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",border:false,layout:"form",items:[{xtype:"combo",fieldLabel:lang("driverExp"),width:150,mode:"local",triggerAction:"all",store:new Ext.data.SimpleStore({fields:["value","experience"],data:[[1,lang("oneYearExp")],[2,lang("twoYearExp")],[3,lang("threeYearExp")],[4,lang("moreThreeYearExp")]]}),valueField:"value",displayField:"experience",editable:false,hiddenName:"experience",name:"experience"}]},{xtype:"panel",border:false,layout:"form",items:[{xtype:"combo",fieldLabel:lang("driverLicenseRating"),width:150,mode:"local",triggerAction:"all",store:new Ext.data.SimpleStore({fields:["value","rank"],data:[[1,lang("aLevel")],[2,lang("blevel")],[3,lang("clevel")]]}),valueField:"value",displayField:"rank",editable:false,hiddenName:"rank",name:"rank"}]}]},{xtype:"textfield",fieldLabel:lang("residenceAddress"),width:385,name:"address",style:{marginBottom:"5px"}}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:5px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:this.title,width:560,height:280,modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){a.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.window.close()}}]}).show();if(this.type=="edit"){a.loadFormData()}},loadFormData:function(){var a=this;a.formPanel.getForm().load({url:a.baseUrl+"&task=loadFormData",params:{did:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){})}.createDelegate(this)})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type,waitMsg:lang("waiting"),method:"POST",params:{did:a.edit_id},success:function(b,c){CNOA.msg.notice(c.result.msg,lang("driverMgr"));a.store.reload();a.window.close()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},deleteList:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delete",method:"POST",params:{dids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("driverMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},makeOperate:function(g,e,a,i,c,f){var d=a.data;var b="";b+="<a href='javascript:void(0);' class='gridview' onclick='CNOA_adm_car_driver.showDriverInfo("+d.did+");' Ext:qtip='"+lang("viewDetail")+"'>"+lang("view")+"</a>";return b},showDriverInfo:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=driverInfo&did="+a,"viewcar","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};var CNOA_adm_car_userecordClass,CNOA_adm_car_userecord;CNOA_adm_car_userecordClass=CNOA.Class.create();CNOA_adm_car_userecordClass.prototype={init:function(){var h=this;var g=Ext.id();var c=Ext.id();var f=Ext.id();var b=Ext.id();var d=Ext.id();var a=Ext.id();var e=Ext.id();this.baseUrl="index.php?app=adm&func=car&action=userecord";this.storeBar={carnumber:"",y_stime:0,y_etime:0,stime:0,etime:0,status:0,driver:""};this.fields=[{name:"id"},{name:"carnumber"},{name:"caruser"},{name:"destination"},{name:"starttime"},{name:"endtime"},{name:"realstarttime"},{name:"realendtime"},{name:"other"},{name:"status"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(n,m,o,l,k,j){var i=Ext.decode(k.responseText);if(i.failure){CNOA.msg.alert(i.msg)}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(i,j){Ext.apply(j,h.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:150,sortable:true,menuDisabled:true},{header:lang("carPeople"),dataIndex:"caruser",width:120,sortable:true,menuDisabled:true,renderer:this.operate.createDelegate(this)},{header:lang("status"),dataIndex:"status",width:100,sortable:true,menuDisabled:true},{header:lang("destination"),dataIndex:"destination",width:120,sortable:true,menuDisabled:true},{header:lang("isStartTime"),dataIndex:"starttime",width:120,sortable:true,menuDisabled:true},{header:lang("isEndTime"),dataIndex:"endtime",width:120,sortable:true,menuDisabled:true},{header:lang("sjStartTime"),dataIndex:"realstarttime",width:120,sortable:true,menuDisabled:true},{header:lang("actualEndTime"),dataIndex:"realendtime",width:120,sortable:true,menuDisabled:true},{header:lang("remark"),dataIndex:"other",width:200,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(i,j){h.store.reload()}},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue4",handler:function(i,j){Ext.MessageBox.confirm(lang("export2"),lang("sureExportCarRecord"),function(k){if(k=="yes"){Ext.Ajax.request({url:h.baseUrl+"&task=export&step=1",method:"POST",success:function(m){var l=Ext.decode(m.responseText);if(l.success==true){ajaxDownload(h.baseUrl+"&task=export&file="+l.msg+"&step=2")}else{CNOA.msg.alert(l.msg,function(){})}},failure:function(m){var l=Ext.decode(m.responseText);CNOA.msg.alert(l.msg)}})}})}},lang("licensePalte")+"：",{xtype:"textfield",id:g,width:200},lang("status"),new Ext.form.ComboBox({id:a,store:new Ext.data.SimpleStore({fields:["id","name"],data:[["5",lang("Pending")],["1",lang("approvalThrough")],["2",lang("approvalNotThrough")],["3",lang("beenIssued")],["4",lang("carBeenBack")]]}),valueField:"id",displayField:"name",mode:"local",width:100,triggerAction:"all",forceSelection:true,editable:false}),lang("driver")+"： ",{xtype:"textfield",id:e,width:100},{xtype:"button",text:lang("search"),handler:function(){h.storeBar={carnumber:Ext.getCmp(g).getValue(),y_stime:Ext.getCmp(c).getRawValue(),y_etime:Ext.getCmp(f).getRawValue(),stime:Ext.getCmp(b).getRawValue(),etime:Ext.getCmp(d).getRawValue(),status:Ext.getCmp(a).getValue(),driver:Ext.getCmp(e).getValue()};h.store.load({params:h.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){h.storeBar={carnumber:"",y_stime:0,y_etime:0,stime:0,etime:0,status:0,driver:""};Ext.getCmp(g).setValue();Ext.getCmp(c).setValue();Ext.getCmp(f).setValue();Ext.getCmp(b).setValue();Ext.getCmp(d).setValue();Ext.getCmp(a).setValue();Ext.getCmp(e).getValue();h.store.load({params:h.storeBar})}}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list],tbar:[lang("yyUseTimeFrom")+"：",{xtype:"datefield",format:"Y-m-d",id:c,width:100},lang("to")+"：",{xtype:"datefield",format:"Y-m-d",id:f,width:100},lang("sjUseTimeFrom")+"：",{xtype:"datefield",format:"Y-m-d",id:b,width:100},lang("to")+"：",{xtype:"datefield",format:"Y-m-d",id:d,width:100}]})},operate:function(b,d,a){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_userecord.view("+a.data.id+")'>"+b+"</a>"},view:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=apply&aid="+a,"viewapply","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};var CNOA_adm_car_transportClass,CNOA_adm_car_transport;CNOA_adm_car_transportClass=CNOA.Class.create();CNOA_adm_car_transportClass.prototype={init:function(){var e=this;this.edit_id=0;this.type="unuse";this.baseUrl="index.php?app=adm&func=car&action=transport";var b=Ext.id();var d=Ext.id();var c=Ext.id();var a=Ext.id();this.storeBar={storeType:"unuse",number:0,caruser:"",stime:0,etime:0};this.fields=[{name:"id"},{name:"caruser"},{name:"carnumber"},{name:"status"},{name:"realstarttime"},{name:"realendtime"},{name:"transportName"},{name:"checkname"},{name:"cid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load({params:{type:e.type}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(f,g){Ext.apply(g,e.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:100,sortable:true,menuDisabled:true,renderer:this.view.createDelegate(this)},{header:lang("carPeople"),dataIndex:"caruser",width:120,sortable:true,menuDisabled:true},{header:lang("requestStatus"),dataIndex:"id",width:80,sortable:true,menuDisabled:true,renderer:this.status.createDelegate(this)},{header:lang("auditor"),dataIndex:"checkname",width:120,sortable:true,menuDisabled:true},{header:lang("sjStartTime"),dataIndex:"realstarttime",width:120,sortable:true,menuDisabled:true},{header:lang("actualEndTime"),dataIndex:"realendtime",width:120,sortable:true,menuDisabled:true},{header:lang("Progress"),dataIndex:"id",width:100,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(f,g){var h=e.list.getSelectionModel().getSelections();e.edit_id=h[0].get("id")}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(f,g){e.store.reload()}},{text:lang("noSchedule"),iconCls:"icon-noPass",enableToggle:true,cls:"btn-red1",pressed:true,allowDepress:false,toggleGroup:"adm_car_transport_list",handler:function(f,g){e.storeBar.storeType="unuse";e.store.load({params:e.storeBar})}},{text:lang("alreadyStart"),iconCls:"icon-pass",enableToggle:true,pressed:false,cls:"btn-blue3",allowDepress:false,toggleGroup:"adm_car_transport_list",handler:function(f,g){e.storeBar.storeType="using";e.store.load({params:e.storeBar})}},{text:lang("carBeenBack"),iconCls:"document-excel-import",enableToggle:true,cls:"btn-blue3",pressed:false,allowDepress:false,toggleGroup:"adm_car_transport_list",handler:function(f,g){e.storeBar.storeType="useover";e.store.load({params:e.storeBar})}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:143}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list],tbar:[lang("licensePalte"),{xtype:"textfield",id:b,width:120},lang("carPeople"),{xtype:"textfield",id:d,width:120},lang("startTime"),{xtype:"datefield",id:c,format:"Y-m-d",width:100},lang("endTime"),{xtype:"datefield",id:a,format:"Y-m-d",width:"100"},{text:lang("search"),iconCls:"icon-hr-search",handler:function(){e.storeBar.number=Ext.getCmp(b).getValue();e.storeBar.caruser=Ext.getCmp(d).getValue();e.storeBar.stime=Ext.getCmp(c).getRawValue();e.storeBar.etime=Ext.getCmp(a).getRawValue();e.store.load({params:e.storeBar})}},{text:lang("clear"),handler:function(){Ext.getCmp(b).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue("");e.storeBar={number:0,caruser:"",stime:0,etime:0};e.store.load({params:e.storeBar})}}]})},newRegisterWindow:function(a){var e=this;var i=Ext.id();var j=Ext.id();var g=Ext.id();var c=Ext.id();var f=Ext.id();var b=Ext.id();var h=Ext.id();var d=Ext.id();this.ID_STARTTIME=Ext.id();this.ID_ENDTIME=Ext.id();this.aid=a;this.baseField=[{xtype:"fieldset",title:lang("basicXXaboutCar"),defaults:{style:{},border:false},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"hidden",value:e.aid,name:"aid"},{xtype:"textfield",fieldLabel:lang("licensePalte"),name:"carnumber",readOnly:true,width:230},{xtype:"textfield",fieldLabel:lang("yuyueDriver"),name:"driver2",readOnly:true,width:230},{xtype:"textfield",fieldLabel:lang("destination"),name:"destination",width:230},{xtype:"datetimefield",fieldLabel:lang("sTimeOfBudeget"),name:"starttime",id:this.ID_STARTTIME,allowBlank:false,format:"Y-m-d H:i:s",width:230}]},{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"hidden",value:e.type,name:"type"},{xtype:"hidden",name:"applyUid"},{xtype:"textfield",fieldLabel:lang("truename"),name:"applyname",readOnly:true,width:230},{xtype:"departmentselectorfield",fieldLabel:lang("useCarDept"),hiddenName:"deptID",name:"department",multiSelect:false,width:230},{xtype:"textfield",fieldLabel:lang("yyMileageKM"),name:"way",width:230},{xtype:"datetimefield",fieldLabel:lang("budgetEtime"),name:"endtime",id:this.ID_ENDTIME,allowBlank:false,format:"Y-m-d H:i:s",width:230}]}]},{xtype:"displayfield",html:'<font style="color: #999">注意：部分信息不可修改</font>'}]},{xtype:"fieldset",title:lang("ddCarBasicXX"),defaults:{style:{},border:false},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"panel",layout:"table",fieldLabel:lang("sjStartTime"),items:[{xtype:"datefield",width:130,name:"realstartdate",editable:false,format:"Y-m-d"},{xtype:"timefield",width:100,increment:30,name:"realstarttime",editable:false,format:"H:i"}]},{xtype:"cnoa_textfield",width:230,name:"realwaystart",fieldLabel:lang("beforeUseKM"),enableKeyEvents:true,id:b,listeners:{keyup:function(k,m){var l=k.getValue();var n=Ext.getCmp(h).getValue();if((n-l)>0){Ext.getCmp(d).setValue(n-l)}}}}]},{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"panel",layout:"table",width:230,fieldLabel:lang("actualEndTime"),items:[{xtype:"datefield",width:130,format:"Y-m-d",editable:false,name:"realenddate"},{xtype:"timefield",width:100,format:"H:i",increment:30,editable:false,name:"realendtime"}]},{xtype:"cnoa_textfield",width:230,name:"realwayend",fieldLabel:lang("afterUseKM"),enableKeyEvents:true,id:h,listeners:{keyup:function(k,m){var l=Ext.getCmp(b).getValue();var n=k.getValue();if((n-l)>0){Ext.getCmp(d).setValue(n-l)}}}}]}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",width:230,name:"totalway",fieldLabel:lang("totalKm"),id:d,readOnly:true}]},{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},border:false},items:[{xtype:"cnoa_textfield",width:230,name:"driver",fieldLabel:lang("sjDriver")}]}]}]},{xtype:"fieldset",title:lang("carPeople"),defaults:{border:false},items:[{xtype:"displayfield",fieldLabel:lang("carPeople"),name:"caruser",width:580},{xtype:"displayfield",fieldLabel:lang("remark"),name:"other",width:580}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:90,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:lang("setDDcar"),width:780,height:makeWindowHeight(420),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("setTheDD"),iconCls:"icon-flow-entrust",handler:function(){if(e.type=="useover"){CNOA.msg.alert(lang("carBeenBackNotEdit"))}else{e.submitForm()}}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.window.close()}}]}).show();e.loadFormData()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editList",params:{aid:a.aid,type:a.type},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.newArticlesWindow.close()})}.createDelegate(this)})},operation:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_transport.transportlist("+e+")' ext:qtip='"+lang("viewAppProgress")+"'>"+lang("viewAppProgress")+"</a>"},transportlist:function(a){var b=this;mainPanel.closeTab("CNOA_ADM_CAR_TRANSPORT_LIST");mainPanel.loadClass("index.php?app=adm&func=car&action=transport&task=transportlist&from=loadPage&aid="+a,"CNOA_ADM_CAR_transport_LIST",lang("viewAppRecord"),"icon-page-view")},view:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_transport.show("+a.data.id+")' ext:qtip='"+lang("viewDetailVehicle")+"'>"+e+"</a>"},show:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=info&id="+a,"viewinfo","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},status:function(e,c,b,g,a,d){var f=this;return"<a href='javascript:void(0)' class='gridview4' onclick='CNOA_adm_car_transport.newRegisterWindow("+e+")' ext:qtip='"+lang("setTheDD")+"'>"+lang("setTheDD")+"</a>"},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task=add",waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("vehicleDDmgr"));a.window.close();a.store.reload()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}}};var CNOA_adm_car_recordlistClass,CNOA_adm_car_recordlist;CNOA_adm_car_recordlistClass=CNOA.Class.create();CNOA_adm_car_recordlistClass.prototype={init:function(c){var b=this;this.edit_id=0;this.type="add";this.cid=c;var a=Ext.id();this.baseUrl="index.php?app=adm&func=car&action=record";this.fields=[{name:"id"},{name:"checkname"},{name:"time"},{name:"date"},{name:"step"},{name:"notes"},{name:"unpassnotes"},{name:"status"},{name:"passnotes"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=recordlist&cid="+this.cid}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),sortInfo:{field:"id",direction:"ASC"},groupOnSort:false,groupField:"date",sortData:function(){},listeners:{load:function(f,d,e){Ext.getCmp(a).getEl().update(lang("vehicleNum")+": "+f.reader.jsonData.carnumber)}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("proposer"),dataIndex:"date",hidden:true},{header:lang("step"),dataIndex:"step",width:120,sortable:true,menuDisabled:true},{header:lang("approvalor"),dataIndex:"checkname",width:100,sortable:true,menuDisabled:true},{header:lang("approvalTime"),dataIndex:"time",width:120,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:80,sortable:true,menuDisabled:true},{header:lang("reasonRequest"),dataIndex:"notes",width:200,sortable:true,menuDisabled:true},{header:lang("notByReason"),dataIndex:"unpassnotes",width:200,sortable:true,menuDisabled:true},{header:lang("tgReason"),dataIndex:"passnotes",width:200,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(d,e){b.store.reload()}},{xtype:"box",id:a,autoEl:{tag:"div",html:""}},"->",{xtype:"cnoa_helpBtn",helpid:141}],bbar:this.pagingBar,view:new Ext.grid.GroupingView({forceFit:false,startCollapsed:true})});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},applyinfo:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=applyinfo&aid="+a,"viewapply","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};var CNOA_adm_car_recordClass,CNOA_adm_car_record;CNOA_adm_car_recordClass=CNOA.Class.create();CNOA_adm_car_recordClass.prototype={init:function(){var a=this;this.edit_id=0;this.type="add";a.baseUrl="index.php?app=adm&func=car&action=record";this.fields=[{name:"id"},{name:"carnumber"},{name:"actionnumber"},{name:"date"},{name:"companynumber"},{name:"type"},{name:"price"},{name:"status"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:160,sortable:true,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("type"),dataIndex:"type",width:100,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:80,sortable:true,menuDisabled:true},{header:lang("brandModel"),dataIndex:"companynumber",width:100,sortable:true,menuDisabled:true},{header:lang("appRecord"),dataIndex:"id",width:100,sortable:false,menuDisabled:true,renderer:this.operationrecord.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:140}],bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},checkpic:function(a){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_record.viewpic("+a+")' ext:qtip='"+lang("checkVehicleImg")+"'>"+lang("view")+"</a>"},viewpic:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=pic&id="+a,"viewpic","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},operation:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_record.view("+a.data.id+")' ext:qtip='"+lang("viewDetailVehicle")+"'>"+e+"</a>&nbsp;<a onclick='CNOA_adm_car_record.viewpic("+a.data.id+")' href='javascript:void(0)'><img src='resources/images/icons/x-edit-picture.png' align='absbottom' ext:qtip='"+lang("checkVehicleImg")+"' /></a>"},view:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=view&id="+a,"viewcar","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},operationrecord:function(a){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_record.viewrecord("+a+")' ext:qtip='"+lang("viewAppRecord")+"'>"+lang("appRecord")+"</a>"},viewrecord:function(a){var b=this;mainPanel.closeTab("CNOA_ADM_CAR_RECORD_LIST");mainPanel.loadClass("index.php?app=adm&func=car&action=record&task=checklist&from=loadPage&cid="+a,"CNOA_ADM_CAR_RECORD_LIST",lang("viewAppRecord"),"icon-page-view")}};var CNOA_adm_car_checkClass,CNOA_adm_car_check;CNOA_adm_car_checkClass=CNOA.Class.create();CNOA_adm_car_checkClass.prototype={init:function(){var d=this;this.edit_id=0;this.type="add";this.baseUrl="index.php?app=adm&func=car&action=check";this.storeBar={storeType:"uncheck",number:0,caruser:"",stime:0,etime:0};this.carnumberStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getcarnumber"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"carnumber"},{name:"driver"},{name:"notes"}]})});this.carnumberStore.load();this.departmentStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=department"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});this.departmentStore.load();this.transportStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=gettransport"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"name"}]})});this.fields=[{name:"id"},{name:"prename"},{name:"carnumber"},{name:"status"},{name:"pic"},{name:"starttime"},{name:"endtime"},{name:"nextcheckname"},{name:"applyName"},{name:"notes"},{name:"cid"},{name:"aid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(j,i,k,h,f){var g=f.responseText;if(g!=""){var e=Ext.decode(g);if(e.failure){CNOA.msg.alert(e.msg)}}}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(e,f){Ext.apply(f,d.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:100,sortable:true,menuDisabled:true,renderer:this.carinfo.createDelegate(this)},{header:lang("submutter"),dataIndex:"prename",width:100,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:100,sortable:true,menuDisabled:true,renderer:this.check.createDelegate(this)},{header:lang("opt"),dataIndex:"status",width:260,sortable:true,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:lang("sTimeOfBudeget"),dataIndex:"starttime",width:120,sortable:true,menuDisabled:true},{header:lang("budgetEtime"),dataIndex:"endtime",width:120,sortable:true,menuDisabled:true},{header:lang("viewAppProgress"),dataIndex:"aid",width:100,sortable:true,menuDisabled:true,renderer:this.progress.createDelegate(this)},{header:lang("viewApplication"),dataIndex:"aid",width:80,sortable:false,menuDisabled:true,renderer:this.apply.createDelegate(this)},{header:lang("appOpinion"),dataIndex:"notes",width:100,sortable:false,menuDisabled:true,renderer:this.notes.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(e,f){var g=d.list.getSelectionModel().getSelections();d.edit_id=g[0].get("id")}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){d.store.reload()}},{text:lang("unAppList"),iconCls:"icon-unappro",cls:"btn-red1",enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"adm_car_check_list",handler:function(){d.storeBar.storeType="uncheck";d.store.load({params:d.storeBar})}},{text:lang("auditedList"),iconCls:"icon-pass",cls:"btn-blue3",enableToggle:true,pressed:false,allowDepress:false,toggleGroup:"adm_car_check_list",handler:function(){d.storeBar.storeType="check";d.store.load({params:d.storeBar})}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:139}],bbar:this.pagingBar});var a=new Ext.form.TextField({width:120});var b=new Ext.form.DateField({width:100,editable:false,format:"Y-m-d"});var c=new Ext.form.DateField({width:100,editable:false,format:"Y-m-d"});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list],tbar:[lang("licensePalte"),a,lang("startTime"),b,lang("endTime"),c,{text:lang("search"),iconCls:"icon-hr-search",handler:function(){d.storeBar.number=a.getValue();d.storeBar.stime=b.getRawValue();d.storeBar.etime=c.getRawValue();d.store.load({params:d.storeBar})}},{text:lang("clear"),handler:function(){a.setValue("");b.setValue("");c.setValue("");d.storeBar={number:0,caruser:"",stime:0,etime:0};d.store.load({params:d.storeBar})}}]})},apply:function(e,c,a,g,b,d){var f=this;return"<a href='javascript:void(0)'  class='gridview' onclick='CNOA_adm_car_check.viewapply("+e+")' ext:qtip='"+lang("clickToView")+"'>"+lang("details")+"</a>"},viewapply:function(e,c,a,g,b,d){var f=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(f.baseUrl+"&task=apply&aid="+e,"viewapply","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},show:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=info&id="+a,"viewcar","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},pic:function(e,c,a,g,b,d){var f=this;if(e==""){return lang("noPhoto")}else{return"<a href='"+CNOA.config.file+"/common/car/"+e+"' target='_blank' ext:qtip='"+lang("viewPhotoVehicle")+"'>"+lang("view")+"</a>"}},notes:function(e,c,b,g,a,d){var f=this;if(e==""){return lang("nothing")}else{return"<a  class='gridview' href='javascript:void(0)' onclick=\"CNOA_adm_car_check.shownotes('"+e+"')\" ext:qtip='"+lang("viewAppSubmitOpinion")+"'>"+lang("viewApplyOpinion")+"</a>"}},shownotes:function(a){var b=this;CNOA.msg.alert(a)},check:function(e,c,b,g,a,d){var f=this;if(e==0){return"<span class='cnoa_color_blue'>"+lang("pendingTrial")+"</span>"}else{if(e==1){return"<span class='cnoa_color_red'>"+lang("unPass")+"</span>"}else{if(e==2){return"<span class='cnoa_color_green'>"+lang("pass")+"</span>"}else{if(e==3){return lang("appCancel")}else{if(e==4){return lang("hasBeenSubmitApp")}else{if(e==5){return lang("undone")}}}}}}},operation:function(e,c,b,g,a,d){var f=this;if(e!=0){return lang("nothing")}else{return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_check.showPass("+b.data.id+")' ext:qtip='"+lang("TGvehicleApp")+"'>"+lang("throughEnd")+"</a><a class='gridview3 jianju' href='javascript:void(0)' onclick='CNOA_adm_car_check.unpass("+b.data.id+")' ext:qtip='"+lang("TGvehicleApp")+"'>"+lang("unPass")+"</a><a  class='gridview jianju' href='javascript:void(0)' onclick='CNOA_adm_car_check.showPer("+b.data.id+")' ext:qtip='"+lang("submitToHigherContinue")+"'>"+lang("throughSelectHigher")+"</a>"}},showPass:function(b){var c=this;var a=Ext.id();this.baseField=[{xtype:"panel",hideBorders:true,border:false,layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("TGopinion"),width:330,height:50,id:a}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:60,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:lang("approvalThrough"),width:450,height:150,modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("pass"),iconCls:"icon-dialog-ok-apply",handler:function(){var d=this;d.Url="&task=pass";d.params={pass:"pass",id:b,notes:Ext.getCmp(a).getValue()};d.submitAll();d.window.close()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.window.close()}}]}).show()},showPer:function(b){var d=this;var c=Ext.id();var a=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("submitHigherAudit"),defaults:{style:{},border:false},items:[{xtype:"panel",hideBorders:true,border:false,layout:"form",autoWidth:true,items:[{xtype:"hidden",name:"checkID",id:c},{xtype:"panel",hidden:false,layout:"form",border:false,items:[{xtype:"triggerForPeople",fieldLabel:lang("approvalOfPerson"),allowBlank:false,name:"checkName",dataUrl:d.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:230,listeners:{selected:function(g,f,e){Ext.getCmp(c).setValue(f)}}}]},{xtype:"textarea",fieldLabel:lang("opinion"),width:230,id:a}]}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:lang("submitHigherAudit"),width:400,height:250,modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("submit"),iconCls:"icon-flow-entrust",handler:function(){var e=this;e.Url="&task=newcheck";e.params={checkid:Ext.getCmp(c).getValue(),id:b,notes:Ext.getCmp(a).getValue()};e.submitAll();e.window.close()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.window.close()}}]}).show()},carinfo:function(e,c,b,f,a,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_check.show("+b.data.cid+")' ext:qtip='"+lang("viewDetailVehicle")+"'>"+e+"</a>"},nextcheckname:function(e,c,b,g,a,d){var f=this;if(e==""){return lang("noApprover")}else{return e}},progress:function(e,c,b,f,a,d){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_check.viewprogress("+e+")' ext:qtip='"+lang("viewDetailVehicle")+"'>"+lang("approvalProgress")+"</a>"},viewprogress:function(a){var b=this;mainPanel.closeTab("CNOA_ADM_CAR_CHECK_LIST");mainPanel.loadClass("index.php?app=adm&func=car&action=check&task=applylist&from=loadPage&aid="+a,"CNOA_ADM_CAR_CHECK_LIST",lang("viewAppRecord"),"icon-page-view")},unpass:function(a){var b=this;b.showunpass(a)},showunpass:function(b){var c=this;var a=Ext.id();this.baseField=[{xtype:"fieldset",title:lang("notByReason"),defaults:{style:{},border:false},items:[{xtype:"panel",hideBorders:true,border:false,layout:"table",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("reason"),width:350,id:a}]}]}];this.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:80,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[this.baseField]}]});this.window=new Ext.Window({title:lang("notByReason"),width:430,height:230,modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("submit"),iconCls:"icon-flow-entrust",handler:function(){var d=this;d.Url="&task=pass";d.params={pass:"unpass",id:b,unpassnotes:Ext.getCmp(a).getValue()};d.submitAll();this.window.close()}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.window.close()}.createDelegate(this)}]}).show()},submitAll:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+a.Url,method:"POST",params:a.params,success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice(b.msg,lang("vehicleAppMgr"));a.store.reload()}else{CNOA.msg.alert(b.msg)}}})}};var CNOA_adm_car_applyClass,CNOA_adm_car_apply;var CNOA_adm_car_applylistClass,CNOA_adm_car_applylist;CNOA_adm_car_applylistClass=CNOA.Class.create();CNOA_adm_car_applylistClass.prototype={init:function(b,d){var c=this;var a=Ext.id();this.aid=b;if(d=="apply"){this.baseUrl="index.php?app=adm&func=car&action=apply"}else{if(d=="transport"){this.baseUrl="index.php?app=adm&func=car&action=transport"}}this.fields=[{name:"id"},{name:"checkname"},{name:"time"},{name:"date"},{name:"aid"},{name:"revoketime"},{name:"step"},{name:"notes"},{name:"unpassnotes"},{name:"status"},{name:"passnotes"},{name:"revokenotes"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getapplylist&aid="+this.aid}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(g,e,f){Ext.getCmp(a).getEl().update("<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_applylist.viewapply("+g.reader.jsonData.aid+")'>"+lang("checkCarBrand")+": "+g.reader.jsonData.carnumber+lang("appInformation")+"</a>")}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("step"),dataIndex:"step",width:120,sortable:true,menuDisabled:true},{header:lang("approvalor"),dataIndex:"checkname",width:100,sortable:true,menuDisabled:true},{header:lang("approvalTime"),dataIndex:"time",width:120,sortable:true,menuDisabled:true},{header:lang("revoketime"),dataIndex:"revoketime",width:120,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:80,sortable:true,menuDisabled:true},{header:lang("reasonRequest"),dataIndex:"notes",width:200,sortable:true,menuDisabled:true},{header:lang("notByReason"),dataIndex:"unpassnotes",width:200,sortable:true,menuDisabled:true},{header:lang("TGopinion"),dataIndex:"passnotes",width:200,sortable:true,menuDisabled:true},{header:lang("revokenotes"),dataIndex:"revokenotes",width:200,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(e,f){c.store.reload()}},{xtype:"box",id:a,autoEl:{tag:"div",html:""}},"->",{xtype:"cnoa_helpBtn",helpid:142}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list]})},viewapply:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=getapplydetails&aid="+a,"viewapply","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")}};CNOA_adm_car_applyClass=CNOA.Class.create();CNOA_adm_car_applyClass.prototype={init:function(){var f=this;this.edit_id=0;this.type="add";this.baseUrl="index.php?app=adm&func=car&action=apply";var b=Ext.id();var e=Ext.id();var d=Ext.id();var a=Ext.id();this.storeBar={storeType:"",number:0,caruser:"",stime:0,etime:0};this.carnumberStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getcarnumber"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"carnumber"},{name:"notes"},{name:"realwayend"}]})});this.carnumberStore.load();this.departmentStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=department"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});this.departmentStore.load();this.transportStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=gettransport"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"name"}]})});this.fields=[{name:"id"},{name:"caruser"},{name:"carnumber"},{name:"status"},{name:"starttime"},{name:"endtime"},{name:"applyName"},{name:"checkname"},{name:"cid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15,listeners:{beforechange:function(g,h){Ext.apply(h,f.storeBar)}}});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:"status",dataIndex:"status",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:100,sortable:true,menuDisabled:true,renderer:this.view.createDelegate(this)},{header:lang("carPeople"),dataIndex:"caruser",width:120,sortable:true,menuDisabled:true},{header:lang("requestStatus"),dataIndex:"status",width:80,sortable:true,menuDisabled:true,renderer:this.status.createDelegate(this)},{header:lang("auditor"),dataIndex:"checkname",width:120,sortable:true,menuDisabled:true},{header:lang("startTime"),dataIndex:"starttime",width:120,sortable:true,menuDisabled:true},{header:lang("endTime"),dataIndex:"endtime",width:120,sortable:true,menuDisabled:true},{header:lang("Progress"),dataIndex:"id",width:100,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:"操作",dataIndex:"id",width:80,sortable:false,menuDisabled:true,renderer:this.handleCar.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var c=Ext.id();this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,listeners:{rowdblclick:function(g,h){var i=f.list.getSelectionModel().getSelections();f.edit_id=i[0].get("id")}},tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){f.store.reload()}},{text:lang("requestCar"),iconCls:"icon-utils-s-add",cls:"btn-blue4",id:c,handler:function(){f.type="add";f.newRegisterWindow()}},{text:lang("unappro"),iconCls:"icon-unappro",enableToggle:true,cls:"btn-red1",pressed:true,allowDepress:false,toggleGroup:"adm_car_apply_list",handler:function(){f.storeBar.storeType="uncheck";f.store.load({params:f.storeBar})}},{text:lang("hasBeApp"),iconCls:"icon-pass",enableToggle:true,pressed:false,cls:"btn-blue3",allowDepress:false,toggleGroup:"adm_car_apply_list",handler:function(){f.storeBar.storeType="check";f.store.load({params:f.storeBar})}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:137}],bbar:this.pagingBar,listeners:{render:function(){getFlowId4Engine("admCar",function(h,g){Ext.getCmp(c).setHandler(function(){h()})})}}});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.list],tbar:[lang("licensePalte"),{xtype:"textfield",id:b,width:120},lang("carPeople"),{xtype:"textfield",id:e,width:120},lang("startTime"),{xtype:"datefield",id:d,format:"Y-m-d",width:100},lang("endTime"),{xtype:"datefield",id:a,format:"Y-m-d",width:"100"},{text:lang("search"),iconCls:"icon-hr-search",handler:function(){f.storeBar.number=Ext.getCmp(b).getValue();f.storeBar.caruser=Ext.getCmp(e).getValue();f.storeBar.stime=Ext.getCmp(d).getRawValue();f.storeBar.etime=Ext.getCmp(a).getRawValue();f.store.load({params:f.storeBar})}},{text:lang("clear"),handler:function(){Ext.getCmp(b).setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(d).setValue("");Ext.getCmp(a).setValue("");f.storeBar={number:0,caruser:"",stime:0,etime:0};f.store.load({params:f.storeBar})}}]})},newRegisterWindow:function(){var f=this;var b=Ext.id();var c=Ext.id();var d=Ext.id();var e=Ext.id();var a=Ext.id();f.driverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getdriver"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"did"},{name:"driver"}]}),listeners:{load:function(i,g,h){}}});f.driverStore.load();this.baseField=[{xtype:"fieldset",title:lang("appBasicInformation"),defaults:{style:{marginBottom:"-10px"},border:false},items:[{hideBorders:true,border:false,layout:"column",autoWidth:true,layoutConfig:{columns:2},items:[{layout:"form",columnWidth:0.5,defaults:{style:{marginBottom:"10px"},xtype:"combo",width:230},items:[{fieldLabel:lang("licensePalte"),name:"carnumber",allowBlank:false,id:b,store:f.carnumberStore,hiddenName:"cid",valueField:"id",displayField:"carnumber",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i,g,h){if(g.data.carnumber!=""){f.driverStore.load({params:{cid:g.data.id}})}Ext.getCmp(c).setValue("");Ext.getCmp(a).setValue(g.data.notes);f.formPanel.getForm().findField("realwayend").setValue(g.data.realwayend);f.transportStore.load({params:{cid:g.data.id}})}}},{xtype:"cnoa_textfield",fieldLabel:lang("carPeople"),name:"caruser",width:230},{xtype:"compositefield",fieldLabel:lang("startTime")+'<span class="cnoa_color_red">*</span>',items:[{xtype:"datefield",width:125,allowBlank:false,name:"startdate",editable:false,format:"Y-m-d",value:new Date().format("Y-m-d")},{xtype:"timefield",width:100,allowBlank:false,increment:30,name:"starttime",editable:false,format:"H:i",value:new Date().format("H:i")}]},{xtype:"cnoa_textfield",fieldLabel:lang("destination"),name:"destination"},{xtype:"userselectorfield",id:d,fieldLabel:lang("approvalOfPerson"),emptyText:lang("clickSelectPerson"),readOnly:true,allowBlank:false,hiddenName:"checkid",multiSelect:false}]},{layout:"form",columnWidth:0.5,defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"combo",fieldLabel:lang("yuyueDriver"),name:"driver",id:c,hiddenName:"driver",valueField:"did",displayField:"driver",mode:"local",triggerAction:"all",forceSelection:true,editable:false,store:f.driverStore,allowBlank:false},{xtype:"departmentselectorfield",fieldLabel:lang("inDepartment"),hiddenName:"deptID",name:"deptName",multiSelect:false},{xtype:"compositefield",fieldLabel:lang("endTime")+'<span class="cnoa_color_red">*</span>',items:[{xtype:"datefield",width:125,format:"Y-m-d",allowBlank:false,editable:false,name:"enddate"},{xtype:"timefield",width:100,format:"H:i",increment:30,allowBlank:false,editable:false,name:"endtime"}]},{xtype:"cnoa_textfield",name:"realwayend",readOnly:true,fieldLabel:lang("numOfMileCar")},{xtype:"combo",fieldLabel:"调度员",name:"transport",allowBlank:false,id:e,store:f.transportStore,hiddenName:"tid",valueField:"tid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]}]},{xtype:"box",height:40,autoEl:{tag:"div",style:"margin-left:80px;margin-top:10px;margin-bottom:15px;color:#676767;",html:lang("ifCarPersonEmpty")}}]},{xtype:"fieldset",title:lang("remark"),items:[{xtype:"textarea",fieldLabel:lang("remark"),name:"other",width:580}]},{xtype:"fieldset",title:lang("otherInformatin"),items:[{xtype:"displayfield",fieldLabel:lang("appFlowRemain"),name:"notes",width:580,id:a}]}];this.formPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:80,labelAlign:"right",bodyStyle:"padding:10px",autoScroll:true,items:[this.baseField]});this.window=new Ext.Window({title:lang("requestCar"),width:780,height:makeWindowHeight(555),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.window.close()}}]}).show()},operation:function(e,c,a,g,b,d){var f=this;if(f.storeBar.storeType=="check"){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_apply.applylist("+e+")' ext:qtip='"+lang("checkVehicleAppStatus")+"'>"+lang("viewAppProgress")+"</a>"}else{return"<a href='javascript:void(0)' class='gridview3' onclick='CNOA_adm_car_apply.deleteApp("+e+")' ext:qtip='"+lang("removeVehicleSubmit")+"'>"+lang("del")+"</a>"}},handleCar:function(e,c,a,g,b,d){var f=this;status=a.data.status;checktime=a.json.checktime;if(status==3){return"<a href='javascript:void(0)'  class='gridview' onclick='CNOA_adm_car_apply.revoke("+e+")'>   "+lang("recell")+"</a>"}if(checktime){return"<a href='javascript:void(0)'  class='gridview3' onclick='CNOA_adm_car_apply.delrecord("+e+")'>"+lang("del")+"</a>"}},revoke:function(c){var b=this;var a=Ext.id();b.baseField=[{xtype:"panel",hideBorders:true,border:false,layout:"form",autoWidth:true,items:[{xtype:"textarea",fieldLabel:lang("revokenotes"),width:330,height:50,allowBlank:false,name:"revokenotes"}]}];b.formPanel=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,layout:"border",labelWidth:60,labelAlign:"right",items:[{xtype:"panel",border:false,bodyStyle:"padding:10px",layout:"form",region:"center",autoScroll:true,items:[b.baseField]}]});b.window=new Ext.Window({title:lang("revokenotes"),width:450,height:150,modal:true,layout:"fit",resizable:false,border:false,items:[b.formPanel],buttons:[{text:lang("recell"),iconCls:"icon-dialog-ok-apply",handler:function(){if(b.formPanel.getForm().isValid()){b.formPanel.getForm().submit({url:b.baseUrl+"&task=revoke",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{id:c},success:function(d,e){CNOA.msg.notice(e.result.msg,lang("recell"));b.store.reload();b.window.close()},failure:function(d,e){CNOA.msg.alert(e.result.msg)}})}}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.window.close()}}]}).show()},delrecord:function(b){var a=this;CNOA.msg.cf(lang("areYouDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delrecord",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("carMgr"));a.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},deleteApp:function(b){var a=this;CNOA.msg.cf(lang("areYouDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delete",method:"POST",params:{id:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice(d.msg,lang("carMgr"));a.store.reload()}else{CNOA.msg.alert(d.msg,function(){})}}})}})},applylist:function(a){var b=this;mainPanel.closeTab("CNOA_ADM_CAR_APPLY_LIST");mainPanel.loadClass("index.php?app=adm&func=car&action=apply&task=applylist&from=loadPage&aid="+a,"CNOA_ADM_CAR_APPLY_LIST",lang("viewAppRecord"),"icon-page-view")},view:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_apply.show("+a.data.id+")' ext:qtip='"+lang("viewDetailVehicle")+"'>"+e+"</a>"},show:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=info&id="+a,"viewinfo","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},status:function(e,c,b,g,a,d){var f=this;if(e==2){return lang("pendingTrial")}else{if(e==1){return"<span class='cnoa_color_red'>"+lang("unPass")+"</span>"}else{if(e==3){return"<span class='cnoa_color_green'>"+lang("pass")+"</span>"}else{if(e==5){return lang("inUse")}else{if(e==6){return"已撤销"}else{if(e==0){return"<span class='cnoa_color_red'>"+lang("appBeenCancel")+"</span>"}}}}}}},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task=add",waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("chiefCarMgr"));a.window.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},deleteApplic:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=deleteApplic",waitMsg:lang("waiting"),method:"POST",params:{id:b},success:function(c){CNOA.msg.notice(Ext.decode(c.responseText).msg,lang("chiefCarMgr"));a.store.load()}.createDelegate(this),failure:function(c,d){CNOA.msg.alert(d.result.msg)}.createDelegate(this)})}};var CNOA_adm_car_appointment,CNOA_adm_car_appointmentClass;CNOA_adm_car_appointmentClass=CNOA.Class.create();CNOA_adm_car_appointmentClass.prototype={init:function(){var f=this;this.edit_id=0;this.type="add";this.day=0;var a=Ext.id();f.baseUrl="index.php?app=adm&func=car&action=appointment";var b=[{name:"carnumber"},{name:"cid"}];var d=[{header:"",width:140,dataIndex:"carnumber",menuDisabled:true,resizable:false,sortable:false,renderer:this.carnumber.createDelegate(this)}];for(var c=0;c<=47;++c){b.push({name:"t"+c,mapping:"dt.t"+c});d.push({header:"",width:15,dataIndex:"t"+c,renderer:this.mkBG.createDelegate(this)})}d.push({header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false});this.fd=Ext.data.Record.create(b);this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data"},this.fd),listeners:{load:function(i,g,h){Ext.getCmp(a).getEl().update(i.reader.jsonData.date)}}});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel({defaults:{header:"",menuDisabled:true,resizable:false,sortable:false,width:15},columns:d});var e=[{header:lang("vehcleName")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;("+lang("hour")+")",colspan:1,align:"center",menuDisabled:true,resizable:false,sortable:false}];for(var c=0;c<24;++c){e.push({header:c,colspan:2,align:"center",menuDisabled:true,resizable:false,sortable:false})}this.list=new Ext.grid.GridPanel({border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){f.store.reload()}},{text:lang("prevDay"),handler:function(){f.day--;f.store.load({params:{day:f.day}})}},{text:lang("today"),handler:function(){f.day=0;f.store.load({params:{day:f.day}})}},{xtype:"box",id:a,autoEl:{tag:"div",html:""}},{text:lang("nextDay"),handler:function(){f.day++;f.store.load({params:{day:f.day}})}},"<span class='cnoa_color_gray'>"+lang("colorShuoMing")+":&nbsp;</span><span class='cnoa_car_a'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("pengdingVehicle")+"&nbsp;</span><span class='cnoa_car_b'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("vehicleAppTimeOverlap")+"&nbsp;</span><span class='cnoa_car_c'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("vehicleAppBy")+"&nbsp;</span><span class='cnoa_car_d'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("vehicleInuse")+"&nbsp;</span><span class='cnoa_car_e'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='cnoa_color_gray'>&nbsp;"+lang("vehicleActualUse")+"&nbsp;</span>","->",{xtype:"cnoa_helpBtn",helpid:138}],plugins:[new Ext.ux.grid.ColumnHeaderGroup({rows:[e],hierarchicalColMenu:true})],bbar:this.pagingBar});this.center=new Ext.Panel({region:"center",layout:"fit",items:[this.list]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.center]})},carnumber:function(e,c,a,f,b,d){return"<a href='javascript:void(0)' onclick='CNOA_adm_car_appointment.showappointment("+a.data.cid+")' ext:qtip='"+lang("viewVehicleReservation")+"'>"+e+"</a>"},showappointment:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=apply&cid="+a+"&day="+b.day,"appointment","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},mkBG:function(e,c,a,f,b,d){if(e==0||e==1){c.css="cnoa_bgc_F6F6F6"}else{if(e==2){c.css="cnoa_car_a"}else{if(e%2==0){c.css="cnoa_car_b"}else{if(e==3){c.css="cnoa_car_c"}else{if(e==5){c.css="cnoa_car_d"}else{if(e==7){c.css="cnoa_car_e"}}}}}}}};var CNOA_adm_car_info,CNOA_adm_car_infoClass;CNOA_adm_car_infoClass=CNOA.Class.create();CNOA_adm_car_infoClass.prototype={init:function(){var a=this;this.edit_id=0;this.type="add";this.ID_tree_treeRoot=Ext.id();this.ID_CARNUMBER=Ext.id();this.ID_CARTYPE=Ext.id();a.baseUrl="index.php?app=adm&func=car&action=info";this.storeBar={id:"",carnumber:"",carSort:""};this.fields=[{name:"id"},{name:"carnumber"},{name:"actionnumber"},{name:"driver"},{name:"date"},{name:"companynumber"},{name:"carSort"},{name:"dept"},{name:"price"},{name:"status"},{name:"type"}];this.storeType=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getCarType",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"value"}]})});this.storeType.load();this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=list",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:this.store,pageSize:15});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:lang("licensePalte"),dataIndex:"carnumber",width:120,sortable:true,menuDisabled:true},{header:lang("type"),dataIndex:"carSort",width:100,sortable:true,menuDisabled:true},{header:lang("brandModel"),dataIndex:"companynumber",width:100,sortable:true,menuDisabled:true},{header:lang("belongDept"),dataIndex:"dept",width:100,sortable:true,menuDisabled:true},{header:lang("purchaseDate"),dataIndex:"date",width:80,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:80,sortable:true,menuDisabled:true},{header:lang("photo"),dataIndex:"id",width:80,sortable:true,menuDisabled:true,renderer:this.checkpic.createDelegate(this)},{header:lang("opt"),dataIndex:"id",width:100,sortable:false,menuDisabled:true,renderer:this.operation.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.list=new Ext.grid.GridPanel({region:"center",layout:"fit",border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}},{text:lang("addNewVehicle"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(b,c){a.type="add";a.addWindow()}},{text:lang("editVehicle"),cls:"btn-red1",iconCls:"icon-utils-s-edit",handler:function(b,c){var d=a.list.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{a.type="edit";a.edit_id=d[0].get("id");a.addWindow()}}},{text:"编辑车辆图片",iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(b,c){var d=a.list.getSelectionModel().getSelections();if(d.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{var e=d[0].get("id");a.photoWindow(e)}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(b){a.deleteList(b)}},"<span class='cnoa_color_gray'>"+lang("ctrlShiftSelect")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:134}]}),bbar:this.pagingBar});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allVehicle"),type:"",iconCls:"icon-tree-root-cnoa",id:a.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){a.sortTree.selectPath(a.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.resetSearchBar();a.storeBar.carSort=b.attributes.tid;a.store.load({params:a.storeBar})}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:140,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("vehicleColumn"),"->",{handler:function(b,c){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});this.centerPanel=new Ext.Panel({plain:false,region:"center",hideBorders:true,layout:"fit",border:false,items:[this.list],bodyStyle:"border-left-width:1px;",tbar:[lang("licensePalte"),{xtype:"textfield",name:"carnumber",width:150,id:a.ID_CARNUMBER},"&nbsp"+lang("vehicelType"),{xtype:"combo",fieldLabel:lang("vehicelType"),id:a.ID_CARTYPE,name:"carSort",store:a.storeType,width:150,hiddenName:"tid",valueField:"tid",displayField:"value",editable:false,mode:"local",triggerAction:"all"},{xtype:"button",text:lang("search"),handler:function(){a.storeBar.carnumber=Ext.getCmp(a.ID_CARNUMBER).getValue();a.storeBar.carSort=Ext.getCmp(a.ID_CARTYPE).getValue();a.store.load({params:a.storeBar})}},{xtype:"button",text:lang("clear"),handler:function(){a.storeBar.carnumber=Ext.getCmp(a.ID_CARNUMBER).setValue();a.storeBar.carSort=Ext.getCmp(a.ID_CARTYPE).setValue();this.storeBar={carnumber:"",carSort:""};a.store.load()}}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.centerPanel,this.sortPanel]})},resetSearchBar:function(){var a=this;Ext.getCmp(a.ID_CARTYPE).setValue("");a.storeBar={carSort:""}},getComboStore:function(a){var b=this;var c=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:b.baseUrl+"&task=comboStore&type="+a,disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"tid"},{name:"value"}]})});return c},addWindow:function(){var f=this;var d=Ext.id();var c=Ext.id();var b=Ext.id();var a=Ext.id();f.selectType=a;var e=Ext.id();f.dept=new CNOA.selector.form.DepartmentSelectorField({width:60,fieldLabel:lang("belongDept"),name:"dept"});this.baseField=[{xtype:"fieldset",title:lang("vehicleInformation"),defaults:{style:{marginBottom:"-10px"}},items:[{hideBorders:true,border:false,layout:"column",autoWidth:true,layoutConfig:{columns:2},items:[{layout:"form",width:350,defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"cnoa_textfield",fieldLabel:lang("licensePalte"),allowBlank:false,name:"carnumber"},{xtype:"cnoa_textfield",fieldLabel:lang("engineModel"),name:"actionnumber"},{xtype:"datefield",fieldLabel:lang("purchaseDate"),format:"Y-m-d",name:"date",editable:false},{xtype:"combo",fieldLabel:lang("nowStatus"),name:"status",allowBlank:false,store:new Ext.data.SimpleStore({fields:["value","status"],data:[["4",lang("available")],["3",lang("damage")],["2",lang("maintenance")],["1",lang("scrap")]]}),hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i,g,h){}.createDelegate(this)}}]},{xtype:"panel",layout:"form",width:350,defaults:{style:{marginBottom:"10px"},width:230},items:[{xtype:"cnoa_textfield",fieldLabel:lang("brandModel"),name:"companynumber"},{xtype:"combo",fieldLabel:lang("vehicelType"),name:"carSort",editable:false,allowBlank:false,triggerAction:"all",typeAhead:true,hiddenName:"carSort",mode:"local",valueField:"tid",displayField:"value",store:f.getComboStore("carSort")},{xtype:"cnoa_textfield",fieldLabel:lang("purchasePrice"),name:"price"},f.dept]}]}]},{xtype:"fieldset",title:lang("otherInformatin"),items:[{xtype:"flashfile",fieldLabel:lang("attach"),name:"attach",inputPre:"filesUpload"},{xtype:"textarea",fieldLabel:lang("dispatcher"),allowBlank:false,blankText:lang("selectItemDispatcher"),name:"transport",readOnly:true,width:580},{xtype:"hidden",name:"transports"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-10",dataUrl:f.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:85px;margin-bottom:4px;margin-top:0px;",text:lang("select"),listeners:{selected:function(j,k){var l=new Array();var h=new Array();if(k.length>0){for(var g=0;g<k.length;g++){l.push(k[g].uname);h.push(k[g].uid)}}f.formPanel.getForm().findField("transport").setValue(l.join(","));f.formPanel.getForm().findField("transports").setValue(h.join(","))},onrender:function(g){g.setSelectedUids(f.formPanel.getForm().findField("transports").getValue().split(","))}}},{xtype:"textarea",fieldLabel:lang("appFlowRemain"),name:"notes",width:580},{xtype:"textarea",fieldLabel:"备注",name:"other",width:580}]}];this.formPanel=new Ext.form.FormPanel({border:false,waitMsgTarget:true,labelWidth:80,fileUpload:true,labelAlign:"right",bodyStyle:"padding:10px",autoScroll:true,items:[this.baseField]});this.window=new Ext.Window({title:lang("addNewVehicleInfor"),width:780,height:makeWindowHeight(610),modal:true,layout:"fit",resizable:false,border:false,items:[this.formPanel],buttons:[{text:"保存",iconCls:"icon-btn-save",handler:function(){f.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.window.close()}}]}).show();if(this.type=="edit"){f.loadFormData()}},photoWindow:function(f){var e=this;var a=[{name:"id"},{name:"value"},{name:"date"}];this.photoStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getPhotoList&id="+f}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var b=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"value",width:150},{header:lang("addTime"),dataIndex:"date",width:150}]});this.photoGrid=new Ext.grid.GridPanel({columnWidth:0.6,height:300,border:false,store:this.photoStore,cm:c,sm:b,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.photoGrid.store.reload()}},"-",{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.updatePhoto(f)}},"-",{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=e.photoGrid.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(i){if(i=="yes"){var j=[];Ext.each(h,function(l,k){j.push(l.json.id)});e.delPhoto(j.join(","))}})}}}],listeners:{rowclick:function(h,k,j){var i=h.getSelectionModel().getSelected();var g=i.id;e.getOnePhoto(g)}}});var d=new Ext.Window({title:lang("picture"),width:720,height:400,layout:"fit",border:false,modal:true,items:[new Ext.Panel({layout:"column",items:[this.photoGrid,new Ext.Panel({border:false,height:400,bodyStyle:"padding: 50px 0px 0px 0px;border-left: 1px solid #99BBE8",columnWidth:0.4,items:[{border:false,html:'<div style="width:273px;height:206px;padding:3px;display: table-cell;vertical-align: middle;text-align: center;"><img style="max-width: 267px; max-height: 200px; border: 0px;overflow:hidden;" src="" id="CNOA_CAR_INFO_PHOTO"></div>'}]})]})]}).show()},updatePhoto:function(b){var a=this;this.FACE_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"photo",allowBlank:false,blankText:lang("updateFaceBlankText"),buttonCfg:{text:lang("browse")},hideLabel:true,width:370,listeners:{fileselected:function(d,c){}}}],buttons:[{text:lang("save"),handler:function(){if(this.FACE_WINDOW_FORMPANEL.getForm().isValid()){this.FACE_WINDOW_FORMPANEL.getForm().submit({url:a.baseUrl+"&task=upPhoto",waitMsg:lang("waiting"),params:{id:b},success:function(c,d){Ext.fly("CNOA_CAR_INFO_PHOTO").dom.src=d.result.msg;a.photoStore.reload();a.FACE_WINDOW.close()},failure:function(c,d){CNOA.msg.alert(d.result.msg,function(){a.FACE_WINDOW.close()})}})}}.createDelegate(this)},{text:lang("close"),handler:function(){a.FACE_WINDOW.close()}}]});this.FACE_WINDOW=new Ext.Window({width:398,height:123,autoScroll:false,modal:true,resizable:false,title:lang("upload")+lang("photo"),items:[this.FACE_WINDOW_FORMPANEL]}).show()},getOnePhoto:function(a){var b=this;if(!a){return}Ext.Ajax.request({url:b.baseUrl+"&task=getOnePhoto",params:{id:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);Ext.fly("CNOA_CAR_INFO_PHOTO").dom.src=d.msg}})},delPhoto:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delPhoto",params:{ids:a},method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success==true){CNOA.msg.alert(d.msg);b.photoGrid.store.reload()}}})},submitForm:function(){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+a.type+"&id="+a.edit_id,waitMsg:lang("waiting"),method:"POST",success:function(b,c){CNOA.msg.notice(c.result.msg,lang("carMgr"));a.window.close();a.store.load()}.createDelegate(this),failure:function(b,c){CNOA.msg.alert(c.result.msg)}.createDelegate(this)})}},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:a.baseUrl+"&task=editList",params:{id:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,c){},failure:function(b,c){CNOA.msg.alert(c.result.msg,function(){a.window.close()})}.createDelegate(this)})},deleteList:function(a){var c=this;var b=this.list.getSelectionModel().getSelections();if(b.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("areYouDelete"),function(e){if(e=="yes"){if(b){var f="";for(var d=0;d<b.length;d++){f+=b[d].get("id")+","}c.deleteData(f)}}})}},deleteData:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d,e){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("carMgr"));b.store.reload()}else{CNOA.msg.alert(c.msg)}}})},checkpic:function(a){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_info.viewpic("+a+")'>"+lang("view")+"</a>"},viewpic:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=pic&id="+a,"viewpic","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},operation:function(a){return"<a href='javascript:void(0)' class='gridview' onclick='CNOA_adm_car_info.view("+a+")'>"+lang("detail")+"</a>"},view:function(a){var b=this;x=(screen.availWidth-850)/2;y=(screen.availHeight-600)/2;window.open(b.baseUrl+"&task=view&id="+a,"viewcar","width=900,height=500,left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no")},deleteList2:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delete2",method:"POST",params:{dids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("carMgr"));b.driverStore.reload()}else{CNOA.msg.alert(c.msg)}}})},submit2:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=update2",params:a,method:"POST",success:function(e,d){var c=Ext.decode(e.responseText);if(c.success===true){CNOA.msg.notice(c.msg,lang("carMgr"));b.driverStore.reload()}else{CNOA.msg.alert(c.msg,function(){b.driverStore.reload()})}},failure:function(c,d){CNOA.msg.alert(result.msg,function(){b.driverStore.reload()})}})}};var CNOA_adm_car_sort,CNOA_adm_car_sortClass;CNOA_adm_car_sortClass=CNOA.Class.create();CNOA_adm_car_sortClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=adm&func=car&action=sort";this.TYPE_SORT=0;this.carSort=this.getDropdownPanel(this.TYPE_SORT,lang("vehicelType"));this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:150,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.carSort]})},getDropdownPanel:function(g,h){var f=this;var d=[{name:"tid"},{name:"value"}];var i=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList&type="+g}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d}),listeners:{update:function(n,m,o){if(o==Ext.data.Record.EDIT){Ext.Ajax.request({url:f.baseUrl+"&task=addSort",params:{type:g,value:m.get("value"),tid:m.get("tid")},success:function(p){var q=Ext.decode(p.responseText);if(q.success==true){CNOA.msg.notice2(q.msg)}else{if(q.failure==true){CNOA.msg.alert(q.msg)}}switch(g){case 0:f.carSort.store.reload();break}}})}}}});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=new Ext.form.TextField({allowBlank:false});var j=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),c,{header:"tid",dataIndex:"tid",hidden:true},{header:lang("name"),dataIndex:"value",width:180,editor:b}]});var e=new Ext.ux.grid.RowEditor({saveText:lang("ok"),cancelText:lang("cancel")});var a=new Ext.grid.GridPanel({title:h,stripeRows:true,store:i,sm:c,cm:j,plugins:[e],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:l},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:k},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>")]})});function l(){var m=new i.recordType({id:"",value:""});e.stopEditing();a.store.insert(0,m);e.startEditing(0)}function k(){var m=a.getSelectionModel().getSelected();if(!m){return false}CNOA.msg.cf(lang("areYouDelete"),function(n){if(n=="yes"){Ext.Ajax.request({url:f.baseUrl+"&task=delete",params:{tid:m.get("tid")},success:function(o){i.remove(m);i.reload();var p=Ext.decode(o.responseText);if(p.success==true){CNOA.msg.notice2(p.msg)}else{CNOA.msg.alert(p.msg)}}})}})}return a}};var sm_adm_car=1;
var CNOA_salary_basic_bingdingClass,CNOA_salary_basic_bingding;CNOA_salary_basic_bingdingClass=CNOA.Class.create();CNOA_salary_basic_bingdingClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=basic&action=bingding";this.bingdingPanel=this.getBingdingPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.bingdingPanel]})},getBingdingPanel:function(){var f=this;var e=[{name:"uid"},{name:"truename"},{name:"deptName"},{name:"salaryKey"},{name:"basicSalary"}];var h=function(j){if(j==null||j==0){j=lang("notBind")}return j};var d={truename:"",deptId:""};var c=new Ext.form.TextField({width:100}),i=new CNOA.selector.form.DepartmentSelectorField({hiddenName:"deptid",name:"dept",width:100,multiselect:false,selectorType:"dept"});var g=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:130,sortable:false,menuDisabled:true},{header:lang("belongDept"),dataIndex:"deptName",width:130,sortable:true,menuDisabled:true},{header:"标识符",dataIndex:"salaryKey",width:120,sortable:false,menuDisabled:true,editor:new Ext.form.TextField(),renderer:h},{header:lang("basicSalary"),dataIndex:"basicSalary",width:150,sortable:false,menuDisabled:true,editor:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.store=new Ext.data.Store({autoLoad:true,baseParams:d,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSalaryKey",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var b=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,style:"border: 0px;",store:f.store,pageSize:15});var a=new Ext.grid.EditorGridPanel({region:"center",store:f.store,cm:g,bodyStyle:"border-width: 0px; border-bottom-width: 1px;",tbar:new Ext.Toolbar({style:"border: 0px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}},{text:"同步考勤机标识符",cls:"btn-yellow1",iconCls:"icon-alarmclock",handler:function(){CNOA.msg.cf("是否确定将考勤机标识符同步到薪酬标识符<br>若选择确定，则将<font color=red>清空</font>现有的薪酬标识符，以考勤机标识符为主, 请慎重操作!",function(j){if(j=="yes"){f.synchronization()}})}},lang("truename")+":",c,lang("department")+":",i,{text:lang("search"),handler:function(){var j=c.getValue();d.truename=j;d.deptId=i.getValue();f.store.load()}},{text:lang("clear"),handler:function(){d.truename="";d.deptId="";c.setValue("");i.setValue("");f.store.load()}},'<span style="color:red"> >>>标识符仅在进行薪酬导入时使用，避免同姓名的用户数据错误</span>']}),bbar:b,listeners:{afteredit:function(k){var m=k.field,l=k.value,j=k.record.data.uid;f.updateSalaryKey(j,m,l)}}});return a},updateSalaryKey:function(a,e,d){var c=this,b=/^[a-zA-Z0-9]+$/;if(d.match(b)==null&&d!=0&&d!=""){CNOA.msg.alert("唯一标识符只能为英文字母和数字的组合");return}Ext.Ajax.request({url:c.baseUrl+"&task=updateSalaryKey",params:{uid:a,field:e,value:d},success:function(f){var g=Ext.decode(f.responseText);if(g.failure){CNOA.msg.alert(g.msg)}else{if(g.success){CNOA.msg.notice2(g.msg)}}c.store.reload()}})},synchronization:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=synchronization",success:function(b){var c=Ext.decode(b.responseText);CNOA.msg.alert(c.msg);a.store.reload()}})}};var CNOA_salary_basic_cardinalClass,CNOA_salary_basic_cardinal;CNOA_salary_basic_cardinalClass=CNOA.Class.create();CNOA_salary_basic_cardinalClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=basic&action=cardinal";this.cardinalPanel=a.getCardinalPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.cardinalPanel]})},getCardinalPanel:function(){var f=this;var a=[{name:"id"},{name:"name"},{name:"selectScope"},{name:"isInsure"},{name:"isInReserve"},{name:"isNasui"}];var b=function(h){if(h=="1"){h="<span style='color:blue'>是</span>"}else{h="<span style='color:red'>否</span>"}return h};var d=function(k,i,h){var j=h.data,l=j.id;k="<a javascript:void(0); class='gridview' onclick=CNOA_salary_basic_cardinal.checkedIsUseing("+l+")>"+lang("edit")+"</a>";k+="<a javascript:void(0); class='gridview4 jianju' onclick=CNOA_salary_basic_cardinal.editCalculateWin("+l+")>编辑公式</a>";k+="<a javascript:void(0); class='gridview3 jianju' onclick=CNOA_salary_basic_cardinal.showCardinalWin("+l+")>查看套帐</a>";return k};var g=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var c=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"id",hidden:true},{header:"名称",dataIndex:"name"},{header:"适用部门",dataIndex:"selectScope",width:600},{header:"是否投保",dataIndex:"isInsure",renderer:b},{header:"是否购买公积金",dataIndex:"isInReserve",renderer:b},{header:"是否纳税",dataIndex:"isNasui",renderer:b},{header:"操作",dataIndex:"opt",renderer:d,width:215}]});this.cardinalStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getCardinalData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var e=new Ext.grid.GridPanel({region:"center",store:f.cardinalStore,cm:c,sm:g,bodyStyle:"border: 0px;",tbar:new Ext.Toolbar({style:"border: 0px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.cardinalStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){f.addEditCardinal("add",0)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(h){var i=e.getSelectionModel().getSelected();if(i.length==0){CNOA.miniMsg.alertShowAt(h,"你必须选择一项进行操作")}else{CNOA.msg.cf("删除套帐会影响已经使用此套帐的人员进行录入薪酬，不影响查看薪酬，是否确认删除？",function(j){if(j=="yes"){var k=i.json.id;f.delCardinal(k)}})}}}]})});return e},checkedIsUseing:function(b){var a=this;CNOA.msg.cf("编辑套帐后需要重新编辑计算公式，但不影响查看薪酬操作，是否继续进行编辑？",function(c){if(c=="yes"){a.addEditCardinal("edit",b)}})},addEditCardinal:function(o,k){var r=this,i=1,b=2,q=Ext.id(),n=true,d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:r.baseUrl+"&task=getInsureDropStore"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"sid"},{name:"name"}]})}),l=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:r.baseUrl+"&task=getReserveDropStore"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"rid"},{name:"name"}]})}),a=new Ext.form.SelectorForm({fieldLabel:"选择部门",hiddenName:"deptid",name:"dept",width:500,multiselect:true,selectorType:"dept",allowBlank:false}),g=new Ext.form.Checkbox({fieldLabel:"社会保险",boxLabel:"是否需要投保",name:"isInsure",checked:true,width:200,listeners:{check:function(t,s){if(s==false){p.setVisible(false)}else{p.setVisible(true)}}}}),p=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"选择社保",store:d,width:180,hiddenName:"sid",valueField:"sid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),e=new Ext.form.Checkbox({fieldLabel:"公积金",boxLabel:"是否购买公积金",name:"isInReserve",checked:true,width:200,listeners:{check:function(t,s){if(s==false){m.setVisible(false)}else{m.setVisible(true)}}}}),m=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"选择公积金",store:l,width:180,hiddenName:"rid",valueField:"rid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),j=new Ext.form.FieldSet({labelWidth:80,width:580,title:"薪酬项目",border:true,items:[{xtype:"checkbox",fieldLabel:"个人所得税",boxLabel:"需要缴税",name:"isNasui",checked:true}]});var f=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:70,padding:10,items:[{xtype:"textfield",width:150,fieldLabel:"名称",allowBlank:false,name:"name"},a,g,p,e,m,j]});var h=function(s,t){selectScope=a.getValue();if(f.getForm().isValid()){f.getForm().submit({url:r.baseUrl+"&task=addEditCardinal",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{selectScope:selectScope,id:t},success:function(u,w){var v=JSON.parse(w.response.responseText);if(v.success){CNOA.msg.notice2(v.msg)}r.cardinalStore.reload();c.close()},failure:function(u,v){CNOA.msg.alert(v.result.msg)}})}};var c=new Ext.Window({title:"设置套帐",width:630,height:660,modal:true,items:[f],resizable:false,autoScroll:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){if(g.checked){var s=p.getValue();if(s==""){CNOA.msg.alert("此基数需要投保，请选择社保类型");return}}h(o,k)}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}],listeners:{beforerender:function(s){Ext.Ajax.request({url:r.baseUrl+"&task=getSalaryItem",success:function(t){var w=Ext.decode(t.responseText),v=w.data,x={xtype:"checkbox",fieldLabel:"",boxLabel:"参与录入",name:"",disabled:"",checked:true};for(var u=0;u<v.length;u++){x.fieldLabel=v[u].name;x.name="field"+v[u].fieldId;if(v[u].fieldId<=3){x.disabled=true}else{x.disabled=false}j.add(x)}j.doLayout();if(f.getHeight()<595){f.setHeight(595)}f.doLayout()}})}}});c.show();if(o=="edit"){f.getForm().load({url:r.baseUrl+"&task=loadFormData",method:"POST",params:{id:k},success:function(s,u){var t=u.result.data;n=false;a.setValue(t.selectName);a.hiddenField.setValue(t.selectScope)},failure:function(s,t){CNOA.msg.alert(t.result.msg)}})}},delCardinal:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=delCardinal",params:{id:b},success:function(d){var c=Ext.decode(d.responseText);if(c.success){CNOA.msg.notice2(c.msg)}else{CNOA.msg.alert(c.msg)}a.cardinalStore.reload()}})},showCardinalWin:function(a){window.open("index.php?app=salary&func=basic&action=cardinal&task=showCardinal&id="+a,"noticept","width=450, height="+(screen.availHeight-500)+",left="+((screen.availWidth-700)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")},editCalculateWin:function(f){var g=this,b="1",k="2";SALARY_BASIC_REPORT="3";var d=[{name:"fieldId"},{name:"name"},{name:"type"},{name:"isSysItems"}];var c=function(p,n,l){var o=l.data,m=o.isSysItems;switch(p){case b:p="输入项";break;case k:p="计算项";break;case SALARY_BASIC_REPORT:p="报表项";break}if(m=="1"){p="系统项"}return p};var h=function(q,o,l){var p=l.data,m=p.fieldId,n=p.isSysItems;if(n=="1"){if(p.type==b){q=" "}else{if(p.type==k){q="<a javascript:void(0); class='gridview' onclick=CNOA_salary_basic_cardinal.calculateWin("+m+","+f+")>编辑公式</a>";q+="<a javascript:void(0); class='gridview3 jianju' onclick=CNOA_salary_basic_cardinal.verifyGSWin("+m+","+f+")>验证公式</a>"}}}else{if(p.type==k){q="<a javascript:void(0); class='gridview' onclick=CNOA_salary_basic_cardinal.calculateWin("+m+","+f+")>编辑公式</a>";q+="<a javascript:void(0); class='gridview3 jianju' onclick=CNOA_salary_basic_cardinal.verifyGSWin("+m+","+f+")>验证公式</a>"}}return q};var i=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),{header:"fieldId",dataIndex:"fieldId",hidden:true},{header:"名称",dataIndex:"name"},{header:"类型",dataIndex:"type",renderer:c},{header:lang("opt"),dataIndex:"opt",renderer:h,width:145}]});var j=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getSetFieldData&cid="+f,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var a=new Ext.grid.GridPanel({stripeRows:true,border:false,store:j,cm:i});var e=new Ext.Window({title:"设置套帐",width:550,height:380,modal:true,layout:"fit",items:[a],resizable:true,autoScroll:true,buttonAlign:"right",buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]});e.show()},verifyGSWin:function(a,b){window.open("index.php?app=salary&func=basic&action=cardinal&task=showVerifyGS&fieldId="+a+"&cid="+b,"noticept","width=700, height="+(screen.availHeight-430)+",left="+((screen.availWidth-700)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")},calculateWin:function(d,f){var h=this;this.hiddenId=Ext.id();var c=new Ext.form.ComboBox({fieldLabel:"计算项",store:h.getItemsDropStore("calculate",f),width:180,hiddenName:"calculateID",valueField:"fieldId",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),b=new Ext.form.ComboBox({xtype:"combo",fieldLabel:"参与计算项",store:h.getItemsDropStore("input",f),width:180,hiddenName:"joinId",valueField:"fieldId",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(p,l,m){var n=l.data.fieldId,o=" @field"+n;h.insertValue(o)}}});this.gongshiTextaera=new Ext.form.TextArea({fieldLabel:"计算公式",name:"calculateGS",width:420,height:100});this.yuanGongshiTextaera=new Ext.form.TextArea({fieldLabel:"公式对照",name:"yuanCalculateGS",width:420,height:100});var j="<table style='padding-left: 81px'><tbody><tr><td><input type='button' value = '1' style='width:50px; height:25px;' onclick='CNOA_salary_basic_cardinal.buttonInput(1);'></td><td><input type='button' value = '2' style='width:50px; height:25px;' onclick='CNOA_salary_basic_cardinal.buttonInput(2);'></td><td><input type='button' value = '3' style='width:50px; height:25px;' onclick='CNOA_salary_basic_cardinal.buttonInput(3);'></td><td><input type='button' value = '+' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('+');></td><td><input type='button' value = '(' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('(');></td><td><input type='button' value = ')' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(')');></td><td><input type='button' value = '=' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('=');></td><td><input type='button' value = '清空' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('clear');></td></tr><tr><td><input type='button' value = '4' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(4);></td><td><input type='button' value = '5' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(5);></td><td><input type='button' value = '6' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(6);></td><td><input type='button' value = '-' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('-');></td><td><input type='button' value = '<' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('less');></td><td><input type='button' value = '>' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('greater');></td><td><input type='button' value = '<=' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('lessDY');></td><td><input type='button' value = '>=' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('greaterDY');></td></tr><tr><td><input type='button' value = '7' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(7);></td><td><input type='button' value = '8' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(8);></td><td><input type='button' value = '9' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(9);></td><td><input type='button' value = '*' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('*');></td><td><input type='button' value = '0' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput(0);></td><td><input type='button' value = '/' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('/');></td><td><input type='button' value = '如果' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('if');></td><td><input type='button' value = '则' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('ze');></td></tr><tr><td><input type='button' value = '.' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('.');></td><td><input type='button' value = '结果' style='width:50px; height:25px;' onclick=CNOA_salary_basic_cardinal.buttonInput('result');></td></tr></tbody></table>";this.calculateForm=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,region:"center",items:[c,b,this.gongshiTextaera,this.yuanGongshiTextaera,{hidden:true,id:this.hiddenId},{html:j}]});var a=function(m,l){if(h.calculateForm.getForm().isValid()){h.calculateForm.getForm().submit({url:h.baseUrl+"&task=editCalculateGS",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{cid:m},success:function(n,p){var o=JSON.parse(p.response.responseText);if(o.success){CNOA.msg.notice2(o.msg)}if(l=="close"){k.close()}else{if(l=="apply"){h.loadFormData(d,m)}}},failure:function(n,o){CNOA.msg.alert(o.result.msg)}})}};var i=function(l){if(l=="hide"){g.hide();k.setWidth(540)}else{if(l=="show"){g.show();k.setWidth(830)}}};var e="例子:<br><div><1>如果计算项为 ‘销售提成’，需要参与的计算项为 ‘销售额度-@field10’，则计算公式可以如下：</div><br><div style='background-color:#DEB887'>如果(@field10>10000) 则{ 结果= @field10*0.1} 如果(@field10>=20000) 则{结果=@field10*0.2}</div><br><div><2>如果计算项为 ‘实发工资’，需要参与的计算项为 ‘应付工资-@field10’,‘请假扣款-@field11’,‘迟到扣款-@field12’，则计算公式可以如下：</div><br><div style='background-color:#DEB887'>结果=@field10 - @field11 - @field12+500</div><br><div style='background-color:#DEB887'>或者：结果=(@field10 - @field11+500) / @field12</div><br>";var g=new Ext.Panel({width:290,border:true,hidden:true,tbar:["例子说明","->",{xtype:"button",text:lang("hide"),handler:function(){i("hide")}}],region:"east",bodyStyle:"padding: 10px;",items:[{border:false,html:e}]});var k=new Ext.Window({title:"编辑计算项",width:540,height:500,layout:"border",resizable:true,autoDistory:true,modal:true,maskDisabled:true,items:[this.calculateForm,g],plain:true,buttonAlign:"right",buttons:[{text:"查看例子",handler:function(){i("show")}},{text:lang("save"),iconCls:"icon-btn-save",handler:function(){a(f,"close")}},{text:lang("apply"),iconCls:"icon-btn-save",handler:function(){a(f,"apply")}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){k.close()}}]});k.show();h.loadFormData(d,f)},getItemsDropStore:function(b,d){var c=this;var a=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getCalculateDrop&type="+b+"&cid="+d}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"fieldId"},{name:"name"}]})});return a},loadFormData:function(a,c){var b=this;b.calculateForm.load({url:b.baseUrl+"&task=loadCalculateForm",params:{fieldId:a,cid:c},method:"POST",failure:function(d,e){CNOA.msg.alert(e.result.msg)}})},buttonInput:function(a){var b=this;if(a=="clear"){b.gongshiTextaera.setValue("");return}switch(a){case"less":a="<";break;case"lessDY":a="<=";break;case"greater":a=">";break;case"greaterDY":a=">=";break;case"if":a=" 如果() ";" if() ";break;case"ze":a=" 则{} ";break;case"result":a=" 结果= ";break}b.insertValue(a)},insertValue:function(c){var e=this,g=e.gongshiTextaera.el.dom.selectionStart,f=e.gongshiTextaera.getValue(),b=f.substring(0,g),a=f.substring(g);f=b+c+a;var d=f.length;e.gongshiTextaera.setValue(f);e.gongshiTextaera.el.dom.selectionStart=d}};var CNOA_salary_basic_insureClass,CNOA_salary_basic_insure;CNOA_salary_basic_insureClass=CNOA.Class.create();CNOA_salary_basic_insureClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=basic&action=insure";this.insurePanel=this.getInsurePanel();this.reservePanel=this.getReservePanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.insurePanel,this.reservePanel]})},getInsurePanel:function(){var d=this;var a=[{name:"sid"},{name:"truename"},{name:"name"},{name:"insureBasic"},{name:"yangLao"},{name:"yanglao_p_pay_m"},{name:"yanglao_u_pay_m"},{name:"yiLiao"},{name:"yiliao_p_pay_m"},{name:"yiliao_u_pay_m"},{name:"bigYiliao"},{name:"bigYiliao_p_pay_m"},{name:"bigYiliao_u_pay_m"},{name:"shiYe"},{name:"shiye_p_pay_m"},{name:"shiye_u_pay_m"},{name:"gshang_u_pay_m"},{name:"shengyu_u_pay_m"}];var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),e,{header:"sid",dataIndex:"sid",hidden:true},{header:"名称",dataIndex:"name"},{header:"创建人",dataIndex:"truename"},{header:"养老保险(元)",dataIndex:"yangLao",css:"background-color:#DDDDDD;"},{header:"单位承担(元)",dataIndex:"yanglao_u_pay_m",css:"background-color:#DDDDDD;"},{header:"个人承担(元)",dataIndex:"yanglao_p_pay_m",css:"background-color:#DDDDDD;"},{header:"医疗保险(元)",dataIndex:"yiLiao"},{header:"单位承担(元)",dataIndex:"yiliao_u_pay_m"},{header:"个人承担(元)",dataIndex:"yiliao_p_pay_m"},{header:"重大医疗疾病补助(元)",dataIndex:"bigYiliao",width:130,css:"background-color:#DDDDDD;"},{header:"单位承担(元)",dataIndex:"bigYiliao_u_pay_m",css:"background-color:#DDDDDD;"},{header:"个人承担(元)",dataIndex:"bigYiliao_p_pay_m",css:"background-color:#DDDDDD;"},{header:"失业保险(元)",dataIndex:"shiYe"},{header:"单位承担(元)",dataIndex:"shiye_u_pay_m"},{header:"个人承担(元)",dataIndex:"shiye_p_pay_m"},{header:"工伤保险(元)",dataIndex:"gshang_u_pay_m",css:"background-color:#DDDDDD;"},{header:"生育保险(元)",dataIndex:"shengyu_u_pay_m",css:"background-color:#DDDDDD;"}]});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getInsureData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.GridPanel({region:"center",title:"社会保险",store:d.store,cm:b,sm:e,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.addEditWin(0)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(f){var g=c.getSelectionModel().getSelected();if(g==null){CNOA.miniMsg.alertShowAt(f,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否删除该社保系数设定",function(i){if(i=="yes"){var h=g.json.sid;d.delInsure(h)}})}}},'<span style="color:gray;">双击进行修改</span>']}),listeners:{celldblclick:function(h,j,g,k){var i=h.getSelectionModel().getSelected().data,f=i.sid;d.addEditWin(f)}}});return c},getReservePanel:function(){var d=this;var a=[{name:"rid"},{name:"truename"},{name:"name"},{name:"reserveBasic"},{name:"companyPay"},{name:"personPay"}];var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),e,{header:"sid",dataIndex:"sid",hidden:true},{header:"名称",dataIndex:"name"},{header:"创建人",dataIndex:"truename"},{header:"默认基数",dataIndex:"reserveBasic"},{header:"公司承担",dataIndex:"companyPay"},{header:"个人承担",dataIndex:"personPay"}]});this.reserveStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getReserveData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.GridPanel({region:"center",title:"公积金",store:d.reserveStore,cm:b,sm:e,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.reserveStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.addEditReserveWin()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(f){var g=c.getSelectionModel().getSelected();if(g==null){CNOA.miniMsg.alertShowAt(f,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否删除该公积金设定",function(h){if(h=="yes"){var i=g.json.rid;d.delReserve(i)}})}}},'<span style="color:gray;">双击进行修改</span>']}),listeners:{celldblclick:function(h,j,f,k){var i=h.getSelectionModel().getSelected().data,g=i.rid;d.addEditReserveWin(g)}}});return c},addEditWin:function(a){window.open("index.php?app=salary&func=basic&action=insure&task=showAddEdit&sid="+a,"noticept","width=380, height="+(screen.availHeight-500)+",left="+((screen.availWidth-380)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")},delInsure:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delInsure",params:{sid:a},success:function(c){var d=Ext.decode(c.responseText);b.store.reload();CNOA.msg.alert(d.msg)}})},addEditReserveWin:function(a){window.open("index.php?app=salary&func=basic&action=insure&task=showReserveWin&rid="+a,"noticept","width=550, height="+(screen.availHeight-700)+",left="+((screen.availWidth-700)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")},delReserve:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delReserve",params:{rid:a},success:function(c){var d=Ext.decode(c.responseText);b.reserveStore.reload();CNOA.msg.alert(d.msg)}})}};var CNOA_salary_basic_setClass,CNOA_salary_basic_set;CNOA_salary_basic_setClass=CNOA.Class.create();CNOA_salary_basic_setClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=basic&action=set";this.setPanel=this.getSetPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.setPanel]})},getSetPanel:function(){var f=this,b="1",h="2";SALARY_BASIC_REPORT="3";var e=[{name:"fieldId"},{name:"order"},{name:"name"},{name:"type"},{name:"show"},{name:"isSysItems"}];var c=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var d=function(n,l,j){var m=j.data,k=m.isSysItems;switch(n){case b:n="输入项";break;case h:n="计算项";break;case SALARY_BASIC_REPORT:n="报表项";break}if(k=="1"){n="系统项"}return n};var i=function(j){if(j==" "){return""}checked=j==1?"checked":"";return'<input type="checkbox" '+checked+"  />"};var g=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),c,{header:"fieldId",dataIndex:"fieldId",hidden:true},{header:"名称",dataIndex:"name"},{header:"类型",dataIndex:"type",renderer:d},{header:"是否在导入样板显示",width:130,dataIndex:"show",renderer:i},{header:"排序",dataIndex:"order",editor:new Ext.form.TextField({width:100,regex:/^[1-9]\d*$|^0$/,regexText:"只能输入正整数或者0"})}]});this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getSetData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var a=new Ext.grid.EditorGridPanel({region:"center",store:f.store,cm:g,sm:c,bodyStyle:"border-width: 0px;",tbar:new Ext.Toolbar({style:"border-width: 0px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){f.addWin()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=a.getSelectionModel().getSelected();if(k==null){CNOA.miniMsg.alertShowAt(j,"你必须选择一项进行操作")}else{CNOA.msg.cf("删除薪酬项目，会删除该薪酬项目的全部数据，是否确定要删除？",function(l){if(l=="yes"){var m=k.json.fieldId;f.delSet(m)}})}}}]}),listeners:{cellclick:function(l,o,m){var n=l.getColumnModel().getDataIndex(m);if(n=="show"){var j=l.getStore().getAt(o),k=j.get("fieldId");oldValue=j.get(n);value=$(l.getView().getCell(o,m)).find("input").attr("checked");if(value==undefined||value==oldValue){return}value=value?1:0;f.editFix(k,n,value)}},afteredit:function(k){var m=k.record.data,l=k.value,j=m.fieldId;f.updateWin(l,j)}}});return a},addWin:function(){var c=this,g="添加新项目";var b=new Ext.form.ComboBox({fieldLabel:"类型",store:new Ext.data.ArrayStore({fields:["type","value"],data:[[1,"输入项"],[2,"计算项"],[3,"报表项"]]}),width:180,hiddenName:"type",valueField:"type",displayField:"value",mode:"local",allowBlank:false,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i){if(i.value==3){Ext.getCmp("salaryReport").show();Ext.getCmp("reportField").show()}else{Ext.getCmp("salaryReport").hide();Ext.getCmp("reportField").hide()}}}});var a=new Ext.form.ComboBox({id:"salaryReport",fieldLabel:"用户报表",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getSalaryReport"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["tid","name"]})}),width:180,hiddenName:"salaryReportId",hidden:true,valueField:"tid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(i){Ext.getCmp("reportField").getStore().load({params:{id:i.value}})}}});var h=new Ext.form.ComboBox({id:"reportField",fieldLabel:"报表字段",store:new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getReportField"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["fieldid","title"]})}),width:180,hiddenName:"reportFieldId",hidden:true,valueField:"fieldid",displayField:"title",mode:"local",triggerAction:"all",forceSelection:true,editable:false});var f=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:60,padding:10,items:[b,{xtype:"textfield",name:"name",width:180,allowBlank:false,fieldLabel:"名称"},{xtype:"textfield",name:"order",width:180,regex:/^[0-9]+$/,regexText:"排序只能为正整数，请重新输入",fieldLabel:"排序"},a,h]});var d=function(){if(f.getForm().isValid()){f.getForm().submit({url:c.baseUrl+"&task=addEditItems",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",success:function(i,k){var j=JSON.parse(k.response.responseText);if(j.success){CNOA.msg.notice2(j.msg)}c.store.reload();e.close()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};var e=new Ext.Window({title:g,width:300,height:250,layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[f],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){d()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]});e.show()},editFix:function(a,d,c){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=editFix",method:"POST",params:{fieldId:a,field:d,value:c},success:function(e){var f=Ext.decode(e.responseText);if(f.success){CNOA.msg.notice2(f.msg)}else{CNOA.msg.alert(f.msg)}b.store.reload()}})},updateWin:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=updateOrder",mothod:"POST",params:{value:c,fieldId:a},success:function(d,f){var e=Ext.decode(d.responseText);CNOA.msg.notice2(e.msg);b.store.reload()}})},delSet:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=delItems",params:{id:b},success:function(c){var d=Ext.decode(c.responseText);CNOA.msg.alert(d.msg);a.store.reload()}})}};var CNOA_salary_basic_wealClass,CNOA_salary_basic_weal;CNOA_salary_basic_wealClass=CNOA.Class.create();CNOA_salary_basic_wealClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=basic&action=weal";this.wealPanel=this.getWealPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.wealPanel]})},getWealPanel:function(){var d=this;var a=[{name:"wid"},{name:"title"},{name:"content"},{name:"scope"}];var f=new Ext.ux.grid.RowExpander({tpl:new Ext.Template("<div style='padding: 10px 0px 10px 25px; background-color: #FFF8DC'>","<b>标题</b>: {title}<br>","<b>范围</b>: {scope}<br>","<b>内容</b>: {content}<br>","</div>")});var e=new Ext.grid.CheckboxSelectionModel();var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[f,e,{header:"wid",dataIndex:"wid",hidden:true},{header:"标题",dataIndex:"title",width:200},{header:"范围",dataIndex:"scope",width:300},{header:"内容",dataIndex:"content",width:400}]});this.wealStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getWealJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.GridPanel({region:"center",plugins:f,store:d.wealStore,cm:b,sm:e,bodyStyle:"border-width: 0px;",tbar:new Ext.Toolbar({style:"border-width: 0px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.wealStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){d.addEditWin("add",0)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=c.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf("是否删除该福利",function(j){if(j=="yes"){var i=[];Ext.each(h,function(k){i.push(k.json.wid)});d.delWeal(i.join(","))}})}}}]})});return c},addEditWin:function(e,i){var g=this,d=e=="add"?false:true,h=new Ext.form.SelectorForm({fieldLabel:"对象",hiddenName:"deptid",name:"dept",width:420,multiselect:true,selectorType:"dept"}),b=new Ext.form.SelectorForm({fieldLabel:"对象",hiddenName:"userId",name:"user",width:420,multiselect:true,selectorType:"user"}),j=new Ext.form.RadioGroup({fieldLabel:"适用对象",name:"radio",width:250,items:[{boxLabel:"按部门发放",name:"selectType",inputValue:"1",checked:true},{boxLabel:"按人员发放",name:"selectType",inputValue:"2"}],listeners:{change:function(l,k){h.setVisible(false);h.setValue();h.hiddenField.setValue();b.setVisible(false);b.setValue();b.hiddenField.setValue();if(k.inputValue=="1"){h.setVisible(true)}if(k.inputValue=="2"){b.setVisible(true)}}}});var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:70,padding:10,items:[{xtype:"textfield",width:420,fieldLabel:"标题",allowBlank:false,name:"title"},j,b,h,{xtype:"textarea",fieldLabel:"内容",name:"content",width:420,height:200,allowBlank:false}]});b.setVisible(false);var f=function(){var k=h.getValue(),l=b.getValue();if(j.getValue()=="2"){if(l==null){CNOA.msg.alert("请选择人员");return}}else{if(k==null){CNOA.msg.alert("请选择部门");return}}if(a.getForm().isValid()){a.getForm().submit({url:g.baseUrl+"&task=submitWeal",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{uids:l,dids:k},success:function(m,o){var n=Ext.decode(o.response.responseText);if(n.success){CNOA.msg.notice2(n.msg)}g.wealStore.reload();c.close()},failure:function(m,n){CNOA.msg.alert(n.result.msg)}})}};var c=new Ext.Window({title:"提交审批",width:540,height:450,layout:"fit",resizable:true,autoDistory:true,modal:true,maskDisabled:true,items:[a],plain:true,buttonAlign:"right",buttons:[{text:"提交",iconCls:"icon-btn-save",handler:function(){f()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]});c.show()},delWeal:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delWeal",params:{wids:a},success:function(d){var c=Ext.decode(d.responseText);if(c.success){CNOA.msg.notice2(c.msg)}else{CNOA.msg.alert(c.msg)}b.wealStore.reload()}})}};var CNOA_salary_manage_approveClass,CNOA_salary_manage_approve;CNOA_salary_manage_approveClass=CNOA.Class.create();CNOA_salary_manage_approveClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=manage&action=approve";this.approvePanel=a.getApprovePanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.approvePanel]})},getApprovePanel:function(){var e=this;var a=[{name:"id"},{name:"title"},{name:"tuid"},{name:"tDate"},{name:"date"},{name:"isInApprove"},{name:"shouldSum"},{name:"actualSum"},{name:"appuid"},{name:"status"}];var c=function(m,k,i){var l=i.data,n=l.id,j=l.date;m="<a class='gridview' javascript:void(0); onclick=CNOA_salary_manage_approve.salaryDetail("+n+",'"+j+"')>查看详细</a>";m+="<a class='gridview3 jianju' javascript:void(0); onclick=CNOA_salary_manage_approve.sendApproveFlow("+n+")>发起流程审批</a>";return m};var h=function(k,j,i){if(k==0){k="<span style='color:red'>未审批</span>"}else{if(k==1){k="<span style='color:blue'>通过</span>"}else{if(k==2){k="<span style='color:blue'>不通过</span>"}}}return k};var g=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"id",hidden:true},{header:"标题",dataIndex:"title",width:400},{header:"薪酬日期",dataIndex:"date"},{header:"提交日期",dataIndex:"tDate"},{header:"应发工资",dataIndex:"shouldSum"},{header:"实发工资",dataIndex:"actualSum"},{header:"最后审批人",dataIndex:"appuid",width:80},{header:"审批状态",dataIndex:"status",renderer:h,width:80},{header:"操作",dataIndex:"opt",renderer:c,width:190}]});this.approveStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getapproveJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var f=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:e.approveStore,style:"border-left-width: 0px;",pageSize:15});var d=new Ext.grid.GridPanel({region:"center",store:e.approveStore,cm:b,sm:g,bbar:f,bodyStyle:"border-left-width: 0px; border-top-width: 0px;",tbar:new Ext.Toolbar({style:"border-width: 0px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.approveStore.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=d.getSelectionModel().getSelected(),i=k.json.status;if(i!=0){CNOA.msg.alert("此薪酬审批已经审批过，不能删除。");return}if(k==null){CNOA.miniMsg.alertShowAt(j,"你必须选择一项进行操作")}else{CNOA.msg.cf("是否确定要删除？",function(l){if(l=="yes"){var m=k.json.id;e.delApprove(m)}})}}},{text:"提交审批",iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){e.showApproeWin()}}]})});return d},showApproeWin:function(){var c=this,b=new Ext.form.DateField({fieldLabel:"薪酬日期",format:"Y-m",allowBlank:false,width:150,name:"date",plugins:"monthPickerPlugin",value:new Date()}),h=new Ext.form.SelectorForm({fieldLabel:"对象",hiddenName:"deptid",name:"dept",width:250,multiselect:true,selectorType:"dept",allowBlank:false}),a=new Ext.form.SelectorForm({fieldLabel:"对象",hiddenName:"userid",name:"user",width:250,multiselect:true,selectorType:"user",allowBlank:false}),e=new Ext.form.RadioGroup({fieldLabel:"适用对象",name:"radio",width:250,items:[{boxLabel:"按部门提交",name:"selectType",inputValue:"1",checked:true},{boxLabel:"按人员提交",name:"selectType",inputValue:"2"}],listeners:{change:function(j,i){h.setVisible(false);h.setValue();h.hiddenField.setValue();a.setVisible(false);a.setValue();a.hiddenField.setValue();if(i.inputValue=="1"){h.setVisible(true)}if(i.inputValue=="2"){a.setVisible(true)}}}});a.setVisible(false);var g=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:70,padding:10,items:[{xtype:"textfield",width:150,fieldLabel:"标题",allowBlank:false,name:"title"},b,e,h,a]});var d=function(){var i=h.getValue(),j=a.getValue(),k=e.getValue();if(k=="1"){if(i==null){CNOA.msg.alert("请选择部门");return}}else{if(j==null){CNOA.msg.alert("请选择人员");return}}if(g.getForm().isValid()){g.getForm().submit({url:c.baseUrl+"&task=submitApprove",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{uids:j,dids:i},success:function(l,n){var m=Ext.decode(n.response.responseText);if(m.success){CNOA.msg.notice2(m.msg)}c.approveStore.reload();f.close()},failure:function(l,m){CNOA.msg.alert(m.result.msg)}})}};var f=new Ext.Window({title:"提交审批",width:380,height:250,layout:"fit",resizable:true,autoDistory:true,modal:true,maskDisabled:true,items:[g],plain:true,buttonAlign:"right",buttons:[{text:"提交",iconCls:"icon-btn-save",handler:function(){d()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}}]});f.show()},salaryDetail:function(c,a){var b=this;window.open(b.baseUrl+"&task=getSalaryDetail&id="+c+"&date="+a,"noticept","width=450, height="+(screen.availHeight-430)+",left="+((screen.availWidth-760)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")},sendApproveFlow:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=sendApproveFlow",params:{id:b},success:function(c){var g=Ext.decode(c.responseText);if(g.success==true){var d=g.uFlowId,e=g.flowType,h=g.tplSort,f=g.salaryApproveId;getFlowId4Engine("salaryApprove",function(k,i,j){j(d,e,h,f)})}else{CNOA.msg.alert(g.msg)}}})},delApprove:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=delApprove",params:{id:b},success:function(c){var d=Ext.decode(c.responseText);CNOA.msg.alert(d.msg);a.approveStore.reload()}})}};var CNOA_salary_manage_detailClass,CNOA_salary_manage_detail;CNOA_salary_manage_detailClass=CNOA.Class.create();CNOA_salary_manage_detailClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=manage&action=detail";this.exportDeptId="";this.searchParams={truname:"",date:"",deptId:"",workType:"",status:"",isSearch:""};this.detailPanel=a.getdetailPanel();this.deptPanel=this.getDeptPanel();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.detailPanel]})},getDeptPanel:function(){var c=this;var e="CNOA_main_user_index_structTree_root";var d;var b=Ext.id();var a=new Ext.tree.AsyncTreeNode({id:e,expanded:true});var f=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(g){a.firstChild.collapse(true);if(Ext.getCmp(b).pressed){a.expand(true)}else{a.firstChild.expand()}}}});return new Ext.tree.TreePanel({region:"west",split:true,width:200,rootVisible:false,lines:true,animCollapse:false,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:f,root:a,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:b,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(g,h){if(h){g.setText(lang("collapse"));g.setTooltip(lang("collapseMenuTip"));a.expand(true)}else{g.setText(lang("expand"));g.setTooltip(lang("expandMenuTip"));a.collapse(true);a.firstChild.expand()}}},{text:"导出全部",iconCls:"icon-excel",cls:"btn-blue4",handler:function(){c.openExportExcelWindow("all")}},"->",{handler:function(g,h){a.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]}),listeners:{click:function(g){if(g.disabled){return}c.searchParams.deptId=g.attributes.selfid;c.exportDeptId=g.attributes.selfid;c.detailStore.load();Ext.state.Manager.set("CNOA_main_job_index_treeState",g.getPath())}}})},getdetailPanel:function(){var i=this,e=Ext.id(),g=[{name:"id"},{name:"cid"},{name:"uid"},{name:"truename"},{name:"dept"},{name:"isInSure"},{name:"reason"},{name:"shouldPay"},{name:"actualPay"}];var j=function(r,p,n){var q=n.data,o=q.uid,s=q.cid;r="<a class='gridview' javascript:void(0); onclick=CNOA_salary_manage_detail.detailSalaryWin("+o+","+s+")>查看详细</a>";return r};var l=function(r,o,n){var q=n.data,p=q.isInSure,s=q.reason;if(p=="1"){r="<span style='color:blue'>已确认</span>"}else{if(p=="2"){r="不同意";r+='<img src=/resources/images/icons/message.gif ext:qtip="'+s+'">'}else{r="<span style='color:red'>未确认</span>"}}return r};var c=new Ext.grid.CheckboxSelectionModel();var k=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),c,{header:"uid",dataIndex:"uid",hidden:true},{header:"姓名",dataIndex:"truename"},{header:"所在部门",dataIndex:"dept"},{header:"应发工资",dataIndex:"shouldPay"},{header:"实发工资",dataIndex:"actualPay"},{header:"操作",dataIndex:"opt",renderer:j,width:80},{header:"状态",dataIndex:"sta",renderer:l,width:80}]});this.detailStore=new Ext.data.Store({autoLoad:true,baseParams:i.searchParams,proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getdetailJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g}),listeners:{load:function(r,o,q){var n=r.reader.jsonData;var p=n.top;h.setValue(p.shouldSumPay);m.setValue(p.actualSumPay)}}});var d=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:i.detailStore,pageSize:15});var b=new Ext.form.TextField({width:100}),h=new Ext.form.TextField({fieldLabel:"应发合计"}),m=new Ext.form.TextField({fieldLabel:"实发合计"}),f=new Ext.form.ComboBox({store:new Ext.data.ArrayStore({fields:["type","value"],data:[[0,"未确认"],[1,"已确认"],[2,"不同意"]]}),width:80,hiddenName:"type",valueField:"type",displayField:"value",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(q,n,o){var p=q.value;i.searchParams.status=p;i.detailStore.load()}}});this.getLastMonth=function(){var q=new Date();var s=q.getFullYear();var u=q.getMonth();var p=s;if(u==0){p=parseInt(p)-1;u=12}if(u<10){u="0"+u}var o=p.toString();var t=u.toString();var r=o+"-"+t;return r};this.select_date=new Ext.form.DateField({fieldLabel:"选择日期",format:"Y-m",width:145,plugins:"monthPickerPlugin",value:i.getLastMonth(),listeners:{select:function(o,n){i.searchParams.date=o.getRawValue();i.detailStore.load()}}});this.topPanel=new Ext.form.FormPanel({layout:"table",border:false,bodyStyle:"padding: 5px",labelWidth:100,labelAlign:"right",hideBorders:true,layoutConfig:{columns:3},defaults:{layout:"form",width:250,defaults:{width:100,readOnly:true,style:"text-align:center; font-weight: bold; color:#119911;"}},items:[{items:[h]},{items:[m]}]});var a=new Ext.grid.GridPanel({region:"center",store:i.detailStore,cm:k,sm:c,bbar:d,listeners:{afterrender:function(){i.topPanel.render(this.tbar)}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.detailStore.reload()}},{text:"查看选中人员",cls:"btn-red1",iconCls:"icon-search",id:e,handler:function(){var o=a.getSelectionModel().getSelections(),n=[];if(o.length==0){CNOA.miniMsg.alertShowAt(btn,lang("mustSelectOneRow"))}else{Ext.each(o,function(p){var q=p.data;n.push(q.uid)});i.showDetailWin(n.join(","))}}},"姓名：",b,"日期：",this.select_date,{text:lang("search"),handler:function(){Ext.getCmp(e).setVisible(false);i.searchParams.truename=b.getValue();i.searchParams.date=i.select_date.getRawValue();i.searchParams.isSearch="search";i.detailStore.load()}},{text:lang("clear"),handler:function(){Ext.getCmp(e).setVisible(true);b.setValue("");f.setValue();i.select_date.setValue(i.getLastMonth());i.searchParams.truename="";i.searchParams.status="";i.searchParams.date="";i.searchParams.workType="";i.searchParams.isSearch="clear";i.detailStore.load()}},{text:"在职",width:40,cls:"btn-blue4",handler:function(){Ext.getCmp(e).setVisible(false);i.searchParams.workType=1;i.detailStore.load()}},{text:"离职",width:40,cls:"btn-gray1",handler:function(){Ext.getCmp(e).setVisible(false);i.searchParams.workType=2;i.detailStore.load()}},"确认状态：",f,{text:lang("export2"),iconCls:"icon-excel",tooltip:lang("exportExcel"),cls:"btn-blue3",handler:function(n,o){i.openExportExcelWindow("dept")}}]})});return a},detailSalaryWin:function(b,d){var c=this,a=c.select_date.getRawValue();window.open(c.baseUrl+"&task=getOneDetail&id="+b+"&date="+a+"&cid="+d,"noticept","width=450, height="+(screen.availHeight-430)+",left="+((screen.availWidth-700)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")},openExportExcelWindow:function(b){var c=this;var f=new Ext.form.DateField({width:120,format:"Y-m",plugins:"monthPickerPlugin",value:new Date(),fieldLabel:lang("exportDate")});var d=function(h,g){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=salaryExportExcel&step=1",waitMsg:lang("waiting"),method:"POST",params:{date:h,deptId:c.exportDeptId,act:g},success:function(i,k){var j="";if(g=="all"){j="all"}else{j=c.exportDeptId}ajaxDownload(c.baseUrl+"&task=salaryExportExcel&file="+k.result.msg+"&step=2&date="+h+"&value="+j)},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:100,items:[f]});var e=new Ext.Window({width:300,height:130,title:"导出薪酬详细",resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),cls:"btn-blue4",iconCls:"icon-excel",handler:function(){var g=f.getRawValue();if(g==""){CNOA.msg.alert(lang("pleaseSelectDateExport"))}else{d(g,b)}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()},showDetailWin:function(d){var c=this,a=c.select_date.getRawValue(),b=c.searchParams.deptId;window.open("index.php?app=salary&func=manage&action=detail&task=showDetailWin&ids="+d+"&date="+a+"&deptId="+b,"noticept","width="+(screen.availWidth-10)+",height="+(screen.availHeight-70)+",left=0,top=0,scrollbars=yes,resizable=yes,status=no")}};var CNOA_salary_manage_enteringClass,CNOA_salary_manage_entering;CNOA_salary_manage_enteringClass=CNOA.Class.create();CNOA_salary_manage_enteringClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=manage&action=entering";this.searchParams={truname:"",workType:"",deptId:"",date:""};this.enteringPanel=a.getEnteringPanel();this.deptPanel=this.getDeptPanel();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.enteringPanel]})},getDeptPanel:function(){var c=this;var e="CNOA_main_user_index_structTree_root";var d;var b=Ext.id();var a=new Ext.tree.AsyncTreeNode({id:e,expanded:true});var f=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(g){a.firstChild.collapse(true);if(Ext.getCmp(b).pressed){a.expand(true)}else{a.firstChild.expand()}}}});return new Ext.tree.TreePanel({region:"west",split:true,width:180,rootVisible:false,lines:true,animCollapse:false,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:f,root:a,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:b,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(g,h){if(h){g.setText(lang("collapse"));g.setTooltip(lang("collapseMenuTip"));a.expand(true)}else{g.setText(lang("expand"));g.setTooltip(lang("expandMenuTip"));a.collapse(true);a.firstChild.expand()}}},{xtype:"importButton",cls:"btn-blue3",browseTitle:lang("enteringSalary"),url:this.baseUrl+"&task=importSalary"},"->",{handler:function(g,h){a.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]}),listeners:{click:function(g){if(g.disabled){return}c.searchParams.deptId=g.attributes.selfid;c.cardinalStore.load();Ext.state.Manager.set("CNOA_main_job_index_treeState",g.getPath())}}})},getEnteringPanel:function(){var g=this;var f=[{name:"uid"},{name:"truename"},{name:"dept"},{name:"status"},{name:"reason"},{name:"isInSure"}];var i=function(j){if(j=="1"){j="<span style='color:blue'>已录入</span>"}else{j="<span style='color:red'>未录入</sapn>"}return j};var e=function(m,k,j){var l=j.data,n=l.reason;if(m=="1"){m="<span style='color:blue'>已确认</span>"}else{if(m=="2"){m="不同意";m+='<img src=/resources/images/icons/message.gif ext:qtip="'+n+'">'}else{m="<span style='color:red'>未确认</sapn>"}}return m};var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var h=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:110},columns:[new Ext.grid.RowNumberer(),c,{header:"uid",dataIndex:"uid",hidden:true},{header:"姓名",dataIndex:"truename"},{header:"所在部门",dataIndex:"dept"},{header:"状态",dataIndex:"status",renderer:i,width:80},{header:"确认状态",dataIndex:"isInSure",renderer:e,width:80}]});this.cardinalStore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getEnteringJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.PagingToolbar({displayInfo:true,store:g.cardinalStore,pageSize:50});var b=new Ext.form.TextField({width:100});this.getLastMonth=function(){var l=new Date();var p=l.getFullYear();var r=l.getMonth();var k=p;if(r==0){k=parseInt(k)-1;r=12}if(r<10){r="0"+r}var j=k.toString();var q=r.toString();var o=j+"-"+q;return o};this.search_date=new Ext.form.DateField({format:"Y-m",width:100,plugins:"monthPickerPlugin",value:g.getLastMonth(),listeners:{select:function(k,j){g.searchParams.date=k.getRawValue();g.cardinalStore.load()}}});var a=new Ext.grid.GridPanel({region:"center",store:g.cardinalStore,cm:h,sm:c,bbar:d,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.cardinalStore.reload()}},{text:"录入薪酬",iconCls:"icon-utils-s-edit",cls:"btn-red1",handler:function(j){var l=a.getSelectionModel().getSelections(),k=[];if(l.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{Ext.each(l,function(m){var n=m.data;k.push(n.uid)});g.getSalaryDate(k.join(","))}}},{text:"发送提醒",iconCls:"icon-alarmclock",cls:"btn-yellow1",handler:function(j){var l=a.getSelectionModel().getSelections(),k=[];if(l.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{Ext.each(l,function(m){var n=m.data;k.push(n.uid)});g.sendNotices(k.join(","))}}},"姓名：",b,"日期：",this.search_date,{text:lang("search"),handler:function(){g.searchParams.truename=b.getValue();g.searchParams.date=g.search_date.getRawValue();g.cardinalStore.load()}},{text:lang("clear"),handler:function(){b.setValue("");g.search_date.setValue(g.getLastMonth());g.searchParams.truename="";g.searchParams.workType="";g.searchParams.date="";g.cardinalStore.load()}},{text:"在职",width:40,cls:"btn-blue4",handler:function(){g.searchParams.workType=1;g.cardinalStore.load()}},{text:"离职",cls:"btn-gray1",width:40,handler:function(){g.searchParams.workType=2;g.cardinalStore.load()}},"<span style='color:red'> >>> 若使用导入功能，请先设置好套帐，否则将导入失败。</span>"]})});return a},getSalaryDate:function(b){var a=this;var d=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:60,padding:15,items:[{html:"<div style='padding:10px'>若存在当月薪酬记录，则自动调用。<br> 若不存在，则自动调用上一月份数据</div>"}]});var c=new Ext.Window({title:"薪酬录入",width:280,height:155,layout:"fit",resizable:true,autoDistory:true,modal:true,maskDisabled:true,items:[d],plain:true,buttonAlign:"right",buttons:[{text:"确定",iconCls:"icon-btn-save",handler:function(){a.batchInputOpt(b);c.close()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}}]});c.show()},batchInputOpt:function(d){var c=this,a=c.search_date.getRawValue(),b=c.searchParams.deptId;window.open("index.php?app=salary&func=manage&action=entering&task=showBatchEnterWin&ids="+d+"&date="+a+"&deptId="+b,"noticept","width="+(screen.availWidth-10)+",height="+(screen.availHeight-70)+",left=0,top=0,scrollbars=yes,resizable=yes,status=no")},sendNotices:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=sendNotices",params:{uids:b},success:function(c){var d=Ext.decode(c.responseText)}})}};var CNOA_salary_manage_countClass,CNOA_salary_manage_count;CNOA_salary_manage_countClass=CNOA.Class.create();CNOA_salary_manage_countClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=manage&action=count";this.exportDeptId="";this.searchParams={truname:"",date:"",deptId:"",salary:"",status:"",isSearch:""};this.countPanel=a.getcountPanel();this.deptPanel=this.getDeptPanel();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.countPanel]})},getDeptPanel:function(){var c=this;var e="CNOA_main_user_index_structTree_root";var d;var b=Ext.id();var a=new Ext.tree.AsyncTreeNode({id:e,expanded:true});var f=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(g){a.firstChild.collapse(true);if(Ext.getCmp(b).pressed){a.expand(true)}else{a.firstChild.expand()}}}});return new Ext.tree.TreePanel({region:"west",split:true,width:200,rootVisible:false,lines:true,animCollapse:false,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:f,root:a,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:b,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(g,h){if(h){g.setText(lang("collapse"));g.setTooltip(lang("collapseMenuTip"));a.expand(true)}else{g.setText(lang("expand"));g.setTooltip(lang("expandMenuTip"));a.collapse(true);a.firstChild.expand()}}},{text:"导出全部",iconCls:"icon-excel",cls:"btn-blue4",handler:function(){c.openExportExcelWindow("all")}},"->",{handler:function(g,h){a.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]}),listeners:{click:function(g){if(g.disabled){return}c.searchParams.deptId=g.attributes.selfid;c.exportDeptId=g.attributes.selfid;c.countStore.load();Ext.state.Manager.set("CNOA_main_job_index_treeState",g.getPath())}}})},getcountPanel:function(){var d=this,b=Ext.id();ID_actual=Ext.id();fields=[{name:"id"},{name:"cid"},{name:"uid"},{name:"year"},{name:"jan"},{name:"feb"},{name:"mar"},{name:"apr"},{name:"may"},{name:"jun"},{name:"jul"},{name:"aug"},{name:"sept"},{name:"oct"},{name:"nov"},{name:"dec"},{name:"count"},{name:"salStatus"},{name:"truename"},{name:"dept"},{name:"isInSure"},{name:"reason"},{name:"shouldPay"},{name:"actualPay"}];var g=function(l,j,h){var k=h.data,i=k.salStatus;return i};var a=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"uid",dataIndex:"uid",hidden:true},{header:"姓名",dataIndex:"truename",width:80,sortable:true},{header:"所在部门",dataIndex:"dept"},{header:"状态",dataIndex:"salStatus",renderer:g,width:80},{header:"年份",dataIndex:"year",width:80},{header:"一月",dataIndex:"jan",width:80},{header:"二月",dataIndex:"feb",width:80},{header:"三月",dataIndex:"mar",width:80},{header:"四月",dataIndex:"apr",width:80},{header:"五月",dataIndex:"may",width:80},{header:"六月",dataIndex:"jun",width:80},{header:"七月",dataIndex:"jul",width:80},{header:"八月",dataIndex:"aug",width:80},{header:"九月",dataIndex:"sept",width:80},{header:"十月",dataIndex:"oct",width:80},{header:"十一月",dataIndex:"nov",width:80},{header:"十二月",dataIndex:"dec",width:80},{header:"总计",dataIndex:"count",width:80}]});this.countStore=new Ext.data.Store({autoLoad:true,baseParams:d.searchParams,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getcountJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields}),listeners:{load:function(l,i,k){var h=l.reader.jsonData;var j=h.top}}});var f=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:d.countStore,pageSize:15});var e=new Ext.form.TextField({width:100});this.select_date=new Ext.form.ComboBox({store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getYear"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"value"}]})}),maxHeight:160,width:80,name:"date",value:new Date().getFullYear(),valueField:"value",displayField:"value",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(k,h,i){var j=k.value;d.searchParams.date=d.select_date.getValue();d.searchParams.isSearch="search";d.countStore.load()}}}),this.topPanel=new Ext.form.FormPanel({layout:"table",border:false,labelWidth:100,labelAlign:"right",hideBorders:true,layoutConfig:{columns:3},defaults:{layout:"form",width:250,defaults:{width:100,readOnly:true,style:"text-align:center; font-weight: bold; color:#119911;"}}});var c=new Ext.grid.GridPanel({region:"center",store:d.countStore,cm:a,loadMask:{msg:lang("waiting")},bbar:f,listeners:{afterrender:function(){d.topPanel.render(this.tbar)}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.countStore.reload()}},"姓名：",e,"年份：",this.select_date,{text:lang("search"),handler:function(){d.searchParams.truename=e.getValue();d.searchParams.date=d.select_date.getValue();d.searchParams.isSearch="search";d.countStore.load()}},{text:lang("clear"),handler:function(){e.setValue("");d.searchParams.truename="";d.searchParams.status="";d.searchParams.salary="";d.searchParams.isSearch="clear";d.countStore.load()}},{text:"应发",id:b,width:40,cls:"btn-green1",handler:function(){d.searchParams.salary=1;d.searchParams.isSearch="search";d.countStore.load()}},{text:"实发",id:ID_actual,width:40,cls:"btn-yellow1",handler:function(){d.searchParams.salary=2;d.searchParams.isSearch="search";d.countStore.load()}},{text:lang("export2"),iconCls:"icon-excel",tooltip:lang("exportExcel"),cls:"btn-blue3",handler:function(h,i){d.openExportExcelWindow()}}]})});return c},openExportExcelWindow:function(b){var c=this;if(b!="all"){b="dept"}else{c.exportDeptId=""}var f=new Ext.form.ComboBox({fieldLabel:"工资年份",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getYear"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"value"}]})}),maxHeight:100,width:80,name:"date",value:c.select_date.getValue(),valueField:"value",displayField:"value",mode:"local",triggerAction:"all",forceSelection:true,editable:false});var d=function(g){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=salaryCountExportExcel&step=1",waitMsg:lang("waiting"),method:"POST",params:{date:g,deptId:c.exportDeptId,act:b},success:function(h,j){var i=c.exportDeptId;ajaxDownload(c.baseUrl+"&task=salaryCountExportExcel&file="+j.result.msg+"&step=2&date="+g+"&value="+i)},failure:function(h,i){CNOA.msg.alert(i.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:100,items:[f]});var e=new Ext.Window({width:300,height:130,title:"导出薪酬详细",resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),cls:"btn-blue4",iconCls:"icon-excel",handler:function(){var g=f.getRawValue();if(g==""){CNOA.msg.alert(lang("pleaseSelectDateExport"))}else{d(g)}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){e.close()}}]}).show()}};var CNOA_salary_manage_mysalaryClass,CNOA_salary_manage_mysalary;CNOA_salary_manage_mysalaryClass=CNOA.Class.create();CNOA_salary_manage_mysalaryClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=salary&func=manage&action=mysalary";this.mysalaryPanel=a.getMySalaryPanel();this.myWealPanel=a.getMyWealPanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.mysalaryPanel,this.myWealPanel]})},getMySalaryPanel:function(){var e=this;var a=[{name:"id"},{name:"uid"},{name:"truename"},{name:"isInSure"},{name:"dept"},{name:"date"},{name:"shouldPay"},{name:"reason"},{name:"actualPay"}];var c=function(n,m,k){var i=k.data,l=i.uid,h=i.date,g=i.id,j=i.reason,o=i.isInSure;n="<a href='javascript:void(0);' class='gridview' onclick=CNOA_salary_manage_mysalary.mysalarySalaryWin('"+h+"')>查看详细</a>";if(o=="1"){n+="已确认"}else{if(o=="2"){n+="不同意";n+='<img src=/resources/images/icons/message.gif ext:qtip="'+j+'">'}else{n+="<a href='javascript:void(0);' class='gridview jianju' onclick=CNOA_salary_manage_mysalary.optIsInSure("+g+")>确认</a>";n+="<a href='javascript:void(0);' class='gridview3 jianju' onclick=CNOA_salary_manage_mysalary.optNotInSure("+g+")>不同意</a>"}}return n};var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),f,{header:"姓名",dataIndex:"truename"},{header:"所在部门",dataIndex:"dept"},{header:"日期",dataIndex:"date"},{header:"应发工资",dataIndex:"shouldPay"},{header:"实发工资",dataIndex:"actualPay"},{header:"操作",dataIndex:"opt",renderer:c,width:140}]});this.mysalaryStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getMysalaryJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var d=new Ext.grid.GridPanel({title:"我的薪酬",region:"center",store:e.mysalaryStore,cm:b,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.mysalaryStore.reload()}}]})});return d},getMyWealPanel:function(){var d=this;var a=[{name:"wid"},{name:"tuid"},{name:"title"},{name:"content"}];var e=new Ext.ux.grid.RowExpander({tpl:new Ext.Template("<div style='padding: 10px 0px 10px 25px; background-color: #FFF8DC'>","<b>添加人</b>: {tuid}<br>","<b>标题</b>: {title}<br>","<b>内容</b>: {content}<br>","</div>")});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[e,{header:"wid",dataIndex:"wid",hidden:true},{header:"添加人",dataIndex:"tuid",width:100},{header:lang("title"),dataIndex:"title",width:300},{header:"内容",dataIndex:"content",width:600}]});this.myWealStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getMyWealData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var c=new Ext.grid.GridPanel({title:"我的福利",region:"center",plugins:e,store:d.myWealStore,bodyStyle:"border-left-width:1px;",cm:b,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.myWealStore.reload()}}]})});return c},mysalarySalaryWin:function(a){var b=this;window.open(b.baseUrl+"&task=getOneMysalary&date="+a,"noticept","width=450, height="+(screen.availHeight-430)+",left="+((screen.availWidth-760)/2)+",top=200,scrollbars=yes,resizable=yes,status=no")},optIsInSure:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=optIsInSure",params:{id:b},success:function(c){var d=Ext.decode(c.responseText);CNOA.msg.alert(d.msg);a.mysalaryStore.reload()}})},optNotInSure:function(e){var b=this;var c=function(){var g=a.getForm();if(g.isValid()){g.submit({url:b.baseUrl+"&task=addReason",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{id:e},success:function(f,h){d.close();b.mysalaryStore.reload()},failure:function(f,h){CNOA.msg.alert(h.result.msg)}})}};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:10,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"label",text:"请说明不同意理由："},{xtype:"textarea",width:330,height:160,maxLength:255,name:"explain",style:"margin: 20px 0 0 0;"}]});var d=new Ext.Window({width:400,height:300,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:lang("explainSituation"),layout:"fit",items:[a],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){c()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()}};var sm_salary_salary=1;
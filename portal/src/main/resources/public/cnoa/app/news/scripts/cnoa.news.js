var CNOA_news_news_readClass,CNOA_news_news_read;CNOA_news_news_readClass=CNOA.Class.create();CNOA_news_news_readClass.prototype={init:function(){var a=this;this.edit_id=0;this.sort=0;this.baseUrl="index.php?app=news&func=news&action=read";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_tree_treeRoot=Ext.id();this.search={sort:0,poster:0,title:"",stime:0,etime:0};this.ID_Search_sort=Ext.id();this.ID_Search_poster=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_sort=Ext.id();this.fields=[{name:"lid"},{name:"title"},{name:"sname"},{name:"posttime"},{name:"user"},{name:"status"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,e,d){var b=Ext.decode(e.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("title"),dataIndex:"title",width:300,sortable:true,menuDisabled:true,renderer:this.makeTitle.createDelegate(this)},{header:lang("lanmu"),dataIndex:"sname",width:110,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"user",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"lid",width:60,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(b,d){d.sort=a.sort;if(a.search.sort!=""){d.sort=a.search.sort}if(a.search.poster!=""){d.poster=a.search.poster}if(a.search.title!=""){d.title=a.search.title}if(a.search.stime!=""){d.stime=a.search.stime}if(a.search.etime!=""){d.etime=a.search.etime}}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true,border:false,region:"center",stripeRows:true,listeners:{cellclick:function(d,h,f,g){if((f==3)||(f==7)){var b=d.getStore().getAt(h);a.view(b.data.lid)}}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("articlesList"),{handler:function(b,d){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},"->",{xtype:"cnoa_helpBtn",helpid:39}]}),bbar:this.pagingBar});this.searchSortComboStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList&type=combo"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["sid","name"]})});this.searchSortCombo=new Ext.form.ComboBox({store:this.searchSortComboStore,id:this.ID_Search_sort,displayField:"name",hiddenName:"sid",valueField:"sid",typeAhead:true,width:130,triggerAction:"all",forceSelection:true,editable:false});this.gridCt=new Ext.Panel({border:false,layout:"fit",region:"center",items:[this.grid],listeners:{afterrender:function(){new Ext.Toolbar({renderTo:this.tabr,style:"border-left-width:1px;",items:[lang("posttime2"),{xtype:"datefield",format:"Y-m-d",id:a.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:a.ID_Search_etime,format:"Y-m-d",width:100},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]}).render(this.tbar)}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("inColumns"),this.searchSortCombo,lang("postter"),{xtype:"hidden",id:this.ID_Search_poster},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTreeAll",width:100,id:this.ID_Search_poster+"Tr",listeners:{selected:function(e,d,b){Ext.getCmp(a.ID_Search_poster).setValue(d)}}},(lang("title")+":"),{xtype:"textfield",id:this.ID_Search_title,width:168}]})});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allColumns"),sid:"0",iconCls:"icon-tree-root-cnoa",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){a.sortTree.selectPath(a.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.resetSearchBar();a.sort=b.attributes.sid;a.store.load({params:{sort:a.sort}})}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:140,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(b,d){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",lang("wzColumns")]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.gridCt,this.sortPanel]})},makeTitle:function(a){return'<span style="cursor:pointer">'+a+"</span>"},makeOperate:function(g,e,a,i,d,f){var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_news_read.view("+g+");'>"+lang("view")+"</a>";return b},closeTab:function(){mainPanel.closeTab(CNOA.news.news.postIndex.parentID.replace("docs-",""))},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VIEW");mainPanel.loadClass("index.php?app=news&func=news&action=view&task=view&lid="+a,"CNOA_MENU_NEWS_VIEW",lang("viewMsg"),"icon-page-view")},doSearch:function(){var a=this;a.search.poster=Ext.getCmp(a.ID_Search_poster).getValue();a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.sort=Ext.getCmp(a.ID_Search_sort).getValue();a.store.load({params:{poster:a.search.poster,title:a.search.title,stime:a.search.stime,etime:a.search.etime,sort:a.search.sort}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort};a.store.load({params:{sort:a.sort}})},resetSearchBar:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort}}};var CNOA_news_news_manageIndexClass,CNOA_news_news_manageIndex;CNOA_news_news_manageIndexClass=CNOA.Class.create();CNOA_news_news_manageIndexClass.prototype={init:function(){var a=this;this.edit_id=0;this.sort=0;this.baseUrl="index.php?app=news&func=news&action=manage";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_tree_treeRoot=Ext.id();this.search={sort:0,poster:0,title:"",stime:0,etime:0};this.ID_Search_sort=Ext.id();this.ID_Search_poster=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_sort=Ext.id();this.fields=[{name:"lid"},{name:"title"},{name:"sname"},{name:"posttime"},{name:"user"},{name:"status"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,e,d){var b=Ext.decode(e.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("title"),dataIndex:"title",width:300,sortable:true,menuDisabled:true,renderer:this.makeTitle.createDelegate(this)},{header:lang("lanmu"),dataIndex:"sname",width:110,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"user",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"lid",width:60,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:lang("status"),dataIndex:"status",width:60,sortable:false,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("approval"),dataIndex:"lid",width:100,sortable:false,menuDisabled:true,renderer:this.checkInfo.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(b,d){d.sort=a.sort;if(a.search.sort!=""){d.sort=a.search.sort}if(a.search.poster!=""){d.poster=a.search.poster}if(a.search.title!=""){d.title=a.search.title}if(a.search.stime!=""){d.stime=a.search.stime}if(a.search.etime!=""){d.etime=a.search.etime}}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,region:"center",listeners:{cellclick:function(d,h,f,g){if((f==3)||(f==7)){var b=d.getStore().getAt(h);a.view(b.data.lid)}}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("articlesList")+":&nbsp;",{handler:function(b,d){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("del"),iconCls:"icon-utils-s-delete",id:this.ID_btn_delete,handler:function(d,e){var f=this.grid.getSelectionModel().getSelections();if(f.length==0){var b=Ext.getCmp(this.ID_btn_delete).getEl().getBox();b=[b.x+12,b.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),b)}else{CNOA.msg.cf(lang("confirmToDelete"),function(h){if(h=="yes"){if(f){var j="";for(var g=0;g<f.length;g++){j+=f[g].get("lid")+","}CNOA_news_news_manageIndex.deleteList(j)}}})}}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:39}]}),bbar:this.pagingBar});this.searchSortComboStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList&type=combo"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["sid","name"]})});this.searchSortCombo=new Ext.form.ComboBox({store:this.searchSortComboStore,id:this.ID_Search_sort,displayField:"name",hiddenName:"sid",valueField:"sid",typeAhead:true,width:130,triggerAction:"all",forceSelection:true,editable:false});this.gridCt=new Ext.Panel({border:false,layout:"fit",region:"center",items:[this.grid],listeners:{afterrender:function(){new Ext.Toolbar({renderTo:this.tabr,style:"border-left-width:1px;",items:[lang("posttime2")+":",{xtype:"datefield",format:"Y-m-d",id:a.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:a.ID_Search_etime,format:"Y-m-d",width:100},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]}).render(this.tbar)}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("inColumns")+":",this.searchSortCombo,lang("postter")+":",{xtype:"hidden",id:this.ID_Search_poster},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTreeAll",width:100,id:this.ID_Search_poster+"Tr",listeners:{selected:function(e,d,b){Ext.getCmp(a.ID_Search_poster).setValue(d)}}},(lang("title")+":"),{xtype:"textfield",id:this.ID_Search_title,width:168}]})});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allColumns"),sid:"0",iconCls:"icon-tree-root-cnoa",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){a.sortTree.selectPath(a.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.resetSearchBar();a.sort=b.attributes.sid;a.store.load({params:{sort:a.sort}})}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:140,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(b,d){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",lang("wzColumns")]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.gridCt,this.sortPanel]})},checkInfo:function(j,g,e,i,f,a){var k=e.data;var b=k.status;if(b==0){var d="<a class='gridview3' href='javascript:void(0);' onclick='CNOA_news_news_manageIndex.setpass("+j+",1);'>"+lang("pass")+"</a>"}else{if(b==1){var d="<a class='gridview2' href='javascript:void(0);' onclick='CNOA_news_news_manageIndex.setpass("+j+",0);'>"+lang("unPass")+"</a>"}else{var d="<a class='gridview3' href='javascript:void(0);' onclick='CNOA_news_news_manageIndex.setpass("+j+",1);'>"+lang("pass")+"</a>";d+="<a class='gridview2 jianju' href='javascript:void(0);' onclick='CNOA_news_news_manageIndex.setpass("+j+",0);'>"+lang("unPass")+"</a>"}}return d},setpass:function(b,a){Ext.Ajax.request({url:this.baseUrl+"&task=setPass",method:"POST",params:{lid:b,type:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA_news_news_manageIndex.store.reload()}else{CNOA.msg.alert(d.msg)}}})},makeTitle:function(a){return'<span style="cursor:pointer">'+a+"</span>"},makeOperate:function(g,e,a,i,d,f){var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_news_manageIndex.view("+g+");'>"+lang("view")+"</a>";return b},makeStatus:function(f,d,a,g,b,e){if(f==1){return"<font color='#2EB800'>"+lang("pass")+"</font>"}else{if(f==0){return"<font color='#ff0000'>"+lang("unPass")+"</font>"}else{return lang("pendingTrial")}}},deleteList:function(a){Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){CNOA.msg.alert(b.msg,function(){CNOA_news_news_manageIndex.store.reload()})}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.news.news.postIndex.parentID.replace("docs-",""))},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VIEW");mainPanel.loadClass("index.php?app=news&func=news&action=view&task=view&lid="+a,"CNOA_MENU_NEWS_VIEW",lang("viewMsg"),"icon-page-view")},doSearch:function(){var a=this;a.search.poster=Ext.getCmp(a.ID_Search_poster).getValue();a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.sort=Ext.getCmp(a.ID_Search_sort).getValue();a.store.load({params:{poster:a.search.poster,title:a.search.title,stime:a.search.stime,etime:a.search.etime,sort:a.search.sort}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort};a.store.load({params:{sort:a.sort}})},resetSearchBar:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort}}};var CNOA_news_news_postIndexClass,CNOA_news_news_postIndex;var CNOA_news_news_postIndex_addEditClass,CNOA_news_news_postIndex_addEdit;CNOA_news_news_postIndex_addEditClass=CNOA.Class.create();CNOA_news_news_postIndex_addEditClass.prototype={init:function(a){var b=this;this.sort=0;this.baseUrl="index.php?app=news&func=news&action=post";this.tp=a=="edit"?"edit":"add";this.title=this.tp=="add"?lang("addArticle"):lang("editArticle");this.edit_id=0;this.ID_panel_video=Ext.id();this.sortStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList&type=combo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"sid"},{name:"name"}]}),listeners:{load:function(f,d,e){if(b.sort!=0){b.sortSelector.setValue(b.sort)}Ext.each(d,function(g,h){if(g.json.sid==b.sort){if(g.json.type=="video"){b.addVideoCmp()}else{if(g.json.type=="focus"){b.removeVideoCmp();b.addFocusCmp()}else{if(g.json.type=="html"){b.removeVideoCmp();b.addHtmlThumb()}}}}})}}});this.sortStore.load();this.sortSelector=new Ext.form.ComboBox({store:this.sortStore,valueField:"sid",displayField:"name",hiddenName:"sid",mode:"local",allowBlank:false,width:180,triggerAction:"all",forceSelection:true,editable:false,fieldLabel:lang("inColumns"),listeners:{select:function(g,d,e){var f=d.json.type;if(f=="html"){b.removeVideoCmp();b.addHtmlThumb()}else{if(f=="video"){b.removeVideoCmp();b.addVideoCmp()}else{if(f=="focus"){b.removeVideoCmp();b.addFocusCmp()}}}}}});this.baseField=new Ext.Panel({bodyStyle:"padding:10px;",autoScroll:true,items:[{xtype:"fieldset",title:lang("inColumns"),defaults:{width:255},items:[{xtype:"textfield",width:500,name:"title",fieldLabel:lang("articleTitle"),inputType:"text",allowBlank:false},{xtype:"panel",border:false,autoWidth:true,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"panel",width:372,layout:"form",items:[this.sortSelector]},{xtype:"panel",width:250,layout:"form",items:[{xtype:"textfield",name:"author",readOnly:true,fieldLabel:lang("postter"),inputType:"text",value:CNOA_USER_TRUENAME}]}]},{xtype:"checkbox",fieldLabel:lang("noticeNow"),name:"send_news",checked:false,boxLabel:lang("noticeNowNotice")},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",width:640,inputPre:"filesUpload"},{xtype:"panel",border:false,id:this.ID_panel_video,width:640,layout:"form"},{xtype:"ueditor",toolType:"mini",name:"content",fieldLabel:lang("articleContent"),width:640,height:360}]}]});this.formPanel=new Ext.form.FormPanel({autoScroll:false,border:false,hideBorders:true,labelWidth:70,labelAlign:"right",fileUpload:true,waitMsgTarget:true,items:[this.baseField]});this.mainPanel=new Ext.Window({width:800,height:makeWindowHeight(700),maximizable:true,title:this.title,modal:true,layout:"fit",items:[this.formPanel],buttonAlign:"right",buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:true})}.createDelegate(this)},{text:lang("apply"),id:this.ID_btn_apply,hidden:this.tp=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:false})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){this.mainPanel.show();if(this.tp=="edit"){this.loadFormData()}},close:function(){this.mainPanel.close()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:this.baseUrl+"&task=editLoadFormData",params:{lid:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,d){if(d.result.data.type=="video"){a.addVideoCmp("edit")}if(d.result.data.type=="focus"){a.addFocusCmp("focus")}if(d.result.data.type=="html"){a.addHtmlThumb("html")}},failure:function(b,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}})},submitForm:function(a){var b=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:b.baseUrl+"&task="+b.tp,waitMsg:lang("waiting"),params:{lid:b.edit_id},method:"POST",success:function(d,e){if(a.close){this.close()}CNOA_news_news_postIndex.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}},removeVideoCmp:function(){Ext.getCmp(this.ID_panel_video).removeAll()},addVideoCmp:function(a){Ext.getCmp(this.ID_panel_video).add({xtype:"fileuploadfield",name:"image",allowBlank:a=="edit"?true:false,width:500,blankText:lang("upVieoPicNotice"),regex:/^.*(\.png|\.jpg|\.jpeg|\.gif)$/i,regexText:lang("formatInvaid"),buttonCfg:{text:lang("videoSnapshots")},fieldLabel:lang("videoSnapshots")});Ext.getCmp(this.ID_panel_video).add({xtype:"displayfield",value:"<span class='cnoa_color_gray'>"+lang("picFormat")+": *.png|*.jpg|*.jpeg|*.gif</span>"});Ext.getCmp(this.ID_panel_video).add({xtype:"fileuploadfield",name:"flv",allowBlank:a=="edit"?true:false,width:500,blankText:lang("upVieoNotice"),regex:/^.*(\.flv|\.mp4|\.m4v)$/,regexText:lang("formatInvaid"),buttonCfg:{text:lang("browse")},fieldLabel:lang("videoFile")});Ext.getCmp(this.ID_panel_video).add({xtype:"displayfield",value:"<span class='cnoa_color_gray'>"+lang("videoFormat")+": *.flv|*.mp4|*.m4v</span>"});this.formPanel.doLayout()},addFocusCmp:function(a){var b=this;this.removeVideoCmp();Ext.getCmp(this.ID_panel_video).add({xtype:"fileuploadfield",name:"image",allowBlank:b.tp=="add"?false:true,width:500,blankText:lang("upFocusPic"),regex:/^.*(\.png|\.jpg|\.jpeg|\.gif)$/i,regexText:lang("formatInvaid"),buttonCfg:{text:lang("upFocusPic")},fieldLabel:lang("upFocusPic")});Ext.getCmp(this.ID_panel_video).add({xtype:"displayfield",value:lang("keepBlank")+" <span class='cnoa_color_gray'>"+lang("picFormat")+": *.png|*.jpg|*.jpeg|*.gif, "+lang("bestPicBL")+": 4:3</span>"});this.formPanel.doLayout()},addHtmlThumb:function(a){var b=this;this.removeVideoCmp();Ext.getCmp(this.ID_panel_video).add({xtype:"fileuploadfield",name:"image",width:500,blankText:"请选择要上传的手机缩略图",regex:/^.*(\.png|\.jpg|\.jpeg|\.gif)$/i,regexText:lang("formatInvaid"),buttonCfg:{text:"请选择要上传的手机缩略图"},fieldLabel:"请选择要上传的手机缩略图"});Ext.getCmp(this.ID_panel_video).add({xtype:"displayfield",value:lang("keepBlank")+" <span class='cnoa_color_gray'>"+lang("picFormat")+": *.png|*.jpg|*.jpeg|*.gif, "+lang("bestPicBL")+": 4:3</span>"});this.formPanel.doLayout()}};CNOA_news_news_postIndexClass=CNOA.Class.create();CNOA_news_news_postIndexClass.prototype={init:function(){var d=this;this.edit_id=0;this.sort=0;this.baseUrl="index.php?app=news&func=news&action=post";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_tree_treeRoot=Ext.id();this.search={sort:0,poster:0,title:"",stime:0,etime:0};this.ID_Search_sort=Ext.id();this.ID_Search_poster=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_sort=Ext.id();this.fields=[{name:"lid"},{name:"title"},{name:"sname"},{name:"posttime"},{name:"user"},{name:"status"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(j,i,k,h,g,f){var e=Ext.decode(g.responseText);if(e.failure){CNOA.msg.alert(e.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();var a=function(i,g,e,j,f,h){return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_news_postIndex.view("+i+");'>"+lang("view")+"</a>"};var b=function(i,g,e,j,f,h){if(i==1){return"<font color='#2EB800'>"+lang("pass")+"</font>"}else{if(i==0){return"<font color='#ff0000'>"+lang("unPass")+"</font>"}else{return lang("pendingTrial")}}};this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("title"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("lanmu"),dataIndex:"sname",width:110,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"user",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"lid",width:60,sortable:false,menuDisabled:true,renderer:a},{header:lang("status"),dataIndex:"status",width:60,sortable:false,menuDisabled:true,renderer:b},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(e,f){f.sort=d.sort;if(d.search.sort!=""){f.sort=d.search.sort}if(d.search.poster!=""){f.poster=d.search.poster}if(d.search.title!=""){f.title=d.search.title}if(d.search.stime!=""){f.stime=d.search.stime}if(d.search.etime!=""){f.etime=d.search.etime}}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,region:"center",tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("articlesList")+": ",{handler:function(e,f){d.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(e,f){CNOA_news_news_postIndex_addedit=new CNOA_news_news_postIndex_addEditClass("add");CNOA_news_news_postIndex_addedit.sort=d.sort;CNOA_news_news_postIndex_addedit.show()}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{id:this.ID_btn_edit,handler:function(e,f){d.editPanel()},iconCls:"icon-utils-s-edit",text:lang("modify")},{text:lang("del"),iconCls:"icon-utils-s-delete",id:this.ID_btn_delete,handler:function(f,g){var h=this.grid.getSelectionModel().getSelections();if(h.length==0){var e=Ext.getCmp(this.ID_btn_delete).getEl().getBox();e=[e.x+12,e.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),e)}else{CNOA.msg.cf(lang("confirmToDelete"),function(k){if(k=="yes"){if(h){var l="";for(var j=0;j<h.length;j++){l+=h[j].get("lid")+","}CNOA_news_news_postIndex.deleteList(l)}}})}}.createDelegate(this)},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:1}]}),bbar:this.pagingBar});this.searchSortComboStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList&type=combo"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["sid","name"]})});this.searchSortCombo=new Ext.form.ComboBox({store:this.searchSortComboStore,id:this.ID_Search_sort,displayField:"name",hiddenName:"sid",valueField:"sid",typeAhead:true,width:130,triggerAction:"all",forceSelection:true,editable:false});this.select_user=new Ext.form.SelectorForm({width:80,hiddenName:"uid",multiselect:false,selectorType:"user"});this.gridCt=new Ext.Panel({border:false,layout:"fit",region:"center",items:[this.grid],listeners:{afterrender:function(){new Ext.Toolbar({renderTo:this.tabr,style:"border-left-width:1px;",items:[lang("posttime2")+":",{xtype:"datefield",format:"Y-m-d",id:d.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:d.ID_Search_etime,format:"Y-m-d",width:100},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){d.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){d.resetSearch()}}]}).render(this.tbar)}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("inColumns")+":",this.searchSortCombo,lang("postter")+":",this.select_user,(lang("title")+":"),{xtype:"textfield",id:this.ID_Search_title,width:168}]})});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allColumns"),sid:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(e){d.sort=e.attributes.sid;d.store.load({params:{sort:d.sort}});d.resetSearchBar()}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:140,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(e,f){d.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",lang("wzColumns")]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.gridCt,this.sortPanel]})},editPanel:function(){var d=this;var b=d.grid.getSelectionModel().getSelections();if(b.length==0){var a=Ext.getCmp(d.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{CNOA_news_news_postIndex_addEdit=new CNOA_news_news_postIndex_addEditClass("edit");CNOA_news_news_postIndex_addEdit.edit_id=b[0].get("lid");CNOA_news_news_postIndex_addEdit.show()}},deleteList:function(a){Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){CNOA.msg.alert(b.msg,function(){CNOA_news_news_postIndex.store.reload()})}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.news.news.postIndex.parentID.replace("docs-",""))},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VIEW");mainPanel.loadClass("index.php?app=news&func=news&action=view&task=view&lid="+a,"CNOA_MENU_NEWS_VIEW",lang("viewMsg"),"icon-page-view")},doSearch:function(){var a=this;a.search.poster=a.select_user.getValue();a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.sort=Ext.getCmp(a.ID_Search_sort).getValue();a.store.load({params:{poster:a.search.poster,title:a.search.title,stime:a.search.stime,etime:a.search.etime,sort:a.search.sort}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");a.select_user.setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort};a.store.load({params:{sort:a.sort}})},resetSearchBar:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");a.select_user.setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort}}};var CNOA_news_news_settingIndexClass,CNOA_news_news_settingIndex;var CNOA_news_news_settingIndex_addEditClass,CNOA_news_news_settingIndex_addEdit;var CNOA_news_news_settingIndex_desktopClass,CNOA_news_news_settingIndex_desktop;CNOA_news_news_settingIndex_addEditClass=CNOA.Class.create();CNOA_news_news_settingIndex_addEditClass.prototype={init:function(f){var h=this;this.baseUrl="index.php?app=news&func=news&action=setting";this.tp=f=="edit"?"edit":"add";this.edit_id=0;this.ID_panel_showdesktop=Ext.id();this.ID_panel_showdesktop2=Ext.id();var d=Ext.id();var a=Ext.id();var b=Ext.id();var g=Ext.id();var e=Ext.id();this.baseField=new Ext.Panel({padding:10,items:[{xtype:"fieldset",title:lang("columnInfo"),defaults:{width:255},items:[{xtype:"checkbox",name:"show",fieldLabel:lang("isEnable"),checked:true},{xtype:"textfield",name:"name",fieldLabel:lang("columnName"),inputType:"text",allowBlank:false},{xtype:"radiogroup",fieldLabel:lang("columnType"),width:200,name:"typeGroup",items:[{boxLabel:lang("graphicColumn"),name:"type",inputValue:"html",checked:true},{boxLabel:lang("videoProgram"),name:"type",inputValue:"video"},{boxLabel:lang("focusPic"),name:"type",inputValue:"focus"}]},{xtype:"textarea",width:448,height:50,name:"about",fieldLabel:lang("remark"),inputType:"text"},{xtype:"checkbox",name:"allowcomment",checked:true,fieldLabel:lang("articleAllowComment")},{xtype:"checkbox",name:"needcheck",fieldLabel:lang("youNeedReview")},{xtype:"checkbox",name:"fsIsDownload",checked:true,fieldLabel:lang("fsAllowDownload")}]},{xtype:"fieldset",title:lang("viewPermit"),defaults:{width:448},items:[{xtype:"textarea",fieldLabel:lang("tdcv"),emptyText:lang("clickToSelect"),readOnly:true,name:"viewDepNames",listeners:{render:function(i){i.to=a},focus:function(i){people_selector("dept",i,true,false)}}},{xtype:"hidden",name:"viewDids",id:a},{xtype:"textarea",fieldLabel:lang("peopleToView"),emptyText:lang("clickToSelect"),readOnly:true,name:"viewUserNames",listeners:{render:function(i){i.to=d},focus:function(i){people_selector("user",i,true,false)}}},{xtype:"hidden",name:"viewUids",id:d},{xtype:"box",autoEl:{tag:"div",style:"margin-left:80px;margin-top:10px;margin-bottom:15px;color:#676767;",html:lang("defaultToAll")}}]},{xtype:"fieldset",title:lang("postPermit"),defaults:{width:448},items:[{xtype:"textarea",fieldLabel:lang("deptToPost"),emptyText:lang("clickToSelect"),readOnly:true,name:"releaseDepNames",listeners:{render:function(i){i.to=e},focus:function(i){people_selector("dept",i,true,false)}}},{xtype:"hidden",name:"releaseDids",id:e},{xtype:"textarea",fieldLabel:lang("posters"),emptyText:lang("clickToSelect"),readOnly:true,name:"releaseUserNames",listeners:{render:function(i){i.to=g},focus:function(i){people_selector("user",i,true,false)}}},{xtype:"hidden",name:"releaseUids",id:g},{xtype:"box",autoEl:{tag:"div",style:"margin-left:80px;margin-top:10px;margin-bottom:15px;color:#676767;",html:lang("defaultToAll")}}]},{xtype:"fieldset",title:lang("permit4Mgr"),defaults:{width:448},items:[{xtype:"textarea",fieldLabel:lang("manager"),readOnly:true,name:"manageUserNames",listeners:{render:function(i){i.to=b},focus:function(i){people_selector("user",i,true,false)}}},{xtype:"hidden",name:"manageUids",id:b},{xtype:"box",autoEl:{tag:"div",style:"margin-left:80px;margin-top:10px;margin-bottom:15px;color:#676767;",html:lang("defaultToAll")}}]}]});this.formPanel=new Ext.form.FormPanel({region:"center",border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,autoScroll:true,items:[this.baseField]});this.mainPanel=new Ext.Window({width:600,height:makeWindowHeight(564),title:lang("columnAttr"),resizable:false,modal:true,layout:"border",items:[this.formPanel],buttonAlign:"right",buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:true})}.createDelegate(this)},{text:lang("apply"),id:this.ID_btn_apply,hidden:this.tp=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:false})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){this.mainPanel.show();if(this.tp=="edit"){this.loadFormData()}},close:function(){this.mainPanel.close()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:this.baseUrl+"&task=editLoadFormData",params:{sid:a.edit_id},method:"POST",waitMsg:lang("waiting"),success:function(b,d){}.createDelegate(this),failure:function(b,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}.createDelegate(this)})},submitForm:function(a){var b=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:b.baseUrl+"&task="+b.tp,waitMsg:lang("waiting"),params:{sid:this.edit_id},method:"POST",success:function(d,e){if(a.close){this.close()}CNOA_news_news_settingIndex.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}}};CNOA_news_news_settingIndex_desktopClass=CNOA.Class.create();CNOA_news_news_settingIndex_desktopClass.prototype={init:function(b,d,a){var e=this;this.baseUrl="index.php?app=news&func=news&action=setting";this.edit_id=b;this.type=d;this.desktopvodid=a;this.ID_panel_showdesktop=Ext.id();if(this.type=="html"){this.settingCmp={xtype:"textfield",name:"desktopnum",vtype:"num",vtypeText:lang("onlyNum"),fieldLabel:lang("showCount")}}else{if(this.type=="video"){this.videoListStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=desktopSetting&job=loadVideoList&sid="+this.edit_id,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"desktopvodid",mapping:"lid"},{name:"title"}]}),listeners:{load:function(){if(e.desktopvodid!==0){e.settingCmp.setValue(e.desktopvodid)}else{e.settingCmp.clearValue()}}}});this.videoListStore.load();this.settingCmp=new Ext.form.ComboBox({store:this.videoListStore,valueField:"desktopvodid",displayField:"title",hiddenName:"desktopvodid",mode:"local",allowBlank:false,width:336,triggerAction:"all",forceSelection:true,editable:false,fieldLabel:lang("showVideo")})}else{if(this.type=="focus"){this.focusSm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.focusStore=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getFocusList&sid="+e.edit_id,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"title"},{name:"order"},{name:"lid"}]}),listeners:{load:function(){e.settingCmp.doLayout()},update:function(i,f,h){var g=f.data;if(h==Ext.data.Record.EDIT){Ext.Ajax.request({url:e.baseUrl+"&task=submitFocusList",method:"POST",params:g,success:function(k){var j=Ext.decode(k.responseText);if(j.success===true){CNOA.msg.notice2(j.msg);e.focusStore.reload()}else{CNOA.msg.alert(j.msg,function(){})}}})}}}});this.editor=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});this.focusColModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.focusSm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("title"),dataIndex:"title",width:200,sortable:true,menuDisabled:true},{header:lang("order"),dataIndex:"order",width:110,sortable:false,menuDisabled:true,editor:{xtype:"textfield",allowBlank:false}},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.focusStore.load();this.settingCmp=new Ext.grid.GridPanel({store:this.focusStore,loadMask:{msg:lang("waiting")},cm:this.focusColModel,sm:this.focusSm,plugins:[this.editor],stripeRows:true,border:true,height:150,view:new Ext.grid.GroupingView({markDirty:false})})}}}this.baseField=new Ext.Panel({padding:10,items:[{xtype:"fieldset",title:lang("whetherShowInHomePage"),items:[{xtype:"checkbox",name:"desktop",width:255,fieldLabel:lang("show"),listeners:{check:function(g,f){if(f){Ext.getCmp(e.ID_panel_showdesktop).show()}else{Ext.getCmp(e.ID_panel_showdesktop).hide()}}}},{xtype:"panel",border:false,hidden:true,width:420,layout:this.type=="focus"?"":"form",id:this.ID_panel_showdesktop,items:[this.settingCmp]}]},{xtype:"displayfield",hidden:this.type=="focus"?false:true,value:lang("zeroNotShowInHomePage")},{xtype:"displayfield",value:lang("optShowInHomePage")}]});this.formPanel=new Ext.form.FormPanel({region:"center",border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,items:[this.baseField]});this.mainPanel=new Ext.Window({width:475,height:365,title:lang("columnSetInHomePage"),resizable:false,modal:true,layout:"border",items:[this.formPanel],buttonAlign:"right",buttons:[{text:lang("save"),id:this.ID_btn_save,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:true})}.createDelegate(this)},{text:lang("apply"),id:this.ID_btn_apply,hidden:this.tp=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){this.submitForm({close:false})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){this.mainPanel.show();this.loadFormData()},close:function(){this.mainPanel.close()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:this.baseUrl+"&task=editLoadFormData",params:{sid:a.edit_id,type:a.type},method:"POST",waitMsg:lang("waiting"),success:function(b,d){}.createDelegate(this),failure:function(b,d){CNOA.msg.alert(d.result.msg,function(){a.close()})}.createDelegate(this)})},submitForm:function(a){var b=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:b.baseUrl+"&task=desktopSetting",waitMsg:lang("waiting"),params:{sid:this.edit_id},method:"POST",success:function(d,e){if(a.close){this.close()}else{}CNOA_news_news_settingIndex.store.reload()}.createDelegate(this),failure:function(d,e){CNOA.msg.alert(e.result.msg)}.createDelegate(this)})}}};CNOA_news_news_settingIndexClass=CNOA.Class.create();CNOA_news_news_settingIndexClass.prototype={init:function(){var a=this;this.edit_id=0;this.baseUrl="index.php?app=news&func=news&action=setting";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.fields=[{name:"sid"},{name:"name"},{name:"show"},{name:"desktop"},{name:"allowcomment"},{name:"type"},{name:"desktopvodid"},{name:"needcheck"},{name:"fsIsDownload"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true});this.store.load();this.colModel=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[this.sm,{header:"sid",dataIndex:"sid",hidden:true},{header:lang("columnName"),dataIndex:"name",width:190,sortable:true},{header:lang("columnType"),dataIndex:"type",width:70,sortable:true,renderer:this.makeType},{header:lang("isEnable"),dataIndex:"show",width:70,renderer:this.makeBoolen},{header:lang("showInDesktop"),dataIndex:"desktop",width:70,renderer:this.makeBoolen},{header:lang("allowComment"),dataIndex:"allowcomment",width:60,renderer:this.makeBoolen},{header:lang("needAudit"),dataIndex:"needcheck",width:100,renderer:this.makeBoolen},{header:lang("fsAllowDownload"),dataIndex:"fsIsDownload",width:120,renderer:this.makeBoolen},{header:lang("opt"),dataIndex:"",width:180,renderer:this.makeOperate},{header:"",dataIndex:"noIndex",width:1,resizable:false}]});this.grid=new Ext.grid.GridPanel({store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,region:"center",listeners:{rowdblclick:function(b,g,f){var d=b.getSelectionModel().getSelections();CNOA_news_news_settingIndex_addEdit=new CNOA_news_news_settingIndex_addEditClass("edit");CNOA_news_news_settingIndex_addEdit.edit_id=d[0].get("sid");CNOA_news_news_settingIndex_addEdit.show()}},tbar:new Ext.Toolbar({items:[{handler:function(b,d){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(b,d){CNOA_news_news_settingIndex_addEdit=new CNOA_news_news_settingIndex_addEditClass("add");CNOA_news_news_settingIndex_addEdit.show()}.createDelegate(this),iconCls:"icon-utils-s-add",text:lang("add")},{id:this.ID_btn_edit,handler:function(b,d){this.editPanel()}.createDelegate(this),iconCls:"icon-utils-s-edit",text:lang("modify")},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>"),"->",{xtype:"cnoa_helpBtn",helpid:40}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},makeBoolen:function(f,d,a,i,b,e){var h="";var g="";if(f==1){h=lang("yes");g="green"}else{h=lang("no");g="red"}return"<span style='color:"+g+"'>"+h+"</span>"},makeType:function(f,d,a,h,b,e){var g="";if(f=="html"){g=lang("graphicColumn");c="green"}else{if(f=="video"){g=lang("videoProgram");c="red"}else{if(f=="focus"){g=lang("focusPic");c="blue"}}}return"<span style='color:"+c+"'>"+g+"</span>"},makeOperate:function(i,f,a,j,d,g){var e=a.data;var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_news_settingIndex.editPanel("+e.sid+");'>"+lang("set2")+"</a>";b+="<a href='javascript:void(0);' class='gridview2 jianju' onclick='CNOA_news_news_settingIndex.desktopSettingPanel("+e.sid+', "'+e.type+'", '+e.desktopvodid+");'>"+lang("showInDesktop")+"</a>";b+="<a href='javascript:void(0);' class='gridview3 jianju' onclick='CNOA_news_news_settingIndex.deletecf("+e.sid+");'>"+lang("del")+"</a>";return b},editPanel:function(b){var e=this;if(b!=undefined){CNOA_news_news_settingIndex_addEdit=new CNOA_news_news_settingIndex_addEditClass("edit");CNOA_news_news_settingIndex_addEdit.edit_id=b;CNOA_news_news_settingIndex_addEdit.show();return null}var d=e.grid.getSelectionModel().getSelections();if(d.length==0){var a=Ext.getCmp(e.ID_btn_edit).getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(lang("mustSelectOneRow"),a)}else{CNOA_news_news_settingIndex_addEdit=new CNOA_news_news_settingIndex_addEditClass("edit");CNOA_news_news_settingIndex_addEdit.edit_id=d[0].get("sid");CNOA_news_news_settingIndex_addEdit.show()}},desktopSettingPanel:function(b,d,a){var e=this;CNOA_news_news_settingIndex_desktop=new CNOA_news_news_settingIndex_desktopClass(b,d,a);CNOA_news_news_settingIndex_desktop.show()},deletecf:function(a){var b=this;CNOA.msg.cf(lang("delNoticeNotice"),function(d){if(d=="yes"){b.deleteList(a)}})},deleteList:function(a){Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{sid:a},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){CNOA.msg.alert(b.msg,function(){CNOA_news_news_settingIndex.store.reload()})}else{CNOA.msg.alert(b.msg)}}})}};var CNOA_news_news_sortlistClass,CNOA_news_news_sortlist;CNOA_news_news_sortlistClass=CNOA.Class.create();CNOA_news_news_sortlistClass.prototype={init:function(){var a=this;this.edit_id=0;this.sort=0;this.baseUrl="index.php?app=news&func=news&action=view";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_tree_treeRoot=Ext.id();this.search={sort:0,poster:0,title:"",stime:0,etime:0};this.ID_Search_sort=Ext.id();this.ID_Search_poster=Ext.id();this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_sort=Ext.id();this.fields=[{name:"lid"},{name:"title"},{name:"sname"},{name:"posttime"},{name:"user"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,e,d){var b=Ext.decode(e.responseText);if(b.failure){CNOA.msg.alert(b.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"lid",dataIndex:"lid",hidden:true},{header:lang("title"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("lanmu"),dataIndex:"sname",width:110,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"user",width:120,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"lid",width:60,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,style:"border-left-width:1px;",pageSize:15,listeners:{beforechange:function(b,d){d.sort=a.sort;if(a.search.sort!=""){d.sort=a.search.sort}if(a.search.poster!=""){d.poster=a.search.poster}if(a.search.title!=""){d.title=a.search.title}if(a.search.stime!=""){d.stime=a.search.stime}if(a.search.etime!=""){d.etime=a.search.etime}}}});this.grid=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,listeners:{cellclick:function(d,h,f,g){if(f!=0&&f!=1){var b=d.getStore().getAt(h);a.view(b.data.lid)}}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("articlesList"),{handler:function(b,d){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},"->",{xtype:"cnoa_helpBtn",helpid:41}]}),bbar:this.pagingBar});this.searchSortComboStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getSortList&type=combo"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["sid","name"]})});this.searchSortCombo=new Ext.form.ComboBox({store:this.searchSortComboStore,id:this.ID_Search_sort,displayField:"name",hiddenName:"sid",valueField:"sid",typeAhead:true,width:130,triggerAction:"all",forceSelection:true,editable:false});this.gridCt=new Ext.Panel({border:false,layout:"fit",region:"center",items:[this.grid],listeners:{afterrender:function(){new Ext.Toolbar({renderTo:this.tabr,style:"border-left-width:1px;",items:[lang("posttime2"),{xtype:"datefield",format:"Y-m-d",id:a.ID_Search_stime,width:100},lang("to"),{xtype:"datefield",id:a.ID_Search_etime,format:"Y-m-d",width:100},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){a.doSearch()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){a.resetSearch()}}]}).render(this.tbar)}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[lang("inColumns"),this.searchSortCombo,lang("postter"),{xtype:"hidden",id:this.ID_Search_poster},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTreeAll",width:100,id:this.ID_Search_poster+"Tr",listeners:{selected:function(e,d,b){Ext.getCmp(a.ID_Search_poster).setValue(d)}}},(lang("title")+":"),{xtype:"textfield",id:this.ID_Search_title,width:168}]})});this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allColumns"),sid:"0",iconCls:"icon-tree-root-cnoa",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){a.sortTree.selectPath(a.ID_tree_treeRoot)}.createDelegate(this)}});this.sortTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:true,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.resetSearchBar();a.sort=b.attributes.sid;a.store.load({params:{sort:a.sort}})}}});this.sortPanel=new Ext.Panel({region:"west",layout:"fit",split:true,width:140,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.sortTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("wzColumns"),"->",{handler:function(b,d){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.gridCt,this.sortPanel]})},makeOperate:function(g,e,a,i,d,f){var b="<a href='javascript:void(0);' onclick='CNOA_news_news_sortlist.view("+g+");'>"+lang("view")+"</a>";return b},deleteList:function(a){Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){CNOA.msg.alert(b.msg,function(){CNOA_news_news_sortlist.store.reload()})}else{CNOA.msg.alert(b.msg)}}})},closeTab:function(){mainPanel.closeTab(CNOA.news.news.postIndex.parentID.replace("docs-",""))},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VIEW");mainPanel.loadClass("index.php?app=news&func=news&action=view&task=view&lid="+a,"CNOA_MENU_NEWS_VIEW",lang("viewMsg"),"icon-page-view")},doSearch:function(){var a=this;a.search.poster=Ext.getCmp(a.ID_Search_poster).getValue();a.search.title=Ext.getCmp(a.ID_Search_title).getValue();a.search.stime=Ext.getCmp(a.ID_Search_stime).getRawValue();a.search.etime=Ext.getCmp(a.ID_Search_etime).getRawValue();a.search.sort=Ext.getCmp(a.ID_Search_sort).getValue();a.store.load({params:{poster:a.search.poster,title:a.search.title,stime:a.search.stime,etime:a.search.etime,sort:a.search.sort}})},resetSearch:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort};a.store.load({params:{sort:a.sort}})},resetSearchBar:function(){var a=this;Ext.getCmp(a.ID_Search_title).setValue("");Ext.getCmp(a.ID_Search_stime).setValue("");Ext.getCmp(a.ID_Search_etime).setValue("");Ext.getCmp(a.ID_Search_sort).setValue("");Ext.getCmp(a.ID_Search_poster).setValue("");Ext.getCmp(a.ID_Search_poster+"Tr").setValue("");a.search={poster:0,title:"",stime:0,etime:0,sort:a.sort}}};var CNOA_news_news_viewClass,CNOA_news_news_view;var CNOA_news_news_view_readerClass,CNOA_news_news_view_reader;CNOA_news_news_viewClass=CNOA.Class.create();CNOA_news_news_viewClass.prototype={init:function(){var a=this;this.lid=CNOA.news.news.view.lid;this.ID_post_textarea=Ext.id();this.ID_post_button=Ext.id();this.baseUrl="index.php?app=news&func=news&action=view";this.tplTitle=new Ext.XTemplate('<div class="news_news_view_head">','  <div class="news_news_view_head_title">{title}</div>','  <div class="news_news_view_head_bt">'+lang("posttime2")+":<a>{posttime}</a>&nbsp;&nbsp;&nbsp;&nbsp;"+lang("updateTime")+":<a>{updatetime}</a>&nbsp;&nbsp;&nbsp;&nbsp;"+lang("postter")+":<a>{user}</a>&nbsp;&nbsp;&nbsp;&nbsp;</div></div>");this.tplBody=new Ext.XTemplate('<div class="news_news_view_content">','<div id="CNOA_NEWS_NEWS_VIEW_VIDEO_PLAYER"></div>{content}&nbsp;',"</div>",'	<tpl if="attachCount &gt; 0">','	<div style="border:2px solid #E6E6E6;height:auto;margin-top:100px;">','		<div style="height:32px;background-color:#E6E6E6;line-height:32px;">','			<img src="./resources/images/icons/attach.gif">','			<span style="font-size:14px;font-weight:bold;">'+lang("attach")+"</span>({attachCount}个)","		</div>","		{attach}","	</div>","	</tpl>");this.tplComment=new Ext.XTemplate('<div class="news_news_view_comment">','  	<div class="news_news_view_comment_title">'+lang("articleComment")+'( <span style="color:red">{listCount}</span> )</div>','  	<tpl if="listCount &gt; 0">','  	<tpl for="list">','  	<div class="news_news_view_comment_items {[xindex % 2 === 0 ? "news_news_view_comment_items2" : ""]}">','	<div class="news_news_view_comment_items_title">		#{[xindex]}&nbsp;&nbsp;'+lang("postter")+": <a>{uname}</a>&nbsp;&nbsp;"+lang("posttime2")+": {posttime}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{del}	</div>",'   <div class="news_news_view_comment_items_body">{content}</div>',"  	</div>"," 	</tpl>","  	</tpl>",'  <div style="margin:5px 0;" id="NEWS_NEWS_VIEW_COMMENT_POST_TEXTAREA"></div>','  <div style="margin:5px 0;" id="NEWS_NEWS_VIEW_COMMENT_POST_BUTTON"></div>',"</div>");this.titlePanel=new Ext.Panel({border:false,region:"north",html:'<div class="news_news_view_head"></div>',listeners:{render:function(b){a.readInfo()}}});this.newsPanel=new Ext.Panel({border:false});this.commentPanel=new Ext.Panel({border:false,html:lang("posttime2")});this.bodyPanel=new Ext.Panel({region:"center",border:false,autoScroll:true,items:[this.newsPanel,this.commentPanel]});this.centerPanel=new Ext.Panel({border:false,region:"center",layout:"border",items:[this.titlePanel,this.bodyPanel],tbar:new Ext.Toolbar({items:[{handler:function(b,d){a.closeTab()}.createDelegate(this),text:lang("close")},{handler:function(b,d){CNOA_news_news_view_reader=new CNOA_news_news_view_readerClass(this.lid);CNOA_news_news_view_reader.show()}.createDelegate(this),text:lang("readStatus"),iconCls:"icon-news-reader"},"->",{xtype:"cnoa_helpBtn",helpid:42}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},readInfo:function(){var a=this;a.centerPanel.getEl().mask(lang("waiting"));this.readComment();Ext.Ajax.request({url:a.baseUrl+"&task=viewNews",method:"POST",params:{lid:a.lid},success:function(e){var b=Ext.decode(e.responseText);if(b.success===true){var d=b.data;a.tplBody.overwrite(a.newsPanel.body,d);a.tplTitle.overwrite(a.titlePanel.body,d);if(d.type=="video"){makeFlvPlayer("CNOA_NEWS_NEWS_VIEW_VIDEO_PLAYER",600,466,d.flv,true,d.image)}}else{CNOA.msg.alert(b.msg,function(){a.closeTab()})}a.centerPanel.getEl().unmask()}})},readComment:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=viewComment",method:"POST",params:{lid:a.lid},success:function(e){var b=Ext.decode(e.responseText);if(b.success===true){var d=b.data;if(d.allowComment==false){a.commentPanel.body.update("")}else{a.tplComment.overwrite(a.commentPanel.body,d);a.renderPostCmp()}}}})},postComment:function(){var b=this;var a=Ext.getCmp(this.ID_post_textarea);if(a.getValue().length<1){CNOA.msg.alert(lang("commentBlank"));return null}b.commentPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:b.baseUrl+"&task=postComment",method:"POST",params:{lid:b.lid,content:a.getValue()},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.readComment()}else{CNOA.msg.alert(d.msg)}a.setValue("");b.commentPanel.getEl().unmask()}})},renderPostCmp:function(){var a=this;new Ext.form.TextArea({renderTo:"NEWS_NEWS_VIEW_COMMENT_POST_TEXTAREA",width:560,height:100,id:this.ID_post_textarea,style:"margin-left:5px;"});new Ext.Button({renderTo:"NEWS_NEWS_VIEW_COMMENT_POST_BUTTON",text:lang("addComment"),id:this.ID_post_button,style:"margin-left:5px;",handler:function(){a.postComment()}})},closeTab:function(){mainPanel.closeTab(CNOA.news.news.view.parentID.replace("docs-",""))},delComment:function(d,b){var a=this;Ext.MessageBox.confirm(lang("notice"),lang("sureWantDelComment"),function(e){if(e=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=delComment",params:{cid:d,lid:b},method:"POST",success:function(g){var f=Ext.decode(g.responseText);if(f.success===true){CNOA.msg.alert(f.msg);a.readComment()}else{CNOA.msg.alert(f.msg);a.readComment()}}})}else{return}})}};CNOA_news_news_view_readerClass=CNOA.Class.create();CNOA_news_news_view_readerClass.prototype={init:function(a){var b=this;this.lid=a;this.baseUrl="index.php?app=news&func=news&action=view";this.fields=[{name:"jid"},{name:"name"},{name:"viewtime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getReaderList&lid="+this.lid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("inDepartment"),dataIndex:"jid",width:100,sortable:true,menuDisabled:true},{header:lang("name2"),dataIndex:"name",width:100,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"viewtime",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.readerListFrom=new Ext.grid.GridPanel({store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,viewConfig:{forceFit:true}});this.window=new Ext.Window({layout:"fit",width:600,height:makeWindowHeight(500),title:lang("readStatus"),resizable:false,modal:true,items:[this.readerListFrom],tbar:new Ext.Toolbar({items:[lang("redReaded"),"-",lang("grayUnread")]}),buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}],listeners:{show:function(d,e){$("#CNOA_NEWS_NEWS_VIEW_VIDEO_PLAYER").css("visibility","hidden")},close:function(d,e){$("#CNOA_NEWS_NEWS_VIEW_VIDEO_PLAYER").css("visibility","visible")}}})},show:function(){this.window.show()},close:function(){this.window.close()}};var CNOA_news_notice_mgrClass,CNOA_news_notice_mgr;CNOA_news_notice_mgrClass=CNOA.Class.create();CNOA_news_notice_mgrClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=news&func=notice&action=mgr";this.isHide=false;this.searchParams={sid:"",titleName:"",post_starttime:"",post_endtime:""};this.tree=this.getTreePanel();this.mgrPanel=this.getMgrPanel();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",items:[this.tree,this.mgrPanel]})},getTreePanel:function(){var b=this;this.ID_btn_collapseExpand=Ext.id();this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allSort"),id:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:b.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false});var a=new Ext.tree.TreePanel({region:"west",width:150,split:true,hideBorders:true,rootVisible:true,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:this.treeLoader,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){b.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(d,e){if(e){d.setText(lang("expand"));d.setTooltip(lang("expandMenuTip"));b.treeRoot.collapse(true);b.treeRoot.firstChild.expand()}else{d.setText(lang("collapse"));d.setTooltip(lang("collapseMenuTip"));b.treeRoot.expand(true)}}}]}),listeners:{click:function(d){b.searchParams.sid=d.attributes.id;b.mgrStore.reload()}}});return a},getMgrPanel:function(){var k=this;var f=[{name:"id"},{name:"title"},{name:"posttime"},{name:"stime"},{name:"etime"},{name:"uFlowId"},{name:"poster"},{name:"approveStatus"},{name:"status"}];this.mgrStore=new Ext.data.Store({autoLoad:true,baseParams:k.searchParams,proxy:new Ext.data.HttpProxy({url:k.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{exception:function(r,q,s,p,o,n){var m=Ext.decode(o.responseText);if(m.failure){CNOA.msg.alert(m.msg)}}}});var h=function(n){var m="<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_notice_mgr.view("+n+");'>"+lang("view")+"</a>";return m};var b=function(r,o,m){var p=m.data,q=p.id;if(r=="0"){return"不需要审批"}else{if(r=="1"){return"<span style='color: blue'>审批通过</span>"}else{if(r=="2"){return"<span style='color: red'>审批不通过</span>"}else{if(r=="3"){var n=p.uFlowId;if(n!=0){return"<span style='color: green'>流程中</span>"}else{return"<a href='javascript:void(0);' class='gridview3' onclick='CNOA_news_notice_mgr.sendApproveFlow("+q+");'>发起审批流程</a>"}}}}}};var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var l=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("title"),dataIndex:"title",width:300,id:"title",sortable:true,menuDisabled:true},{header:lang("posttime2"),dataIndex:"posttime",width:110,sortable:false,menuDisabled:true},{header:lang("enableTime"),dataIndex:"stime",width:110,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:110,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"poster",width:90,sortable:false,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:60,sortable:false,menuDisabled:true},{header:"审批状态",dataIndex:"approveStatus",width:110,sortable:false,menuDisabled:true,renderer:b},{header:lang("opt"),dataIndex:"id",width:60,sortable:false,menuDisabled:true,renderer:h},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var e=new Ext.PagingToolbar({displayInfo:true,style:"border-left-width:1px;",store:k.mgrStore,pageSize:15});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:k.mgrStore,loadMask:{msg:lang("waiting")},cm:l,sm:d,hideBorders:true,border:false,region:"center",stripeRows:true,autoExpandColumn:"title",bodyStyle:"border-left-width: 1px",listeners:{rowdblclick:function(m,n){k.editPanel()}},tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{handler:function(m,n){k.mgrStore.reload()},iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(m,n){k.getMgrAddEdit("add")}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(m,n){k.editPanel(m)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(m){var n=k.grid.getSelectionModel().getSelections();if(n.length==0){CNOA.miniMsg.alertShowAt(m,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(p){if(p=="yes"){if(n){var q="";for(var o=0;o<n.length;o++){q+=n[o].get("id")+","}k.deleteList(q)}}})}}},("<span style='color:#999'>"+lang("dblclickToEdit")+"</span>")]}),bbar:e});var g=new Ext.form.TextField({width:220}),a=new Ext.form.DateField({width:150,editable:false,format:"Y-m-d"}),j=new Ext.form.DateField({width:150,editable:false,format:"Y-m-d"});var i=new Ext.Panel({border:false,layout:"fit",region:"center",items:[this.grid],tbar:new Ext.Toolbar({items:[lang("noticeTitle")+":",g,lang("posttime2")+":",a,"至",j,{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){k.searchParams.titleName=g.getValue();k.searchParams.post_starttime=a.getRawValue();k.searchParams.post_endtime=j.getRawValue();k.mgrStore.reload()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){g.setValue("");a.setValue("");j.setValue("");k.searchParams.titleName="";k.searchParams.post_starttime="";k.searchParams.post_endtime="";k.mgrStore.reload()}}]})});return i},getMgrAddEdit:function(h,i){var f=this;var g=h=="add"?lang("addNotice2"):lang("editNotice2");this.import_img_id=1;var a=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getSortDrop"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"sid"},{name:"name"}]})}),e=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getImgStore"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"sid"},{name:"signature"}]})}),d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getFormatStore"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"id"},{name:"name"}]})});this.ueditor=new Ext.form.UEditor({toolType:"mini",name:"content",fieldLabel:lang("articleContent"),width:784,height:360});var b=[{xtype:"fieldset",title:lang("notice2"),items:[{xtype:"panel",border:false,autoWidth:true,layout:"table",layoutConfig:{columns:2},defaults:{border:false,xtype:"panel",layout:"form"},items:[{width:500,items:[{xtype:"textfield",width:400,name:"title",fieldLabel:lang("title"),inputType:"text",allowBlank:false}]},{width:200,items:[{xtype:"colorfield",fieldLabel:lang("titleColor"),defaultColor:"000000",editable:false,name:"title_color",width:60,listeners:{select:function(k,j){f.formPanel.getForm().findField("title").getEl().setStyle("color","#"+j)}}}]}]},{xtype:"panel",hideBorders:true,border:false,layout:"table",layoutConfig:{columns:2},items:[{xtype:"panel",layout:"form",width:245,items:[{xtype:"datetimefield",width:155,fieldLabel:lang("startTime"),name:"stime"}]},{xtype:"panel",layout:"form",width:240,items:[{xtype:"datetimefield",width:155,fieldLabel:lang("endTime"),name:"etime"}]}]},{xtype:"compositefield",fieldLabel:"选择模板",items:[{xtype:"combo",flex:1,store:d,width:180,hiddenName:"tpl",name:"tpl",valueField:"id",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(l,j,k){var m=l.value;Ext.Ajax.request({url:f.baseUrl+"&task=getNoticeTpl",params:{id:m},success:function(n,p){var o=Ext.decode(n.responseText);f.ueditor.setValue(o)}})}}},{xtype:"button",text:"保存模板",flex:1,width:60,handler:function(){var k=f.ueditor.getValue(),j=f.formPanel.getForm().findField("tpl").getValue();if(j==""){CNOA.msg.alert("请选择模板!");return}Ext.Ajax.request({url:f.baseUrl+"&task=saveTpl",params:{tpl:k,id:j},success:function(l,n){var m=Ext.decode(l.responseText);if(m.success){CNOA.msg.alert(m.msg)}},failure:function(l,m){CNOA.msg.alert(m.msg)}})}},{xtype:"button",text:"另存模板",flex:1,width:60,handler:function(){var j=Ext.id();var l=function(){var o=k.getForm();var n=f.ueditor.getValue();if(o.isValid()){o.submit({url:f.baseUrl+"&task=saveTpl",waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{job:"add",tpl:n},success:function(p,q){m.close();d.reload()}.createDelegate(this),failure:function(p,q){CNOA.msg.alert(q.result.msg,function(){})}.createDelegate(this)})}};var k=new Ext.form.FormPanel({bodyStyle:"padding:10px;",border:false,waitMsgTarget:true,items:[{xtype:"textfield",width:325,hideLabel:true,allowBlank:false,name:"name",value:name,listeners:{render:function(n){n.focus.defer(100,n)}}}]});var m=new Ext.Window({title:"另存为模板 - 请输入模板名称",width:360,height:130,modal:true,resizable:false,items:k,layout:"fit",buttons:[{text:lang("ok"),id:j,iconCls:"icon-btn-save",handler:function(){l()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){m.close()}}],keys:[{key:Ext.EventObject.ENTER,fn:l,scope:this}]}).show()}}]},{xtype:"panel",border:false,autoWidth:true,layout:"table",layoutConfig:{columns:2},defaults:{border:false,xtype:"panel",layout:"form"},items:[{width:266,items:[]},{width:200,items:[]}]},{xtype:"combo",fieldLabel:"选择分类",store:a,width:180,hiddenName:"sortId",valueField:"sid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false},{xtype:"combo",fieldLabel:"选择印章",store:e,width:180,hiddenName:"signatureId",valueField:"sid",displayField:"signature",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(l,j,k){var m=l.value;Ext.Ajax.request({url:f.baseUrl+"&task=getSignatureUrl",params:{signatureId:m},success:function(n,q){var p=Ext.decode(n.responseText),o=p.data,s=o.url;isUsePwd=o.isUsePwd;if(isUsePwd=="1"){var r=new Ext.MessageBox.promptWindow({multiline:false,width:200,title:lang("pleaseUserPassword"),resizable:false,txCfg:{inputType:"password"},listeners:{submit:function(t,u){Ext.Ajax.request({url:"index.php?app=my&func=info&action=index&task=checkPassword",method:"POST",params:{text:u},success:function(w,v){result=Ext.decode(w.responseText);if(result.success===true){f.import_img(s);r.close()}else{if(result.failure===true){CNOA.msg.alert(lang("enterWrongPassword"),result.msg)}}}})}}}).show()}else{f.import_img(s)}}})}}},{xtype:"checkbox",fieldLabel:lang("noticeNow"),name:"send_notice",checked:true,boxLabel:lang("noticeNowNotice")},{xtype:"checkbox",fieldLabel:"审批设置",name:"isChecked",hidden:f.isHide,checked:false,boxLabel:"是否需要审批"},f.ueditor,{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",width:640,inputPre:"filesUpload"}]},{xtype:"fieldset",title:lang("viewPermit"),items:[{xtype:"textarea",height:35,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("sendToWho"),name:"toNames"},{xtype:"hidden",name:"toUids"},{xtype:"btnForPoepleSelector",autoWidth:true,anchor:"-20",dataUrl:f.baseUrl+"&task=getAllUserListsInPermitDeptTree",style:"margin-left:75px;",text:lang("selectPeople"),listeners:{selected:function(l,m){var n=new Array();var k=new Array();if(m.length>0){for(var j=0;j<m.length;j++){n.push(m[j].uname);k.push(m[j].uid)}}f.formPanel.getForm().findField("toNames").setValue(n.join(","));f.formPanel.getForm().findField("toUids").setValue(k.join(","))},onrender:function(j){j.setSelectedUids(f.formPanel.getForm().findField("toUids").getValue().split(","))}}},{xtype:"textarea",height:50,anchor:"-20",style:"margin-top:4px;",readOnly:true,fieldLabel:lang("department"),name:"deptNames",listeners:{afterrender:function(j){j.mon(j.el,"click",function(){var k=f.formPanel.getForm().findField("deptIds").getValue();new_selector("dept",f.formPanel.getForm().findField("deptNames"),f.formPanel.getForm().findField("deptIds"),true,f.baseUrl+"&task=selector&target=dept",k)})}}},{xtype:"hidden",name:"deptIds"},{xtype:"displayfield",value:lang("blankSendAll")}]}];this.formPanel=new Ext.form.FormPanel({region:"center",autoScroll:true,border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,items:[{xtype:"panel",border:false,padding:10,items:[b]}]});this.win=new Ext.Window({width:935,height:makeWindowHeight(600),title:g,resizable:false,modal:true,layout:"border",items:[this.formPanel],buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f.submitForm(true,i,h)}},{text:lang("apply"),hidden:h=="edit"?false:true,iconCls:"icon-btn-save",handler:function(){f.submitForm(false,i,h)}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.win.close()}}]});this.win.show();if(h=="edit"){this.loadFormData(i)}},import_img:function(m){var h=this,f="<img name='import_img' style='position:absolute;' id='import_img_"+h.import_img_id+"' src='../../../"+m+"'>";h.ueditor.UEditor.execCommand("inserthtml",f);var n=h.ueditor.getId(),e=$("#"+n).find("iframe")[0].contentWindow,k=$(e.document).find("#import_img_"+h.import_img_id),g=k.position(),j=g.top,d=g.left,b="position:absolute;",i=k.width(),l=780-i;if(d>l&&j<70){var a=d-l;b+="margin-left:-"+a+"px;"}else{if(d>l&&j>70){var a=d-l;b+="margin-left:-"+a+"px;margin-top:-70px;"}else{if(j>=70&&d>=85){b+="margin-left:-85px;margin-top:-70px;"}else{if(j>=70&&d<85){b+="margin-top:-70px;"}else{if(d>=85&&j<70){b+="margin-left:-85px;"}}}}}k.attr("style",b);h.import_img_id++},editPanel:function(a){var d=this;var f=d.grid.getSelectionModel().getSelections();if(f.length==0){CNOA.miniMsg.alertShowAt(a,lang("mustSelectOneRow"));return}else{var e=f[0].data,b=e.approveStatus}if(b=="1"){CNOA.miniMsg.alertShowAt(a,"审批通过，不能修改！")}else{if(b=="2"){CNOA.miniMsg.alertShowAt(a,"审批不通过，不能修改，请重新发起!")}else{if(b=="3"){if(e.uFlowId!=0){CNOA.miniMsg.alertShowAt(a,"已经发起流程审批，不能修改!")}else{var g=f[0].get("id");d.isHide=false;d.getMgrAddEdit("edit",g)}}else{if(b=="0"){d.isHide=true}else{d.isHide=false}var g=f[0].get("id");d.getMgrAddEdit("edit",g)}}}},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_NOTICE_VIEW");mainPanel.loadClass("index.php?app=news&func=notice&action=mgr&task=loadPage&from=view&id="+a,"CNOA_MENU_NEWS_NOTICE_VIEW",lang("notice2"),"icon-system-notice")},deleteList:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.alert(d.msg,function(){b.mgrStore.reload()})}else{CNOA.msg.alert(d.msg)}}})},loadFormData:function(b){var a=this;a.formPanel.getForm().load({url:a.baseUrl+"&task=editLoadFormData",params:{id:b},method:"POST",waitMsg:lang("waiting"),success:function(d,e){a.formPanel.getForm().findField("title").getEl().setStyle("color","#"+e.result.data.title_color)},failure:function(d,e){CNOA.msg.alert(e.result.msg)}})},submitForm:function(d,e,b){var a=this;if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({url:a.baseUrl+"&task="+b,waitMsg:lang("waiting"),params:{id:e},method:"POST",success:function(f,g){CNOA.msg.notice2(g.result.msg);if(d){a.win.close()}a.mgrStore.reload()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}},sendApproveFlow:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=sendApproveFlow",params:{lid:b},success:function(d){var h=Ext.decode(d.responseText);if(h.success==true){var e=h.uFlowId,f=h.flowType,i=h.tplSort,g=h.noticeLid;getFlowId4Engine("newsNotice",function(m,j,l,k,n){n(e,f,i,g)},function(j){CNOA.msg.alert(j)})}else{CNOA.msg.alert(h.msg)}}})}};var CNOA_news_notice_indexClass,CNOA_news_notice_index;CNOA_news_notice_indexClass=CNOA.Class.create();CNOA_news_notice_indexClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=news&func=notice&action=index";this.searchParams={sid:"",title:"",post_starttime:"",post_endtime:""};this.tree=this.getTreePanel();this.indexPanel=this.getIndexPanel();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",items:[this.tree,this.indexPanel]})},getTreePanel:function(){var b=this;this.ID_btn_collapseExpand=Ext.id();this.treeRoot=new Ext.tree.AsyncTreeNode({text:lang("allSort"),id:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:b.baseUrl+"&task=getSortList",preloadChildren:true,clearOnLoad:false});var a=new Ext.tree.TreePanel({region:"west",width:150,split:true,hideBorders:true,rootVisible:true,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:this.treeLoader,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){b.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(d,e){if(e){d.setText(lang("expand"));d.setTooltip(lang("expandMenuTip"));b.treeRoot.collapse(true);b.treeRoot.firstChild.expand()}else{d.setText(lang("collapse"));d.setTooltip(lang("collapseMenuTip"));b.treeRoot.expand(true)}}}]}),listeners:{click:function(d){b.searchParams.sid=d.attributes.id;b.indexStore.reload()}}});return a},getIndexPanel:function(){var h=this;var f=[{name:"id"},{name:"title"},{name:"posttime"},{name:"stime"},{name:"etime"},{name:"poster"},{name:"readStatus"},{name:"isHaveAttact"},{name:"status"}];makeOperate=function(k){return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_notice_index.view("+k+");'>"+lang("view")+"</a>"},changeReadStatus=function(n,l,k){var m=k.data;if(n==1){n='<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />'}else{n='<img src="./resources/images/icons/sms-unread.gif" width="16" height="16" />'}if(m.isHaveAttact){n+="&nbsp;&nbsp;";n+='<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}return n};this.indexStore=new Ext.data.Store({autoLoad:true,baseParams:h.searchParams,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{exception:function(p,o,q,n,m,l){var k=Ext.decode(m.responseText);if(k.failure){CNOA.msg.alert(k.msg)}}}});var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var j=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:"",dataIndex:"readStatus",width:80,align:"center",sortable:false,menuDisabled:true,renderer:changeReadStatus},{header:lang("title"),dataIndex:"title",width:300,id:"title",sortable:true,menuDisabled:true},{header:lang("posttime2"),dataIndex:"posttime",width:110,sortable:false,menuDisabled:true},{header:lang("enableTime"),dataIndex:"stime",width:110,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:110,sortable:false,menuDisabled:true},{header:lang("postter"),dataIndex:"poster",width:90,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"id",width:60,sortable:false,menuDisabled:true,renderer:makeOperate},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var e=new Ext.PagingToolbar({displayInfo:true,store:h.indexStore,pageSize:25});var g=new Ext.form.TextField({width:220}),b=new Ext.form.DateField({width:150,editable:false,format:"Y-m-d"}),i=new Ext.form.DateField({width:150,editable:false,format:"Y-m-d"});var a=new Ext.grid.GridPanel({store:h.indexStore,loadMask:{msg:lang("waiting")},cm:j,sm:d,border:false,region:"center",autoExpandColumn:"title",bodyStyle:"border-left-width: 1px",tbar:new Ext.Toolbar({items:[lang("noticeTitle"),g,lang("posttime2")+":",b,"至",i,{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){var m=g.getValue();var k=b.getRawValue();var l=i.getRawValue();h.searchParams.title=m;h.searchParams.post_starttime=k;h.searchParams.post_endtime=l;h.indexStore.reload()}},{xtype:"button",text:lang("clear"),style:"margin-right:5px",handler:function(){h.searchParams.title="";h.searchParams.post_starttime="";h.searchParams.post_endtime="";g.setValue("");b.setValue("");i.setValue("");h.indexStore.reload()}},{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(k,l){h.indexStore.reload()}}]}),bbar:e});return a},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_NOTICE_VIEW");mainPanel.loadClass("index.php?app=news&func=notice&action=index&task=loadPage&from=view&id="+a,"CNOA_MENU_NEWS_NOTICE_VIEW",lang("notice2"),"icon-system-notice")}};var CNOA_news_notice_viewClass,CNOA_news_notice_view;CNOA_news_notice_viewClass=CNOA.Class.create();CNOA_news_notice_viewClass.prototype={init:function(){var a=this;this.id=CNOA.news.notice.view.id;this.ID_post_textarea=Ext.id();this.ID_post_button=Ext.id();this.baseUrl="index.php?app=news&func=notice&action="+CNOA.news.notice.view.fromaction;this.tplTitle=new Ext.XTemplate('<div class="news_news_view_head" style="height:85px;">','  <div class="news_news_view_head_title">{title}</div>','  <div class="news_news_view_head_bt">'+lang("deptToPost")+":<a>{dept}</a>&nbsp;&nbsp;&nbsp;&nbsp;"+lang("postter")+":<a>{user}</a>&nbsp;&nbsp;&nbsp;&nbsp;"+lang("posttime2")+":<a>{posttime}</a><br>"+lang("enableTime")+":<a>{stime}</a>&nbsp;&nbsp;&nbsp;&nbsp;"+lang("endTime")+":<a>{etime}</a></div></div>");this.tplBody=new Ext.XTemplate('<table id="news_news_content_id" frame="void" width="780px" style="margin: auto;font-size: 16px;"><tbody><tr><td valign="top" style="word-break: break-all;">','<div class="content news_news_view_content">{content}</div>&nbsp;',"</tbody></td></tr></table>",'	<tpl if="attachCount &gt; 0">','	<div style="border:2px solid #E6E6E6;height:auto;margin-top:100px;">','		<div style="height:32px;background-color:#E6E6E6;line-height:32px;">','			<img src="./resources/images/icons/attach.gif">','			<span style="font-size:14px;font-weight:bold;">'+lang("attach")+"</span>({attachCount})","		</div>","		{attach}","	</div>","	</tpl>");this.titlePanel=new Ext.Panel({border:false,region:"north",html:'<div class="news_news_view_head" style="height:85px;text-align: center;"></div>',listeners:{render:function(b){a.readInfo()}}});this.newsPanel=new Ext.Panel({border:false});this.bodyPanel=new Ext.Panel({region:"center",border:false,items:[this.newsPanel]});this.centerPanel=new Ext.Panel({border:false,region:"center",autoScroll:true,items:[this.titlePanel,this.bodyPanel],tbar:new Ext.Toolbar({items:[{handler:function(b,d){a.closeTab()}.createDelegate(this),text:lang("close")},{handler:function(b,d){CNOA_news_notice_view_reader=new CNOA_news_notice_view_readerClass(this.id);CNOA_news_notice_view_reader.show()}.createDelegate(this),text:lang("readStatus"),iconCls:"icon-news-reader"},{handler:function(b,d){a.print()}.createDelegate(this),iconCls:"icon-print",text:"打印 "},"->",{xtype:"cnoa_helpBtn",helpid:45}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},readInfo:function(){var a=this;a.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:a.baseUrl+"&task=view",method:"POST",params:{id:a.id},success:function(i){var g=Ext.decode(i.responseText);if(g.success===true){var h=g.data;a.tplBody.overwrite(a.newsPanel.body,h);a.tplTitle.overwrite(a.titlePanel.body,h);var f=$.find("img[name=import_img]");if(f!=""){var d=$("#news_news_content_id").height(),b=f[0].height;d=d+b;$("#news_news_content_id").height(d)}try{CNOA_news_notice_index.indexStore.reload();CNOA_MAIN_DESKTOP_NEWS_NOTICE_OBJ.store.reload()}catch(j){}}else{CNOA.msg.alert(g.msg,function(){a.closeTab()})}a.centerPanel.getEl().unmask()}})},renderPostCmp:function(){var a=this;new Ext.form.TextArea({renderTo:"NEWS_NEWS_VIEW_COMMENT_POST_TEXTAREA",width:560,height:100,id:this.ID_post_textarea,style:"margin-left:5px;"});new Ext.Button({renderTo:"NEWS_NEWS_VIEW_COMMENT_POST_BUTTON",text:lang("addComment"),id:this.ID_post_button,style:"margin-left:5px;",handler:function(){a.postComment()}})},closeTab:function(){mainPanel.closeTab(CNOA.news.notice.view.parentID.replace("docs-",""))},print:function(){window.open("index.php?app=news&func=notice&action=index&task=print&id="+this.id,"noticept","width=840,height="+(screen.availHeight-200)+",left="+((screen.availWidth-740)/2)+",top=60,scrollbars=yes,resizable=yes,status=no")}};CNOA_news_notice_view_readerClass=CNOA.Class.create();CNOA_news_notice_view_readerClass.prototype={init:function(a){var b=this;this.lid=a;this.baseUrl="index.php?app=news&func=notice&action=index";this.fields=[{name:"jid"},{name:"name"},{name:"viewtime"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getReaderList&lid="+this.lid,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("inDepartment"),dataIndex:"jid",width:100,sortable:true,menuDisabled:true},{header:lang("name2"),dataIndex:"name",width:100,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"viewtime",width:150,sortable:true,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.readerListFrom=new Ext.grid.GridPanel({stripeRows:true,store:this.store,bodyStyle:"border-left-width:1px;",loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,stripeRows:true,hideBorders:true,border:false,viewConfig:{forceFit:true}});this.window=new Ext.Window({layout:"fit",width:600,height:makeWindowHeight(500),title:lang("readStatus"),resizable:false,modal:true,items:[this.readerListFrom],tbar:new Ext.Toolbar({items:[lang("redReaded"),"-",lang("grayUnread")]}),buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){this.close()}.createDelegate(this)}]})},show:function(){this.window.show()},close:function(){this.window.close()}};var CNOA_news_notice_sortClass,CNOA_news_notice_sort;CNOA_news_notice_sortClass=CNOA.Class.create();CNOA_news_notice_sortClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=news&func=notice&action=sort";this.sortPanel=this.getSortPanel();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.sortPanel]})},getSortPanel:function(){var g=this;var a=[{name:"sid"},{name:"name"}];var f=Ext.data.Record.create([{name:"name",type:"string"}]);var e=new Ext.ux.grid.RowEditor({cancelText:lang("cancel"),saveText:lang("update"),errorSummary:false});var h=new Ext.grid.CheckboxSelectionModel();var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),h,{header:"sid",dataIndex:"sid",hidden:true},{header:"名称",dataIndex:"name",width:130,sortable:false,menuDisabled:true,editor:new Ext.form.TextField()},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.sortStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getNoticeSort",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var d=new Ext.grid.EditorGridPanel({region:"center",store:g.sortStore,cm:b,plugins:[e],stripeRows:true,sm:h,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.sortStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){g.addSortWin()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(i){var k=d.getSelectionModel().getSelections(),j=k.data;CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){var m=[];Ext.each(k,function(o,n){m.push(o.json.sid)});g.delSort(m.join(","))}})}}]}),listeners:{afteredit:function(j){var l=j.field,k=j.value,i=j.record.data.sid;g.updateSort(i,l,k)}}});return d},addSortWin:function(){var a=this;var e=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,items:[{xtype:"textfield",fieldLabel:lang("name"),name:"name",allowBlank:false}]});var b=function(){if(e.getForm().isValid()){e.getForm().submit({url:a.baseUrl+"&task=addSort",method:"POST",success:function(f,g){CNOA.msg.notice(g.result.msg,"添加分类");a.sortStore.reload();d.close()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};var d=new Ext.Window({title:"添加分类",width:300,height:140,layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[e],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){b()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()},updateSort:function(a,e,d){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=updateSort",params:{sid:a,field:e,value:d},success:function(h,g){var f=Ext.decode(h.responseText);CNOA.msg.notice2(f.msg,"公告分类");b.sortStore.reload()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})},delSort:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delSort",method:"POST",params:{ids:a},success:function(d){var e=Ext.decode(d.responseText);if(e.success==true){b.sortStore.reload();CNOA.msg.notice2(e.msg)}else{if(e.failure==true){CNOA.msg.alert(e.msg)}}}})}};var CNOA_news_vote_editComponentClass=CNOA.Class.create();CNOA_news_vote_editComponentClass.prototype={init:function(b,a){this.voteListView=b;this.baseUrl=b.baseUrl;this.editId=parseInt(a)||0;this.action=(this.editId===0)?"add":"edit";this.optionCount=0;this.optionsField=new Ext.Panel({layout:"form",labelWidth:20,border:false,items:[]});if(this.action=="add"){this.addOption("")}this.formPanel=this.createEditView();var d=this;var e=this.action=="add"?lang("addVote"):lang("modifyVote");this.mainPanel=new Ext.Window({width:800,height:makeWindowHeight(600),title:e,modal:true,layout:"fit",items:[this.formPanel],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){d.submitForm()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]})},createEditView:function(){var d=this;var b={xtype:"fieldset",title:lang("votingInformation"),items:[{xtype:"textfield",width:400,name:"title",fieldLabel:lang("title"),inputType:"text",allowBlank:false},{xtype:"textfield",width:400,name:"desc",fieldLabel:lang("voteDescription"),inputType:"text"},{xtype:"container",border:false,width:400,fieldLabel:lang("votingOptions"),items:[this.optionsField,{xtype:"button",text:lang("addVotingOption"),handler:function(){d.addOption()}}]},{xtype:"textfield",name:"selectNum",fieldLabel:lang("chooseNum"),value:"1",width:50,regex:/\d+/,inputType:"text",allowBlank:false},{xtype:"container",layout:"column",items:[{xtype:"container",layout:"form",items:[{xtype:"datetimefield",name:"stime",width:155,fieldLabel:lang("startTime"),allowBlank:false,value:new Date()}]},{xtype:"container",layout:"form",items:[{xtype:"datetimefield",name:"etime",width:155,fieldLabel:lang("endTime")}]}]},{xtype:"checkbox",fieldLabel:lang("notice1"),name:"isNotice",inputValue:"1",checked:true,boxLabel:lang("sendReminderVote")},{xtype:"checkbox",fieldLabel:lang("anonymousVote"),name:"isAnonymity",inputValue:"1",checked:true},{xtype:"checkbox",fieldLabel:lang("allowComments"),name:"isComment",inputValue:"1",checked:true},{xtype:"radiogroup",fieldLabel:lang("viewRules"),boxMaxWidth:400,items:[{xtype:"radio",name:"checkRule",checked:true,inputValue:0,boxLabel:lang("beforeSeeResult")},{xtype:"radio",name:"checkRule",inputValue:1,boxLabel:lang("afterVoteSeeResult")},{xtype:"radio",name:"checkRule",inputValue:2,boxLabel:lang("alwaySeeResults")}]},{xtype:"flashfile",fieldLabel:lang("attach"),name:"files",width:640,inputPre:"filesUpload"}]};var a={xtype:"fieldset",title:lang("votePermit"),items:[{xtype:"selectorform",selectorType:"user",multiselect:true,hiddenName:"joinUids",name:"joinUnames",width:500,fieldLabel:lang("voteParticipants")},{xtype:"displayfield",value:lang("emptyDefaultAll")},{xtype:"selectorform",selectorType:"user",multiselect:true,hiddenName:"seeUids",name:"seeUnames",width:500,fieldLabel:lang("additionalViewMan")},{xtype:"displayfield",value:lang("emptyDefaultAll")}]};return new Ext.form.FormPanel({autoScroll:true,border:false,labelWidth:70,labelAlign:"right",waitMsgTarget:true,padding:10,items:[b,a]})},createOption:function(a){return new Ext.form.TextField({width:300,name:"options[]",fieldLabel:this.optionCount,inputType:"text",value:a})},addOption:function(f){f=f||"";if(typeof(f)=="object"&&f.length){var b=[];for(var d=0,a=f.length;d<a;d++){this.optionCount+=1;b.push(this.createOption(f[d].optionName))}this.optionsField.add(b)}else{this.optionCount+=1;var e=this.createOption(f);this.optionsField.add(e)}this.optionsField.doLayout()},loadFormData:function(){var a=this;this.formPanel.getForm().load({url:this.baseUrl+"&task=getVote",params:{vid:this.editId},method:"POST",waitMsg:lang("waiting"),success:function(b,e){var d=e.result.data;a.addOption(d.options)},failure:function(b,d){CNOA.msg.alert(d.result.msg)}})},submitForm:function(){var a=this;if(this.formPanel.getForm().isValid()){this.formPanel.getForm().submit({url:this.baseUrl+"&task="+this.action,waitMsg:lang("waiting"),params:{vid:this.editId},method:"POST",success:function(d,e){var b=e.result;if(b.success){a.close();a.voteListView.reload();CNOA.msg.notice2(b.msg)}else{CNOA.msg.alert(b.msg)}},failure:function(b,d){CNOA.msg.alert(d.result.msg)}})}},show:function(){this.mainPanel.show();if(this.action=="edit"){this.loadFormData()}},close:function(){this.mainPanel.close()}};var CNOA_news_vote_launchClass=CNOA.Class.create();CNOA_news_vote_launchClass.prototype={init:function(){this.baseUrl="index.php?app=news&func=vote&action=launch";this.voteListView=this.createVoteListView();this.voteStore=this.voteListView.getStore();this.mainPanel=new Ext.Panel({autoScroll:false,border:false,layout:"fit",items:[this.voteListView]})},createVoteListView:function(){var f=this;var b=[{name:"vid"},{name:"title"},{name:"voteTime"},{name:"stime"},{name:"etime"},{name:"poster"},{name:"status"}];var e=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var g=function(m,k,j){var i=j.data.status;var l='<a class="gridview" onclick="CNOA_news_vote_launch.view('+m+');">'+lang("view")+"</a>";if(i=="未开始"){return l+'<a class="gridview3 jianju" onclick="CNOA_news_vote_launch.editVote(\'edit\','+m+');">'+lang("modify")+"</a>"}else{return l}};var a=function(j){var i;switch(j){case"未开始":i="cnoa_color_gray";break;case"进行中":i="cnoa_color_green";break;case"已结束":i="cnoa_color_red";break}return'<span class="'+i+'">'+j+"</span>"};var d=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),h,{header:"id",dataIndex:"vid",hidden:true},{header:lang("theme"),dataIndex:"title",width:240,id:"title"},{header:lang("posttime2"),dataIndex:"voteTime",width:120},{header:lang("enableTime"),dataIndex:"stime",width:120},{header:lang("endTime"),dataIndex:"etime",width:120},{header:lang("postter"),dataIndex:"poster",width:100},{header:lang("status"),dataIndex:"status",width:70,renderer:a},{header:lang("opt"),dataIndex:"vid",width:110,renderer:g},{header:"",dataIndex:"noIndex",width:1}]});return new Ext.grid.PageGridPanel({cm:d,sm:h,store:e,autoExpandColumn:"title",tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.voteStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){f.editVote("add")}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(i){var j=f.getSelectionIds(),k;if((k=f.validateSelections(j,"del"))===true){CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){f.deleteVote(j)}})}else{f.showMiniMsg(i,k)}}}]})})},editVote:function(a,d){var d=d||0;var b=new CNOA_news_vote_editComponentClass(this,d);b.show()},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VOTE_VOTING");mainPanel.loadClass("index.php?app=news&func=vote&action=launch&task=loadPage&from=view&vid="+a,"CNOA_MENU_NEWS_VOTE_VOTING",lang("voteView"),"icon-system-vote")},deleteVote:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a.join(",")},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);b.voteStore.reload()}else{CNOA.msg.alert(d.msg)}}})},getSelections:function(){return this.voteListView.getSelectionModel().getSelections()},getSelectionIds:function(){var e=this.getSelections(),d=[];for(var b=0,a=e.length;b<a;b++){d.push(e[b].get("vid"))}return d},validateSelections:function(d,e){if(d.length===0){return lang("mustSelectOneRow")}if(e=="edit"){if(d.length>1){return lang("notAllowEditMoreOneRecord")}for(var b=0,a=d.length;b<a;b++){if(d[b].get("status")!=="未开始"){return"不能对已开始的投票进行修改"}}}return true},showMiniMsg:function(b,d){var a=b.getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(d,a)},reload:function(){this.voteStore.reload()}};var CNOA_news_vote_manageClass=CNOA.Class.create();CNOA_news_vote_manageClass.prototype={init:function(){this.baseUrl="index.php?app=news&func=vote&action=manage";this.voteListView=this.createVoteListView();this.voteStore=this.voteListView.getStore();this.mainPanel=new Ext.Panel({autoScroll:false,border:false,layout:"fit",items:[this.voteListView]})},createVoteListView:function(){var f=this;var b=[{name:"vid"},{name:"title"},{name:"voteTime"},{name:"stime"},{name:"etime"},{name:"poster"},{name:"status"}];var e=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var g=function(i){return'<a class="gridview" onclick="CNOA_news_vote_manage.view('+i+');">'+lang("view")+"</a>"};var a=function(j){var i;switch(j){case"未开始":i="cnoa_color_gray";break;case"进行中":i="cnoa_color_green";break;case"已结束":i="cnoa_color_red";break}return'<span class="'+i+'">'+j+"</span>"};var d=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),h,{header:"id",dataIndex:"vid",hidden:true},{header:lang("theme"),dataIndex:"title",width:300,id:"title"},{header:lang("posttime2"),dataIndex:"voteTime",width:110},{header:lang("enableTime"),dataIndex:"stime",width:110},{header:lang("endTime"),dataIndex:"etime",width:110},{header:lang("postter"),dataIndex:"poster",width:90},{header:lang("status"),dataIndex:"status",width:60,renderer:a},{header:lang("opt"),dataIndex:"vid",width:60,renderer:g},{header:"",dataIndex:"noIndex",width:1}]});return new Ext.grid.PageGridPanel({cm:d,sm:h,store:e,autoExpandColumn:"title",tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.voteStore.reload()}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(i){var j=f.getSelections(),k;if((k=f.validateSelections(j,"edit"))===true){f.editVote("edit",j[0].get("vid"))}else{f.showMiniMsg(i,k)}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(i){var j=f.getSelectionIds(),k;if((k=f.validateSelections(j,"del"))===true){CNOA.msg.cf(lang("confirmToDelete"),function(l){if(l=="yes"){f.deleteVote(j)}})}else{f.showMiniMsg(i,k)}}}]})})},editVote:function(a,d){var d=d||0;var b=new CNOA_news_vote_editComponentClass(this,d);b.show()},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_VOTE_VOTING");mainPanel.loadClass("index.php?app=news&func=vote&action=launch&task=loadPage&from=view&vid="+a,"CNOA_MENU_NEWS_VOTE_VOTING",lang("voteView"),"icon-system-vote")},deleteVote:function(a){var b=this;Ext.Ajax.request({url:this.baseUrl+"&task=delete",method:"POST",params:{ids:a.join(",")},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){CNOA.msg.notice2(d.msg);b.voteStore.reload()}else{CNOA.msg.alert(d.msg)}}})},getSelections:function(){return this.voteListView.getSelectionModel().getSelections()},getSelectionIds:function(){var e=this.getSelections(),d=[];for(var b=0,a=e.length;b<a;b++){d.push(e[b].get("vid"))}return d},validateSelections:function(d,e){if(d.length===0){return lang("mustSelectOneRow")}if(e=="edit"){if(d.length>1){return lang("notAllowEditMoreOneRecord")}for(var b=0,a=d.length;b<a;b++){if(d[b].get("status")!=="未开始"){return lang("modifyBegunVote")}}}return true},showMiniMsg:function(b,d){var a=b.getEl().getBox();a=[a.x+12,a.y+26];CNOA.miniMsg.alert(d,a)},reload:function(){this.voteStore.reload()}};var CNOA_news_vote_readClass,CNOA_news_vote_read;CNOA_news_vote_readClass=CNOA.Class.create();CNOA_news_vote_readClass.prototype={init:function(a){this.baseUrl="index.php?app=news&func=vote&action=read";this.voteStore="";this.renderAction="noVote";this.titleSearchId=Ext.id();this.voteReadView=this.createVoteReadView();this.mainPanel=this.voteReadView},createVoteReadView:function(){var f=this;var b=[{name:"vid"},{name:"title"},{name:"stime"},{name:"etime"},{name:"voteTime"},{name:"status"},{name:"poster"},{name:"action"}];this.voteStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getVoteList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=function(j){var i;switch(j){case"未开始":i="cnoa_color_gray";break;case"进行中":i="cnoa_color_green";break;case"已结束":i="cnoa_color_red";break}return'<span class="'+i+'">'+j+"</span>"};var g=function(m,k,j){var i=j.data.status;var l=j.data.action;switch(i){case"进行中":if(l=="voting"){return'<a class="gridview" onclick="CNOA_news_vote_read.voteOpt('+m+",'voting')\">"+lang("vote")+"</a>"}else{return'<a class="gridview" onclick="CNOA_news_vote_read.voteOpt('+m+",'result')\">"+lang("result")+"</a>"}break;case"已结束":return'<a class="gridview" onclick="CNOA_news_vote_read.voteOpt('+m+",'result')\">"+lang("result")+"</a>";break}};var d=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),h,{header:"id",dataIndex:"vid",hidden:true},{header:lang("theme"),dataIndex:"title",width:300,id:"title"},{header:lang("posttime2"),dataIndex:"voteTime",width:110},{header:lang("enableTime"),dataIndex:"stime",width:110},{header:lang("endTime"),dataIndex:"etime",width:110},{header:lang("postter"),dataIndex:"poster",width:90},{header:lang("status"),dataIndex:"status",width:60,renderer:a},{header:lang("opt"),dataIndex:"vid",width:60,renderer:g},{header:"",dataIndex:"noIndex",width:1}]});var e=Ext.create({xtype:"pagegrid",sm:h,cm:d,store:this.voteStore});return new Ext.Panel({border:false,layout:"fit",items:[e],tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.voteStore.reload()}},lang("theme")+":",{xtype:"textfield",id:f.titleSearchId},{xtype:"button",text:lang("search"),style:"margin-left:5px",text:lang("search"),handler:function(){f.doSearch()}},{xtype:"button",text:lang("clear"),handler:function(){f.resetSearch()}}]})},doSearch:function(){var a=Ext.getCmp(this.titleSearchId).getValue();this.voteStore.load({params:{title:a}})},resetSearch:function(){Ext.getCmp(this.titleSearchId).setValue("");this.voteStore.load({params:{title:""}})},sortLoad:function(a){this.voteStore.load({params:{sort:a}})},voteOpt:function(b,a){mainPanel.closeTab("CNOA_MENU_NEWS_VOTE_VOTING");mainPanel.loadClass(this.baseUrl+"&task=loadPage&from="+a+"&vid="+b,"CNOA_MENU_NEWS_VOTE_VOTING",lang("vote"),"icon-system-vote")}};var CNOA_news_bbs_bbs,CNOA_news_bbs_bbsClass;CNOA_news_bbs_bbsClass=new CNOA.Class.create();CNOA_news_bbs_bbsClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=news&func=bbs&action=bbs&task=getIndex&model=getIndex";this.mainPanel=new Ext.Panel({border:false,hideBorder:true,html:' <iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="'+this.baseUrl+'"> </iframe>'})}};var CNOA_news_bbs_mypost,CNOA_news_bbs_mypostClass;CNOA_news_bbs_mypostClass=new CNOA.Class.create();CNOA_news_bbs_mypostClass.prototype={init:function(){this.baseUrl="index.php?app=news&func=bbs&action=mypost";this.mainPanel=this.getPostPanel()},getPostPanel:function(){var j=this;var d={title:"",forumId:0};var h=[{name:"id"},{name:"title"},{name:"author"},{name:"posttime"},{name:"reply"},{name:"browse"}];var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var k=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"id",dataIndex:"id",hidden:true},{header:"标题",dataIndex:"title",width:300,align:"left"},{header:"作者",dataIndex:"author",width:100},{header:"发表时间",dataIndex:"posttime",width:140},{header:"回复",dataIndex:"reply",width:50},{header:"浏览",dataIndex:"browse",width:50}]});var m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:j.baseUrl+"&task=getPostList&user=1",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:h})});var g=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:m,pageSize:2});var b=new Ext.grid.GridPanel({region:"center",store:m,cm:k,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){m.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(n){var o=b.getSelectionModel().getSelections();if(o.length==0){CNOA.miniMsg.alertShowAt(n,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(n,lang("sureDel"),function(){var p=[];Ext.each(o,function(r,q){p.push(r.json.id)});j.deletePost(p.join(","),m)})}}},"-",("标题："),{xtype:"textfield",id:"title",style:"margin-right:5px",width:130},{xtype:"button",text:"查询",style:"margin-left:5px",cls:"x-btn-over",handler:function(){d.title=Ext.getCmp("title").getValue();m.load({params:d})},listeners:{mouseout:function(n){n.addClass("x-btn-over")}}},{xtype:"button",text:"清空",handler:function(){Ext.getCmp("title").setValue();d.title=0;m.load({params:d})}}]}),bbar:g});var e=new Ext.tree.AsyncTreeNode({text:"所有版块",forumId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var i=new Ext.tree.TreeLoader({dataUrl:j.baseUrl+"&task=getForumTree&type=all",preloadChildren:true,clearOnLoad:false});var l=new Ext.tree.TreePanel({region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,hideBorders:true,border:false,rootVisible:true,split:true,bodyStyle:"border-right-width:1px;",lines:true,animCollapse:false,animate:false,loader:i,root:e,autoScroll:true,listeners:{click:function(n){d.forumId=n.attributes.forumId;m.load({params:d})}},tbar:["版块列表: &nbsp;","->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.reload()}}]});var a=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,region:"center",items:[l,b]});return a},deletePost:function(b,a){var d=this;Ext.Ajax.request({url:d.baseUrl+"&task=deletePost",params:{ids:b},success:function(e){var f=Ext.decode(e.responseText);CNOA.msg.notice2(f.msg);a.reload()}})}};var CNOA_news_bbs_myreply,CNOA_news_bbs_myreplyClass;CNOA_news_bbs_myreplyClass=new CNOA.Class.create();CNOA_news_bbs_myreplyClass.prototype={init:function(){this.baseUrl="index.php?app=news&func=bbs&action=myreply";this.mainPanel=this.getReplyPanel()},getReplyPanel:function(){var j=this;var d={title:"",content:"",forumId:0};var h=[{name:"id"},{name:"content"},{name:"author"},{name:"posttime"},{name:"title"}];var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var l=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"id",dataIndex:"id",hidden:true},{header:"内容",dataIndex:"content",width:300,align:"left"},{header:"作者",dataIndex:"author",width:100},{header:"发表时间",dataIndex:"posttime",width:140},{header:"所在帖子",dataIndex:"title",width:300,align:"left"}]});var k=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:j.baseUrl+"&task=getReplyList&user=1",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:h})});var g=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:k,pageSize:2});var b=new Ext.grid.GridPanel({region:"center",store:k,cm:l,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){k.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(n){var o=b.getSelectionModel().getSelections();if(o.length==0){CNOA.miniMsg.alertShowAt(n,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(n,lang("sureDel"),function(){var p=[];Ext.each(o,function(r,q){p.push(r.json.id)});j.deleteReply(p.join(","),k)})}}},"-",("所在帖子"),{xtype:"textfield",id:"title",style:"margin-right:5px",width:130},("内容"),{xtype:"textfield",id:"content",style:"margin-right:5px",width:130},{xtype:"button",text:"查询",style:"margin-left:5px",cls:"x-btn-over",handler:function(){d.title=Ext.getCmp("title").getValue();d.content=Ext.getCmp("content").getValue();k.load({params:d})},listeners:{mouseout:function(n){n.addClass("x-btn-over")}}},{xtype:"button",text:"清空",handler:function(){Ext.getCmp("title").setValue();Ext.getCmp("content").setValue();d.title="";d.content="";k.load({params:d})}}]}),bbar:g});var e=new Ext.tree.AsyncTreeNode({text:"所有版块",forumId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var i=new Ext.tree.TreeLoader({dataUrl:j.baseUrl+"&task=getForumTree&type=all",preloadChildren:true,clearOnLoad:false});var m=new Ext.tree.TreePanel({region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,hideBorders:true,border:false,rootVisible:true,split:true,bodyStyle:"border-right-width:1px;",lines:true,animCollapse:false,animate:false,loader:i,root:e,autoScroll:true,listeners:{click:function(n){d.forumId=n.attributes.forumId;k.load({params:d})}},tbar:["版块列表: &nbsp;","->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.reload()}}]});var a=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,region:"center",items:[m,b]});return a},deleteReply:function(b,a){var d=this;Ext.Ajax.request({url:d.baseUrl+"&task=deleteReply",params:{ids:b},success:function(e){var f=Ext.decode(e.responseText);CNOA.msg.notice2(f.msg);a.reload()}})}};var CNOA_news_bbs_setting,CNOA_news_bbs_settingClass;CNOA_news_bbs_settingClass=new CNOA.Class.create();CNOA_news_bbs_settingClass.prototype={init:function(){this.baseUrl="index.php?app=news&func=bbs&action=setting";this.forumPanel=this.getForumPanel();this.postPanel=this.getPostPanel();this.friendLinkPanel=this.getFriendLinkPanel();this.otherPanel=this.getOtherPanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.forumPanel,this.postPanel,this.friendLinkPanel,this.otherPanel]})},getForumPanel:function(){var h=this;var f=[{name:"id"},{name:"forumId"},{name:"faceUrl"},{name:"name"},{name:"fName"},{name:"info"},{name:"topics"},{name:"reply"},{name:"browse"}];var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var i=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:"forumId",dataIndex:"forumId",hidden:true},{header:"faceUrl",dataIndex:"faceUrl",hidden:true},{header:"版块名称",dataIndex:"name",width:100,align:"left"},{header:"简介",dataIndex:"info",width:500},{header:"所属主版块",dataIndex:"fName",width:100,align:"left"},{header:"帖子",dataIndex:"topics",width:50},{header:"回复",dataIndex:"reply",width:50},{header:"浏览",dataIndex:"browse",width:50}]});var j=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getForumList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:f})});var b=new Ext.grid.GridPanel({region:"center",store:j,cm:i,sm:d,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){j.reload()}},"-",{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){h.editForum("add",j)}},"-",{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(l){var m=b.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{if(m.length>1){CNOA.miniMsg.alertShowAt(l,lang("onlyOneItem"))}else{h.editForum("edit",j,"",m[0].json)}}}},"-",{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(l,m){var n=b.getSelectionModel().getSelections();if(n.length==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(l,lang("sureDel"),function(){var o=[];Ext.each(n,function(q,p){o.push(q.json.id)});h.deleteForum(o.join(","),j)})}}}]})});var e=new Ext.tree.AsyncTreeNode({text:"所有主版块",forumId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var g=new Ext.tree.TreeLoader({dataUrl:h.baseUrl+"&task=getForumTree",preloadChildren:true,clearOnLoad:false});var k=new Ext.tree.TreePanel({region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,hideBorders:true,border:false,rootVisible:true,split:true,bodyStyle:"border-right-width:1px;",lines:true,animCollapse:false,animate:false,loader:g,root:e,autoScroll:true,listeners:{click:function(l){j.load({params:{forumId:l.attributes.forumId}})}},tbar:[{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){var l=h.editForum("add",e,true)}},"-",{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(l){var m=k.getSelectionModel().getSelectedNode();if(m==null||m.attributes.forumId=="0"){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{h.editForum("edit",e,true,m.attributes)}}},"-",{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(l){var m=k.getSelectionModel().getSelectedNode();if(m==null||m.attributes.forumId=="0"){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(l,lang("sureDel"),function(){h.deleteMainForum(m.attributes.forumId,e,j)})}}}]});var a=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,region:"center",title:"版块管理",items:[k,b]});return a},getPostPanel:function(){var j=this;var d={uid:0,title:"",forumId:0};var h=[{name:"id"},{name:"title"},{name:"author"},{name:"posttime"},{name:"reply"},{name:"browse"}];var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var k=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"id",dataIndex:"id",hidden:true},{header:"标题",dataIndex:"title",width:300,align:"left"},{header:"作者",dataIndex:"author",width:100},{header:"发表时间",dataIndex:"posttime",width:140},{header:"回复",dataIndex:"reply",width:50},{header:"浏览",dataIndex:"browse",width:50},{header:lang("opt"),dataIndex:"id",width:60,sortable:false,menuDisabled:true,renderer:this.makeOperate.createDelegate(this)}]});var m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:j.baseUrl+"&task=getPostList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:h})});var g=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:m,pageSize:2});var b=new Ext.grid.GridPanel({region:"center",store:m,cm:k,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){m.reload()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(n){var o=b.getSelectionModel().getSelections();if(o.length==0){CNOA.miniMsg.alertShowAt(n,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(n,lang("sureDel"),function(){var p=[];Ext.each(o,function(r,q){p.push(r.json.id)});j.deletePost(p.join(","),m)})}}},"-",("标题："),{xtype:"textfield",id:"title",style:"margin-right:5px",width:130},(" 作者："),{xtype:"userselectorfield",id:"uid",width:100,allowBlank:false,multiSelect:false},{xtype:"button",text:"查询",style:"margin-left:5px",cls:"x-btn-over",handler:function(){d.uid=Ext.getCmp("uid").getValue();d.title=Ext.getCmp("title").getValue();m.load({params:d})},listeners:{mouseout:function(n){n.addClass("x-btn-over")}}},{xtype:"button",text:"清空",handler:function(){Ext.getCmp("uid").clearValue();Ext.getCmp("title").setValue();d.uid=0;d.title="";m.load({params:d})}}]}),bbar:g});var e=new Ext.tree.AsyncTreeNode({text:"所有版块",forumId:"0",iconCls:"icon-tree-root-cnoa",cls:"feeds-node",expanded:true});var i=new Ext.tree.TreeLoader({dataUrl:j.baseUrl+"&task=getForumTree&type=all",preloadChildren:true,clearOnLoad:false});var l=new Ext.tree.TreePanel({region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,hideBorders:true,border:false,rootVisible:true,split:true,bodyStyle:"border-right-width:1px;",lines:true,animCollapse:false,animate:false,loader:i,root:e,autoScroll:true,listeners:{click:function(n){d.forumId=n.attributes.forumId;m.load({params:d})}},tbar:["版块列表: &nbsp;","->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.reload()}}]});var a=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,region:"center",title:"帖子管理",items:[l,b]});return a},getFriendLinkPanel:function(){var e=this;var b=[{name:"id"},{name:"name"},{name:"url"},{name:"order"}];var g=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),g,{header:"id",dataIndex:"id",hidden:true},{header:"标题",dataIndex:"name",width:100,align:"left",editor:new Ext.form.TextField({allowBlank:false})},{header:"地址",dataIndex:"url",width:400,editor:new Ext.form.TextField({allowBlank:false})},{header:"排序",dataIndex:"order",width:50,editor:new Ext.form.NumberField({nanText:"只能是数字",allowNegative:false,allowDecimals:false,allowBlank:false})}]});var f=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getFriendLinkList",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:b})});var d=new Ext.grid.EditorGridPanel({region:"center",store:f,title:"友情链接",cm:a,sm:g,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.reload()}},"-",{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.addFriendLink("add",f)}},"-",{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(h){var i=d.getSelectionModel().getSelections();if(i.length==0){CNOA.miniMsg.alertShowAt(h,lang("mustSelectOneRow"))}else{CNOA.miniMsg.cfShowAt(h,lang("sureDel"),function(){var j=[];Ext.each(i,function(l,k){j.push(l.json.id)});e.deleteFriendLink(j.join(","),f)})}}}]}),listeners:{afteredit:function(j){var i=j.field,k=j.record.get("id"),h=j.value;e.updateFriendLink(k,i,h,f)}}});return d},getOtherPanel:function(){var a=this;return new Ext.Panel({title:"其他设置",items:[{xtype:"form",width:200,bodyBorder:false,labelWidth:100,labelAlign:"left",id:"orderForm",style:"margin: 5px;",items:[{xtype:"numberfield",fieldLabel:"帖子条数",nanText:"只能是数字",allowNegative:false,allowDecimals:false,name:"postListPagesize",width:50},{xtype:"numberfield",fieldLabel:"回复条数",nanText:"只能是数字",allowNegative:false,allowDecimals:false,name:"replyListPagesize",width:50},{xtype:"checkbox",fieldLabel:"桌面显示最新帖子",name:"desktopNewPost"},{xtype:"checkbox",fieldLabel:"桌面显示最新回复",name:"desktopNewReply"},{xtype:"checkbox",fieldLabel:"桌面显示本周热门",name:"desktopWeekHot"}],buttons:[{text:"保存",handler:function(){var b=Ext.getCmp("orderForm");if(b.getForm().isValid()){b.getForm().submit({url:a.baseUrl+"&task=submitToSetting",method:"POST",waitMsg:lang("notice"),success:function(d,e){CNOA.msg.notice2(e.result.msg)},failure:function(d,e){CNOA.msg.alert(e.result.msg)}})}}}],listeners:{afterRender:function(){Ext.Ajax.request({url:a.baseUrl+"&task=getOrderFile",success:function(b){var d=Ext.decode(b.responseText);Ext.getCmp("orderForm").getForm().setValues(d)}})}}}]})},deleteMainForum:function(e,a,d){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=deleteMainForum",params:{id:e},success:function(f){var g=Ext.decode(f.responseText);CNOA.msg.notice2(g.msg);a.reload();d.load()}})},deleteForum:function(b,a){var d=this;Ext.Ajax.request({url:d.baseUrl+"&task=deleteForum",params:{ids:b},success:function(e){var f=Ext.decode(e.responseText);CNOA.msg.notice2(f.msg);a.reload()}})},editForum:function(i,j,e,k){var h=this;var g=function(){if(a.getForm().isValid()){a.getForm().submit({url:h.baseUrl+"&task=editForum",method:"POST",waitMsg:lang("notice"),success:function(l,m){CNOA.msg.notice2(m.result.msg);j.reload();f.close()},failure:function(l,m){CNOA.msg.alert(m.result.msg)}})}};var d=[{xtype:"textfield",fieldLabel:"版块名称",allowBlank:false,name:"name"},{xtype:"hidden",name:"forumId"}];var b=[{layout:"column",width:600,items:[{layout:"form",columnWidth:0.5,items:[{fieldLabel:"版块名称",xtype:"textfield",allowBlank:false,name:"name",width:150}]},{layout:"form",columnWidth:0.5,items:[{xtype:"combo",displayField:"name",valueField:"id",triggerAction:"all",fieldLabel:"主版块",editable:false,allowBlank:false,hiddenName:"fid",mode:"local",width:130,store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getMainForumList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["id","name"]}),listeners:{load:function(){if(!e){var n=a.getForm().findField("fid");if(k){var m=n.getValue();n.setValue(m)}else{var l=n.store.reader.jsonData.data[0].id;n.setValue(l)}}}}})}]}]},{xtype:"textarea",fieldLabel:"简介",allowBlank:false,name:"info",width:430},{fieldLabel:"版块图像",bodyStyle:"text-align:center;margin-top:7px;",hideBorders:true,border:false,items:[{html:'<div style="border:1px solid #CCC;width:160px;height:160px;display: table-cell;vertical-align: middle;"><img src="app/news/bbs/images/border.jpg" style="width:160px;height:160px;" id="CNOA_MY_INDEX_INFO_FACEBOX"></div>'},{xtype:"button",width:160,style:"margin-top: 3px;",text:"修改图像",handler:function(){h.showUpdateFaceDialog(a)}}]},{xtype:"hidden",name:"forumId"},{xtype:"hidden",name:"faceUrl"}];var a=new Ext.form.FormPanel({labelAlign:"right",labelWidth:65,buttonAlign:e?"center":"right",border:false,bodyBorder:false,frame:true,bodyStyle:"padding-right: 10px;",items:e?d:b,buttons:[{text:"确定",handler:g},{text:"取消",handler:function(){f.close()}}],keys:[{key:13,fn:function(){g()},scope:this}],listeners:{afterrender:function(){if(i=="edit"){a.getForm().setValues(k);if(k.faceUrl!=""){setTimeout(function(){Ext.fly("CNOA_MY_INDEX_INFO_FACEBOX").dom.src=k.faceUrl},200)}}}}});var f=new Ext.Window({title:i=="edit"?"修改版块":"增加版块",width:e?250:600,items:[a],listeners:{show:function(){a.getForm().findField("name").focus("",100)}}}).show()},deletePost:function(b,a){var d=this;Ext.Ajax.request({url:d.baseUrl+"&task=deletePost",params:{ids:b},success:function(e){var f=Ext.decode(e.responseText);CNOA.msg.notice2(f.msg);a.reload()}})},deleteFriendLink:function(b,a){var d=this;Ext.Ajax.request({url:d.baseUrl+"&task=deleteFriendLink",params:{ids:b},success:function(e){var f=Ext.decode(e.responseText);CNOA.msg.notice2(f.msg);a.reload()}})},addFriendLink:function(d,b){var e=this;var f=function(){if(a.getForm().isValid()){a.getForm().submit({url:e.baseUrl+"&task=addFriendLink",method:"POST",waitMsg:lang("notice"),success:function(h,i){CNOA.msg.notice2(i.result.msg);b.reload();g.close()},failure:function(h,i){CNOA.msg.alert(i.result.msg)}})}};var a=new Ext.form.FormPanel({labelWidth:35,buttonAlign:"center",border:false,bodyBorder:false,frame:true,bodyStyle:"padding-right: 10px;",items:[{layout:"column",items:[{layout:"form",columnWidth:0.6,items:[{xtype:"textfield",fieldLabel:"标题",allowBlank:false,name:"name"}]},{layout:"form",columnWidth:0.4,items:[{xtype:"numberfield",width:80,fieldLabel:"排序",nanText:"只能是数字",allowNegative:false,allowDecimals:false,name:"order"}]}]},{xtype:"textfield",fieldLabel:"地址",allowBlank:false,width:268,name:"url"}],buttons:[{text:"确定",handler:f},{text:"取消",handler:function(){g.close()}}],keys:[{key:13,fn:function(){f()},scope:this}]});var g=new Ext.Window({title:"添加友情链接",width:350,items:[a],listeners:{show:function(){a.getForm().findField("name").focus("",100)}}}).show()},updateFriendLink:function(f,e,d,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=updateFriendLink",params:{id:f,field:e,value:d},success:function(h){var g=Ext.decode(h.responseText);if(g.failure===true){CNOA.msg.alert(g.msg);a.reload()}else{CNOA.msg.notice2(g.msg);a.reload()}}})},makeOperate:function(g,e,a,i,d,f){var b="<a href='javascript:void(0);' class='gridview' onclick='CNOA_news_bbs_setting.view("+g+");'>"+lang("view")+"</a>";return b},view:function(a){mainPanel.closeTab("CNOA_MENU_NEWS_BBS_BBS");mainPanel.loadClass("index.php?app=news&func=bbs&action=bbs&pid="+a,"CNOA_MENU_NEWS_BBS_BBS","站内论坛","icon-system-notice")},showUpdateFaceDialog:function(a){var b=this;this.FACE_WINDOW_FORMPANEL=new Ext.FormPanel({fileUpload:true,autoHeight:true,autoScroll:false,waitMsgTarget:true,hideBorders:true,border:false,bodyStyle:"padding: 5px;",buttonAlign:"right",items:[{xtype:"fileuploadfield",name:"face",allowBlank:false,blankText:lang("updateFaceBlankText"),buttonCfg:{text:lang("browse")},hideLabel:true,width:370,listeners:{fileselected:function(e,d){}}}],buttons:[{text:lang("save"),handler:function(){if(this.FACE_WINDOW_FORMPANEL.getForm().isValid()){this.FACE_WINDOW_FORMPANEL.getForm().submit({url:b.baseUrl+"&task=upFace",waitMsg:lang("waiting"),params:{},success:function(d,e){a.getForm().findField("faceUrl").setValue(e.result.msg);Ext.fly("CNOA_MY_INDEX_INFO_FACEBOX").dom.src=e.result.msg;b.FACE_WINDOW.close()},failure:function(d,e){CNOA.msg.alert(e.result.msg,function(){b.FACE_WINDOW.close()})}})}}.createDelegate(this)},{text:lang("close"),handler:function(){b.FACE_WINDOW.close()}}]});this.FACE_WINDOW=new Ext.Window({width:398,height:123,autoScroll:false,modal:true,resizable:false,title:lang("upload")+lang("photo"),items:[this.FACE_WINDOW_FORMPANEL]}).show()}};var CNOA_news_bbs_view,CNOA_news_bbs_viewClass;CNOA_news_bbs_viewClass=new CNOA.Class.create();CNOA_news_bbs_viewClass.prototype={init:function(){var a="index.php?app=news&func=bbs&action=bbs&task=getIndex&model=browse&id="+CNOA.news.bbs.view.pid+"&fid="+CNOA.news.bbs.view.fid;this.mainPanel=new Ext.Panel({html:' <iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="'+a+'"> </iframe>'})}};var sm_news_news=1;
var CNOA_food_snack_basesettingClass,CNOA_food_snack_basesetting;CNOA_food_snack_basesettingClass=new CNOA.Class.create();CNOA_food_snack_basesettingClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=food&func=snack&action=basesetting";this.today=this.todayPanel();this.pro=this.proPanel();this.userMoney=this.userMoneyPanel();this.recordList=this.recordPanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:150,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.today,this.pro,this.userMoney,this.recordList]})},todayPanel:function(){var c=this;var b=function(d){return new Ext.data.Store({autoLoad:true,baseParams:{status:d},proxy:new Ext.data.HttpProxy({url:c.baseUrl+"&task=getStoreList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["id","name"]})})};var a=new Ext.form.FormPanel({title:lang("menu"),border:false,autoScroll:false,padding:10,tbar:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=submit",method:"POST",success:function(d,e){CNOA.msg.notice2(e.result.msg)},failure:function(d,e){CNOA.msg.alert(e.result.msg)}})}}}],items:[{xtype:"fieldset",title:lang("isEnable"),style:"margin: 10px;",items:[{xtype:"itemselector",name:"store",width:700,imagePath:"extjs/3.4.0/ux/images",multiselects:[{width:250,height:200,store:b(0),displayField:"name",valueField:"id"},{width:250,height:200,store:b(1),displayField:"name",valueField:"id",tbar:[{text:lang("clear2"),handler:function(){a.getForm().findField("store").reset()}}]}]}]}]});return a},proPanel:function(){var d=this;var c=Ext.id();var a=new Ext.form.FormPanel({title:"权限设置",border:false,padding:10,tbar:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){a.getForm().submit({url:d.baseUrl+"&task=faqiPermit",method:"POST",success:function(e,f){CNOA.msg.notice2(f.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg)}})}}],items:[{xtype:"hidden",listeners:{beforerender:function(){b()}}},{xtype:"fieldset",title:"发起人权限",items:[{xtype:"textarea",height:45,width:580,readOnly:true,fieldLabel:"发起人",name:"faqiNames",emptyText:lang("clickSelectPerson"),style:{marginBottom:"3px"},listeners:{render:function(e){e.to=c},focus:function(e){people_selector("user",e,true,false)}}},{xtype:"hidden",name:"faqiIDs",id:c}]},{xtype:"displayfield",style:"color: red",value:"如果为空,则全部人都可以发起"},{xtype:"fieldset",title:"是否启用自动扣费",items:[{xtype:"radiogroup",width:200,items:[{boxLabel:lang("yes"),name:"auto",inputValue:1},{boxLabel:lang("no"),name:"auto",checked:true,inputValue:0}]}]}]});var b=function(){a.getForm().load({url:d.baseUrl+"&task=getPermit"})};return a},userMoneyPanel:function(){var f=this;var e=[{name:"uid"},{name:"truename"},{name:"deptName"},{name:"key"},{name:"total"},{name:"usedSum"},{name:"balance"}];var i=function(k){if(k==null||k==0){k=lang("notBind")}return k};var d={truename:"",deptId:""};var c=new Ext.form.TextField({width:100,listeners:{specialkey:function(){var k=c.getValue();d.truename=k;d.deptId=j.getValue();f.store.load()}}});var j=new CNOA.selector.form.DepartmentSelectorField({hiddenName:"deptid",name:"dept",width:100,multiselect:false,selectorType:"dept"});var g=function(n,m,k){var l=k.json.uid;return"<a href='javascript:void(0);' class='gridview' onclick=\"CNOA_food_snack_basesetting.setting("+l+",'update');\">"+lang("increment")+"</a><a href='javascript:void(0);' class='gridview3 jianju' onclick=\"CNOA_food_snack_basesetting.setting("+l+",'reset');\">"+lang("reset")+"</a>"};var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:130,sortable:false,menuDisabled:true},{header:lang("belongDept"),dataIndex:"deptName",width:130,sortable:true,menuDisabled:true},{header:"唯一标识符",dataIndex:"key",width:120,sortable:false,menuDisabled:true,editor:new Ext.form.TextField(),renderer:i},{header:lang("totalAmount"),dataIndex:"total",width:120,menuDisabled:true},{header:lang("useAmounYuan"),dataIndex:"usedSum",width:120,menuDisabled:true},{header:lang("usableAmountYuan"),dataIndex:"balance",width:120,menuDisabled:true},{header:lang("opt"),dataIndex:"",renderer:g,menuDisabled:true,width:110}]);this.store=new Ext.data.Store({autoLoad:true,baseParams:d,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var b=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:f.store,pageSize:15});var a=new Ext.grid.EditorGridPanel({title:"用户充值",store:f.store,cm:h,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}},{text:"同步考勤机标识符",iconCls:"icon-SYNC",cls:"btn-blue4",handler:function(){CNOA.msg.cf("是否确定将考勤机标识符同步到标识符<br>若选择确定，则将<font color=red>清空</font>现有的标识符，以考勤机标识符为主, 请慎重操作!",function(k){if(k=="yes"){f.synchronization()}})}},{text:"同步薪酬标识符",iconCls:"icon-SYNC",cls:"btn-blue4",handler:function(){CNOA.msg.cf("是否确定将薪酬标识符同步到标识符<br>若选择确定，则将<font color=red>清空</font>现有的标识符，以薪酬标识符为主, 请慎重操作!",function(k){if(k=="yes"){f.synchronization2()}})}},lang("truename")+":",c,lang("department")+":",j,{text:lang("search"),cls:"x-btn-over",listeners:{mouseout:function(k){k.addClass("x-btn-over")}},handler:function(){var k=c.getValue();d.truename=k;d.deptId=j.getValue();f.store.load()}},{text:lang("clear"),handler:function(){d.truename="";d.deptId="";c.setValue("");j.setValue("");f.store.load()}},'<span style="color:red"> >>>标识符避免同姓名的用户</span>']}),bbar:b,listeners:{afteredit:function(l){var n=l.field,m=l.value,k=l.record.data.uid;f.updateKey(k,n,m)}}});return a},updateKey:function(a,d,c){var e=this,b=/^[a-zA-Z0-9]+$/;if(c.match(b)==null&&c!=0&&c!=""){CNOA.msg.alert("唯一标识符只能为英文字母和数字的组合");return}Ext.Ajax.request({url:e.baseUrl+"&task=updateKey",params:{uid:a,field:d,value:c},success:function(f){var g=Ext.decode(f.responseText);if(g.failure){CNOA.msg.alert(g.msg)}else{if(g.success){CNOA.msg.notice2(g.msg)}}e.store.reload()}})},synchronization:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=synchronization",success:function(b){var c=Ext.decode(b.responseText);CNOA.msg.alert(c.msg);a.store.reload()}})},synchronization2:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=synchronization2",success:function(b){var c=Ext.decode(b.responseText);CNOA.msg.alert(c.msg);a.store.reload()}})},setting:function(c,b){var d=this;var a=new Ext.form.FormPanel({labelAlign:"right",padding:20,labelWidth:60,border:false,items:[{xtype:"numberfield",fieldLabel:lang("amount"),name:"total",allowBlank:false}]}),e=function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=updateAmount",method:"POST",params:{uid:c,opt:b},waitMsg:lang("notice"),success:function(f,g){CNOA.msg.notice2(g.result.msg);d.store.reload();win.close()},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};win=new Ext.Window({title:"金额设置",modal:true,layout:"fit",width:300,height:150,items:a,buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:e},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){win.close()}}]}).show()},recordPanel:function(){var f=this;var g=Ext.id();var j=Ext.id();var b=Ext.id();var e=[{name:"id"},{name:"type"},{name:"username"},{name:"deptname"},{name:"sum"},{name:"posttime"},{name:"optname"}];var d={type:"",uid:"",deptId:""};var k=new CNOA.selector.form.DepartmentSelectorField({hiddenName:"deptid",name:"dept",width:100,multiselect:false,selectorType:"dept"});var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"修改类型",dataIndex:"type",width:130},{header:"人员",dataIndex:"username"},{header:"所属部门",dataIndex:"deptname",width:120},{header:"修改金额",dataIndex:"sum"},{header:"修改时间",dataIndex:"posttime",width:140},{header:"修改人",dataIndex:"optname",width:120}]);var i=new Ext.data.Store({autoLoad:true,baseParams:d,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRecordList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var c=new Ext.PagingToolbar({displayInfo:true,store:i,pageSize:15});var a=new Ext.grid.GridPanel({title:"充值记录",store:i,cm:h,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.reload()}},lang("type"),{xtype:"combo",id:g,valueField:"id",displayField:"type",mode:"local",width:100,triggerAction:"all",forceSelection:true,editable:false,store:new Ext.data.ArrayStore({fields:["id","type"],data:[[1,lang("increment")],[2,lang("reset")]]})},lang("people"),{xtype:"textfield",id:j,readOnly:true,width:100,listeners:{render:function(l){l.to=b},focus:function(l){people_selector("user",l,false,false)}}},{xtype:"hidden",id:b},lang("department")+":",k,{text:lang("search"),cls:"x-btn-over",listeners:{mouseout:function(l){l.addClass("x-btn-over")}},handler:function(){d.type=Ext.getCmp(g).getValue();d.uid=Ext.getCmp(b).getValue();d.deptId=k.getValue();i.load()}},{text:lang("clear"),handler:function(){d.type="";d.uid="";d.deptId="";Ext.getCmp(g).setValue("");Ext.getCmp(j).setValue("");Ext.getCmp(b).setValue("");k.setValue("");i.load()}}]}),bbar:c});return a}};var CNOA_food_snack_cancellistClass,CNOA_food_snack_cancellist;CNOA_food_snack_cancellistClass=new CNOA.Class.create();CNOA_food_snack_cancellistClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=food&func=snack&action=cancellist";this.searchParams={storeId:""};this.panel=a.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.panel]})},centerPanel:function(){var h=this;var c=Ext.id();var g=[{name:"id"},{name:"store"},{name:"name"},{name:"addition"},{name:"quantity"},{name:"price"},{name:"remark"},{name:"posttime"},{name:"username"},{name:"info"}];this.gridstore=new Ext.data.GroupingStore({autoLoad:true,baseParams:h.searchParams,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g}),sortInfo:{field:"posttime",direction:"DESC"},groupOnSort:false,groupField:"store"});var d=new Ext.grid.CheckboxSelectionModel();var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("foodStore"),dataIndex:"store",width:120,sortable:true,menuDisabled:true},{header:lang("foodName"),dataIndex:"name",width:160,sortable:true,menuDisabled:true},{header:lang("sideDish"),dataIndex:"addition",width:120,sortable:true,menuDisabled:true},{header:lang("quantity"),dataIndex:"quantity",width:40,sortable:true,menuDisabled:true},{header:lang("unitPrice"),dataIndex:"price",width:50,sortable:true,menuDisabled:true},{header:lang("remark"),dataIndex:"remark",width:70,sortable:true,menuDisabled:true},{header:lang("cencelTime"),dataIndex:"posttime",width:140,sortable:true,menuDisabled:true},{header:lang("NameOfPassenger"),dataIndex:"username"},{header:lang("baseInfo2"),dataIndex:"info",hidden:true}]});var f=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:h.gridstore,pageSize:15});var e=Ext.id();var i=Ext.id();var b=new Ext.grid.GridPanel({border:false,store:h.gridstore,cm:j,sm:d,bbar:f,view:new Ext.grid.GroupingView({forceFit:false,startCollapsed:true}),tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){h.gridstore.reload()}},"-",lang("foodStore")+":",{xtype:"combo",valueField:"id",displayField:"text",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",width:120,id:c,store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"index.php?app=food&func=snack&action=setting&task=getSortList&type=combo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["id","text"]})})},"-",lang("NameOfPassenger")+":",{xtype:"hidden",name:"selectName",id:e},{xtype:"textfield",width:130,id:i,readOnly:true,listeners:{render:function(k){k.to=e},focus:function(k){people_selector("user",k,false,false)}}},"-",{text:lang("search"),cls:"x-btn-over",iconCls:"icon-search",listeners:{mouseout:function(k){k.addClass("x-btn-over")},click:function(k){h.searchParams.searchName=Ext.getCmp(e).getValue();h.searchParams.storeId=Ext.getCmp(c).getValue();h.gridstore.reload({params:h.searchParams})}}},{text:lang("clear2"),handler:function(){h.searchParams.searchName="";Ext.getCmp(e).setValue("");Ext.getCmp(i).setValue("");h.searchParams.storeId="";Ext.getCmp(c).setValue("");Ext.getCmp(c).setRawValue("");h.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a}};var CNOA_food_snack_myorderClass,CNOA_food_snack_myorder;CNOA_food_snack_myorderClass=new CNOA.Class.create();CNOA_food_snack_myorderClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=food&func=snack&action=myorder";this.panel=a.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.panel]})},centerPanel:function(){var h=this;var j=Ext.id();var c=Ext.id();var l=Ext.id();var g=[{name:"id"},{name:"store"},{name:"name"},{name:"addition"},{name:"quantity"},{name:"price"},{name:"remark"},{name:"posttime"},{name:"username"}];this.gridstore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g}),listeners:{load:function(){Ext.Ajax.request({url:h.baseUrl+"&task=getUserSum",success:function(n){var o=Ext.decode(n.responseText);Ext.getCmp(j).setValue(o.total);Ext.getCmp(c).setValue(o.usedSum);Ext.getCmp(l).setValue(o.balance)}})}}});var e=new Ext.grid.CheckboxSelectionModel();var i=function(q,p,n){var o=n.json.picture;if(o){p.attr="ext:qtip='<img src="+o+">'";return"<img width='30' height='30' src="+o+">"}};var k=function(q,p,n){var t=n.json.id,o=parseInt(n.json.stime),s=parseInt(n.json.etime),r=parseInt(Date.parse(new Date())/1000);if((o<r&&r<s)||(o<r&&s==0)){return"<a class='gridview2' href='javascript:void(0);' onclick='CNOA_food_snack_myorder.cancel("+t+")'>取消</a>"}};var m=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"",renderer:i,width:50},{header:lang("foodStore"),dataIndex:"store",width:120},{header:lang("foodName"),dataIndex:"name",width:160},{header:lang("sideDish"),dataIndex:"addition",width:120},{header:lang("quantity"),dataIndex:"quantity",width:40},{header:lang("unitPrice"),dataIndex:"price",width:50},{header:lang("remark"),dataIndex:"remark",width:70},{header:lang("presetTime"),dataIndex:"posttime",width:140},{header:lang("NameOfPassenger"),dataIndex:"username"},{header:lang("opt"),dataIndex:"",renderer:k}]});var f=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:h.gridstore,pageSize:15});var d=new Ext.form.TextField({width:130});var b=new Ext.grid.EditorGridPanel({border:false,store:h.gridstore,cm:m,sm:e,bbar:f,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){h.gridstore.reload()}},lang("totalAmount")+": ",{xtype:"displayfield",id:j,style:"color:red"},"已用金额: ",{xtype:"displayfield",id:c,style:"color:red"},"余额: ",{xtype:"displayfield",id:l,style:"color:red"}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},cancel:function(b){var a=this;if(!b){return}CNOA.msg.cf("您确定要取消吗？",function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=cancel",params:{id:b},success:function(d){var d=Ext.decode(d.responseText);if(d.success==true){a.gridstore.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})}};var CNOA_food_snack_orderingClass,CNOA_food_snack_ordering;CNOA_food_snack_orderingClass=new CNOA.Class.create();CNOA_food_snack_orderingClass.prototype={init:function(){var a=this;this.orderInfo=Ext.id();this.baseUrl="index.php?app=food&func=snack&action=ordering";this.searchParams={faqiId:"",storeId:""};this.tree=a.treePanel();this.panel=a.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.tree,this.panel]})},treePanel:function(){var c=this;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:280,minWidth:220,maxWidth:320,rootVisible:false,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:b,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("initiator"),"->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.treeRoot.reload()}}]}),listeners:{click:function(d){c.searchParams.faqiId=d.attributes.id;c.storeText=d.attributes.text;Ext.getCmp(c.orderInfo).setValue(d.text);c.gridstore.reload()}}});return a},centerPanel:function(){var i=this;var e=Ext.id();var k=Ext.id();var c=Ext.id();var m=Ext.id();var h=[{name:"id"},{name:"name"},{name:"price"},{name:"store"}];this.gridstore=new Ext.data.GroupingStore({autoLoad:true,baseParams:i.searchParams,proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:h}),sortInfo:{field:"id",direction:"ASC"},groupOnSort:false,groupField:"store",listeners:{load:function(){Ext.Ajax.request({url:i.baseUrl+"&task=getUserSum",success:function(o){var p=Ext.decode(o.responseText);Ext.getCmp(k).setValue(p.total);Ext.getCmp(c).setValue(p.usedSum);Ext.getCmp(m).setValue(p.balance)}})}}});var f=new Ext.grid.CheckboxSelectionModel();var j=function(r,q,o){var p=o.json.url;if(p){q.attr="ext:qtip='<img src="+p+">'";return"<img width='30' height='30' src="+p+">"}};var l=function(r,q,o){var s=o.json.id,p=o.json.name;return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_food_snack_ordering.orderWin("+s+',"'+p+"\")'>点餐</a>"};var n=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),f,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"",renderer:j,width:50},{header:lang("foodName"),dataIndex:"name",width:200},{header:lang("foodStore"),dataIndex:"store",width:120},{header:lang("unitPrice"),dataIndex:"price",width:120},{header:lang("opt"),dataIndex:"",renderer:l}]});var g=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],style:"border-left-width:1px;",displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:i.gridstore,pageSize:15});var d=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:i.gridstore,cm:n,sm:f,bbar:g,view:new Ext.grid.GroupingView({forceFit:false,startCollapsed:true,groupTextTpl:"{text}(共{[values.rs.length]}条)"}),tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.gridstore.reload()}},lang("foodStore")+":",{xtype:"combo",valueField:"id",displayField:"text",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",width:120,id:e,store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"index.php?app=food&func=snack&action=setting&task=getSortList&type=combo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["id","text"]})})},lang("name")+":",d,{text:lang("search"),cls:"x-btn-over",iconCls:"icon-search",listeners:{mouseout:function(o){o.addClass("x-btn-over")},click:function(o){i.searchParams.searchName=d.getValue();i.searchParams.storeId=Ext.getCmp(e).getValue();i.gridstore.reload({params:i.searchParams})}}},{text:lang("clear2"),handler:function(){i.searchParams.searchName="";i.searchParams.storeId="";d.setValue("");Ext.getCmp(e).setValue("");Ext.getCmp(e).setRawValue("");i.gridstore.reload()}},lang("totalAmount")+": ",{xtype:"displayfield",id:k,style:"color:red"},"已用金额: ",{xtype:"displayfield",id:c,style:"color:red"},"余额: ",{xtype:"displayfield",id:m,style:"color:red"},"订餐发起人/时间: ",{xtype:"displayfield",id:i.orderInfo,style:"color:red"}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},createOption1:function(b,c,a){return new Ext.form.Radio({name:"price",checked:a==1?true:false,boxLabel:c,inputValue:b})},createOption2:function(a,b){return new Ext.form.Checkbox({name:"addition[]",boxLabel:b,inputValue:a})},orderWin:function(b,h){var e=this;var a=Ext.id();var d=Ext.id();var i=Ext.id();var c=new Ext.form.FormPanel({border:false,labelAlign:"right",labelWidth:80,padding:10,autoScroll:true,items:[{xtype:"fieldset",title:h,items:[{xtype:"displayfield",fieldLabel:lang("name"),value:h},{xtype:"panel",id:a,border:false,fieldLabel:lang("unitPrice")},{xtype:"numberfield",allowDecimals:false,fieldLabel:lang("quantity"),name:"quantity",width:30,value:1},{xtype:"textarea",name:"remark",width:220,height:50,fieldLabel:lang("remark")},{xtype:"panel",id:d,border:false,autoScroll:true,fieldLabel:lang("sideDish")}]}]});var f=new Ext.Window({border:false,width:500,height:400,layout:"fit",modal:true,items:[c],buttons:[{text:"确定点餐",handler:function(){g()}},{text:lang("cancel"),handler:function(){f.close()}}],listeners:{render:function(){Ext.Ajax.request({url:e.baseUrl+"&task=loadPrice",method:"POST",params:{bid:b},success:function(k){var l=Ext.decode(k.responseText);for(var j=0;j<l.length;j++){if(j==0){this.priceType=1}else{this.priceType=0}Ext.getCmp(a).add(e.createOption1(l[j].id,l[j].price,this.priceType))}Ext.getCmp(a).doLayout()}});Ext.Ajax.request({url:e.baseUrl+"&task=loadAddition",method:"POST",params:{bid:b},success:function(m){var n=Ext.decode(m.responseText);var k=[];if(n.length>0){for(var l=0;l<n.length;l++){k.push({boxLabel:n[l].name+"<span style='color: red;'>/"+n[l].price+"元</span>",name:"addition[]",inputValue:n[l].id,checked:false})}var j=new Ext.form.CheckboxGroup({columns:3,items:k});Ext.getCmp(d).add(j);Ext.getCmp(d).doLayout()}}})}}});var g=function(){if(c.getForm().isValid()){c.getForm().submit({url:e.baseUrl+"&task=submit",method:"POST",params:{bid:b,fid:e.searchParams.faqiId},success:function(j,k){f.close();e.gridstore.reload();CNOA.msg.notice2(k.result.msg)},failure:function(j,k){CNOA.msg.alert(k.result.msg)}})}};f.show()}};var CNOA_food_snack_orderlistClass,CNOA_food_snack_orderlist;CNOA_food_snack_orderlistClass=new CNOA.Class.create();CNOA_food_snack_orderlistClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=food&func=snack&action=orderlist";this.searchParams={faqiId:""};this.tree=a.treePanel();this.panel=a.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.tree,this.panel]})},treePanel:function(){var c=this;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:280,minWidth:220,maxWidth:320,rootVisible:false,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:b,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){c.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("launch"),iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){c.faqi()}},{text:"结束点餐",cls:"x-btn-over",cls:"btn-red1",listeners:{mouseout:function(d){d.addClass("x-btn-over")},click:function(d){if(!c.searchParams.faqiId){CNOA.msg.alert("请选择要结束的订单")}else{Ext.Ajax.request({url:c.baseUrl+"&task=endOperate",params:{fid:c.searchParams.faqiId},success:function(e){var f=Ext.decode(e.responseText);if(f.success==true){CNOA.msg.notice2(f.msg);c.treeRoot.reload()}else{CNOA.msg.alert(f.msg)}}})}}}},("<span style='color:#999'>右键可删除</span>")]}),contextMenu:new Ext.menu.Menu({items:[{iconCls:"delete",text:lang("del")}],listeners:{itemclick:function(e){var d=e.parentMenu.contextNode.attributes;switch(e.iconCls){case"delete":c.deleteFaqi(d);break}e.parentMenu.hide()}}}),listeners:{click:function(d){c.searchParams.faqiId=d.attributes.id;c.gridstore.reload()},contextmenu:function(f,g){appContextmenu=false;f.select();var d=f.getOwnerTree();var h=d.contextMenu;h.contextNode=f;h.showAt(g.getXY())}}});return a},deleteFaqi:function(a){var b=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteFaqi",method:"POST",params:{fid:a.id},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.searchParams.storeId="";b.treeRoot.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},centerPanel:function(){var g=this;var f=[{name:"id"},{name:"store"},{name:"name"},{name:"addition"},{name:"quantity"},{name:"price"},{name:"remark"},{name:"posttime"},{name:"username"},{name:"info"}];this.gridstore=new Ext.data.GroupingStore({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),sortInfo:{field:"name",direction:"ASC"},remoteSort:true,groupOnSort:false,groupField:"info"});var d=new Ext.grid.CheckboxSelectionModel();var h=function(n,m,k){var l=k.json.picture;if(l){m.attr="ext:qtip='<img src="+l+">'";return"<img width='30' height='30' src="+l+">"}};var i=function(m,l,k){var n=k.json.id;return"<a class='gridview' href='javascript:void(0);' onclick='CNOA_food_snack_orderlist.remind("+n+")'>提醒</a>"};var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"",renderer:h,width:50},{header:lang("foodStore"),dataIndex:"store",width:120,sortable:true,menuDisabled:true},{header:lang("foodName"),dataIndex:"name",width:160,sortable:true,menuDisabled:true},{header:lang("sideDish"),dataIndex:"addition",width:120,sortable:true,menuDisabled:true},{header:lang("quantity"),dataIndex:"quantity",width:40,sortable:true,menuDisabled:true},{header:lang("unitPrice"),dataIndex:"price",width:50,sortable:true,menuDisabled:true},{header:lang("remark"),dataIndex:"remark",width:70,sortable:true,menuDisabled:true},{header:lang("presetTime"),dataIndex:"posttime",width:140,sortable:true,menuDisabled:true},{header:lang("NameOfPassenger"),dataIndex:"username"},{header:lang("baseInfo2"),dataIndex:"info",hidden:true},{header:lang("opt"),dataIndex:"",renderer:i}]});var e=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],style:"border-left-width:1px;",displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:g.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.GridPanel({border:false,store:g.gridstore,cm:j,sm:d,bbar:e,view:new Ext.grid.GroupingView({forceFit:false,startCollapsed:true}),tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},lang("name")+":",c,"-",{text:lang("search"),iconCls:"icon-hr-search",listeners:{click:function(k){g.searchParams.searchName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue4",handler:function(){if(g.searchParams.faqiId){Ext.MessageBox.confirm(lang("export2"),"是否导出订单列表",function(k){if(k=="yes"){Ext.Ajax.request({url:g.baseUrl+"&task=export&step=1",method:"POST",params:{faqi:g.searchParams.faqiId},success:function(m){var l=Ext.decode(m.responseText);if(l.success==true){ajaxDownload(g.baseUrl+"&task=export&file="+l.msg+"&step=2")}else{CNOA.msg.alert(l.msg,function(){})}},failure:function(m){var l=Ext.decode(m.responseText);CNOA.msg.alert(l.msg)}})}})}else{CNOA.msg.alert("请选择点餐列表项")}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.gridstore.reload()}},"<span style='color: red;'>时间结束,截止点餐;请结束前联系商家,以防出现商家没有菜</span>"]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},faqi:function(){var f=this;var e=Ext.id();var a=Ext.id();var b=new Ext.form.FormPanel({border:false,labelWidth:70,autoScroll:true,labelAlign:"right",padding:10,items:[{xtype:"checkbox",fieldLabel:"通知提醒",checked:true,name:"mss",listeners:{check:function(h,g){if(g){Ext.getCmp(a).show()}else{Ext.getCmp(a).hide()}}}},{xtype:"textfield",fieldLabel:"订餐标题",allowBlank:false,width:160,name:"orderTitle"},{xtype:"datetimefield",fomat:"Y-m-d H:i:s",fieldLabel:lang("startTime"),minValue:new Date(),allowBlank:false,width:160,name:"stime"},{xtype:"datetimefield",fomat:"Y-m-d H:i:s",fieldLabel:lang("endTime"),minValue:new Date(),width:160,name:"etime"},{xtype:"displayfield",value:'<span style="color: red">结束时间为空,则需手动结束订单(推荐)</span>'},{xtype:"panel",border:false,fieldLabel:lang("foodStore"),id:e},{xtype:"displayfield",value:'<span style="color: red">商家不勾选，则默认为全部</span>'},{xtype:"textarea",fieldLabel:lang("noticeContent"),name:"mssContent",id:a,hidden:false,width:160,height:50}]});var d=new Ext.Window({width:360,height:300,layout:"fit",modal:true,border:false,autoScroll:true,items:[b],buttons:[{text:lang("save"),handler:function(){c()}},{text:lang("cancel"),handler:function(){d.close()}}],listeners:{render:function(){Ext.Ajax.request({url:f.baseUrl+"&task=loadStore",method:"POST",success:function(k){var l=Ext.decode(k.responseText);var h=[];for(var j=0;j<l.length;j++){h.push({boxLabel:l[j].name,name:"store[]",inputValue:l[j].id,checked:false})}var g=new Ext.form.CheckboxGroup({columns:2,items:h});Ext.getCmp(e).add(g);Ext.getCmp(e).doLayout()}})}}});var c=function(){if(b.getForm().isValid()){b.getForm().submit({url:f.baseUrl+"&task=submit",success:function(g,h){f.treeRoot.reload();d.close();CNOA.msg.notice2(h.result.msg)},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}};d.show()},remind:function(d){var c=this;var a=new Ext.form.FormPanel({border:false,labelAlign:"right",labelWidth:70,padding:10,items:[{xtype:"textarea",fieldLabel:lang("remind"),allowBlank:false,name:"remind",value:"没有这个菜了,请重新点餐",width:160},{xtype:"checkbox",boxLabel:"删除订单",checked:true,name:"del"},{xtype:"checkbox",boxLabel:"提醒并删除相关此菜单的订单",name:"all"}]});var b=new Ext.Window({border:false,modal:true,width:300,height:220,layout:"fit",items:[a],buttons:[{text:lang("remind"),cls:"btn-blue4",handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=remind",params:{id:d},success:function(f,e){b.close();c.gridstore.reload();CNOA.msg.notice2(e.result.msg)},failure:function(f,e){CNOA.msg.alert(e.result.msg)}})}}},{text:lang("cancel"),handler:function(){b.close()}}]});b.show()}};var CNOA_food_snack_settingClass,CNOA_food_snack_setting;CNOA_food_snack_settingClass=new CNOA.Class.create();CNOA_food_snack_settingClass.prototype={init:function(){var a=this;this.ID_WEEK_GROUP=Ext.id();this.baseUrl="index.php?app=food&func=snack&action=setting";this.searchParams={storeId:""};this.tree=a.treePanel();this.panel=a.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.tree,this.panel]})},treePanel:function(){var c=this;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});var b=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getSortList&type=tree",preloadChildren:true,clearOnLoad:false});var a=new Ext.tree.TreePanel({border:false,region:"west",split:true,width:250,minWidth:220,maxWidth:320,rootVisible:false,lines:true,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:b,root:this.treeRoot,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[lang("foodStore"),"->",{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){c.editStoreWin("")}},{handler:function(d,e){c.treeRoot.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"-",("<span style='color:#999'>右键可编辑</span>")]}),contextMenu:new Ext.menu.Menu({items:[{iconCls:"addition",text:lang("sideDish")},{iconCls:"edit",text:lang("modify")},{iconCls:"delete",text:lang("del")}],listeners:{itemclick:function(e){var d=e.parentMenu.contextNode.attributes;switch(e.iconCls){case"addition":c.additionWin(d);break;case"edit":c.editStoreWin(d);break;case"delete":c.deleteStore(d);break}e.parentMenu.hide()}}}),listeners:{click:function(d){c.searchParams.storeId=d.attributes.id;c.storeText=d.attributes.text;c.gridstore.reload()},contextmenu:function(f,g){appContextmenu=false;f.select();var d=f.getOwnerTree();var h=d.contextMenu;h.contextNode=f;h.showAt(g.getXY())}}});return a},additionWin:function(d){var h=this;var l=d.id;var e=[{name:"id"},{name:"name"},{name:"price"}];var i=new Ext.data.Store({autoLoad:true,baseParams:{storeId:l},proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=additionList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e}),listeners:{update:function(o,n,p){if(p==Ext.data.Record.EDIT){Ext.Ajax.request({url:h.baseUrl+"&task=editAddition",params:{storeId:l,name:n.get("name"),id:n.get("id"),price:n.get("price")},success:function(q){var r=Ext.decode(q.responseText);if(r.success==true){o.reload();CNOA.msg.notice2(r.msg)}else{if(r.failure==true){CNOA.msg.alert(r.msg)}}}})}}}});var b=new Ext.grid.CheckboxSelectionModel();var j=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"id",hidden:true},{header:lang("name"),dataIndex:"name",width:200,editor:new Ext.form.TextField({allowBlank:false})},{header:lang("unitPrice"),dataIndex:"price",width:120,editor:new Ext.form.NumberField({allowBlank:false})}]});var c=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:i,pageSize:10});var g=new Ext.ux.grid.RowEditor({saveText:lang("ok"),cancelText:lang("cancel")});var a=new Ext.grid.GridPanel({border:false,store:i,cm:j,sm:b,plugins:[g],tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:m},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:k}],bbar:c});function m(){var n=new i.recordType({id:"",name:"",price:""});g.stopEditing();a.store.insert(0,n);g.startEditing(0)}function k(){var n=a.getSelectionModel().getSelections();if(n.length==0){CNOA.miniMsg.alertShowAt(btn,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(o){if(o=="yes"){var p=[];Ext.each(n,function(r,q){p.push(r.json.id)});Ext.Ajax.request({url:h.baseUrl+"&task=delAddition",params:{ids:p.join(",")},success:function(q){i.reload();var r=Ext.decode(q.responseText);if(r.success==true){CNOA.msg.notice2(r.msg)}else{CNOA.msg.alert(r.msg)}}})}})}}var f=new Ext.Window({border:false,title:lang("sideDish"),width:500,height:400,layout:"fit",modal:true,items:[a]});f.show()},editStoreWin:function(e){var h=this;var d=Ext.id();var f=Ext.id();var i=Ext.id();var j=e.id,a=e.text,c=e.qtip;this.storeForm=new Ext.FormPanel({padding:10,labelWidth:60,labelAlign:"right",defaults:{width:160},items:[{xtype:"hidden",id:d},{xtype:"textfield",fieldLabel:lang("name"),name:"name",id:f,allowBlank:false},{xtype:"textarea",fieldLabel:"商家信息",id:i,name:"info"}]});var g=new Ext.Window({border:false,width:300,height:200,modal:true,title:lang("add")+lang("foodStore"),layout:"fit",buttons:[{text:lang("save"),iconCls:"icon-order-s-accept",handler:function(){b()}},{text:lang("cancel"),handler:function(){g.close()}}],items:[h.storeForm]});var b=function(){if(h.storeForm.getForm().isValid()){h.storeForm.getForm().submit({url:h.baseUrl+"&task=editStore",params:{storeId:j},method:"POST",success:function(k,l){g.close();h.searchParams.storeId="";h.storeText="";h.treeRoot.reload();CNOA.msg.notice2(l.result.msg)},failure:function(k,l){CNOA.msg.alert(l.result.msg)}})}};g.show();Ext.getCmp(d).setValue(j);Ext.getCmp(f).setValue(a);Ext.getCmp(i).setValue(c)},deleteStore:function(a){var b=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:b.baseUrl+"&task=deleteStore",method:"POST",params:{id:a.id},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){b.searchParams.storeId="";b.storeText="";b.treeRoot.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},centerPanel:function(){var g=this;var f=[{name:"id"},{name:"name"},{name:"price"},{name:"store"}];this.gridstore=new Ext.data.Store({autoLoad:true,baseParams:g.searchParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var d=new Ext.grid.CheckboxSelectionModel();var h=function(o,n,l){var m=l.json.url;if(m){n.attr="ext:qtip='<img src="+m+">'";return"<img width='30' height='30' src="+m+">"}};var i=function(o,n,m){var p=m.json.id,l=Number(m.json.status);if(l){return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_food_snack_setting.changeStatus("+p+',"no")\'>'+lang("noUse")+"</a>"}else{return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_food_snack_setting.changeStatus("+p+',"yes")\'>'+lang("enable")+"</a>"}};var j=function(o,n,m){var p=m.json.id,l=Number(m.json.status);if(l){return lang("enable")}else{return lang("noUse")}};var k=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),d,{header:"id",dataIndex:"id",hidden:true},{header:lang("picture"),dataIndex:"",renderer:h,width:50},{header:lang("foodName"),dataIndex:"name",width:200},{header:lang("foodStore"),dataIndex:"store",width:120},{header:lang("unitPrice"),dataIndex:"price",width:120},{header:lang("nowStatus"),dataIndex:"",renderer:j},{header:lang("opt"),dataIndex:"",renderer:i}]});var e=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],style:"border-left-width:1px;",displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("showDataTotal2"),store:g.gridstore,pageSize:15});var c=new Ext.form.TextField({width:130});var b=new Ext.grid.EditorGridPanel({border:false,store:g.gridstore,cm:k,sm:d,bbar:e,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.gridstore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){g.addWin("add","");if(g.searchParams.storeId&&g.storeText){g.formPanel.getForm().findField("storeId").setValue(g.searchParams.storeId);g.formPanel.getForm().findField("storeId").setRawValue(g.storeText)}}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(l){var m=b.getSelectionModel().getSelected();if(!m){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{var n=m.json.id;g.addWin("edit",n);g.loadFormData(n)}}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(l){var m=b.getSelectionModel().getSelections();if(m.length==0){CNOA.miniMsg.alertShowAt(l,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(n){if(n=="yes"){var o=[];Ext.each(m,function(q,p){o.push(q.json.id)});g.delData(o.join(","))}})}}},lang("name")+":",c,{text:lang("search"),cls:"x-btn-over",iconCls:"icon-search",listeners:{mouseout:function(l){l.addClass("x-btn-over")},click:function(l){g.searchParams.searchName=c.getValue();g.gridstore.reload({params:g.searchParams})}}},{text:lang("clear2"),handler:function(){g.searchParams.searchName="";c.setValue("");g.gridstore.reload()}}]});var a=new Ext.Panel({border:false,region:"center",layout:"fit",bodyStyle:"border-left-width:1px;",items:[b]});return a},addWin:function(b,g){var f=this;var a=Ext.id();var e=Ext.id();this.optionCount=0;this.optionsField=new Ext.Panel({layout:"form",labelWidth:20,border:false,items:[]});if(b=="add"){this.addOption("")}this.formPanel=new Ext.form.FormPanel({border:false,padding:10,labelAlign:"right",autoScroll:true,items:[{xtype:"fieldset",title:lang("add"),layout:"column",columns:2,defaults:{labelWidth:60},items:[{xtype:"panel",columnWidth:0.65,layout:"form",border:false,defaults:{width:192,labelWidth:30},items:[{xtype:"combo",editable:false,allowBlank:false,fieldLabel:lang("foodStore"),typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",hiddenName:"storeId",name:"storeId",valueField:"id",displayField:"text",store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getSortList&type=combo",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:["id","text"]})})},{xtype:"textfield",fieldLabel:lang("foodName"),allowBlank:false,name:"name"},{xtype:"container",border:false,width:400,id:this.ID_container,fieldLabel:lang("unitPrice"),items:[f.optionsField,{xtype:"button",text:lang("add")+"价格选项",cls:"btn-blue4",handler:function(){f.addOption()}}]},{xtype:"checkboxgroup",id:f.ID_WEEK_GROUP,fieldLabel:lang("week2"),columns:3,items:[{boxLabel:lang("everyDay"),name:"week[]",inputValue:0,checked:true},{boxLabel:lang("monday"),name:"week[]",inputValue:1,checked:false},{boxLabel:lang("tuesday"),name:"week[]",inputValue:2,checked:false},{boxLabel:lang("wednesday"),name:"week[]",inputValue:3,checked:false},{boxLabel:lang("thursday"),name:"week[]",inputValue:4,checked:false},{boxLabel:lang("friday"),name:"week[]",inputValue:5,checked:false},{boxLabel:lang("saturday"),name:"week[]",inputValue:6,checked:false},{boxLabel:lang("sunday"),name:"week[]",inputValue:7,checked:false}]},{xtype:"textarea",fieldLabel:lang("remark"),name:"remark"},{xtype:"hidden",name:"img",id:a}]},{xtype:"panel",height:195,border:false,columnWidth:0.35,items:[{xtype:"panel",height:160,html:"<img src='' id='ID_FOOD_IMG' width='160' height='160'>"},{xtype:"button",style:"margin-top: 5px;",text:lang("uploadPic"),cls:"btn-blue4",handler:function(){new Ext.EditpicWindow({width:160,height:160,orderAttr:"orderAttr",listeners:{comfirmpic:function(i,h){$("#ID_FOOD_IMG").attr("src",h);Ext.getCmp(a).setValue(h)}}})}}]}]}]});var d=new Ext.Window({width:500,modal:true,height:420,layout:"fit",items:[this.formPanel],buttons:[{text:lang("save"),handler:function(){c(false)}},{text:lang("saveAndClose"),cls:"btn-blue4",handler:function(){c(true)}},{text:lang("close"),handler:function(){d.close()}}]});var c=function(h){if(f.formPanel.getForm().isValid()){f.formPanel.getForm().submit({url:f.baseUrl+"&task=submit",method:"POST",params:{id:g},success:function(i,j){f.gridstore.reload();if(h){d.close()}CNOA.msg.notice2(j.result.msg)},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};d.show()},createOption:function(a){return new Ext.form.NumberField({width:167,allowBlank:this.optionCount==1?false:true,name:"options[]",fieldLabel:this.optionCount,inputType:"text",value:a})},addOption:function(e){e=e||"";if(typeof(e)=="object"&&e.length){var b=[];for(var c=0,a=e.length;c<a;c++){this.optionCount+=1;b.push(this.createOption(e[c].price))}this.optionsField.add(b)}else{this.optionCount+=1;var d=this.createOption(e);this.optionsField.add(d)}this.optionsField.doLayout()},delData:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delData",params:{ids:a},success:function(c){var c=Ext.decode(c.responseText);if(c.success==true){b.gridstore.reload();CNOA.msg.notice2(c.msg)}else{CNOA.msg.alert(c.msg)}}})},loadFormData:function(b){var a=this;a.formPanel.getForm().load({url:a.baseUrl+"&task=loadFormData",params:{id:b},method:"POST",success:function(f,h){var g=h.result.data;var c=Ext.getCmp(a.ID_WEEK_GROUP).items;c.get(0).setValue(false);for(var e=0;e<c.length;e++){for(var d=0;d<g.week.length;d++){if(c.get(e).getRawValue()==g.week[d]){c.get(e).setValue(true)}}}a.addOption(g.options);$("#ID_FOOD_IMG").attr("src",g.url)},failure:function(c,d){CNOA.msg.alert(d.result.msg)}})},changeStatus:function(c,a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=changeStatus",params:{id:c,string:a},success:function(d){var d=Ext.decode(d.responseText);if(d.success==true){b.gridstore.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}};var sm_food_snack=1;
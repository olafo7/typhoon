var CNOA_att_arrange_recordClass,CNOA_att_arrange_record;CNOA_att_arrange_recordClass=CNOA.Class.create();CNOA_att_arrange_recordClass.prototype={init:function(){var d=this;this.isThreeDate=CNOA.att.arrange.record.isThreeDate==1?true:false;this.uid=0;this.baseUrl="index.php?app=att&func=arrange&action=record";this.recordAdmin=CNOA.att.arrange.record.recordAdmin;this.workParams={stime:"",uid:0};this.searchParams={uid:0,sDate:""};this.leaveParams={uid:0,sDate:""};this.workTime=this.getWorkTime();this.leaveRecord=this.getLeaveRecord();this.machine=this.getMachineData();var e=new Ext.TabPanel({region:"center",border:false,bodyStyle:"border-left-width:1px",items:[{title:lang("kQRecord"),layout:"fit",items:[this.workTime]},{title:lang("leaveRecord"),layout:"fit",items:[this.leaveRecord]},{title:lang("oDataOfWorkAtt"),layout:"fit",items:[this.machine]}],activeItem:0,listeners:{tabchange:function(h,g){var i=g.title;if(i==lang("kQRecord")){d.workParams.uid=d.uid;d.workStore.load()}else{if(i==lang("oDataOfWorkAtt")){d.searchParams.uid=d.uid;d.machineStore.load()}else{if(i==lang("leaveRecord")){d.leaveParams.uid=d.uid;d.storeInHours.load()}}}}}});var a=new Ext.tree.AsyncTreeNode({text:lang("companyPerson"),expanded:true});var f=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getUserTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(g){c.expandAll();c.getEl().unmask()}}});var c=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:f,root:a,autoScroll:true,listeners:{click:function(i){var j=e.activeTab.title;var g=i.attributes,h=g.uid;if(h!=undefined){d.uid=h;if(j==lang("kQRecord")){d.workParams.uid=h;d.workStore.load()}else{if(j==lang("oDataOfWorkAtt")){d.searchParams.uid=h;d.machineStore.load()}else{if(j==lang("leaveRecord")){d.leaveParams.uid=d.uid;d.storeInHours.load()}}}}}}});var b=new Ext.Panel({region:"west",layout:"fit",split:true,width:180,minWidth:150,maxWidth:300,border:false,bodyStyle:"border-right-width:1px;",items:[c],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(g,h){a.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},{text:lang("collapse"),tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(g,h){if(h){g.setText(lang("expand"));g.setTooltip(lang("expandMenuTip"));a.collapse(true);a.firstChild.expand()}else{g.setText(lang("collapse"));g.setTooltip(lang("collapseMenuTip"));a.expand(true)}}}]})});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[b,e]})},getWorkTime:function(){var i=this;var h=[{name:"id"},{name:"day"},{name:"date"},{name:"month"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"oneTime"},{name:"twoTime"},{name:"threeTime"},{name:"fourTime"},{name:"fiveTime"},{name:"sixTime"},{name:"oneExplain"},{name:"twoExplain"},{name:"threeExplain"},{name:"fourExplain"},{name:"fiveExplain"},{name:"sixExplain"},{name:"leaveHours"},{name:"thrStime"},{name:"thrEtime"}];this.workStore=new Ext.data.Store({baseParams:i.workParams,proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getWorkTime",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:h}),listeners:{load:function(r,o,q){var n=r.reader.jsonData;var p=n.top;f.setValue(p.fullatt);l.setValue(p.absent);g.setValue(p.belate);c.setValue(p.leaved);m.setValue(p.oncktimes);b.setValue(p.offcktimes)},exception:function(t,s,u,r,p,o){var q=p.responseText;if(q!=""){var n=Ext.decode(q);if(n.failure){CNOA.msg.alert(n.msg)}}}}});var d=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var e=[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:lang("goWork"),dataIndex:"oneStime",width:165,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"oneEtime",width:165,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("goWork"),dataIndex:"twoStime",width:165,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"twoEtime",width:165,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("remark"),dataIndex:"leaveHours",width:100,renderer:i.leaveHoursRender},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}];if(i.isThreeDate){e=[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:lang("goWork"),dataIndex:"oneStime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"oneEtime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("goWork"),dataIndex:"twoStime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"twoEtime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("goWork"),dataIndex:"thrStime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"thrEtime",width:120,sortable:false,editor:i.recordAdmin?true:false,menuDisabled:true,renderer:i.changeFont},{header:lang("remark"),dataIndex:"leaveHours",width:100,renderer:i.leaveHoursRender},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]}var j=new Ext.grid.ColumnModel(e);var f=new Ext.form.TextField({fieldLabel:lang("fullDays")}),l=new Ext.form.TextField({fieldLabel:lang("kuanggong")}),g=new Ext.form.TextField({fieldLabel:lang("cdTimes")}),c=new Ext.form.TextField({fieldLabel:lang("ztTimes")}),m=new Ext.form.TextField({fieldLabel:lang("sBWDJ")}),b=new Ext.form.TextField({fieldLabel:lang("xBWDJ")}),k=new Ext.form.DateField({format:"Y-m",plugins:"monthPickerPlugin",value:new Date()});this.topPanel=new Ext.form.FormPanel({layout:"table",border:false,bodyStyle:"padding: 5px",labelWidth:90,labelAlign:"right",hideBorders:true,layoutConfig:{columns:3},defaults:{layout:"form",width:230,defaults:{width:100,readOnly:true,style:"text-align:center; font-weight: bold; color:#119911;"}},items:[{items:[f,l]},{items:[g,c]},{items:[m,b]}]});var a=new Ext.grid.EditorGridPanel({stripeRows:true,border:false,bodyStyle:"border-top-width: 1px",store:i.workStore,loadMask:{msg:lang("waiting")},cm:j,sm:d,hideBorders:true,listeners:{afterrender:function(){i.topPanel.render(this.tbar)},afteredit:function(o){var n=o.originalValue;if(n=="未登记(休假)"||n=="(外出)"||n=="请假"||n=="(出差)"){CNOA.msg.alert("该时间不能修改")}else{if(n=="未登记"){i.changeRecord(o,1)}else{i.changeRecord(o,2)}}i.workStore.reload()}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(n,o){i.workStore.reload()}},{handler:function(o,p){var n=i.uid;if(n==0){CNOA.msg.alert(lang("clickLeftSideTree"))}else{i.openExportExcelWindow()}},iconCls:"icon-excel",cls:"btn-blue3",tooltip:lang("exportExcel"),text:lang("export2")},lang("viewtime")+"：",k,{text:lang("search"),handler:function(){var n=i.uid,o=k.getValue();i.workParams.uid=n;i.workParams.stime=o;i.workStore.load()}},{text:lang("clear"),handler:function(){var n=0;k.setValue(new Date());i.workParams.stime="";i.workStore.load()}}]})});return a},getMachineData:function(){var d=this;var a=[{name:"date"},{name:"value"}];this.machineStore=new Ext.data.Store({baseParams:d.searchParams,proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getMachineData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{load:function(i,g,h){var j=i.reader.jsonData.msg;if(j!=""){CNOA.msg.alert(j)}}}});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:lang("originalData"),dataIndex:"value",id:"value",sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var e=new Ext.form.DateField({format:"Y-m",plugins:"monthPickerPlugin",value:new Date()});var c=new Ext.grid.GridPanel({border:false,autoExpandColumn:"value",bodyStyle:"border-top-width: 1px",store:d.machineStore,loadMask:{msg:lang("waiting")},cm:b,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(g,h){d.machineStore.reload()}},lang("viewtime")+"：",e,{text:lang("search"),handler:function(){var g=d.uid,h=e.getRawValue();d.searchParams.uid=g;d.searchParams.sDate=h;d.machineStore.load()}},{text:lang("clear"),handler:function(){e.setValue(new Date());d.searchParams.sDate="";d.machineStore.load()}}]})});return c},getLeaveRecord:function(){var d=this;var a=[{name:"id"},{name:"stime"},{name:"etime"},{name:"detail"},{name:"posttime"},{name:"hours"}];var e=new Ext.form.DateField({format:"Y-m",plugins:"monthPickerPlugin",value:new Date()});this.storeInHours=new Ext.data.Store({autoLoad:true,baseParams:d.leaveParams,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getLeaveList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("detail"),dataIndex:"detail",width:230}]});var c=new Ext.grid.GridPanel({region:"center",border:false,store:d.storeInHours,cm:b,sm:f,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.storeInHours.reload()}},lang("viewtime")+"：",e,{text:lang("search"),handler:function(){var g=d.uid,h=e.getRawValue();d.leaveParams.uid=g;d.leaveParams.sDate=h;d.storeInHours.load()}},{text:lang("clear"),handler:function(){e.setValue(new Date());d.leaveParams.sDate="";d.storeInHours.load()}}]}),listeners:{cellclick:function(j,m,i,l){var k=d.storeInHours.reader.jsonData.data[m];var h=k.detail;var g="<div>"+h+"</div>";if(i==5){d.showDetail(g)}}}});return c},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},changeFont:function(i,b,e,h,k,j){var g=this,d=e.data,c=new Date(),a=c.getDate();nMonth=c.getMonth()+1;if(a<d.day&&nMonth==d.month){i="------"}else{if(i=="未登记"){i="<span style='color: red'>"+lang("unRegister")+"</span>"}else{if(i=="休假"){i="<span style='color: green'>"+lang("beOnLeave")+"</span>"}else{if(i=="请假"){i="<span style='color: mediumblue'>"+lang("leave")+"</span>"}else{if(i=="正常"){switch(k){case 3:i=d.oneTime;break;case 4:i=d.twoTime;break;case 5:i=d.threeTime;break;case 6:i=d.fourTime;break;case 7:i=d.fiveTime;break;case 8:i=d.sixTime;break}}else{if(i=="未登记1"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break}}else{if(i=="出差"){i="<span style='color: indigo'>"+lang("evection")+"</span>"}else{if(i=="外出"){i="<span style='color: #008B8B'>"+lang("egress")+"</span>"}else{if(i=="(出差)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 7:i=d.fiveTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 8:i=d.sixTime+"<span style='color: red'>("+lang("evection")+")</span>";break}}else{if(i=="(外出)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 7:i=d.fiveTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 8:i=d.sixTime+"<span style='color: red'>("+lang("egress")+")</span>";break}}else{if(i=="迟到"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 7:if(d.fiveExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fiveExplain+'">'}i=d.fiveTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 8:if(d.sixExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.sixExplain+'">'}i=d.sixTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break}}else{if(i=="早退"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 7:if(d.fiveExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fiveExplain+'">'}i=d.fiveTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 8:if(d.sixExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.sixExplain+'">'}i=d.sixTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break}}else{if(i=="未登记(休假)"){i="<span style='color: red'>"+lang("unRegister")+"</sspan><span style='color: green'>("+lang("beOnLeave")+")</span>"}else{if(i=="免签"){i="<span style='color:saddlebrown'>"+lang("notSignIn")+"</span>"}}}}}}}}}}}}}}return i},openExportExcelWindow:function(){var b=this;var e=new Ext.form.DateField({width:120,format:"Y-m",plugins:"monthPickerPlugin",value:new Date(),fieldLabel:lang("exportDate")});var c=function(){var f=e.getRawValue(),g=b.uid;if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=attRecordExportExcel&step=1",waitMsg:lang("waiting"),method:"POST",params:{uid:g,date:f},success:function(h,i){ajaxDownload(b.baseUrl+"&task=attRecordExportExcel&file="+i.result.msg+"&step=2")},failure:function(h,i){CNOA.msg.alert(i.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:100,items:[e]});var d=new Ext.Window({width:300,height:130,title:lang("exportPerson"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){var f=e.getRawValue();if(f==""){CNOA.msg.alert(lang("pleaseSelectDateExport"))}else{c()}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]}).show()},leaveHoursRender:function(a){if(a==""||a==undefined||a==null){a=""}else{a="请假<span style='color:blue; font-weight:bold'>"+a+"</span>小时"}return a},changeRecord:function(f,b){var d=this;var a=/^[0-1][0-9]:[0-5][0-9]:[0-5][0-9]|[2][0-3]:[0-5][0-9]:[0-5][0-9]$/;if(a.exec(f.value)){var c=f.record.data;Ext.Ajax.request({url:d.baseUrl+"&task=changeRecord",params:{uid:d.uid,time:f.value,field:f.field,date:c.date,type:b},success:function(e){var g=Ext.decode(e.responseText);if(g.success){CNOA.msg.notice2(g.msg)}else{CNOA.msg.alert(g.msg)}}})}else{CNOA.msg.alert("请正确输入时间格式xx:xx:xx")}}};var CNOA_att_arrange_statisticsClass,CNOA_att_arrange_statistics;CNOA_att_arrange_statisticsClass=CNOA.Class.create();CNOA_att_arrange_statisticsClass.prototype={init:function(){var a=this;this.uid=0;this.baseUrl="index.php?app=att&func=arrange&action=statistics";this.workParams={truename:"",time:"",deptId:""};this.egrParams={truename:"",time:""};this.leaveParams={truename:"",time:"",leaveType:""};this.evectionParams={truename:"",time:""};this.overTimeParams={truename:"",time:""};this.workTime=this.getWorkTime();this.egression=this.getEgression();this.leave=this.getLeave();this.evection=this.getEvection();this.overtime=this.getOverTime();var b=new Ext.TabPanel({region:"center",border:false,items:[{title:lang("commutingStatistics"),layout:"fit",items:[this.workTime]},{title:lang("egressStatistics"),layout:"fit",items:[this.egression]},{title:lang("leaveStatistics"),layout:"fit",items:[this.leave]},{title:lang("travelStatistics"),layout:"fit",items:[this.evection]},{title:lang("overtimeStatistics"),layout:"fit",items:[this.overtime]}],activeItem:0});this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[b]})},getWorkTime:function(){var g=this;var f=[{name:"id"},{name:"name"},{name:"truename"},{name:"fullatt"},{name:"absent"},{name:"belate"},{name:"leaved"},{name:"oncktimes"},{name:"offcktimes"},{name:"egression"},{name:"evection"},{name:"leave"},{name:"leaveInHours"},{name:"overtime"}];this.workStore=new Ext.data.Store({autoLoad:true,baseParams:g.workParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getWorkStatistics",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{exception:function(p,o,q,n,l,k){var m=l.responseText;if(m!=""){var j=Ext.decode(m);if(j.failure){CNOA.msg.alert(j.msg)}}}}});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),c,{header:"id",dataIndex:"id",hidden:true},{header:lang("department"),dataIndex:"name",width:130,sortable:true,menuDisabled:true},{header:lang("truename"),dataIndex:"truename",width:100,sortable:true,menuDisabled:true},{header:lang("fullDays"),dataIndex:"fullatt",width:80,sortable:true,menuDisabled:true,renderer:g.changeFullatt},{header:lang("kuanggong"),dataIndex:"absent",width:80,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("cdTimes"),dataIndex:"belate",width:80,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("ztTimes"),dataIndex:"leaved",width:80,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("sBWDJ"),dataIndex:"oncktimes",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("xBWDJ"),dataIndex:"offcktimes",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("outTimeDay"),dataIndex:"egression",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("travelTimeDay"),dataIndex:"evection",width:80,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("leaveTimeDay"),dataIndex:"leave",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("leaveTimeHours"),dataIndex:"leaveInHours",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:lang("otTimes"),dataIndex:"overtime",width:90,sortable:true,menuDisabled:true,renderer:g.changeAll},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:true}]);var e=new Ext.form.TextField({width:100});var i=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(k,j){g.workParams.time=k.getRawValue();g.workStore.load()}}});var b=new Ext.form.SelectorForm({width:100,hiddenName:"deptId",multiselect:false,selectorType:"dept"});var d=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:g.workStore,pageSize:15});var a=new Ext.grid.GridPanel({stripeRows:true,border:false,store:g.workStore,loadMask:{msg:lang("waiting")},cm:h,sm:c,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){g.workStore.reload()}},{handler:function(j,k){g.openExportExcelWindow()},iconCls:"icon-excel",tooltip:lang("exportExcel"),cls:"btn-blue3",text:lang("export2")},lang("statisticalTime")+"：",i,lang("department")+":",b,lang("registrant")+"：",e,{text:lang("search"),handler:function(){var j=e.getValue(),k=b.getValue();g.workParams.truename=j;g.workParams.deptId=k;g.workStore.load()}},{text:lang("clear"),handler:function(){e.setValue("");b.setValue("");b.clearValue("");g.workParams.truename="";g.workParams.deptId="";g.workStore.load()}},"<span class='cnoa_color_gray'>"+lang("doubleClick")+"</span>"]}),bbar:d,listeners:{celldblclick:function(n,q,m,p){var o=a.getSelectionModel().getSelected().json,j=o.truename,l=o.uid,k=i.getRawValue();g.showDetailRecord(l,k,j)}}});return a},getEgression:function(){var e=this;var a=[{name:"id"},{name:"posttime"},{name:"address"},{name:"reason"},{name:"truename"},{name:"stime"},{name:"etime"}];this.egrssionStore=new Ext.data.Store({autoLoad:true,baseParams:e.egrParams,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getEgrssion",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{exception:function(o,n,p,m,k,j){var l=k.responseText;if(l!=""){var i=Ext.decode(l);if(i.failure){CNOA.msg.alert(i.msg)}}}}});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("proposer"),dataIndex:"truename",width:100,sortable:false,menuDisabled:true},{header:lang("appTime"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("egressLocation"),dataIndex:"address",width:350,sortable:false,menuDisabled:true},{header:lang("WCYY"),dataIndex:"reason",width:360,sortable:false,menuDisabled:true,renderer:e.renDetail},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var d=new Ext.form.TextField({width:150});var f=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(j,i){e.egrParams.time=j.getRawValue();e.egrssionStore.load()}}});var g=new Ext.PagingToolbar({displayInfo:true,store:e.egrssionStore,pageSize:15});var c=new Ext.grid.GridPanel({stripeRows:true,border:false,store:e.egrssionStore,loadMask:{msg:lang("waiting")},cm:b,sm:h,hideBorders:true,listeners:{cellclick:function(i,p,o,n){var k=e.egrssionStore.reader.jsonData.data[p];var j=k.stime;var l=k.etime;var m=k.reason;var q=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+j+"</span> - "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+l+'</span><BR><div style="color:#333; padding:20px; ">'+m+"</div>";if(o==5){e.showDetail(q)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(i,j){e.egrssionStore.reload()}},lang("statisticalTime")+"：",f,lang("proposer")+"：",d,{text:lang("search"),handler:function(){var i=d.getValue();e.egrParams.truename=i;e.egrssionStore.load()}},{text:lang("clear"),handler:function(){var i=d.setValue();e.egrParams.truename="";e.egrssionStore.load()}}]}),bbar:g});return c},getLeave:function(){var g=this;var e=[{name:"id"},{name:"posttime"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"detail"},{name:"truename"}];this.leaveStore=new Ext.data.Store({autoLoad:true,baseParams:g.leaveParams,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getLeave",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e}),listeners:{exception:function(p,o,q,n,l,k){var m=l.responseText;if(m!=""){var j=Ext.decode(m);if(j.failure){CNOA.msg.alert(j.msg)}}}}});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("proposer"),dataIndex:"truename",width:100,sortable:false,menuDisabled:true},{header:lang("appTime"),dataIndex:"posttime",width:111,sortable:false,menuDisabled:true},{header:lang("detail"),dataIndex:"detail",width:500,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var i=new Ext.form.TextField({width:150});var b=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(k,j){g.leaveParams.time=k.getRawValue();g.leaveStore.load()}}});var f=new Ext.form.ComboBox({name:"leaveType",store:new Ext.data.SimpleStore({fields:["id","value"],data:[["0","病假"],["1","事假"],["2","年假"],["3","路途假"],["4","婚嫁"],["5","陪产假"],["6","产假"],["7","丧假"],["8","调休假"],["9","其它"]]}),width:60,hiddenName:"leaveType",valueField:"id",displayField:"value",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(k,j){g.leaveParams.leaveType=k.getValue();g.leaveStore.load()}}});var d=new Ext.PagingToolbar({displayInfo:true,store:g.leaveStore,pageSize:15});var a=new Ext.grid.GridPanel({stripeRows:true,border:false,store:g.leaveStore,loadMask:{msg:lang("waiting")},cm:h,sm:c,hideBorders:true,listeners:{cellclick:function(m,p,l,o){var n=g.leaveStore.reader.jsonData.data[p];var k=n.detail;var j="<div>"+k+"</div>";if(l==4){g.showDetail(j)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(j,k){g.leaveStore.reload()}},lang("statisticalTime")+"：",b,"请假类型：",f,lang("proposer")+"：",i,{text:lang("search"),handler:function(){var j=i.getValue();g.leaveParams.truename=j;g.leaveStore.load()}},{text:lang("clear"),handler:function(){var j=i.setValue();f.setValue("");g.leaveParams.truename="";g.leaveParams.leaveType="";g.leaveStore.load()}}]})});return a},getEvection:function(){var f=this;var a=[{name:"id"},{name:"posttime"},{name:"verifier"},{name:"status"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"address"},{name:"truename"},{name:"days"}];this.evectionStore=new Ext.data.Store({autoLoad:true,baseParams:f.evectionParams,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getEvection",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{exception:function(o,n,p,m,k,j){var l=k.responseText;if(l!=""){var i=Ext.decode(l);if(i.failure){CNOA.msg.alert(i.msg)}}}}});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("proposer"),dataIndex:"truename",width:100,sortable:false,menuDisabled:true},{header:lang("appTime"),dataIndex:"posttime",width:150,sortable:false,menuDisabled:true},{header:lang("travelSites"),dataIndex:"address",width:350,sortable:false,menuDisabled:true},{header:lang("travelReason"),dataIndex:"reason",width:360,sortable:false,menuDisabled:true,renderer:f.renDetail},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false},{header:"总出差天数",dataIndex:"days"}]);var e=new Ext.form.TextField({width:150});var d=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(j,i){f.evectionParams.time=j.getRawValue();f.evectionStore.load()}}});var g=new Ext.PagingToolbar({displayInfo:true,store:f.evectionStore,pageSize:15});var c=new Ext.grid.GridPanel({stripeRows:true,border:false,store:f.evectionStore,loadMask:{msg:lang("waiting")},cm:b,sm:h,hideBorders:true,listeners:{cellclick:function(i,p,o,n){var k=f.evectionStore.reader.jsonData.data[p];var j=k.stime;var l=k.etime;var m=k.reason;var q=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+j+"</span> - "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+l+'</span><BR><div style="color:#333; padding:20px; ">'+m+"</div>";if(o==5){f.showDetail(q)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(i,j){f.evectionStore.reload()}},lang("statisticalTime")+"：",d,lang("proposer")+"：",e,{text:lang("search"),handler:function(){var i=e.getValue();f.evectionParams.truename=i;f.evectionStore.load()}},{text:lang("clear"),handler:function(){e.setValue();f.evectionParams.truename="";f.evectionStore.load()}}]}),bbar:g});return c},getOverTime:function(){var f=this;var a=[{name:"id"},{name:"posttime"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"truename"},{name:"hour"}];this.overTimeStore=new Ext.data.Store({autoLoad:true,baseParams:f.overTimeParams,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getOverTime",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{exception:function(o,n,p,m,k,j){var l=k.responseText;if(l!=""){var i=Ext.decode(l);if(i.failure){CNOA.msg.alert(i.msg)}}}}});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var b=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("proposer"),dataIndex:"truename",width:100,sortable:false,menuDisabled:true},{header:lang("appTime"),dataIndex:"posttime",width:111,sortable:false,menuDisabled:true},{header:lang("jiabanTime"),dataIndex:"hour",width:70,sortable:false,menuDisabled:true},{header:lang("otReason"),dataIndex:"reason",width:340,sortable:false,menuDisabled:true,renderer:f.renDetail},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var e=new Ext.form.TextField({width:150});var d=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(j,i){f.overTimeParams.time=j.getRawValue();f.overTimeStore.load()}}});var g=new Ext.PagingToolbar({displayInfo:true,store:f.overTimeStore,pageSize:15});var c=new Ext.grid.GridPanel({stripeRows:true,border:false,store:f.overTimeStore,loadMask:{msg:lang("waiting")},cm:b,sm:h,hideBorders:true,listeners:{cellclick:function(i,p,o,n){var k=f.overTimeStore.reader.jsonData.data[p];var j=k.stime;var l=k.etime;var m=k.reason;var q=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+j+"</span> - "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+l+'</span><BR><div style="color:#333; padding:20px; ">'+m+"</div>";if(o==5){f.showDetail(q)}}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(i,j){f.overTimeStore.reload()}},lang("statisticalTime")+"：",d,lang("proposer")+"：",e,{text:lang("search"),handler:function(){var i=e.getValue();f.overTimeParams.truename=i;f.overTimeStore.load()}},{text:lang("clear"),handler:function(){e.setValue("");f.overTimeParams.truename="";f.overTimeStore.load()}}]}),bbar:g});return c},openExportExcelWindow:function(){var d=this;var c=new Ext.form.SelectorForm({width:220,hiddenName:"deptId",multiselect:true,selectorType:"dept",fieldLabel:lang("selectExportDept")}),g=new Ext.form.DateField({width:220,format:"Y-m-d",value:new Date(),fieldLabel:lang("exportSdate")}),b=new Ext.form.DateField({width:220,format:"Y-m-d",value:new Date(),fieldLabel:lang("exportEndDate")});var e=function(i){var h=g.getRawValue(),j=b.getRawValue();if(j==""||h==""){CNOA.msg.alert(lang("exportNotEmpty"));return}if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=attExportExcel&step=1",waitMsg:lang("waiting"),method:"POST",params:{dids:i,sdate:h,edate:j},success:function(k,l){ajaxDownload(d.baseUrl+"&task=attExportExcel&file="+l.result.msg+"&step=2")},failure:function(k,l){CNOA.msg.alert(l.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:100,items:[c,g,b]});var f=new Ext.Window({width:360,height:200,title:lang("exportPerson"),resizable:true,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){var h=c.getValue();if(h==undefined){CNOA.msg.alert(lang("haveNotEnter"))}else{e(h)}}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},renDetail:function(h,a,f,g,j,i){var k="";var c=f.data;var b=c.stime;var e=c.etime;var d=c.reason;k=lang("startTime")+'：<span style="color:#558899; font-weight:bold">'+b+"</span> - "+lang("endTime")+'：<span style="color:#558899; font-weight:bold">'+e+'</span><BR><span ext:qtip="点击查看详细" style="color:#888">'+d+"</span>";return k},changeFullatt:function(a){return"<span style='color: green'>"+a+"</span>"},changeAll:function(a){return"<span style='color: red'>"+a+"</span>"},showDetailRecord:function(h,d,b){var i=this;var f=[{name:"id"},{name:"day"},{name:"date"},{name:"month"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"oneTime"},{name:"twoTime"},{name:"threeTime"},{name:"fourTime"},{name:"oneExplain"},{name:"twoExplain"},{name:"threeExplain"},{name:"fourExplain"}];var e=new Ext.data.Store({autoLoad:true,baseParams:{uid:h,date:d},proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getPersonRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var j=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:lang("goWork"),dataIndex:"oneStime",width:150,sortable:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"oneEtime",width:150,sortable:false,menuDisabled:true,renderer:i.changeFont},{header:lang("goWork"),dataIndex:"twoStime",width:150,sortable:false,menuDisabled:true,renderer:i.changeFont},{header:lang("offWork"),dataIndex:"twoEtime",width:150,sortable:false,menuDisabled:true,renderer:i.changeFont},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var a=new Ext.grid.GridPanel({stripeRows:true,border:false,store:e,loadMask:{msg:lang("waiting")},cm:j,sm:c,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(k,l){e.reload()}}]})});var g=new Ext.Window({modal:true,width:800,height:makeWindowHeight(600),layout:"fit",items:[a],title:lang("view")+"“"+b+"”"+lang("sXBDJdetails"),buttons:[{xtype:"button",text:lang("closeWindow"),handler:function(){g.close()}}]}).show()},changeFont:function(i,b,e,h,k,j){var g=this,d=e.data,c=new Date(),a=c.getDate();nMonth=c.getMonth()+1;if(a<d.day&&nMonth==d.month){i="------"}else{if(i=="未登记"){i="<span style='color: red'>"+lang("unRegister")+"</span>"}else{if(i=="休假"){i="<span style='color: green'>"+lang("beOnLeave")+"</span>"}else{if(i=="请假"){i="<span style='color: mediumblue'>"+lang("leave")+"</span>"}else{if(i=="正常"){switch(k){case 3:i=d.oneTime;break;case 4:i=d.twoTime;break;case 5:i=d.threeTime;break;case 6:i=d.fourTime;break}}else{if(i=="未登记1"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break}}else{if(i=="出差"){i="<span style='color: indigo'>"+lang("evection")+"</span>"}else{if(i=="外出"){i="<span style='color: #008B8B'>"+lang("egress")+"</span>"}else{if(i=="(出差)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("evection")+")</span>";break}}else{if(i=="(外出)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("egress")+")</span>";break}}else{if(i=="迟到"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break}}else{if(i=="早退"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break}}else{if(i=="未登记(休假)"){i="<span style='color: red'>"+lang("unRegister")+"</sspan><span style='color: green'>("+lang("beOnLeave")+")</span>"}else{if(i=="免签"){i="<span style='color:saddlebrown'>"+lang("notSignIn")+"</span>"}}}}}}}}}}}}}}return i}};var CNOA_att_arrange_statusClass,CNOA_att_arrange_status;CNOA_att_arrange_statusClass=CNOA.Class.create();CNOA_att_arrange_statusClass.prototype={init:function(){this.baseUrl="index.php?app=att&func=arrange&action=status";this.isThreeDate=CNOA.att.arrange.status.isThreeDate==1?true:false;this.arrangeStatus=this.getArrangeStatus();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.arrangeStatus]})},getArrangeStatus:function(){var j=this;var h=[{name:"uid"},{name:"truename"},{name:"deptId"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"thrStime"},{name:"thrEtime"}];var d=new Ext.grid.CheckboxSelectionModel();var e=[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:130,sortable:false,menuDisabled:true},{header:lang("belongDept"),dataIndex:"deptId",width:130,sortable:true,menuDisabled:true},{header:lang("goWork"),dataIndex:"oneStime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus},{header:lang("offWork"),dataIndex:"oneEtime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus},{header:lang("goWork"),dataIndex:"twoStime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus},{header:lang("offWork"),dataIndex:"twoEtime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus}];if(this.isThreeDate){e.push({header:lang("goWork"),dataIndex:"thrStime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus});e.push({header:lang("offWork"),dataIndex:"thrEtime",width:111,sortable:false,menuDisabled:true,renderer:j.changeStatus})}e.push({header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false});var k=new Ext.grid.ColumnModel(e);this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getstatusJson",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:h}),listeners:{load:function(r,o,q){var n=r.reader.jsonData;var p=n.top;g.setValue(p.evectionNum);l.setValue(p.leaveNum);i.setValue(p.egressionNum);c.setValue(p.restNum);b.setValue(p.chidaoNum);m.setValue(p.zaotuiNum)}}});var f=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:j.store,pageSize:15});var g=new Ext.form.TextField({fieldLabel:lang("numOfEvection"),listeners:{focus:function(){j.showAttDetail("evection")}}}),l=new Ext.form.TextField({fieldLabel:lang("numOfLeave"),listeners:{focus:function(){j.showAttDetail("leave")}}}),c=new Ext.form.TextField({fieldLabel:lang("numOfTakeVacation"),listeners:{focus:function(){j.showAttDetail("rest")}}}),b=new Ext.form.TextField({fieldLabel:lang("numOfLate"),listeners:{focus:function(){j.showAttDetail("chidao")}}}),m=new Ext.form.TextField({fieldLabel:lang("numOfLeaveEarly"),listeners:{focus:function(){j.showAttDetail("zaotui")}}}),i=new Ext.form.TextField({fieldLabel:lang("numOfEgress"),listeners:{focus:function(){j.showAttDetail("egression")}}});this.topPanel=new Ext.form.FormPanel({layout:"table",border:false,bodyStyle:"padding: 5px",labelWidth:90,labelAlign:"right",hideBorders:true,layoutConfig:{columns:3},defaults:{layout:"form",width:230,defaults:{width:100,readOnly:true,style:"text-align:center; font-weight: bold; color:#119911;"}},items:[{items:[l,c]},{items:[g,b]},{items:[i,m]}]});var a=new Ext.grid.GridPanel({region:"center",store:j.store,cm:k,bodyStyle:"border-top-width: 1px",listeners:{afterrender:function(){j.topPanel.render(this.tbar)}},tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){j.store.reload()}},{text:lang("unregMan"),iconCls:"icon-communication-share",cls:"btn-blue3",handler:function(n){j.showNoRegInfo()}},"<span class='cnoa_color_gray'>"+lang("clickTJinputViewDetail")+"</span>"]}),bbar:f});return a},showNoRegInfo:function(){var h=this;var j={stime:"",etime:""};var f=[{name:"uid"},{name:"date"},{name:"dept"},{name:"truename"}];var e=new Ext.data.Store({baseParams:j,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getNoRegMan",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{exception:function(p,o,q,n,l){var m=l.responseText;if(m!=""){var k=Ext.decode(m);if(k.failure){CNOA.msg.alert(k.msg)}}}}});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var i=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),b,{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:85,sortable:false,menuDisabled:true},{header:lang("department"),dataIndex:"dept",width:130,sortable:false,menuDisabled:true},{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var c=new Ext.form.TimeField({format:"H:i",width:80,allowBlank:false}),d=new Ext.form.TimeField({format:"H:i",width:80,allowBlank:false});var a=new Ext.grid.GridPanel({stripeRows:true,border:false,bodyStyle:"border-top-width: 1px",store:e,loadMask:{msg:lang("waiting")},cm:i,sm:b,hideBorders:true,tbar:new Ext.Toolbar({items:[lang("selectTimePeriod")+":",c,"　"+lang("to")+"　",d,{text:lang("search"),handler:function(){var k=c.getValue(),l=d.getValue();if(k==""||l==""){CNOA.msg.alert(lang("stimeOrEtimeNotEmpty"));return}j.stime=k;j.etime=l;e.load()}}]})});var g=new Ext.Window({modal:true,width:550,height:makeWindowHeight(700),layout:"fit",items:[a],title:lang("unregMan"),buttons:[{xtype:"button",text:lang("send"),handler:function(){var l=a.getSelectionModel().getSelections(),k=[];if(l.length==0){CNOA.msg.alert(lang("mustSelectOneRow"))}else{Ext.each(l,function(n,m){k.push(n.data.uid)});h.sendRemind(k.join(","))}}}]}).show()},sendRemind:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=sendRemind",params:{ids:a},success:function(c,e){var d=Ext.decode(c.responseText);if(d.success){CNOA.msg.alert(d.msg)}else{CNOA.msg.alert(d.msg)}}})},changeStatus:function(h){var b="0",i="1",g="2",c="3",j="4",d="5",a="6",e="7",f="8";if(h==b){h="<span style='color: red'>"+lang("unRegister")+"</span>"}else{if(h==j){h="<span style='color: green'>"+lang("beOnLeave")+"</span>"}else{if(h==d){h="<span style='color: mediumblue'>"+lang("leave")+"</span>"}else{if(h==a){h="<span style='color: orangered'>"+lang("evection")+"</span>"}else{if(h==e){h="<span style='color: #008B8B'>"+lang("egress")+"</span>"}else{if(h==c){h=lang("normalReg")}else{if(h==f){h="<span style='color:saddlebrown'>"+lang("notSignIn")+"</span>"}else{if(h==i){h=lang("late")}else{if(h==g){h=lang("leaveEarly")}}}}}}}}}return h},showAttDetail:function(f){var g=this,c;switch(f){case"evection":c=lang("numOfEvection");break;case"egression":c=lang("numOfEgress");break;case"leave":c=lang("numOfLeave");break;case"chidao":c=lang("numOfLate");break;case"zaotui":c=lang("numOfLeaveEarly");break;case"rest":c=lang("numOfTakeVacation");break}var d=[{name:"date"},{name:"dept"},{name:"truename"}];var i=new Ext.data.Store({autoLoad:true,baseParams:{act:f},proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getDetailStatus",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:lang("date"),dataIndex:"date",width:130,sortable:false,menuDisabled:true},{header:lang("department"),dataIndex:"dept",width:130,sortable:false,menuDisabled:true},{header:lang("truename"),dataIndex:"truename",width:85,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var a=new Ext.grid.GridPanel({stripeRows:true,border:false,bodyStyle:"border-top-width: 1px",store:i,loadMask:{msg:lang("waiting")},cm:h,sm:b,hideBorders:true});var e=new Ext.Window({modal:true,width:400,height:makeWindowHeight(320),layout:"fit",items:[a],title:lang("view")+" "+c+" "+lang("details"),buttons:[{xtype:"button",text:lang("closeWindow"),handler:function(){e.close()}}]}).show()}};var CNOA_att_mgr_manageClass,CNOA_att_mgr_manage;CNOA_att_mgr_manageClass=CNOA.Class.create();CNOA_att_mgr_manageClass.prototype={init:function(){this.baseUrl="index.php?app=att&func=mgr&action=manage";this.mgrPanel=this.getmgrPanel();this.deptPanel=this.getDeptPanel();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.mgrPanel]})},getmgrPanel:function(){var g=this;this.fields=[{name:"uid"},{name:"truename"}];for(var f=1;f<=31;f++){g.fields.push({name:"day"+f})}this.manageParams={deptid:"",truename:"",time:"",widthSon:""};var c=new Date();var e=g.getColumn(c,true);this.colModel=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true,align:"center",width:50},columns:e});this.store=new Ext.data.Store({autoLoad:true,baseParams:g.manageParams,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getManageJson",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g.fields})});var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getClassesDrop",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"cid"},{name:"name"}]})});var a=new Ext.form.TextField({width:100});var h=new Ext.PagingToolbar({style:"border-left-width:1px;",plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:g.store,pageSize:15,listeners:{beforechange:function(){g.selections=[]}}});this.selections=[];var d=new Ext.grid.EditorGridPanel({region:"center",store:g.store,cm:g.colModel,bodyStyle:"border-left-width:1px;",tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.selections=[];g.store.reload()}},(lang("truename")+":"),a,{text:lang("search"),handler:function(){g.manageParams.truename=a.getValue();g.store.load()}},{text:lang("clear"),handler:function(){a.setValue("");g.manageParams.truename="";g.store.load()}},lang("selectEditOfClasses")+":",{xtype:"combo",store:b,width:100,id:"class",hiddenName:"classes",valueField:"cid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(j,o){var r=[],l={},s=o.data.cid,p=o.data.name;for(var m=0;m<g.selections.length;m++){var n=g.selections[m][0],t=g.selections[m][2],q=g.selections[m][3],k=g.selections[m][4];r.push([t,q,k,n])}g.editClasses(r,s,p,g.manageParams.time)}}},"->",lang("selectScheduDate")+":",{xtype:"datefield",format:"Y-m",width:100,value:new Date().format("Y-m"),plugins:"monthPickerPlugin",listeners:{select:function(j,i){g.manageParams.time=j.getRawValue();g.getColumn(j.getValue(),false);g.selections=[];g.store.load()}}}]}),bbar:h,listeners:{cellclick:function(j,r,t,q){j.selModel.clearSelections();var s=j.getView(),k=false,p=g.selections.length,u;for(var m=0;m<p;m++){u=g.selections[m];if(r==u[0]&&t==u[1]){g.selections.splice(m,1);k=true;break}}if(k){s.onCellDeselect(r,t)}else{var n=j.getStore().getAt(r),v=j.getColumnModel().getDataIndex(t),l=n.get(v),o=n.get("uid");if(t>2){g.selections.push([r,t,o,v,l]);s.onCellSelect(r,t)}}},headerclick:function(j,s){j.selModel.clearSelections();var q=j.bottomToolbar.pageSize;var r=j.getView();var k=false,p=g.selections.length,t;for(var m=p-1;m>=0;m--){t=g.selections[m];if(t[1]==s){k=true;g.selections.splice(m,1)}}if(k){for(var m=0;m<q;m++){r.onCellDeselect(m,s)}}else{for(var m=0;m<q;m++){var n=j.getStore().getAt(m),u=j.getColumnModel().getDataIndex(s),l=n.get(u),o=n.get("uid");if(s!="1"&&s!="2"){g.selections.push([m,s,o,u,l]);r.onCellSelect(m,s)}}}}}});return d},getDeptPanel:function(){var c=this;var e="CNOA_main_user_index_structTree_root";var d;var b=Ext.id();var a=new Ext.tree.AsyncTreeNode({id:e,expanded:true});var f=new Ext.tree.TreeLoader({dataUrl:c.baseUrl+"&task=getDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(g){a.firstChild.collapse(true);if(Ext.getCmp(b).pressed){a.expand(true)}else{a.firstChild.expand()}}}});return new Ext.tree.TreePanel({region:"west",split:true,width:180,rootVisible:false,lines:true,animCollapse:false,animate:false,autoScroll:true,bodyStyle:"border-right-width:1px;",loader:f,root:a,tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{text:lang("expand"),id:b,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(g,h){if(h){g.setText(lang("collapse"));g.setTooltip(lang("collapseMenuTip"));a.expand(true)}else{g.setText(lang("expand"));g.setTooltip(lang("expandMenuTip"));a.collapse(true);a.firstChild.expand()}}},"->",{handler:function(g,h){a.reload()},iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")}]}),listeners:{click:function(g){if(g.disabled){return}c.manageParams.deptid=g.attributes.selfid;c.store.load();c.selections=[];Ext.state.Manager.set("CNOA_main_job_index_treeState",g.getPath())}},bbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{xtype:"checkbox",checked:false,boxLabel:lang("showDownDeptUser"),listeners:{check:function(h,g){c.manageParams.widthSon=g;c.store.reload()}}}]})})},getWeek:function(a){a=a%7;switch(a){case 0:return'<span style="color:#FF7F00">'+lang("sunday")+"</span>";case 1:return lang("monday");case 2:return lang("tuesday");case 3:return lang("wednesday");case 4:return lang("thursday");case 5:return lang("friday");case 6:return lang("saturday");default:return""}},getColumn:function(b,a){var f=this;var b=new Date(b),g=b.getMonth(),h=b.getDaysInMonth(),e=new Date(b.getFullYear(),g,1).getDay();var d=[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:80}];for(var c=1;c<=h;c++){d.push({header:f.get2Number(g+1)+"-"+f.get2Number(c)+"<br/>"+f.getWeek(e),dataIndex:"day"+c,sortable:false});e++}if(a){return d}f.colModel.setConfig(d)},editClasses:function(b,d,c,g){var f=this,h=[],a=b.length;if(a<=0){CNOA.msg.alert(lang("selectPersonWantEdit"));return}for(var e=0;e<a;e++){h.push([b[e][1]+"-"+b[e][0]+"-"+b[e][2]])}Ext.Ajax.request({url:f.baseUrl+"&task=editClasses",method:"post",params:{header:h.join(","),editCid:d,time:g},success:function(l){var n=Ext.decode(l.responseText);if(n.success==true){var k=f.mgrPanel.getView();for(var m=0;m<a;m++){var j=f.mgrPanel.getStore().getAt(b[m][3]);j.set(b[m][1],c)}for(var m=0;m<f.selections.length;m++){k.onCellSelect(f.selections[m][0],f.selections[m][1]);f.selections[m][4]=c}CNOA.msg.notice(n.msg,lang("kQSet"));CNOA.msg.alert(lang("continueClickRefresh"))}else{CNOA.msg.alert(n.msg)}}})},get2Number:function(a){return a<10?"0"+a:a}};var CNOA_att_mgr_restClass,CNOA_att_mgr_rest;CNOA_att_mgr_restClass=CNOA.Class.create();CNOA_att_mgr_restClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=att&func=mgr&action=rest";this.AnnualPanel=this.getAnnualRest();this.TakeRest=this.getTakeRest();this.AutoRest=this.getAutoRest();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.AnnualPanel,this.TakeRest,this.AutoRest]})},getAnnualRest:function(){var e=this;var d=[{name:"uid"},{name:"truename"},{name:"annualLeave"},{name:"useLeave"},{name:"unuseLeave"}];var g={truename:"",year:""};var b=new Ext.grid.CheckboxSelectionModel();var f=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true,width:80},{header:lang("truename"),dataIndex:"truename"},{header:lang("annualLeave"),dataIndex:"annualLeave",editor:new Ext.form.TextField()},{header:lang("hasBeenUseAnnual"),dataIndex:"useLeave"},{header:lang("unuseAnnualLeave"),dataIndex:"unuseLeave"}]});this.store=new Ext.data.Store({autoLoad:true,baseParams:g,proxy:new Ext.data.HttpProxy({url:e.baseUrl+"&task=getAnnualData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:d})});var i=new Ext.form.TextField({width:150});var h=new Ext.form.NumberField({width:50});var c=new Ext.PagingToolbar({style:"border-left-width:1px;",plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:e.store,pageSize:15});var a=new Ext.grid.EditorGridPanel({title:lang("annualLeave"),region:"center",store:e.store,bodyStyle:"border-left-width:1px;",cm:f,sm:b,tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.store.reload()}},{xtype:"importButton",cls:"btn-blue3",browseTitle:lang("vacationManagement"),url:this.baseUrl+"&task=importRest"},lang("truename")+"：",i,lang("year")+"：",h,{text:lang("search"),handler:function(){g.truename=i.getValue();g.year=h.getValue();e.store.load()}},{text:lang("clear"),handler:function(){i.setValue("");h.setValue("");g.truename="";g.year="";e.store.load()}}]}),bbar:c,listeners:{afteredit:function(m){var l=m.field,j=m.record.get("uid"),k=m.value;e.updateLeave(j,l,k)}}});return a},getTakeRest:function(){var f=this;var e=[{name:"uid"},{name:"truename"},{name:"takeRest"},{name:"useRest"}];var h={truename:"",year:""};var b=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true,width:80},columns:[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename"},{header:"可用调休小时",width:130,dataIndex:"takeRest"},{header:"已用调休小时",width:130,dataIndex:"useRest"}]});var d=new Ext.data.Store({autoLoad:true,baseParams:h,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getTakeRest",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:e})});var j=new Ext.form.TextField({width:150});var i=new Ext.form.NumberField({width:50});var c=new Ext.PagingToolbar({style:"border-left-width:1px;",plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:d,pageSize:15});var a=new Ext.grid.EditorGridPanel({title:lang("takeRest"),store:d,cm:g,sm:b,bodyStyle:"border-left-width:1px;",tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.reload()}},lang("truename")+"：",j,lang("year")+"：",i,{text:lang("search"),handler:function(){h.truename=j.getValue();h.year=i.getValue();d.load()}},{text:lang("clear"),handler:function(){j.setValue("");i.setValue("");h.truename="";h.year="";d.load()}}]}),bbar:c});return a},getAutoRest:function(){var b=this;var a=new Ext.form.FormPanel({title:"自动年假",style:"margin: 5px;",labelWidth:80,items:[{xtype:"numberfield",name:"baseRest",allowBlank:false,allowNegative:false,fieldLabel:"年假基数"},{xtype:"numberfield",name:"increaseDay",allowNegative:false,allowBlank:false,fieldLabel:"每年递增"},{xtype:"numberfield",name:"highestDay",allowNegative:false,allowBlank:false,fieldLabel:"最高年假"},{xtype:"checkbox",name:"open",fieldLabel:"是否开启"},{xtype:"button",text:"提交",handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=updateAutoRest",method:"POST",success:function(c,d){CNOA.msg.notice2(lang("successopt"))},failure:function(c,e){var d=e.response.responseText;d=JSON.parse(d);CNOA.msg.alert(d.msg)}})}}}]});a.load({url:b.baseUrl+"&task=getAutoRest",method:"GET"});return a},updateLeave:function(a,d,c){var b=this;CNOA_att_mgr_rest=new CNOA_att_mgr_restClass;if(c<0){CNOA.msg.alert(lang("enterNumNotLess0"));return}Ext.Ajax.request({url:b.baseUrl+"&task=updateLeave",params:{uid:a,field:d,value:c},success:function(e){var f=Ext.decode(e.responseText);b.store.reload();CNOA.msg.notice2(f.msg)}})}};var CNOA_att_mgr_settingsClass,CNOA_att_mgr_settings;CNOA_att_mgr_settingsClass=CNOA.Class.create();CNOA_att_mgr_settingsClass.prototype={init:function(){this.baseUrl="index.php?app=att&func=mgr&action=settings";this.TYPE_CLASSES=0;this.TYPE_SHIFT=1;this.isThreeDate=CNOA.att.mgr.settings.isThreeDate==1?true:false;var a=[{name:"cid"},{name:"name"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"thrStime"},{name:"thrEtime"},{name:"isRest"},{name:"isThreeDate"},{name:"status"}];this.classesStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getClasses",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});this.getClassDown=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getClassesDown",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});this.getShiftStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getShiftStore"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"sid"},{name:"name"}]})});this.classesPanel=this.getClassesPanel();this.shiftPanel=this.getShiftPanel();this.groupPanel=this.getGroupPanel();this.restSetting=this.getRestSetting();this.lockClass=this.getLockClass();this.isAlert=this.getIsAlertPanel();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.classesPanel,this.shiftPanel,this.groupPanel,this.restSetting,this.lockClass,this.isAlert]})},getClassesPanel:function(){var e=this;var f=new Ext.grid.CheckboxSelectionModel();var a=function(g){if(g==""){return""}checked=g==1?lang("yes"):lang("no");return checked};var d=[new Ext.grid.RowNumberer(),f,{header:lang("name"),dataIndex:"name",width:100},{header:lang("goWorkTime"),dataIndex:"oneStime"},{header:lang("getOffWorkTime"),dataIndex:"oneEtime"},{header:lang("goWorkTime"),dataIndex:"twoStime"},{header:lang("getOffWorkTime"),dataIndex:"twoEtime"},{header:lang("whetherSetVacation"),dataIndex:"isRest",renderer:a,width:100},{header:lang("whetherEffect"),dataIndex:"status",renderer:a},{header:lang("opt"),dataIndex:"opt",renderer:function(l,k,g){var j=g.data;var i="";i="<a href='javascript:void(0);' class='gridview' onclick='CNOA_att_mgr_settings.showEdit("+j.cid+");'>"+lang("edit")+"</a>";return i}}];if(e.isThreeDate){d=[new Ext.grid.RowNumberer(),f,{header:lang("name"),dataIndex:"name",width:100},{header:lang("goWorkTime"),dataIndex:"oneStime"},{header:lang("getOffWorkTime"),dataIndex:"oneEtime"},{header:lang("goWorkTime"),dataIndex:"twoStime"},{header:lang("getOffWorkTime"),dataIndex:"twoEtime"},{header:lang("goWorkTime"),dataIndex:"thrStime"},{header:lang("getOffWorkTime"),dataIndex:"thrEtime"},{header:lang("whetherSetVacation"),dataIndex:"isRest",renderer:a,width:100},{header:lang("whetherEffect"),dataIndex:"status",renderer:a},{header:"是否三班",dataIndex:"isThreeDate",renderer:a},{header:lang("opt"),dataIndex:"opt",renderer:function(l,k,g){var j=g.data;var i="";i="<a href='javascript:void(0);' class='gridview' onclick='CNOA_att_mgr_settings.showEdit("+j.cid+");'>"+lang("edit")+"</a>";return i}}]}var b=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true,width:80},columns:d});var c=new Ext.grid.GridPanel({title:lang("classes"),border:false,loadMask:{msg:lang("loading")},store:this.classesStore,cm:b,sm:f,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){e.classesStore.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){e.addClasses("add")}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=c.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("sureDelHasBeenStaff"),function(i){if(i=="yes"){var j=[];Ext.each(h,function(l,k){j.push(l.json.cid)});e.delClasses(j.join(","))}})}}}]})});return c},getShiftPanel:function(){var g=this;var b=[{name:"sid"},{name:"name"},{name:"sun"},{name:"mon"},{name:"tue"},{name:"wed"},{name:"thurs"},{name:"fri"},{name:"sat"}];var a=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getShift",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:b})});var f=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:this.getClassDown,valueField:"cid",displayField:"name"});var e=function(i){return function(k){var j=i.findRecord(i.valueField,k);return j?j.get("name"):i.valueNotFoundText}};var h=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),h,{header:lang("name"),dataIndex:"name",editor:new Ext.form.TextField({allowBlank:false})},{header:lang("sunday"),dataIndex:"sun",editor:f},{header:lang("monday"),dataIndex:"mon",editor:f},{header:lang("tuesday"),dataIndex:"tue",editor:f},{header:lang("wednesday"),dataIndex:"wed",editor:f},{header:lang("thursday"),dataIndex:"thurs",editor:f},{header:lang("friday"),dataIndex:"fri",editor:f},{header:lang("saturday"),dataIndex:"sat",editor:f}]});var d=new Ext.grid.EditorGridPanel({title:lang("shifts"),border:false,loadMask:{msg:lang("loading")},store:a,cm:c,sm:h,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.shiftPanel.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){g.addShift()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(i){var j=d.getSelectionModel().getSelections();if(j.length==0){CNOA.miniMsg.alertShowAt(i,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("sureDelCarefulOperation"),function(k){if(k=="yes"){var l=[];Ext.each(j,function(n,m){l.push(n.json.sid)});g.delShift(l.join(","))}})}}}]}),listeners:{afteredit:function(k){var j=k.field,l=k.record.get("sid"),i=k.value;k.record.set("");g.updateShift(l,j,i)}}});return d},getGroupPanel:function(){var h=this;var f=[{name:"id"},{name:"did"},{name:"sid"}];var c=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:h.getShiftStore,valueField:"sid",displayField:"name"});var d=function(j){return function(l){var k=j.findRecord(j.valueField,l);return k?k.get("name"):j.valueNotFoundText}};var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:h.baseUrl+"&task=getGroup",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var e=new Ext.grid.CheckboxSelectionModel();var i=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:lang("deptName"),dataIndex:"did"},{header:lang("shifts"),dataIndex:"sid",editor:c,renderer:d(c)}]});var g=new Ext.Toolbar({region:"north",height:30,border:false,items:[{xtype:"box",html:"<span style='color:red; font-size:18px'>"+lang("rPbYpbWz")+"</span>"}]});var a=new Ext.grid.EditorGridPanel({title:lang("teamGroup"),border:false,loadMask:{msg:lang("loading")},store:b,cm:i,sm:e,items:[g],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){h.groupPanel.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){h.addGroup()}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(j){var k=a.getSelectionModel().getSelections();if(k.length==0){CNOA.miniMsg.alertShowAt(j,lang("mustSelectOneRow"))}else{Ext.MessageBox.show({title:lang("del"),msg:lang("whetherDelSameTime"),buttons:Ext.MessageBox.YESNOCANCEL,icon:Ext.MessageBox.QUESTION,fn:function(l){var m=[];Ext.each(k,function(o,n){m.push(o.json.id)});if(l=="yes"){h.delGroup(m.join(","),"true")}else{if(l=="no"){h.delGroup(m.join(","))}}}})}}}]}),listeners:{afteredit:function(l){var k=l.field,m=l.record.get("id"),j=l.value;l.record.set("");Ext.MessageBox.show({title:lang("modify"),msg:lang("editWhetherOverwriteDept"),buttons:Ext.MessageBox.YESNOCANCEL,icon:Ext.MessageBox.QUESTION,fn:function(n){if(n=="yes"){h.updateGroup(m,k,j,"yes")}else{if(n=="no"){h.updateGroup(m,k,j)}else{b.reload()}}}})}}});return a},getRestSetting:function(){var q=this;var l=new Ext.form.SelectorForm({fieldLabel:"设置免签人员",hiddenName:"userid",name:"user",multiselect:true,selectorType:"user",width:500});var o=new Ext.form.SelectorForm({fieldLabel:"设置考勤数据管理员",hiddenName:"userid",name:"user",multiselect:true,selectorType:"user",width:500});var m=new CNOA.selector.UserSelector({closeAction:"hide",multiSelect:true});var j=new CNOA.selector.UserSelector({closeAction:"hide",multiSelect:true});var r=new CNOA.selector.StationSelector({closeAction:"hide",multiSelect:true});var p=new CNOA.selector.StationSelector({closeAction:"hide",multiSelect:true});var d=new CNOA.selector.DepartmentSelector({closeAction:"hide",multiSelect:true});var f=new CNOA.selector.DepartmentSelector({closeAction:"hide",multiSelect:true});var e=new CNOA.selector.form.MultiFunctionSelectorField({fieldLabel:"适用人员",height:100,width:400,name:"appperson",blankText:"请选择适用人员",userButton:true,stationButton:true,departmentButton:true,userSelector:m,stationSelector:r,departmentSelector:d});var c=new CNOA.selector.form.MultiFunctionSelectorField({fieldLabel:"禁止人员",width:400,height:100,name:"stopperson",userButton:true,stationButton:true,departmentButton:true,userSelector:j,stationSelector:p,departmentSelector:f});var h=Ext.id(),k=Ext.id(),a=Ext.id(),n=Ext.id();var g=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;overflow: auto;",title:lang("kQSet"),tbar:new Ext.Toolbar({items:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){i()}},'<span style="color:gray;"><<<'+lang("clickSaveData")+"</span>"]}),defaults:{xtype:"fieldset",labelWidth:130,width:980},items:[{title:"设置第一次打卡时间段(时间单位：分钟)",items:[{xtype:"textfield",fieldLabel:lang("allowgotowork1"),name:"onbeforetime"},{xtype:"textfield",fieldLabel:lang("allowgotowork"),name:"onaftertime"}]},{title:"设置第二次打卡时间段(时间单位：分钟)",items:[{xtype:"textfield",fieldLabel:lang("getOffWorkBefore"),id:a,disabled:true,name:"twoOffbeforetime"},{xtype:"textfield",fieldLabel:lang("getOffWorlAfter"),id:n,disabled:true,name:"twoOffaftertime"}]},{title:"设置第三次打卡时间段(时间单位：分钟)",items:[{xtype:"textfield",fieldLabel:lang("allowgotowork1"),id:h,disabled:true,name:"twoOnbeforetime"},{xtype:"textfield",fieldLabel:lang("allowgotowork"),id:k,disabled:true,name:"twoOnaftertime"}]},{title:"设置第四次打卡时间段(时间单位：分钟)",items:[{xtype:"textfield",fieldLabel:lang("getOffWorkBefore"),name:"offbeforetime"},{xtype:"textfield",fieldLabel:lang("getOffWorlAfter"),name:"offaftertime"}]},{title:"设置第五次打卡时间段(时间单位：分钟)",hidden:true,id:"fifthCheck",items:[{xtype:"textfield",fieldLabel:lang("getOffWorkBefore"),name:"thrOnbeforetime"},{xtype:"textfield",fieldLabel:lang("getOffWorlAfter"),name:"thrOnaftertime"}]},{title:"设置第六次打卡时间段(时间单位：分钟)",hidden:true,id:"sixthCheck",items:[{xtype:"textfield",fieldLabel:lang("getOffWorkBefore"),name:"thrOffbeforetime"},{xtype:"textfield",fieldLabel:lang("getOffWorlAfter"),name:"thrOffaftertime"}]},{title:"是否三班",items:[{xtype:"radiogroup",items:[{boxLabel:lang("yes"),name:"isThreeDate",inputValue:1},{boxLabel:lang("no"),name:"isThreeDate",inputValue:0,checked:true}],listeners:{change:function(s){if(s.getValue()==1){Ext.getCmp("fifthCheck").show();Ext.getCmp("sixthCheck").show()}else{Ext.getCmp("fifthCheck").hide();Ext.getCmp("sixthCheck").hide()}}}}]},{title:"弹性排班",items:[{xtype:"numberfield",allowNegative:false,allowDecimals:false,fieldLabel:"弹性时长(分)",name:"elasticityTime"},{xtype:"radiogroup",fieldLabel:"弹性排班类型",items:[{boxLabel:"情况一",name:"elasticityType",inputValue:0,checked:true},{boxLabel:"情况二",name:"elasticityType",inputValue:1}]},{xtype:"radiogroup",fieldLabel:"提前下班视为",items:[{boxLabel:"迟到",name:"elasticityEarly",inputValue:0,checked:true},{boxLabel:"早退",name:"elasticityEarly",inputValue:1}]},{xtype:"button",text:"说明",handler:function(){new Ext.Window({title:"说明",items:[{border:false,style:"margin: 8px;",html:"弹性　　时长：设置后正式上班的数分钟内不算迟到，不过下班要多上相应的迟到时间；<br /><br />弹性排班类型：假如排了两班，9:00-12:00、14:00-18:00，某员工9:15上班，<br />　　　　　　　假设该员工需要12:15下班请选择情况一，而在18:15下班请选择情况二<br /><br />提前下班视为：假设排班为9:00-18:00，某员工9:15上班，18:10下班，实际上少上了5分钟,<br />　　　　　　　那么，是早上9:00这个时间段迟到，还是下午18:00这个时间早退"}]}).show()}}]},{xtype:"hidden",listeners:{afterrender:function(){b()}}},{title:lang("setHowHourDay"),items:[{xtype:"textfield",fieldLabel:lang("setNumHourHalfDay"),name:"hour"}]},{title:"设置免签人员",items:[l]},{title:"设置考勤数据管理员",items:[o]},{title:"设置是否由系统自动填补中间班次的未打卡记录(由系统自动填补第二次上班打卡记录以及第一次下班打卡记录)",items:[{xtype:"checkbox",fieldLabel:"启用自动填补中间班次的未打卡记录",name:"autoFill",checked:true,listeners:{check:function(t,s){if(s){Ext.getCmp(h).setDisabled(true);Ext.getCmp(k).setDisabled(true);Ext.getCmp(a).setDisabled(true);Ext.getCmp(n).setDisabled(true);e.show();c.show()}else{Ext.getCmp(h).setDisabled(false);Ext.getCmp(k).setDisabled(false);Ext.getCmp(a).setDisabled(false);Ext.getCmp(n).setDisabled(false);e.hide();c.hide()}}}},e,c]},{title:"设置是否开启手机信息绑定用户",items:[{xtype:"checkbox",fieldLabel:"启用手机信息绑定",name:"checkPhone",checked:true}]}]});var b=function(){g.getForm().load({url:q.baseUrl+"&task=getSettingInfo",method:"POST",success:function(u,w){var v=w.result.data,t=v.notRegister,s=v.truename;cwjname=v.cwjname;cwjuids=v.recordAdmin;l.setValue(s);l.hiddenField.setValue(t);o.setValue(cwjname);o.hiddenField.setValue(cwjuids)},failure:function(s,t){CNOA.msg.alert(t.result.msg)}})};var i=function(s){var u=g.getForm(),t=l.getValue(),v=o.getValue();if(u.isValid()){u.submit({url:q.baseUrl+"&task=settingUpdate",method:"POST",params:{uids:t,recordAdmin:v},success:function(w,x){CNOA.msg.notice(x.result.msg,lang("kQMgr"));e.clearValue();c.clearValue();b()},failure:function(w,x){CNOA.msg.alert(x.result.msg)}})}};return g},addClasses:function(a,e){var b=this;this.classesFormPanel=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,defaults:{width:180,xtype:"timefield"},items:[{xtype:"textfield",fieldLabel:lang("name"),name:"name",allowBlank:false},{fieldLabel:lang("goWorkTime"),format:"H:i",name:"oneStime",minValue:"00:15",allowBlank:false},{fieldLabel:lang("getOffWorkTime"),format:"H:i",name:"oneEtime",minValue:"00:15",allowBlank:false},{fieldLabel:lang("goWorkTime"),format:"H:i",name:"twoStime",minValue:"00:15",allowBlank:false},{fieldLabel:lang("getOffWorkTime"),format:"H:i",name:"twoEtime",minValue:"00:15",allowBlank:false},{fieldLabel:lang("goWorkTime"),format:"H:i",name:"thrStime",minValue:"00:15",hidden:true},{fieldLabel:lang("getOffWorkTime"),format:"H:i",name:"thrEtime",minValue:"00:15",hidden:true},{xtype:"radiogroup",fieldLabel:lang("whetherSetVacation"),items:[{boxLabel:lang("yes"),name:"isRest",inputValue:1},{boxLabel:lang("no"),name:"isRest",inputValue:0,checked:true}]},{xtype:"radiogroup",fieldLabel:lang("whetherEffect"),items:[{boxLabel:lang("yes"),name:"status",inputValue:1,checked:true},{boxLabel:lang("no"),name:"status",inputValue:0}]},{xtype:"radiogroup",fieldLabel:"是否三班",hidden:!b.isThreeDate,items:[{boxLabel:lang("yes"),name:"isThreeDate",inputValue:1},{boxLabel:lang("no"),name:"isThreeDate",inputValue:0,checked:true}],listeners:{change:function(f){if(f.getValue()==1){b.classesFormPanel.getForm().findField("thrStime").show();b.classesFormPanel.getForm().findField("thrEtime").show()}else{b.classesFormPanel.getForm().findField("thrEtime").hide();b.classesFormPanel.getForm().findField("thrStime").hide()}}}}]});var c=function(f,g){if(b.classesFormPanel.getForm().isValid()){b.classesFormPanel.getForm().submit({url:b.baseUrl+"&task=addEditClasses",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{action:f,cid:g},success:function(h,i){CNOA.msg.notice(i.result.msg,lang("kQSet"));b.classesPanel.store.reload();b.getClassDown.reload();d.close()},failure:function(h,i){CNOA.msg.alert(i.result.msg)}})}};var d=new Ext.Window({title:lang("addClasses"),width:330,height:380,layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[this.classesFormPanel],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){c(a,e)}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});if(a=="edit"){b.loadEditClasses(e)}d.show()},delClasses:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delClasses",params:{ids:a},success:function(c){var d=Ext.decode(c.responseText);CNOA.msg.notice2(d.msg);b.classesPanel.store.reload();b.getClassDown.reload()}})},addShift:function(){var b=this;var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,defaults:{width:180,xtype:"combo",typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:this.getClassDown,valueField:"cid",displayField:"name"},items:[{xtype:"textfield",fieldLabel:lang("name"),name:"name",allowBlank:false},{fieldLabel:lang("monday"),allowBlank:false,hiddenName:"mon"},{fieldLabel:lang("tuesday"),allowBlank:false,hiddenName:"tue"},{fieldLabel:lang("wednesday"),allowBlank:false,hiddenName:"wed"},{fieldLabel:lang("thursday"),allowBlank:false,hiddenName:"thurs"},{fieldLabel:lang("friday"),allowBlank:false,hiddenName:"fri"},{fieldLabel:lang("saturday"),allowBlank:false,hiddenName:"sat"},{fieldLabel:lang("sunday"),allowBlank:false,hiddenName:"sun"}]});var c=function(){if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=addShift",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",success:function(e,f){CNOA.msg.notice(f.result.msg,lang("kQSet"));b.shiftPanel.store.reload();b.getShiftStore.reload();d.close()},failure:function(e,f){CNOA.msg.alert(f.result.msg)}})}};var d=new Ext.Window({title:lang("addShifts"),width:330,height:350,layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[a],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){c()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()},delShift:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=delShift",params:{ids:a},success:function(c){var d=Ext.decode(c.responseText);CNOA.msg.notice2(d.msg);b.shiftPanel.store.reload();b.getShiftStore.reload()}})},updateShift:function(d,c,b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=updateShift",params:{id:d,field:c,value:b},success:function(e){var f=Ext.decode(e.responseText);a.shiftPanel.store.reload();a.getShiftStore.reload();CNOA.msg.notice2(f.msg)}})},addGroup:function(){var b=this;var e=new Ext.form.SelectorForm({width:180,hiddenName:"deptid",multiselect:true,selectorType:"dept"});var c=function(){var f=e.getValue();if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=addGroup",waitTitle:lang("notice"),waitMsg:lang("notice"),method:"POST",params:{deptid:f},success:function(g,h){CNOA.msg.notice(h.result.msg,lang("kQSet"));b.groupPanel.store.reload();d.close()},failure:function(g,h){CNOA.msg.alert(h.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,hideBorders:true,labelAlign:"right",labelWidth:80,padding:10,defaults:{width:180},items:[{fieldLabel:lang("deptName"),items:[e]},{xtype:"combo",fieldLabel:lang("selectShift"),allowBlank:false,store:b.getShiftStore,width:180,hiddenName:"shift",valueField:"sid",displayField:"name",mode:"local",triggerAction:"all",forceSelection:true,editable:false}]});var d=new Ext.Window({title:lang("addTeamsAndgroups"),width:330,height:200,layout:"fit",resizable:false,autoDistory:true,modal:true,maskDisabled:true,items:[a],plain:true,buttonAlign:"right",buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){c()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()},delGroup:function(b,a){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=delGroup",params:{ids:b,type:a},success:function(d){var e=Ext.decode(d.responseText);CNOA.msg.notice2(e.msg);c.groupPanel.store.reload()}})},updateGroup:function(e,d,a,b){var c=this;Ext.Ajax.request({url:c.baseUrl+"&task=updateGroup",params:{id:e,field:d,sid:a,type:b},success:function(f){var g=Ext.decode(f.responseText);CNOA.msg.notice2(g.msg)}})},showEdit:function(b){var a=this;CNOA.msg.cf(lang("noteBHYX")+"<br>"+lang("needToRe")+"<br>"+lang("sureContinue"),function(c){if(c=="yes"){a.addClasses("edit",b)}})},loadEditClasses:function(b){var a=this;a.classesFormPanel.getForm().load({url:a.baseUrl+"&task=getClasses",params:{cid:b},method:"POST",failure:function(c,d){CNOA.msg.alert(d.result.msg)}})},getLockClass:function(){var c=this;this.ID_attendUids=Ext.id();var a=new Ext.form.FormPanel({title:"锁定排班",border:false,padding:10,tbar:new Ext.Toolbar({items:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){b()}},'<span style="color:gray;"><<<锁定后，在规定时间内不能再排班(除例外人员) </span>']}),items:[{xtype:"fieldset",title:lang("lockSetup"),labelAlign:"right",items:[{xtype:"checkbox",name:"isLock",fieldLabel:"启用锁定"},{xtype:"compositefield",fieldLabel:"锁定时长",items:[{xtype:"numberfield",name:"lockDay",width:50},{xtype:"displayfield",value:lang("tian")},{xtype:"numberfield",name:"lockHour",width:50},{xtype:"displayfield",value:lang("hour")},{xtype:"displayfield",value:"<span style='color: red'>注意: 超过时长锁定自动失效,如果时长为空,则表示一直锁定</span>"}]},{xtype:"textarea",height:100,width:300,readOnly:true,fieldLabel:lang("exclude")+lang("people"),name:"excludeUsers",listeners:{render:function(d){d.to=c.ID_attendUids},focus:function(d){people_selector("user",d,true,false)}}},{xtype:"hidden",id:this.ID_attendUids,name:"excludeUids"}]}],listeners:{render:function(){Ext.Ajax.request({url:c.baseUrl+"&task=loadLockData",success:function(d){var e=Ext.decode(d.responseText);a.getForm().findField("isLock").setValue(e.data.isLock);a.getForm().findField("lockDay").setValue(e.data.lockDay);a.getForm().findField("lockHour").setValue(e.data.lockHour);a.getForm().findField("excludeUsers").setValue(e.data.excludeUsers);a.getForm().findField("excludeUids").setValue(e.data.excludeUids)}})}}});var b=function(){if(a.getForm().isValid()){a.getForm().submit({url:c.baseUrl+"&task=lockClass",method:"POST",success:function(d,e){}})}};return a},getIsAlertPanel:function(){var b=this;var a=new Ext.FormPanel({title:"考勤登记提醒",bodyStyle:"padding-top: 15px;",tbar:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=isAlert",success:function(c,d){CNOA.msg.notice2(d.result.msg)}})}}}],items:[{xtype:"radiogroup",width:150,items:[{xtype:"radio",boxLabel:lang("yes"),name:"isAlert",inputValue:1},{xtype:"radio",boxLabel:lang("no"),name:"isAlert",inputValue:0}]}],listeners:{render:function(){Ext.Ajax.request({url:b.baseUrl+"&task=loadIsAlert",success:function(d){var c=Ext.decode(d.responseText);a.getForm().findField("isAlert").setValue(c)}})}}});return a}};var CNOA_att_person_classesClass,CNOA_att_person_classes;CNOA_att_person_classesClass=CNOA.Class.create();CNOA_att_person_classesClass.prototype={init:function(){this.isThreeDate=CNOA.att.person.classes.isThreeDate==1?true:false;this.classesPanel=this.getPersonClasses();this.personRestPanel=this.getPersonRest();this.myAttPanel=this.getMyAttRecord();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:100,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.classesPanel,this.personRestPanel,this.myAttPanel]})},getPersonClasses:function(){var h=this;var g="index.php?app=att&func=person&action=classes";var a=[{name:"uid"},{name:"truename"},{name:"date"},{name:"classes"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"thrStime"},{name:"thrEtime"}];var f=function(i){if(i==4){i="<span style='color:#FF7F00'>"+lang("beOnLeave")+"</span>"}return i};var e=[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true},{header:lang("truename"),dataIndex:"truename",width:100},{header:lang("date"),dataIndex:"date",width:140},{header:lang("classes"),dataIndex:"classes",width:100,renderer:f},{header:lang("goWork"),dataIndex:"oneStime",width:100,renderer:f},{header:lang("offWork"),dataIndex:"oneEtime",width:100,renderer:f},{header:lang("goWork"),dataIndex:"twoStime",width:100,renderer:f},{header:lang("offWork"),dataIndex:"twoEtime",width:100,renderer:f}];if(this.isThreeDate){e.push({header:lang("goWork"),dataIndex:"thrStime",width:100,renderer:f});e.push({header:lang("offWork"),dataIndex:"thrEtime",width:100,renderer:f})}var c=new Ext.grid.ColumnModel({defaults:{align:"center",width:50,sortable:false,menuDisabled:true},columns:e});var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:g+"&task=getPersonClasses",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a}),listeners:{exception:function(n,m,o,l,j){var k=j.responseText;if(k!=""){var i=Ext.decode(k);if(i.failure){CNOA.msg.alert(i.msg)}}}}});var d=new Ext.grid.GridPanel({region:"center",store:b,cm:c,title:lang("mySchedulingTable"),tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.reload()}}]})});return d},getPersonRest:function(){var f=this;var e="index.php?app=att&func=person&action=classes";var a=[{name:"truename"},{name:"annualLeave"},{name:"useLeave"},{name:"unUseLeave"},{name:"takeRest"}];var b=new Ext.grid.ColumnModel({defaults:{align:"center",menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:lang("truename"),dataIndex:"truename",width:80},{header:lang("annualLeave"),dataIndex:"annualLeave",width:140,renderer:f.renValue},{header:lang("hasBeenUseAnnual"),dataIndex:"useLeave",width:140,renderer:f.renValue},{header:lang("unuseAnnualLeave"),dataIndex:"unUseLeave",width:140,renderer:f.renValue},{header:"剩余调休小时",dataIndex:"takeRest",width:140,renderer:f.renValue}]});var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:e+"&task=getPersonRest",disableCaching:true}),reader:new Ext.data.JsonReader({root:"data",fields:a})});var c=new Ext.grid.GridPanel({region:"center",store:d,cm:b,title:lang("myHoliday"),tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.reload()}}]})});return c},getMyAttRecord:function(){var e=this;var d="index.php?app=att&func=person&action=classes";var c=[{name:"id"},{name:"date"},{name:"day"},{name:"month"},{name:"oneStime"},{name:"oneEtime"},{name:"twoStime"},{name:"twoEtime"},{name:"oneTime"},{name:"twoTime"},{name:"threeTime"},{name:"fourTime"},{name:"fiveTime"},{name:"sixTime"},{name:"oneExplain"},{name:"twoExplain"},{name:"threeExplain"},{name:"fourExplain"},{name:"fiveExplain"},{name:"sixExplain"},{name:"leaveHours"},{name:"thrStime"},{name:"thrEtime"}];var i={stime:""};var b=[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:140},{header:lang("goWork"),dataIndex:"oneStime",width:140,renderer:e.changeFont},{header:lang("offWork"),dataIndex:"oneEtime",width:140,renderer:e.changeFont},{header:lang("goWork"),dataIndex:"twoStime",width:140,renderer:e.changeFont},{header:lang("offWork"),dataIndex:"twoEtime",width:140,renderer:e.changeFont},{header:lang("remark"),dataIndex:"leaveHours",width:100,renderer:e.leaveHoursRender}];if(this.isThreeDate){b=[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("date"),dataIndex:"date",width:140},{header:lang("goWork"),dataIndex:"oneStime",width:140,renderer:e.changeFont},{header:lang("offWork"),dataIndex:"oneEtime",width:140,renderer:e.changeFont},{header:lang("goWork"),dataIndex:"twoStime",width:140,renderer:e.changeFont},{header:lang("offWork"),dataIndex:"twoEtime",width:140,renderer:e.changeFont},{header:lang("goWork"),dataIndex:"thrStime",width:140,renderer:e.changeFont},{header:lang("offWork"),dataIndex:"thrEtime",width:140,renderer:e.changeFont},{header:lang("remark"),dataIndex:"leaveHours",width:100,renderer:e.leaveHoursRender}]}var f=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:b});var g=new Ext.data.Store({autoLoad:true,baseParams:i,proxy:new Ext.data.HttpProxy({url:d+"&task=getPersonRecord",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c}),listeners:{exception:function(o,n,p,m,k){var l=k.responseText;if(l!=""){var j=Ext.decode(l);if(j.failure){CNOA.msg.alert(j.msg)}}}}});var h=new Ext.form.DateField({format:"Y-m",value:new Date(),plugins:"monthPickerPlugin",listeners:{select:function(k,j){i.stime=k.getRawValue();g.load()}}});var a=new Ext.grid.GridPanel({region:"center",store:g,cm:f,title:lang("myAtt"),tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.reload()}},lang("queryTime")+": ",h]})});return a},renValue:function(a){if(a==null){a=0}return a},changeFont:function(i,b,e,h,k,j){var g=this,d=e.data,c=new Date(),a=c.getDate();nMonth=c.getMonth()+1;if(a<d.day&&nMonth==d.month){i="------"}else{if(i=="未登记"){i="<span style='color: red'>"+lang("unRegister")+"</span>"}else{if(i=="休假"){i="<span style='color: green'>"+lang("beOnLeave")+"</span>"}else{if(i=="请假"){i="<span style='color: mediumblue'>"+lang("leave")+"</span>"}else{if(i=="正常"){switch(k){case 3:i=d.oneTime;break;case 4:i=d.twoTime;break;case 5:i=d.threeTime;break;case 6:i=d.fourTime;break;case 7:i=d.fiveTime;break;case 8:i=d.sixTime;break}}else{if(i=="未登记1"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i="<span style='color: red'>"+lang("unRegister")+"</span>"+f;break}}else{if(i=="出差"){i="<span style='color: indigo'>"+lang("evection")+"</span>"}else{if(i=="外出"){i="<span style='color: #008B8B'>"+lang("egress")+"</span>"}else{if(i=="(出差)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 7:i=d.fiveTime+"<span style='color: red'>("+lang("evection")+")</span>";break;case 8:i=d.sixTime+"<span style='color: red'>("+lang("evection")+")</span>";break}}else{if(i=="(外出)"){switch(k){case 3:i=d.oneTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 4:i=d.twoTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 5:i=d.threeTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 6:i=d.fourTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 7:i=d.fiveTime+"<span style='color: red'>("+lang("egress")+")</span>";break;case 8:i=d.sixTime+"<span style='color: red'>("+lang("egress")+")</span>";break}}else{if(i=="迟到"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 7:if(d.fiveExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fiveExplain+'">'}i=d.fiveTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break;case 8:if(d.sixExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.sixExplain+'">'}i=d.sixTime+"<span style='color: red'>("+lang("late")+")</span>"+f;break}}else{if(i=="早退"){var f="";switch(k){case 3:if(d.oneExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.oneExplain+'">'}i=d.oneTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 4:if(d.twoExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.twoExplain+'">'}i=d.twoTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 5:if(d.threeExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.threeExplain+'">'}i=d.threeTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 6:if(d.fourExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fourExplain+'">'}i=d.fourTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 7:if(d.fiveExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.fiveExplain+'">'}i=d.fiveTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break;case 8:if(d.sixExplain){f='<img src=/resources/images/icons/message.gif ext:qtip="'+d.sixExplain+'">'}i=d.sixTime+"<span style='color: red'>("+lang("leaveEarly")+")</span>"+f;break}}else{if(i=="未登记(休假)"){switch(k){case 3:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break;case 4:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break;case 5:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break;case 6:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break;case 7:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break;case 8:i="<span style='color: red'>未登记</span><span style='color: green'>("+lang("beOnLeave")+")</span>";break}}else{if(i=="免签"){i="<span style='color:saddlebrown'>"+lang("notSignIn")+"</span>"}}}}}}}}}}}}}}return i},leaveHoursRender:function(a){if(a==""||a==undefined||a==null){a=""}else{a="请假<span style='color:blue; font-weight:bold'>"+a+"</span>小时"}return a}};var CNOA_att_person_egressionClass,CNOA_att_person_egression;CNOA_att_person_egressionClass=CNOA.Class.create();CNOA_att_person_egressionClass.prototype={init:function(){var c=this;this.baseUrl="index.php?app=att&func=person&action=egression";fields=[{name:"id"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"address"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEgressionList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),a=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("egressLocation"),dataIndex:"address",width:145},{header:lang("WCYY")+"<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230,renderer:c.renReason}]});var d=Ext.id();var b=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:a,sm:e,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.store.reload()}},{text:lang("wCDJ"),id:d,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(f,m,l,k){if(l==6){var h=c.store.reader.jsonData.data[m];var g=h.stime;var i=h.etime;var j=h.reason;var n=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+g+"</span> ---- "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+i+'</span><BR><div style="color:#333; padding:20px; ">'+j+"</div>";c.showDetail(n)}},render:function(){getFlowId4Engine("attEgression",function(g,f){Ext.getCmp(d).setHandler(function(){g()})})}},bbar:b});this.mainPanel=this.grid},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},renReason:function(g,b,a,h,d,c){var f=a.data,e="";e='<span style="color:#555">'+g+"</span>";return e}};var CNOA_att_person_evectionClass,CNOA_att_person_evection;CNOA_att_person_evectionClass=CNOA.Class.create();CNOA_att_person_evectionClass.prototype={init:function(){var c=this;this.baseUrl="index.php?app=att&func=person&action=evection";fields=[{name:"id"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"status"},{name:"address"},{name:"days"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEvectionList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("travelSites"),dataIndex:"address",width:145},{header:lang("travelReason")+"<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230,renderer:c.renReason},{header:"总出差天数",dataIndex:"days"}]});var a=Ext.id();var d=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:b,sm:e,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.store.reload()}},{text:lang("cCDJ"),id:a,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(f,m,l,k){if(l==6){var h=c.store.reader.jsonData.data[m];var g=h.stime;var i=h.etime;var j=h.reason;var n=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+g+"</span> ---- "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+i+'</span><BR><div style="color:#333; padding:20px; ">'+j+"</div>";c.showDetail(n)}},render:function(){getFlowId4Engine("attEvection",function(g,f){Ext.getCmp(a).setHandler(function(){g()})})}},bbar:d});this.mainPanel=this.grid},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},renReason:function(g,b,a,h,d,c){var f=a.data,e="";e='<span style="color:#555">'+g+"</span>";return e}};var CNOA_att_person_againClass,CNOA_att_person_again;CNOA_att_person_againClass=CNOA.Class.create();CNOA_att_person_againClass.prototype={init:function(){var c=this;this.baseUrl="index.php?app=att&func=person&action=again";fields=[{name:"id"},{name:"posttime"},{name:"reason"},{name:"againDate"},{name:"againClasses"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getAgainList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:"补卡日期",dataIndex:"againDate",width:145},{header:"补卡班次",dataIndex:"againClasses",width:145},{header:"补卡原因<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230,renderer:c.renReason}]});var a=Ext.id();var d=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:b,sm:e,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.store.reload()}},{text:"补卡登记",id:a,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(f,m,l,k){if(l==5){var i=c.store.reader.jsonData.data[m];var h=i.againDate;var g=i.againClasses;var j=i.reason;var n='补卡日期：<span style="color:#228833; font-weight:bold">'+h+'</span>  补卡班次：<span style="color:#228833; font-weight:bold">'+g+'</span><BR><div style="color:#333; padding:20px; ">'+j+"</div>";c.showDetail(n)}},render:function(){getFlowId4Engine("attAgain",function(g,f){Ext.getCmp(a).setHandler(function(){g()})})}},bbar:d});this.mainPanel=this.grid},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},renReason:function(g,b,a,h,d,c){var f=a.data,e="";e='<span style="color:#555">'+g+"</span>";return e}};var CNOA_att_person_leaveClass,CNOA_att_person_leave;CNOA_att_person_leaveClass=CNOA.Class.create();CNOA_att_person_leaveClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=att&func=person&action=leave";this.engineInDay=this.getEngineInDay();this.engineInHours=this.getEngineInHours();this.mainPanel=new Ext.ux.VerticalTabPanel({region:"center",border:false,tabPosition:"left",tabWidth:110,activeItem:0,deferredRender:true,layoutOnTabChange:true,items:[this.engineInDay,this.engineInHours]})},getEngineInDay:function(){var e=this;var a=[{name:"id"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"days"},{name:"hour"}];var b=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getListInDays",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),c=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("leaveDays"),dataIndex:"days",width:80},{header:lang("leaveHours"),dataIndex:"hour",width:80},{header:lang("qjReason")+"<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230}]});var g=new Ext.PagingToolbar({displayInfo:true,store:b,pageSize:15});var f=Ext.id();var d=new Ext.grid.GridPanel({title:lang("qJDJ")+"（"+lang("tian")+"）",region:"center",border:false,store:b,loadMask:{msg:lang("waiting")},cm:c,sm:h,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){b.reload()}},{text:lang("qJDJ"),id:f,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(i,p,o,n){if(o==6){var k=b.reader.jsonData.data[p];var j=k.stime;var l=k.etime;var m=k.reason;var q=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+j+"</span> ---- "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+l+'</span><BR><div style="color:#333; padding:20px; ">'+m+"</div>";e.showDetail(q)}},render:function(){getFlowId4Engine("attLeave",function(j,i){Ext.getCmp(f).setHandler(function(){j()})})}},bbar:g});return d},getEngineInHours:function(){var e=this;var a=[{name:"id"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"hours"}];var d=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getListInHours",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var h=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("leaveHours"),dataIndex:"hours",width:80},{header:lang("qjReason")+"<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230}]});var g=new Ext.PagingToolbar({displayInfo:true,store:d,pageSize:15});var f=Ext.id();var c=new Ext.grid.GridPanel({title:lang("qJDJ")+"（"+lang("hour")+"）",region:"center",border:false,store:d,loadMask:{msg:lang("waiting")},cm:b,sm:h,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){d.reload()}},{text:lang("qJDJ"),id:f,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(i,p,o,n){if(o==6){var k=d.reader.jsonData.data[p];var j=k.stime;var l=k.etime;var m=k.reason;var q=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+j+"</span> ---- "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+l+'</span><BR><div style="color:#333; padding:20px; ">'+m+"</div>";e.showDetail(q)}},render:function(){getFlowId4Engine("attLeaveInHours",function(j,i){Ext.getCmp(f).setHandler(function(){j()})})}},bbar:g});return c},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()}};var CNOA_att_person_overtimeClass,CNOA_att_person_overtime;CNOA_att_person_overtimeClass=CNOA.Class.create();CNOA_att_person_overtimeClass.prototype={init:function(){var c=this;this.baseUrl="index.php?app=att&func=person&action=overtime";fields=[{name:"id"},{name:"stime"},{name:"etime"},{name:"reason"},{name:"posttime"},{name:"hour"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getOvertimeList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:fields})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false}),a=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"num",dataIndex:"id",hidden:true},{header:lang("appTime"),dataIndex:"posttime",width:145},{header:lang("startTime"),dataIndex:"stime",width:145},{header:lang("endTime"),dataIndex:"etime",width:145},{header:lang("jiabanTime")+"("+lang("hour")+")",dataIndex:"hour",width:100},{header:lang("otReason")+"<span style='color:#999; font-weight:bold;'>("+lang("clickToView")+")</span>",dataIndex:"reason",width:230,renderer:c.renReason}]});var d=Ext.id();var b=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15});this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,store:this.store,loadMask:{msg:lang("waiting")},cm:a,sm:e,hideBorders:true,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){c.store.reload()}},{text:lang("jBDJ"),id:d,iconCls:"icon-utils-s-add",cls:"btn-blue4",handler:function(){CNOA.msg.alert(lang("unBindingEngine"))}}]}),listeners:{cellclick:function(f,m,l,k){if(l==6){var h=c.store.reader.jsonData.data[m];var g=h.stime;var i=h.etime;var j=h.reason;var n=lang("startTime")+'：<span style="color:#228833; font-weight:bold">'+g+"</span> ---- "+lang("endTime")+'：<span style="color:#228833; font-weight:bold">'+i+'</span><BR><div style="color:#333; padding:20px; ">'+j+"</div>";c.showDetail(n)}},render:function(){getFlowId4Engine("attOvertime",function(g,f){Ext.getCmp(d).setHandler(function(){g()})})}},bbar:b});this.mainPanel=this.grid},showDetail:function(a){a=a.replace(/\n/g,"<BR> ");winInfos=new Ext.Window({title:lang("viewDetail1"),width:650,height:400,autoScroll:true,modal:true,bodyStyle:"padding: 20px; background-color:#fff",html:a,buttons:[{text:lang("close"),handler:function(){winInfos.close()}}]}).show()},renReason:function(g,b,a,h,d,c){var f=a.data,e="";e='<span style="color:#555">'+g+"</span>";return e}};var CNOA_att_person_registerClass,CNOA_att_person_register;CNOA_att_person_registerClass=CNOA.Class.create();CNOA_att_person_registerClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=att&func=person&action=register";this.toolbarTip=Ext.id();this.fields=[{name:"num"},{name:"classes"},{name:"workType"},{name:"time"},{name:"stime"},{name:"etime"},{name:"recTime"},{name:"explain"},{name:"date"},{name:"nowTime"},{name:"type"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getRegisterTime",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(h,g,i,f,d,c){var e=d.responseText;if(e!=""){var b=Ext.decode(e);if(b.failure){CNOA.msg.alert(b.msg)}}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"num",dataIndex:"num",hidden:true},{header:lang("classes"),dataIndex:"classes",width:130,sortable:false,menuDisabled:true},{header:lang("registerType"),dataIndex:"workType",width:130,sortable:false,menuDisabled:true,renderer:a.checkType},{header:lang("specifiedTime"),dataIndex:"time",width:130,sortable:false,menuDisabled:true},{header:lang("registerSTime"),dataIndex:"stime",width:130,sortable:false,menuDisabled:true},{header:lang("registerETime"),dataIndex:"etime",width:130,sortable:false,menuDisabled:true},{header:lang("registerTime"),dataIndex:"recTime",width:130,sortable:false,menuDisabled:true,renderer:a.checkTime},{header:lang("opt"),dataIndex:"opt",width:150,sortable:false,menuDisabled:true,renderer:a.operation}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,border:false,layout:"fit",region:"center",store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,hideBorders:true});this.mainPanel=new Ext.form.FormPanel({border:false,layout:"border",title:"",items:[this.grid],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.store.reload()}}]})})},checkType:function(e,b,a){var d=a.data;var c=d.workType==0?lang("goWork"):lang("offWork");return c},checkTime:function(e,c,b){var d=b.data,a=d.date,f=Date.parse(a+" "+d.recTime);if(d.recTime==""){item=lang("unRegister");return item}if(d.type==1){item=d.recTime+"<font color=red>("+lang("late")+")</font>";return item}else{if(d.type==2){item=d.recTime+"<font color=red>("+lang("leaveEarly")+")</font>";return item}}item=d.recTime;return item},operation:function(m,c,i,k,o,n){var f=i.data,p="",b=f.date,a=Date.parse(b+" "+f.nowTime),e=Date.parse(b+" "+f.time),l=Date.parse(b+" "+f.recTime),d=Date.parse(b+" "+f.stime),h=Date.parse(b+" "+f.etime),j=f.explain,g='<a class="gridview" href="javascript:void(0);" onclick="CNOA_att_person_register.doExplain('+f.num+",'"+f.classes+"');\">"+lang("explainSituation")+"</a>";if(f.recTime==""){if(a>=d&&a<=h){if(j!=""){p='<span ext:qtip="'+j+'">'+lang("haveExplainSituation")+"</span>"}else{p='<a class="gridview" href="javascript:void(0);" onclick="CNOA_att_person_register.doRecord('+f.num+');">'+lang("register2")+"</a>"}}else{if(a>h){if(j!=""){p='<span ext:qtip="'+j+'">'+lang("haveExplainSituation")+"</span>"}else{p=g}}else{if(a<d){if(j!=""){p='<span ext:qtip="'+j+'">'+lang("haveExplainSituation")+"</span>"}else{p=lang("notInRegisterTime")}}}}return p}if(f.type==1||f.type==2){p=g}if(j!=""){p='<span ext:qtip="'+j+'">'+lang("haveExplainSituation")+"</span>"}return p},doRecord:function(b){var c=this;var e=c.mainPanel.getForm();var a=c.grid.getStore().data.items[b],d=a.data;if(e.isValid()){e.submit({url:c.baseUrl+"&task=addChecktime",method:"POST",params:d,success:function(f,g){CNOA.msg.notice(g.result.msg,lang("kQMgr"));c.store.reload()},failure:function(f,g){CNOA.msg.alert(g.result.msg);c.store.reload()}})}},doExplain:function(b,c){var e=this;var g=e.baseUrl+"&task=updateExplain";var f=function(){var h=a.getForm();if(h.isValid()){h.submit({url:g,waitTitle:lang("notice"),method:"POST",waitMsg:lang("waiting"),params:{cnum:b,classes:c},success:function(i,j){d.close();e.store.reload()},failure:function(i,j){CNOA.msg.alert(j.result.msg)}})}};var a=new Ext.form.FormPanel({hideBorders:true,border:false,waitMsgTarget:true,labelWidth:10,labelAlign:"right",bodyStyle:"padding: 10px",items:[{xtype:"label",text:lang("describeAboutIt")+"："},{xtype:"textarea",width:330,height:160,maxLength:255,name:"explain",style:"margin: 20px 0 0 0;"}]});var d=new Ext.Window({width:400,height:310,modal:true,autoDestroy:true,closeAction:"close",resizable:false,title:lang("explainSituation"),layout:"fit",items:[a],buttons:[{text:lang("save"),iconCls:"icon-btn-save",handler:function(){f()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()}};var CNOA_att_arrange_originalClass,CNOA_att_arrange_original;CNOA_att_arrange_originalClass=CNOA.Class.create();CNOA_att_arrange_originalClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=att&func=arrange&action=original";this.originalData=this.getArrangeOriginal();this.mainPanel=new Ext.Panel({border:false,layout:"border",items:[this.originalData]})},getArrangeOriginal:function(){var i=this;var f=[{name:"machineId"},{name:"enrollNum"},{name:"truename"},{name:"timeStr"}];var k={machineId:"",enrollNum:"",sdate:"",edate:""};var b=function(m){if(m==null){return"<span style='color:grey'>"+lang("unbindUser")+"</span>"}return m};var c=new Ext.grid.CheckboxSelectionModel();var j=new Ext.grid.ColumnModel({defaults:{sortable:true,menuDisabled:true,width:130},columns:[new Ext.grid.RowNumberer(),{header:"uid",dataIndex:"uid",hidden:true,width:80},{header:lang("attMachineId"),dataIndex:"machineId",width:66},{header:lang("attEnrollId"),dataIndex:"enrollNum",width:66},{header:lang("truename"),dataIndex:"truename",renderer:b},{header:lang("clockTime"),dataIndex:"timeStr",id:"originalData",width:230}]});this.store=new Ext.data.Store({autoLoad:true,baseParams:k,proxy:new Ext.data.HttpProxy({url:i.baseUrl+"&task=getOriginalData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{exception:function(r,q,s,p,n){var o=n.responseText;if(o!=""){var m=Ext.decode(o);if(m.failure){CNOA.msg.alert(m.msg)}}}}});var e=new Ext.form.TextField({width:80}),h=new Ext.form.TextField({width:80}),g=new Ext.form.DateField({format:"Y-m-d"}),l=new Ext.form.DateField({format:"Y-m-d"});var d=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:i.store,pageSize:15});var a=new Ext.grid.EditorGridPanel({region:"center",store:i.store,cm:j,sm:c,border:false,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){i.store.reload()}},{text:lang("synchronization"),iconCls:"icon-SYNC",cls:"btn-blue4",handler:function(){Ext.Ajax.request({url:i.baseUrl+"&task=synAttData",success:function(m){var n=Ext.decode(m.responseText);CNOA.msg.notice2(n.msg);i.store().reload()}})}},lang("attMachineId")+":",e,lang("attEnrollId")+":",h,lang("startTime")+":",g,lang("endTime")+":",l,{text:lang("search"),handler:function(){k.machineId=e.getValue();k.enrollNum=h.getValue();k.sdate=g.getRawValue();k.edate=l.getRawValue();i.store.load()}},{text:lang("clear"),handler:function(){e.setValue("");h.setValue("");g.setValue("");l.setValue("");k.machineId="";k.enrollNum="";k.sdate="";k.edate="";i.store.load()}}]}),bbar:d});return a}};var CNOA_att_mgr_joinAttClass,CNOA_att_mgr_joinAtt;CNOA_att_mgr_joinAttClass=CNOA.Class.create();CNOA_att_mgr_joinAttClass.prototype={init:function(){this.baseUrl="index.php?app=att&func=mgr&action=joinAtt";this.joinAttPanel=this.getJoinAttPanel();this.mainPanel=new Ext.Container({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.joinAttPanel]})},getJoinAttPanel:function(){var g=this;var f=[{name:"uid"},{name:"truename"},{name:"deptName"},{name:"isJoinAtt"},{name:"machineId"},{name:"importKey"},{name:"ykkq"},{name:"pc"},{name:"phone"},{name:"address"},{name:"checkPhone"}];var e=function(j){switch(j){case"notReg":return lang("mianQianPerson");break;case"1":return"<input type='checkbox' checked=true>";break;case"0":return"<input type='checkbox'>";break;case"":return"";break}};getReset=function(){return"<a href='javascript:void(0);' class='gridview' >重置</a>"};var i=function(j){if(j==0){j=lang("notBind")}return j};var d={truename:""};var c=new Ext.form.TextField();var h=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("truename"),dataIndex:"truename",width:130,sortable:false,menuDisabled:true},{header:lang("belongDept"),dataIndex:"deptName",width:130,sortable:true,menuDisabled:true},{header:lang("whetherForAtt"),dataIndex:"isJoinAtt",width:120,sortable:false,menuDisabled:true,renderer:e},{header:lang("attMachineId"),dataIndex:"machineId",width:80,sortable:false,menuDisabled:true,editor:new Ext.form.TextField(),renderer:i},{header:lang("attIdentifier"),dataIndex:"importKey",width:80,sortable:false,menuDisabled:true,editor:new Ext.form.TextField(),renderer:i},{header:"<input type='checkbox' id='ID_ISYKKQ'>是否考勤机打卡",dataIndex:"ykkq",width:100,sortable:false,menuDisabled:true,renderer:e},{header:"<input type='checkbox' id='ID_ISPC'>是否电脑打卡",dataIndex:"pc",width:100,sortable:false,menuDisabled:true,renderer:e},{header:"<input type='checkbox' id='ID_ISPHONE'>是否手机打卡",dataIndex:"phone",width:100,sortable:false,menuDisabled:true,renderer:e},{header:"允许考勤签到地址",dataIndex:"address",width:220,sortable:false,menuDisabled:true},{header:"重置手机设备信息",dataIndex:"checkPhone",width:120,sortable:false,menuDisabled:true,renderer:getReset},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.store=new Ext.data.Store({autoLoad:true,baseParams:d,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJoinAttUser",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f}),listeners:{load:function(j){g.isCheck()}}});var b=new Ext.PagingToolbar({plugins:[new Ext.grid.plugins.ComboPageSize()],displayInfo:true,store:g.store,pageSize:15});var a=new Ext.grid.EditorGridPanel({region:"center",store:g.store,cm:h,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){g.store.reload()}},{xtype:"importButton",browseTitle:lang("importAttMan"),cls:"btn-blue3",url:g.baseUrl+"&task=import_preson"},{text:lang("export2"),iconCls:"icon-excel",cls:"btn-blue3",handler:function(){Ext.Ajax.request({url:g.baseUrl+"&task=exportExcel&step=1",method:"POST",success:function(k,l){var j=Ext.decode(k.responseText);ajaxDownload(g.baseUrl+"&task=exportExcel&file="+j.msg+"&step=2")}})}},{text:"重置手机设备信息",iconCls:"icon-system-refresh",cls:"btn-blue3",handler:function(){CNOA.msg.cf("是否重置手机设备信息？",function(j){if(j=="yes"){Ext.Ajax.request({url:g.baseUrl+"&task=resetPhone&id=all",method:"POST",success:function(k,l){CNOA.msg.alert("重置成功")}})}})}},lang("truename")+":",c,{text:lang("search"),handler:function(){var j=c.getValue();d.truename=j;g.store.reload()}},{text:lang("clear"),handler:function(){d.truename="";c.setValue("");g.store.reload()}},"<span class='cnoa_color_gray'>请先导出数据再导入修改后的数据</span>"]}),bbar:b,listeners:{afteredit:function(k){var m=k.field,l=k.value,j=k.record.data.uid;if(l.match(/^[0-9]\d*$/)==null&&l!=""){if(m=="importKey"){CNOA.msg.alert(lang("attIdentOnlyInt"))}else{if(m=="machineId"){CNOA.msg.alert("考勤机ID只能为数字，请重新输入!")}}return}g.updateJoinAtt(j,m,l)},cellclick:function(j,r,p){var s=j.getColumnModel().getDataIndex(p);if(s=="isJoinAtt"||s=="ykkq"||s=="pc"||s=="phone"){var n=j.getStore().getAt(r),o=n.get("uid"),k=n.get("isJoinAtt"),l=n.get("ykkq"),q=n.get("pc"),m=n.get("phone");value=$(j.getView().getCell(r,p)).find("input").attr("checked");if(s=="isJoinAtt"&&(value==undefined||value==k)){return}if(s=="ykkq"&&(value==undefined||value==l)){return}if(s=="pc"&&(value==undefined||value==q)){return}if(s=="phone"&&(value==undefined||value==m)){return}value=value?1:0;g.updateJoinAtt(o,s,value)}if(s=="checkPhone"){var n=j.getStore().getAt(r),o=n.get("uid");g.resetById(o)}}}});return a},updateJoinAtt:function(a,d,c){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=editJoinAtt",params:{uid:a,field:d,value:c},success:function(e){var f=Ext.decode(e.responseText);if(f.success){CNOA.msg.notice2(f.msg)}else{CNOA.msg.alert(f.msg)}b.store.reload()}})},isCheck:function(){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=isFull",success:function(g){var c=Ext.decode(g.responseText);var e=c.ykkq,f=c.pc,d=c.phone;if(d){$("#ID_ISPHONE").attr("checked",true)}if(e){$("#ID_ISYKKQ").attr("checked",true)}if(f){$("#ID_ISPC").attr("checked",true)}}});$("#ID_ISPHONE").click(function(){var c=$(this).attr("checked");if(c){a("phone",1)}else{a("phone",0)}});$("#ID_ISYKKQ").click(function(){var c=$(this).attr("checked");if(c){a("ykkq",1)}else{a("ykkq",0)}});$("#ID_ISPC").click(function(){var c=$(this).attr("checked");if(c){a("pc",1)}else{a("pc",0)}});function a(d,c){Ext.Ajax.request({url:b.baseUrl+"&task=allSelect&type="+d,params:{isAll:c},success:function(e){var e=Ext.decode(e.responseText);if(e.success==true){b.store.reload();CNOA.msg.notice2(e.msg)}}})}},resetById:function(b){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=resetPhone&id="+b,success:function(c){var c=Ext.decode(c.responseText);if(c.success==true){a.store.reload();CNOA.msg.notice2(c.msg)}}})}};var CNOA_att_mgr_areasClass,CNOA_att_mgr_areas;CNOA_att_mgr_areasClass=CNOA.Class.create();CNOA_att_mgr_areasClass.prototype={init:function(){var a=this;this.Twidth=$(window).width();this.Theight=$(window).height();this.baseUrl="index.php?app=att&func=mgr&action=areas";this.center=this.centerPanel();this.mainPanel=new Ext.Panel({layout:"border",border:false,items:[this.center]})},centerPanel:function(){var f=this;var c=[{name:"id"},{name:"address"},{name:"longitude"},{name:"latitude"},{name:"radius"}];this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:f.baseUrl+"&task=getList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:c})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var b=function(i,h,g){var j=g.json.id;return"<a href='javascript:void(0);' class='gridview' onclick='CNOA_att_mgr_areas.applyUsers("+j+");'>适用人员</a>"};var a=new Ext.grid.ColumnModel({defaults:{menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"id",dataIndex:"id",hidden:true},{header:"地点",dataIndex:"address",width:300},{header:"经度",dataIndex:"longitude",width:120},{header:"纬度",dataIndex:"latitude",width:120},{header:"半径(米)",dataIndex:"radius"},{header:lang("opt"),dataIndex:"",renderer:b}]});var d=new Ext.grid.GridPanel({border:false,region:"center",store:this.store,sm:e,cm:a,tbar:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(){f.store.reload()}},{text:lang("add"),iconCls:"icon-utils-s-add",handler:function(){f.win("")}},{text:lang("modify"),iconCls:"icon-utils-s-edit",handler:function(g){var h=d.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"));return false}else{if(h.length!=1){CNOA.miniMsg.alertShowAt(g,lang("selectItemOnly"))}}var i=h[0].json.id;f.win(i)}},{text:lang("del"),iconCls:"icon-utils-s-delete",handler:function(g){var h=d.getSelectionModel().getSelections();if(h.length==0){CNOA.miniMsg.alertShowAt(g,lang("mustSelectOneRow"));return false}else{if(h.length!=1){CNOA.miniMsg.alertShowAt(g,lang("selectItemOnly"))}}var i=h[0].json.id;f.deleteAddr(i)}}]});return d},win:function(e){var d=this;var c="添加";d.formPanel=new Ext.form.FormPanel({border:false,padding:10,labelAlign:"right",items:[{xtype:"textfield",name:"address",allowBlank:false,fieldLabel:"名称"},{xtype:"textfield",name:"longitude",allowBlank:false,fieldLabel:"经度",listeners:{focus:function(){d.mapWin()}}},{xtype:"textfield",name:"latitude",allowBlank:false,readOnly:true,fieldLabel:"纬度"},{xtype:"numberfield",name:"radius",allowBlank:false,allowDecimals:false,fieldLabel:"半径(米)"},{xtype:"displayfield",style:"color: red",value:"半径:以选取点为中心,半径范围内打卡有效"}]});var a=function(){if(d.formPanel.getForm().isValid()){d.formPanel.getForm().submit({url:d.baseUrl+"&task=submitForm",method:"POST",params:{id:e},success:function(f,g){d.store.reload();b.close();CNOA.msg.notice2(g.result.msg)},failure:function(f,g){CNOA.msg.alert(g.result.msg)}})}};if(e){c="修改"}var b=new Ext.Window({border:false,title:c,width:400,height:230,layout:"fit",modal:true,items:[d.formPanel],buttons:[{text:lang("ok"),handler:function(){a()}},{text:lang("cancel"),handler:function(){b.close()}}]});b.show();if(e){d.formPanel.getForm().load({url:d.baseUrl+"&task=loadFormData",params:{id:e},success:function(f,g){}})}},mapWin:function(){var f=this;var e=Ext.id();var b=Ext.id();var a=Ext.id();var c=new Ext.form.FormPanel({border:false,autoScroll:true,layout:"border",items:[{xtype:"panel",region:"north",height:98,layout:"form",labelWidth:60,padding:10,border:false,items:[{xtype:"panel",border:false,layout:"column",columns:3,items:[{xtype:"displayfield",width:65,value:"地点:"},{xtype:"textfield",id:e,width:185,listeners:{specialkey:function(){var g=Ext.getCmp(e).getValue();f.sear(g)}}},{xtype:"button",width:60,text:"搜索",handler:function(){var g=Ext.getCmp(e).getValue();f.sear(g)}}]},{xtype:"textfield",width:180,id:b,readOnly:true,fieldLabel:"经度"},{xtype:"textfield",width:180,id:a,readOnly:true,fieldLabel:"纬度"}]},{xtype:"panel",region:"center",border:false,html:"<div style='width:100%;height:100%;border-top: 1px solid gray' id='container'></div>",listeners:{afterrender:function(){Ext.Ajax.request({url:f.baseUrl+"&task=getIP",success:function(j){var j=Ext.decode(j.responseText);var m="116.415854";var l="39.920753";if(j.x&&j.y){m=j.x;l=j.y}f.map=new BMap.Map("container");f.map.setDefaultCursor("crosshair");f.map.enableScrollWheelZoom();var o=new BMap.Point(m,l);f.map.centerAndZoom(o,13);var p=new BMap.Geocoder();f.map.addControl(new BMap.NavigationControl());f.map.addControl(new BMap.OverviewMapControl());f.map.addControl(new BMap.ScaleControl());f.map.addControl(new BMap.MapTypeControl());f.map.addControl(new BMap.CopyrightControl());var i=new BMap.Marker(o);f.map.addOverlay(i);i.addEventListener("click",function(q){document.getElementById(b).value=q.point.lng;document.getElementById(a).value=q.point.lat});i.enableDragging();i.addEventListener("dragend",function(q){p.getLocation(q.point,function(r){n(q.point,r)})});function n(u,q){var t={width:250,height:150,title:"当前位置"};var s=q.addressComponents;var v="当前位置："+s.province+", "+s.city+", "+s.district+", "+s.street+", "+s.streetNumber+"<br/>";v+="纬度: "+u.lat+", 经度："+u.lng;var r=new BMap.InfoWindow(v,t);i.openInfoWindow(r)}f.map.addEventListener("click",function(q){document.getElementById(b).value=q.point.lng;document.getElementById(a).value=q.point.lat});var g=new BMap.TrafficLayer();f.map.addTileLayer(g);function h(q){var r=q.name}var k=new BMap.LocalCity();k.get(h);f.sear=function(q){var r=new BMap.LocalSearch(f.map,{renderOptions:{map:f.map}});r.search(q)}}})}}}]});var d=new Ext.Window({border:false,width:f.Twidth-100,height:f.Theight-100,modal:true,layout:"fit",items:[c],buttons:[{text:lang("ok"),handler:function(){var h=Ext.getCmp(b).getValue();var g=Ext.getCmp(a).getValue();if(h&&g){f.formPanel.getForm().findField("longitude").setValue(h);f.formPanel.getForm().findField("latitude").setValue(g);d.close()}else{CNOA.msg.alert("请选取有效的经纬度")}}},{text:lang("cancel"),handler:function(){d.close()}}]});d.show()},deleteAddr:function(b){var a=this;if(!b){return}CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=deleteAddr",params:{id:b},success:function(d){var d=Ext.decode(d.responseText);if(d.success==true){a.store.reload();CNOA.msg.notice2(d.msg)}else{CNOA.msg.alert(d.msg)}}})}})},applyUsers:function(d){var h=this;var k=new CNOA.selector.UserSelector({closeAction:"hide",multiSelect:true});var i=new CNOA.selector.UserSelector({closeAction:"hide",multiSelect:true});var e=new CNOA.selector.StationSelector({closeAction:"hide",multiSelect:true});var a=new CNOA.selector.StationSelector({closeAction:"hide",multiSelect:true});var f=new CNOA.selector.DepartmentSelector({closeAction:"hide",multiSelect:true});var b=new CNOA.selector.DepartmentSelector({closeAction:"hide",multiSelect:true});var c=new Ext.form.FormPanel({waitMsgTarget:true,autoScroll:true,bodyStyle:"padding:5px",defaults:{width:380},border:false,labelAlign:"right",labelWidth:70,padding:10,items:[{xtype:"multifunctionselectorfield",fieldLabel:"适用人员",height:100,width:400,name:"appperson",allowBlank:false,blankText:"请选择适用人员",userButton:true,stationButton:true,departmentButton:true,userSelector:k,stationSelector:e,departmentSelector:f},{xtype:"multifunctionselectorfield",fieldLabel:"禁止人员",width:400,height:100,name:"stopperson",userButton:true,stationButton:true,departmentButton:true,userSelector:i,stationSelector:a,departmentSelector:b}]});var j=function(){if(c.getForm().isValid()){c.getForm().submit({url:h.baseUrl+"&task=submit",method:"POST",params:{addressId:d},success:function(l,m){g.close();CNOA.msg.notice2(m.result.msg)},failure:function(m,l){CNOA.msg.alert(l.result.msg)}})}};var g=new Ext.Window({border:false,modal:true,width:600,height:420,layout:"fit",items:[c],buttons:[{text:lang("save"),handler:function(){j()}},{text:lang("cancel"),handler:function(){g.close()}}]});g.show();c.getForm().load({url:h.baseUrl+"&task=loadApplyUsers",method:"POST",params:{id:d},success:function(l,m){},failure:function(l,m){CNOA.msg.alert(m.result.msg)}})}};var sm_att_att=1;
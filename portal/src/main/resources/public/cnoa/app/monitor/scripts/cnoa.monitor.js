var CNOA_monitor_mgr_imClass,CNOA_monitor_mgr_im;CNOA_monitor_mgr_imClass=CNOA.Class.create();CNOA_monitor_mgr_imClass.prototype={init:function(){var a=this;this.ID_btn_refreshList=Ext.id();this.ID_tree_treeRoot="CNOA_monitor_mgr_im_tree_root";this.ID_tree_treeRoot2="CNOA_monitor_mgr_im_tree_root2";this.ID_btn_collapseExpand=Ext.id();this.ID_btn_collapseExpand2=Ext.id();this.ID_chattingWith=Ext.id();this.ID_exportBtn=Ext.id();this.tuid=0;this.fuid=0;this.gid=0;this.type="person";this.baseUrl="index.php?app=monitor&func=mgr&action=im";this.fields=[{name:"id",mapping:"id"},{name:"date",mapping:"date"},{name:"content",mapping:"content"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getHistoryList"}),groupField:"date",sortInfo:{field:"id",direction:"ASC"},applySort:function(){},reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(d,b,e){var c=$("div[id=CHAT_HISTORYPANEL2] div.x-grid3-scroller").get(0);c.scrollTop=999999999;setTimeout(function(){c.scrollTop=999999999},500)}}});this.colModel=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:20,sortable:true,hidden:true},{header:lang("date"),dataIndex:"date",width:20,sortable:true},{header:lang("content"),dataIndex:"content",width:60,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderContent}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,emptyMsg:lang("pagingToolbarEmptyMsg"),displayMsg:lang("pagingToolbarDisplayMsg"),store:this.store,pageSize:30,listeners:{beforechange:function(b,c){if(a.type=="person"){c.fuid=a.fuid;c.tuid=a.tuid;c.type=a.type}if(a.type=="group"){c.gid=a.gid;c.type=a.type}}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,hideHeaders:true,id:"CHAT_HISTORYPANEL2",loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,viewConfig:{forceFit:true},view:new Ext.grid.GroupingView({forceFit:true,showGroupName:true,enableNoGroups:false,enableGroupingMenu:false,hideGroupedColumn:true})});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",autoScroll:true,items:[this.grid],tbar:new Ext.Toolbar({style:"height:22px;line-height:22px;",items:[new Ext.BoxComponent({id:this.ID_chattingWith,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:lang("clickToViewRecord")}}),"->",{xtype:"button",text:lang("delSelected"),hidden:true,handler:function(b){var c=a.grid.getSelectionModel().getSelections();if(c.length==0){CNOA.miniMsg.alertShowAt(b,lang("mustSelectOneRow"))}else{CNOA.msg.cf(lang("confirmToDelete"),function(e){if(e=="yes"){if(c){var f="";for(var d=0;d<c.length;d++){f+=c[d].get("id")+",";var g=c[d];a.store.remove(g)}Ext.Ajax.request({url:a.baseUrl+"&task=deleteRecord",method:"POST",params:{ids:f},success:function(j){var i=Ext.decode(j.responseText);if(i.success===true){}else{CNOA.msg.alert(i.msg,function(){})}}})}}})}}},{xtype:"button",text:lang("export2"),hidden:true,hidden:true,id:this.ID_exportBtn,iconCls:"icon-file-down",handler:function(){a.exportHistory()}}]}),bbar:this.pagingBar});this.treeRoot=new Ext.tree.AsyncTreeNode({id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getAllUserListsInDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){this.treeRoot.firstChild.collapse(true);try{if(Ext.getCmp(this.ID_btn_collapseExpand).pressed){this.treeRoot.expand(true)}else{this.treeRoot.firstChild.expand()}}catch(c){}try{if(Ext.getCmp(this.ID_btn_collapseExpand2).pressed){this.treeRoot2.expand(true)}else{this.treeRoot2.firstChild.expand()}}catch(c){}this.deptTree.getEl().unmask()}.createDelegate(this)}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(){setTimeout(function(){a.openHistory()},100)}.createDelegate(this)}});this.deptPanel=new Ext.Panel({region:"west",layout:"fit",width:180,minWidth:80,maxWidth:380,items:[this.deptTree],tbar:new Ext.Toolbar({items:[{handler:function(b,c){this.reloadDeptData()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(b,c){if(c){b.setText(lang("collapse"));b.setTooltip(lang("collapseMenuTip"));a.treeRoot.expand(true)}else{b.setText(lang("expand"));b.setTooltip(lang("expandMenuTip"));a.treeRoot.collapse(true);a.treeRoot.firstChild.expand()}}}]})});this.treeRoot2=new Ext.tree.AsyncTreeNode({id:this.ID_tree_treeRoot2,expanded:true});this.deptTree2=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot2,autoScroll:true,bodyStyle:"border-left-width:1px;",listeners:{click:function(){setTimeout(function(){a.openHistory()},100)}.createDelegate(this)}});this.deptPanel2=new Ext.Panel({region:"center",layout:"fit",width:180,minWidth:80,maxWidth:200,items:[this.deptTree2],tbar:new Ext.Toolbar({items:[{handler:function(b,c){this.reloadDeptData()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand2,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(b,c){if(c){b.setText(lang("collapse"));b.setTooltip(lang("collapseMenuTip"));a.treeRoot2.expand(true)}else{b.setText(lang("expand"));b.setTooltip(lang("expandMenuTip"));a.treeRoot2.collapse(true);a.treeRoot2.firstChild.expand()}}}]})});this.ddtoCenterPanel=new Ext.Panel({region:"center",layout:"border",hideBorders:true,items:[this.deptPanel2]});this.ddmainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.deptPanel,this.ddtoCenterPanel]});this.groupFields=[{name:"gid"},{name:"status"},{name:"name"}];this.groupStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getGroupList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.groupFields})});this.groupStore.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.groupColModel=new Ext.grid.ColumnModel([{header:"gid",dataIndex:"gid",hidden:true},{header:lang("group"),dataIndex:"name",width:210,sortable:true,menuDisabled:true,renderer:this.makeOper.createDelegate(this)}]);this.ddGroupGridPanel=new Ext.grid.GridPanel({border:false,hideBorders:false,autoScroll:true,region:"center",layout:"fit",store:this.groupStore,cm:this.groupColModel,stripeRows:true,viewConfig:{forceFit:true},tbar:["->",{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(b,c){a.groupStore.reload()}}],listeners:{rowclick:function(c,f,d){var b=a.ddGroupGridPanel.getStore().getAt(f);a.gid=b.data.gid;a.store.load({params:{type:"group",gid:b.data.gid}});Ext.getCmp(a.ID_chattingWith).getEl().update(lang("groupsRecord",b.data.name))}}});this.ddGroupMainPanel=new Ext.Panel({width:280,collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.ddGroupGridPanel]});this.ddPanel=new Ext.Panel({width:380,minWidth:400,maxWidth:450,region:"west",layout:"card",activeItem:0,hideBorders:true,items:[this.ddmainPanel,this.ddGroupMainPanel],tbar:[{enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"CHAT_RECORD_VIEW",iconCls:"icon-importLinkman",cls:"btn-blue4",text:lang("linkMan"),handler:function(){a.type="person";a.ddPanel.getLayout().setActiveItem(0);a.store.removeAll();a.store.load({params:{type:"person",fuid:0,tuid:0}});var b=lang("clickToViewRecord");Ext.getCmp(a.ID_chattingWith).getEl().update(b);a.ddGroupGridPanel.getSelectionModel().clearSelections()}},{enableToggle:true,allowDepress:false,toggleGroup:"CHAT_RECORD_VIEW",iconCls:"icon-group",cls:"btn-blue3",text:lang("group"),handler:function(){a.type="group";a.ddPanel.getLayout().setActiveItem(1);a.store.removeAll();a.store.load({params:{type:"group",gid:0}});var b=lang("clickGroupToViewRecord");Ext.getCmp(a.ID_chattingWith).getEl().update(b)}}]});this.toCenterPanel=new Ext.Panel({region:"center",layout:"border",hideBorders:true,bodyStyle:"border-left-width:1px;",items:[this.centerPanel]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:true,items:[this.ddPanel,this.toCenterPanel]})},exportHistory:function(){var a=this;Ext.Ajax.request({url:a.baseUrl+"&task=exportHistory",method:"POST",params:{uid:a.newSelectUid,step:1},success:function(b){ajaxDownload(a.baseUrl+"&task=exportHistory&uid="+a.newSelectUid+"&file="+b.responseText)}})},renderContent:function(c,b,a){b.attr='style="white-space:normal;"';return c},reloadDeptData:function(){this.treeRoot2.reload();this.treeRoot.reload()},openHistory:function(){var f=this;var b=this.deptTree.getSelectionModel().getSelectedNode();var a=this.deptTree2.getSelectionModel().getSelectedNode();if(!b||!a){return}if((b==undefined)||b.disabled||(b.attributes.uid==undefined)){return}if((a==undefined)||a.disabled||(a.attributes.uid==undefined)){return}var c=b.attributes.uid;var d=a.attributes.uid;if(c==d){return}this.fuid=c;this.tuid=d;var e=lang("recordOfTwo",b.text,a.text);Ext.getCmp(this.ID_chattingWith).getEl().update(e);this.store.load({params:{type:"person",fuid:c,tuid:d}})},makeOper:function(e,c,b){var f=this;var d=b.data;var a="";if(d.status=="0"){a+=e+'<span style="color: red">('+lang("dismissed")+")</span>"}else{a+=e}return a}};var CNOA_monitor_mgr_diaryClass,CNOA_monitor_mgr_diary;CNOA_monitor_mgr_diaryClass=CNOA.Class.create();CNOA_monitor_mgr_diaryClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=monitor&func=mgr&action=diary";this.remindGet="";if(CNOA.monitor.mgr.diary.uid!=""&&CNOA.monitor.mgr.diary.cid!=""&&CNOA.monitor.mgr.diary.lid!=""){this.remindGet="&uid="+CNOA.monitor.mgr.diary.uid+"&cid="+CNOA.monitor.mgr.diary.cid+"&lid="+CNOA.monitor.mgr.diary.lid;this.leftName=CNOA.monitor.mgr.diary.truname}this.tpl=new Ext.XTemplate('<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">'+lang("todayPlan")+":</div>",'  <div class="user_diary_body_right" style="margin-bottom:20px;">',"    <ul>",'     <tpl if="listCount &gt; 0">','     <tpl for="list">',"      <li>",'        <div class="user_diary_body_right_left"><span style="font-weight:bold;line-height:14px;">{[xindex]}.</span>&nbsp;&nbsp;&nbsp;<img {[this.makeIcon(values.done)]} style="margin-top:5px !important;margin-top:4px;" /></div>','        <div class="user_diary_body_right_mid">{[this.makeAlarm(values)]}&nbsp;&nbsp;{content}</div>','        <div class="user_diary_body_right_right">{plantime}</div>',"      </tpl>","      </tpl>","      </li>","    </ul>","  </div>",'  <div class="clear"></div>',"</div>",'<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("workSummary")+":</div>",'  <div class="user_diary_body_right">{summary}&nbsp;</div>','  <div class="clear"></div></div>','<div class="user_diary_body" style="background-color:#F5F5F5">','<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("workSummaryComplement")+":</div>",'  <div class="user_diary_body_right">{summarycomplement}&nbsp;</div>','  <div class="clear"></div></div>','<div class="user_diary_body" style="background-color:#F5F5F5">','  <div class="user_diary_body_left">'+lang("attach")+":</div>",'  <div class="user_diary_body_right">',"		{attach}","  </div>",'  <div class="clear"></div>','  <img src="'+Ext.BLANK_IMAGE_URL+'" />',"</div>",'<tpl if="editable != true">','<div class="user_diary_body">','  <div class="user_diary_body_left">'+lang("diaryComplement")+":</div>",'  <div class="user_diary_body_right">',"    {additional}","  &nbsp;</div>",'  <div class="clear"></div>',"</div>","</tpl>",{makeIcon:function(b){if(b==1){return'src="./resources/images/cnoa/btn-job-done.gif" ext:qtip="'+lang("finished")+'"'}else{return'src="./resources/images/cnoa/btn-job-doing.gif" ext:qtip="'+lang("unfinished")+'"'}},makeAlarm:function(b){if(b.alarm==1){return'<img src="./resources/images/icons/alarm.png" ext:qtip="'+lang("noticeTime")+":"+b.alarmtime+'" />'}else{return""}}});this.tplComment=new Ext.XTemplate('<div class="user_task_discuss_view" style="margin-left:5px;width:760px;margin-bottom:5px;">','  <div class="user_task_discuss_view_header" style="width:760px;height:24px;">','    <div class="user_task_discuss_view_header_title">'+lang("diaryOfLeader")+"</div>","  </div>",'  <tpl for="list">','  <div class="user_task_discuss_view_body" style="width:760px;">','    <div class="user_task_discuss_view_body_left">','      <div class="user_task_discuss_view_body_left_top">{user}[{dept}]</div>','      <div class="user_task_discuss_view_body_left_body">','        <span><img width=120; height="130" src="{face}" onerror="this.src=\'./resources/images/default.jpg\'" /></span>',"      </div>","    </div>",'    <div class="user_task_discuss_view_body_right" style="width:609px; min-height: 170px;">','      <div class="user_task_discuss_view_body_right_top">#{[xindex]}&nbsp;&nbsp;<a>{user}</a>&nbsp;&nbsp;'+lang("postAt")+'&nbsp;{posttime}<tpl if="uid == '+CNOA_USER_UID+'"><a style="float:right;" href="javascript:void(0);" onclick="CNOA_monitor_mgr_diary.deleteComment({id});">'+lang("del")+"&nbsp;&nbsp;</a></tpl></div>",'      <div class="user_task_discuss_view_body_right_body">{content}</div>',"    </div>",'    <div class="clear"></div>',"  </div>","  </tpl>","</div>");this.ID_btn_collapseExpand=Ext.id();this.ID_openWidth=Ext.id();this.ID_currentUid=Ext.id();this.ID_year_text=Ext.id();this.ID_currentDate=Ext.id();this.newSelectUid=0;this.treeRoot=new Ext.tree.AsyncTreeNode({expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getAllUserListsInDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(b){this.treeRoot.firstChild.collapse(true);if(Ext.getCmp(this.ID_btn_collapseExpand).pressed){this.treeRoot.expand(true)}else{this.treeRoot.firstChild.expand()}a.westPanel.getEl().unmask()}.createDelegate(this),beforeload:function(c,b,d){a.westPanel.getEl().mask(lang("waiting"))}}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(b){a.openGridList(b)}}});this.westPanel=new Ext.Panel({region:"west",layout:"fit",split:true,border:false,width:176,minWidth:120,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.deptTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(b,c){a.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(b,c){if(c){b.setText(lang("collapse"));b.setTooltip(lang("collapseMenuTip"));a.treeRoot.expand(true)}else{b.setText(lang("expand"));b.setTooltip(lang("expandMenuTip"));a.treeRoot.collapse(true);a.treeRoot.firstChild.expand()}}}]})});this.storeBar={uid:0,year:"",query:"",storeType:"nowyear"};this.fields=[{name:"rnid"},{name:"id"},{name:"did"},{name:"date"},{name:"user"},{name:"updatetime"},{name:"dateMonth",type:"int"},{name:"content"},{name:"stime"},{name:"etime"},{name:"signtime"},{name:"number"},{name:"displaybtn"},{name:"signStatus"},{name:"signContent"},{name:"additional"}];this.store=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonList"+this.remindGet}),groupField:"dateMonth",sortInfo:{field:"dateMonth",direction:"DESC"},remoteSort:true,reader:new Ext.data.JsonReader({idProperty:"rnid",totalProperty:"total",root:"data",fields:this.fields}),listeners:{load:function(c,b){if(c.reader.jsonData.exportExcel==true){ajaxDownload(c.reader.jsonData.exportExcelUrl)}}}});this.colModel=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},{header:"did",dataIndex:"did",hidden:true},new Ext.grid.RowNumberer(),{header:lang("month2"),dataIndex:"dateMonth",width:100,sortable:true,renderer:this.additional},{header:lang("datePeople"),dataIndex:"date",width:175,sortable:true,renderer:this.renderDate},{header:lang("content"),dataIndex:"content",width:349,sortable:true},{header:lang("jhwcsj"),dataIndex:"stime",width:100,sortable:true},{header:lang("sjwcsj"),dataIndex:"etime",width:100,sortable:true},{header:lang("receivedTime"),dataIndex:"signtime",width:100,sortable:true},{header:lang("receiveYJ"),dataIndex:"signContent",width:80,sortable:true},{header:lang("opt"),dataIndex:"",width:60,sortable:true,renderer:this.signOperate.createDelegate(this)}]);this.grid=new Ext.grid.GridPanel({stripeRows:true,ds:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,autoScroll:true,viewConfig:{forceFit:true},listeners:{rowclick:function(c,d){var b=c.getStore().getAt(d)}},view:new Ext.grid.GroupingView({hideGroupedColumn:true,forceFit:true,groupTextTpl:'{text}--<span style="color:#9D9DFF">('+lang("gongTiao","{[values.rs.length]}")+")</span>"}),tbar:[{xtype:"hidden",id:this.ID_year_text,value:new Date().getFullYear()},{text:"<< "+lang("prevYear"),enableToggle:true,allowDepress:false,toggleGroup:"diary_date",handler:function(){var b=Ext.getCmp(a.ID_currentUid).getValue();var c=parseInt(Ext.getCmp(a.ID_year_text).getValue())-1;a.storeBar.storeType="upyear";a.storeBar.year=c;a.storeBar.uid=b;a.store.load({params:a.storeBar});Ext.getCmp(a.ID_currentDate).getEl().update("<span style='color:red'>"+lang("currentYearIs",c)+"</span>");Ext.getCmp(a.ID_year_text).setValue(c)}},new Ext.BoxComponent({id:this.ID_currentDate,autoEl:{tag:"div",style:"color: red",html:lang("currentYearIs",new Date().getFullYear())}}),{text:lang("thisYear"),enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"diary_date",handler:function(){var b=Ext.getCmp(a.ID_currentUid).getValue();var c=parseInt(new Date().getFullYear());a.storeBar.storeType="nowyear";a.storeBar.year=c;a.storeBar.uid=b;a.store.load({params:a.storeBar});Ext.getCmp(a.ID_currentDate).getEl().update(lang("currentYearIs",c));Ext.getCmp(a.ID_year_text).setValue(c)}},{enableToggle:true,allowDepress:false,toggleGroup:"diary_date",text:lang("nextYear")+" >>",handler:function(){var b=Ext.getCmp(a.ID_currentUid).getValue();var c=parseInt(Ext.getCmp(a.ID_year_text).getValue())+1;a.storeBar.storeType="downyear";a.storeBar.year=c;a.storeBar.uid=b;a.store.load({params:a.storeBar});Ext.getCmp(a.ID_currentDate).getEl().update(lang("currentYearIs",c));Ext.getCmp(a.ID_year_text).setValue(c)}},lang("content")+":",new Ext.ux.form.SearchField({store:a.store,allowBlank:false,id:"QUERY",width:110,onTrigger1Click:function(b){if(this.hasSearch){this.el.dom.value="";this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";a.storeBar.year=parseInt(Ext.getCmp(a.ID_year_text).getValue());a.storeBar.uid=Ext.getCmp(a.ID_currentUid).getValue();this.store.reload({params:a.storeBar});this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(c){var b=this.getRawValue();if(b.length<1){alert(lang("searchNotEmpty"));return}a.storeBar.year=parseInt(Ext.getCmp(a.ID_year_text).getValue());a.storeBar.uid=Ext.getCmp(a.ID_currentUid).getValue();a.storeBar.query=Ext.getCmp("QUERY").getValue();this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]=b;this.store.reload({params:a.storeBar});this.hasSearch=true;this.triggers[0].show()}})]});this.centerPanel=new Ext.Panel({region:"center",layout:"fit",bodyStyle:"border-left-width:1px;overflow:auto;",items:[this.grid],tbar:new Ext.Toolbar({style:"border-left-width:1px;",items:[new Ext.BoxComponent({id:this.ID_openWidth,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:lang("clickToViewDiary")}}),{xtype:"hidden",id:this.ID_currentUid},{text:lang("expandAll"),cls:"btn-red1",iconCls:"icon-expandAll",enableToggle:false,pressed:true,toggleGroup:"btn_group",handler:function(){a.grid.view.expandAllGroups()}},{text:lang("collapseAll"),iconCls:"icon-collapseAll",cls:"btn-blue4",enableToggle:false,toggleGroup:"btn_group",handler:function(){a.grid.view.collapseAllGroups()}},{text:lang("exportAllToExcel"),cls:"btn-blue2",iconCls:"icon-excel",handler:function(){var b=a.store.lastOptions;Ext.apply(b.params,{exportExcel:1});a.store.reload(b);Ext.apply(b.params,{exportExcel:0})}},{cls:"btn-gray1",text:"删除日记",iconCls:"icon-utils-s-delete",handler:function(c,b){a.deleteDiary()}},"->",{xtype:"cnoa_helpBtn",helpid:54}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.westPanel,this.centerPanel]})},deleteDiary:function(){var f=this,d,a;var b=Ext.id();var e=f.baseUrl+"&task=deleteDiary";var c=function(g){var i=a.getForm();if(i.isValid()){CNOA.msg.cf(lang("sureDelDiary"),function(j){if(j=="yes"){i.submit({url:e,method:"POST",params:{uid:f.newSelectUid},success:function(k,l){f.store.reload();CNOA.msg.alert(l.result.msg);d.close()},failure:function(k,l){CNOA.msg.alert(l.result.msg);d.close()}})}else{d.close()}})}else{CNOA.miniMsg.alertShowAt(b,lang("formValid"))}};a=new Ext.form.FormPanel({hideBorders:true,border:false,labelWidth:60,labelAlign:"right",bodyStyle:"padding: 10px",defaults:{width:170,format:"Y-m-d",allowBlank:false},items:[{xtype:"datefield",name:"stime",allowBlank:false,fieldLabel:lang("startTime")},{xtype:"datefield",name:"etime",allowBlank:false,fieldLabel:lang("endTime")}]});d=new Ext.Window({width:270,height:140,title:lang("delDiary"),layout:"fit",autoDestroy:true,closeAction:"close",resizable:false,items:[a],modal:true,buttons:[{text:lang("confirmDel"),id:b,handler:function(){c()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]});d.show()},renderDate:function(c,b,a){return"<span style='font-weight:bold;'>"+c+"</span><br /><span style='color:#333'>"+a.data.user+"</span>"},openGridList:function(a){var c=this;if((a==undefined)||a.disabled||(a.attributes.uid==undefined)){return}c.newSelectUid=a.attributes.uid;var b=lang("whosDiary",a.text);Ext.getCmp(this.ID_openWidth).getEl().update(b);Ext.getCmp(this.ID_currentUid).setValue(c.newSelectUid);this.store.load({params:{uid:a.attributes.uid}})},deleteComment:function(b){var a=this;CNOA.msg.cf(lang("confirmToDelete"),function(c){if(c=="yes"){a.commentWindow.getEl().mask(lang("waiting"));Ext.Ajax.request({url:a.baseUrl+"&task=deleteComment",method:"POST",params:{cid:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.loadComment()}else{CNOA.msg.alert(d.msg,function(){})}a.commentWindow.getEl().unmask()}})}})},openDiaryDetailWindow:function(m){var g=this;var d=Ext.id();var a;var l=function(){Ext.Ajax.request({url:g.baseUrl+"&task=loadDiary",method:"POST",params:{did:m},success:function(o){var n=Ext.decode(o.responseText);if(n.success===true){a=n.data;Ext.fly("user_diary_manage_todaytitle").update("<font color=red>"+a.user+"</font>的工作日记&nbsp;&nbsp;"+a.today)}else{CNOA.msg.alert(n.msg,function(){})}g.tpl.overwrite(c.body,a);g.commentWindow.getEl().unmask()}})};this.loadComment=function(){Ext.Ajax.request({url:g.baseUrl+"&task=loadComment",method:"POST",params:{did:m},success:function(o){var n=Ext.decode(o.responseText);if(n.success===true){if(n.data.list.length<1){f.body.update("")}else{g.tplComment.overwrite(f.body,n.data)}}else{CNOA.msg.alert(n.msg,function(){})}g.tpl.overwrite(c.body,a)}})};var i=function(){var n=Ext.getCmp(d);if(n.getValue().length<1){CNOA.msg.alert(lang("opinionNotEmpty"));return false}g.commentWindow.getEl().mask(lang("waiting"));Ext.Ajax.request({url:g.baseUrl+"&task=addComment",method:"POST",params:{did:m,comment:n.getValue()},success:function(p){var o=Ext.decode(p.responseText);if(o.success===true){n.setValue("");g.loadComment()}else{CNOA.msg.alert(o.msg,function(){})}g.commentWindow.getEl().unmask()}})};var b='<div class="user_diary_header">';b+='  <span style="line-height:23px;" id="user_diary_manage_todaytitle"></span>';b+='  <div class="clear"></div>';b+='  <img src="'+Ext.BLANK_IMAGE_URL+'" width="760" height="1" />';b+="</div>";var j=new Ext.Panel({border:false,region:"north",html:b});var c=new Ext.Panel({border:false,listeners:{render:function(){l()}}});var f=new Ext.Panel({border:false,listeners:{render:function(){g.loadComment()}}});var e=new Ext.Panel({border:false,bodyStyle:"margin-left:5px;",items:[{xtype:"htmleditor",id:d,width:762,heigth:130},{xtype:"button",style:"margin:5px 0 10px 694px;",text:lang("pyOpinion"),handler:function(){i()}}]});var k=new Ext.Panel({border:false,region:"center",autoScroll:true,items:[c,f,e]});this.commentWindow=new Ext.Window({width:800,height:makeWindowHeight(500),title:lang("viewDiary"),resizable:true,maximizable:true,modal:true,layout:"border",items:[j,k]}).show()},signOperate:function(e,c,b){var f=this,d=b.data,a="";if(d.displaybtn==1){a="<a href='javascript:void(0)'  class='gridview3' onclick='CNOA_monitor_mgr_diary.signfor("+d.id+");'>"+lang("receive2")+"</a>"}else{if(d.signStatus==1){a="<span style='color:gray'>"+lang("received")+"</span>"}else{a=""}}a+="<br><a href='javascript:void(0)' class='gridview' onclick='CNOA_monitor_mgr_diary.openDiaryDetailWindow("+d.did+");'>"+lang("py")+"</a>";return a},additional:function(e,c,b){var f=this,a;var d=b.data;if(Ext.isEmpty(d.additional)){a=e}else{a=e+"<span style='color: red'>("+lang("py")+":"+d.additional+")"}return a},signfor:function(d){var c=this;var a=new Ext.form.FormPanel({border:false,hideBorders:false,layout:"fit",region:"center",items:[{xtype:"textarea",name:"signContent",emptyText:lang("fillQSJY")}]});var b=new Ext.Window({title:lang("receiveYJ"),width:300,height:150,border:false,layout:"border",items:[a],buttons:[{text:lang("save"),handler:function(e,f){var g=a.getForm().findField("signContent").getValue();Ext.Ajax.request({url:c.baseUrl+"&task=signfor",method:"POST",params:{id:d,signContent:g},success:function(j){var i=Ext.decode(j.responseText);if(i.success===true){b.close();c.store.reload()}}})}},{text:lang("close"),handler:function(e,f){b.close()}}]}).show()}};var CNOA_monitor_mgr_taskClass,CNOA_monitor_mgr_task;CNOA_monitor_mgr_taskClass=CNOA.Class.create();CNOA_monitor_mgr_taskClass.prototype={init:function(){var f=this;this.baseUrl="index.php?app=monitor&func=mgr&action=task";var j={title:"",uid:"",execman:"",examapp:"",status:"",sDate:"",eDate:""};var l=new Ext.ux.tree.TreeGridLoader({dataUrl:this.baseUrl+"&task=getTaskTreeList"});var k=new Ext.data.Store({autoLoad:true,baseParams:j,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTaskTreeList&form=getTotal"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:[{name:"id"}]})});var d=new Ext.PagingToolbar({style:"border-left-width:1px;",displayInfo:true,pageSize:15,store:k,listeners:{beforechange:function(p,q){l.baseParams=q;l.baseParams.title=j.title;l.baseParams.uid=j.uid;l.baseParams.execman=j.execman;l.baseParams.examapp=j.examapp;l.baseParams.status=j.status;l.baseParams.sDate=j.sDate;l.baseParams.eDate=j.eDate;m.root.reload()}}});var c=new Ext.form.TextField({width:120}),g=new Ext.form.SelectorForm({hiddenName:"bzr",multiselect:false,selectorType:"user",width:75}),e=new Ext.form.SelectorForm({hiddenName:"principal",multiselect:false,selectorType:"user",width:75}),a=new Ext.form.SelectorForm({hiddenName:"approvalor",multiselect:false,selectorType:"user",width:75}),i=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",width:90,store:new Ext.data.ArrayStore({id:0,fields:["status","displayText"],data:[[1,lang("waitingForAccept")],[2,lang("pendingApproval")],[3,lang("approvalNotThrough")],[4,lang("rejectReceive")],[5,lang("inProgress")],[6,lang("submitApproval")],[7,lang("approved")],[8,lang("taskRecall")],[9,lang("taskFailed")]]}),valueField:"status",displayField:"displayText"}),n=new Ext.form.DateField({format:"Y-m-d",width:95}),b=new Ext.form.DateField({format:"Y-m-d",width:95});var m=new Ext.ux.tree.TreeGrid({loader:l,columns:[{header:lang("taskTitle"),dataIndex:"title",width:220},{header:lang("status"),dataIndex:"status",width:120,tpl:new Ext.XTemplate("{duration:this.formatHours}",{formatHours:function(t,o){var q=o.status;var u="&nbsp;";var s=0;var p="#5B5B5B";u=o.statusText;s=o.progress;p=o.statusColor;var r="<div style='color:#808080;margin-top:3px;'>"+u+"</div>";r+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+s+"px;background-color:"+p+";'></div></div>";return r}})},{header:lang("jdjx"),dataIndex:"jixiao",width:120},{header:lang("principal"),dataIndex:"execman",width:80},{header:lang("bzr"),dataIndex:"postter",width:80},{header:lang("approvalor"),dataIndex:"approvalor",width:80},{header:lang("startTime"),dataIndex:"stime",width:80},{header:lang("endTime"),dataIndex:"etime",width:80},{header:lang("opt"),dataIndex:"",width:80,tpl:new Ext.XTemplate("{duration:this.formatHours}",{formatHours:function(p,o){h="<a href='javascript:void(0);' class='gridview' onclick='CNOA_monitor_mgr_task.viewTask("+o.tid+");'>"+lang("view")+"</a>";return h}})}],tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(o,p){m.root.reload()}},{text:lang("export2"),cls:"btn-blue3",tooltip:lang("exportAllToExcel"),iconCls:"icon-excel",handler:function(o,p){f.openExportExcelWindow()}},lang("taskName")+":",c,lang("bzr")+":",g,lang("principal")+":",e,lang("approvalor")+":",a,lang("status")+":",i,lang("startTime")+":",n,lang("to"),b,{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){var p=n.getValue(),o=b.getValue();if(o<p){CNOA.msg.alert(lang("StimeGreaterThanEtime"));return}j.title=c.getValue();j.uid=g.getValue();j.execman=e.getValue();j.examapp=a.getValue();j.status=i.getValue();j.sDate=p;j.eDate=o;l.baseParams.start=0;l.baseParams.title=j.title;l.baseParams.uid=j.uid;l.baseParams.execman=j.execman;l.baseParams.examapp=j.examapp;l.baseParams.status=j.status;l.baseParams.sDate=j.sDate;l.baseParams.eDate=j.eDate;k.reload();m.root.reload()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){j.title="";j.uid="";j.execman="";j.examapp="";j.status="";j.sDate="";j.eDate="";c.setValue();g.setValue();e.setValue();a.setValue();i.setValue();n.setValue();b.setValue();g.clearValue();e.clearValue();a.clearValue();l.baseParams.start=0;l.baseParams.title="";l.baseParams.uid="";l.baseParams.execman="";l.baseParams.examapp="";l.baseParams.status="";l.baseParams.sDate="";l.baseParams.eDate="";k.reload();m.root.reload()}}]}),bbar:d});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,region:"center",layout:"fit",autoScroll:false,items:[m]})},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_WATCH_VIEW");mainPanel.loadClass("index.php?app=monitor&func=mgr&action=task&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_WATCH_VIEW",lang("viewTask"),"icon-page-view")},openExportExcelWindow:function(){var b=this;var c=function(){if(a.getForm().isValid()){a.getForm().submit({url:b.baseUrl+"&task=exportExcel",waitMsg:lang("waiting"),params:{},method:"POST",success:function(e,f){d.close();b.openDownloadExcelWindow(f.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg)}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:110,items:[{xtype:"selectorform",fieldLabel:lang("principal"),width:100,multiselect:false,hiddenName:"execman"},{xtype:"selectorform",fieldLabel:lang("bzr"),width:100,multiselect:false,hiddenName:"postuid"},{xtype:"datefield",fieldLabel:lang("taskStartTime"),width:150,format:"Y-m-d",allowBlank:false,name:"stime"},{xtype:"datefield",fieldLabel:lang("taskAddEndTime"),width:150,format:"Y-m-d",allowBlank:false,name:"etime"}]});var d=new Ext.Window({width:320,height:190,title:lang("exportTask"),resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),iconCls:"icon-excel",handler:function(){c()}},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){d.close()}}]}).show()},openDownloadExcelWindow:function(a){var b=new Ext.Window({width:320,height:150,title:lang("downExcel"),resizable:false,modal:true,layout:"fit",bodyStyle:"padding:10px;background-color: #FFF;",html:lang("clickToDownload")+":<br/>"+a,buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}}]}).show()}};var CNOA_monitor_mgr_tasktotalClass,CNOA_monitor_mgr_tasktotal;CNOA_monitor_mgr_tasktotalClass=CNOA.Class.create();CNOA_monitor_mgr_tasktotalClass.prototype={init:function(){var g=this;this.edit_id=0;this.content_start=1;this.baseUrl="index.php?app=monitor&func=mgr&action=tasktotal";this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_plan_content=Ext.id();var b=Ext.id();var f=Ext.id();this.storeBar={execman:0,stime:"",etime:""};this.fields=[{name:"tid"},{name:"name"},{name:"dept"},{name:"jixiaofast"},{name:"jixiaoslow"},{name:"jixiaoaver"},{name:"jixiaoall"},{name:"done"},{name:"doing"},{name:"all"},{name:"overdone"},{name:"overdoing"},{name:"cancel"},{name:"wait"},{name:"refuse"},{name:"execman"}];this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:g.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields}),listeners:{exception:function(n,m,o,l,k,j){var i=Ext.decode(k.responseText);if(i.failure){CNOA.msg.alert(i.msg)}}}});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"uid",dataIndex:"uid",hidden:true},{header:lang("monitorTask"),dataIndex:"name",width:80,sortable:true,menuDisabled:true},{header:lang("inDepartment"),dataIndex:"dept",width:160,sortable:true,menuDisabled:true},{header:lang("allTask"),dataIndex:"all",width:70,sortable:false,menuDisabled:true},{header:lang("taskwcs"),dataIndex:"done",width:80,sortable:false,menuDisabled:true},{header:lang("taskWaitingCount"),dataIndex:"wait",width:80,sortable:false,menuDisabled:true},{header:lang("taskIng"),dataIndex:"doing",width:100,sortable:false,menuDisabled:true},{header:lang("jxzcqs"),dataIndex:"overdoing",width:100,sortable:false,menuDisabled:true},{header:lang("wcycqs"),dataIndex:"overdone",width:100,sortable:false,menuDisabled:true},{header:lang("recellCount"),dataIndex:"cancel",width:80,sortable:false,menuDisabled:true},{header:lang("rejectCount"),dataIndex:"refuse",width:80,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(i,j){Ext.apply(j,g.storeBar)}}});var d=Ext.id();var e=Ext.id();var a=Ext.id();var c=Ext.id();this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,sm:this.sm,autoWidth:true,border:false,listeners:{cellclick:function(k,n,l,m){var j=k.getStore().getAt(n);try{var i="";if(l==5){i="all"}else{if(l==6){i="done"}else{if(l==7){i="wait"}else{if(l==8){i="doing"}else{if(l==9){i="overdoing"}else{if(l==10){i="overdone"}else{if(l==11){i="cancel"}else{if(l==12){i="refuse"}}}}}}}}if(l==0||l==1||l==2||l==3||l==4){}else{this.showTaskList(j.data.execman,i)}}catch(m){}}.createDelegate(this)},tbar:new Ext.Toolbar({items:[{handler:function(i,j){g.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{handler:function(i,j){g.openExportExcelWindow()}.createDelegate(this),iconCls:"icon-excel",cls:"btn-blue3",tooltip:lang("exportAllToExcel"),text:lang("export2")},"->",{xtype:"cnoa_helpBtn",helpid:64}]}),bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"fit",autoScroll:false,items:[this.grid],tbar:new Ext.Toolbar({items:["&nbsp;"+lang("principal")+":",{xtype:"hidden",id:d},{xtype:"triggerForPeople",dataUrl:this.baseUrl+"&task=getAllUserListsInPermitDeptTree",width:100,id:d+"Tr",listeners:{selected:function(k,j,i){Ext.getCmp(d).setValue(j)}}},"&nbsp;"+lang("startTime"),{xtype:"datefield",width:120,format:"Y-m-d",id:b},"&nbsp;"+lang("endTime"),{xtype:"datefield",width:120,format:"Y-m-d",id:f},{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){g.storeBar.execman=Ext.getCmp(d).getValue();g.storeBar.stime=Ext.getCmp(b).getRawValue();g.storeBar.etime=Ext.getCmp(f).getRawValue();g.store.load({params:g.storeBar})}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){Ext.getCmp(d).setValue("");Ext.getCmp(d+"Tr").setValue("");Ext.getCmp(b).setValue("");Ext.getCmp(f).setValue("");g.storeBar.stime="";g.storeBar.etime="";g.storeBar.execman="";g.store.load({params:g.storeBar})}}]})})},showTaskList:function(b,a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW_DETAIL");mainPanel.loadClass("index.php?app=monitor&func=mgr&action=tasktotal&task=loadPage&from=viewTotalDetial&execman="+b+"&status="+a,"CNOA_MENU_USER_TASK_VIEW_DETAIL",lang("viewTask"),"icon-page-view")},openExportExcelWindow:function(){var d=this;var b=function(){if(a.getForm().isValid()){a.getForm().submit({url:d.baseUrl+"&task=exportExcel",waitMsg:lang("waiting"),params:{},method:"POST",success:function(e,f){c.close();d.openDownloadExcelWindow(f.result.msg)},failure:function(e,f){CNOA.msg.alert(f.result.msg,function(){})}})}};var a=new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px;",waitMsgTarget:true,labelWidth:110,items:[{xtype:"datefield",fieldLabel:lang("startTime"),width:170,format:"Y-m-d",editable:false,allowBlank:false,name:"stime"},{xtype:"datefield",fieldLabel:lang("endTime"),width:170,format:"Y-m-d",editable:false,allowBlank:false,name:"etime"},{xtype:"displayfield",hideLabel:true,value:lang("exportTaskNotice2")}]});var c=new Ext.Window({width:320,height:160,title:lang("exportTask"),resizable:false,modal:true,layout:"fit",items:a,buttons:[{text:lang("export2"),iconCls:"icon-excel",handler:function(){b()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){c.close()}.createDelegate(this)}]}).show()},openDownloadExcelWindow:function(a){var b=new Ext.Window({width:320,height:150,title:lang("downExcel"),resizable:false,modal:true,layout:"fit",bodyStyle:"padding:10px;background-color: #FFF;",html:lang("clickToDownload")+":<br/>"+a,buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){b.close()}.createDelegate(this)}]}).show()},makeStatus:function(k,g,d,i,f,b){var m=d.data;var l=m.status;var j="&nbsp;";var a=0;var c="#5B5B5B";j=m.statusText;a=m.progress;c=m.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+j+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},makeOperate:function(m,j,e,k,i,b){var o=e.data;var n=o.status;var a=false;var d=false;var g=false;var f=false;var l=false;a=o.eenable;d=o.denable;g=o.repealenable;f=o.urgeenable;l=o.failenable;var c="<a href='javascript:void(0);' onclick='CNOA_monitor_mgr_tasktotal.viewTask("+o.tid+");'>"+lang("view")+"</a>";return c},makeMiniWindow:function(i,j,a,c,d){var e=this;var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"textarea",anchor:"-20 -20",name:"content",fieldLabel:j}]});var f=new Ext.Window({width:400,height:270,title:i,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){g();f.close()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show();var g=function(){var k=b.getForm().findField("content").getValue();Ext.Ajax.request({url:e.baseUrl+"&task=operateTask&tid="+c,method:"POST",params:{tid:c,job:a,status:d,content:k},success:function(m){var l=Ext.decode(m.responseText);if(l.success===true){CNOA.msg.notice2(l.msg);e.store.reload()}else{CNOA.msg.alert(l.msg)}}})}},makeDelayWindow:function(j,a,c,d,e){var f=this;var b=new Ext.form.FormPanel({border:false,hideBorders:true,labelWidth:70,labelAlign:"right",waitMsgTarget:true,bodyStyle:"padding-top:20px;",items:[{xtype:"displayfield",fieldLabel:lang("oldEndTime"),value:e},{xtype:"datefield",name:"newtime",width:160,minValue:e,format:"Y-m-d",fieldLabel:lang("editTo")}]});var g=new Ext.Window({width:400,height:270,title:j,resizable:true,modal:true,layout:"fit",items:b,buttons:[{text:lang("ok"),iconCls:"icon-btn-save",handler:function(){i();g.close()}.createDelegate(this)},{text:lang("cancel"),iconCls:"icon-dialog-cancel",handler:function(){g.close()}.createDelegate(this)}]}).show();var i=function(){var k=b.getForm().findField("newtime").getRawValue();Ext.Ajax.request({url:f.baseUrl+"&task=operateTask&tid="+c,method:"POST",params:{tid:c,job:a,status:d,newtime:k},success:function(m){var l=Ext.decode(m.responseText);if(l.success===true){CNOA.msg.notice2(l.msg);f.store.reload()}else{CNOA.msg.alert(l.msg)}}})}},planTime:function(b,c,a){return"<span >"+b+"</span><br /><span >"+a.data.p_etime+"</span>"},trueTime:function(b,c,a){return"<span >"+b+"</span><br /><span >"+a.data.t_etime+"</span>"},jixiaofast:function(b,c,a){return"<span class='cnoa_color_green'><b>"+b+"</b></span>"},jixiaoslow:function(b,c,a){return"<span class='cnoa_color_red'><b>"+b+"</b></span>"},jixiaoall:function(b,c,a){return"<span class='cnoa_color_green'><b>"+b+"</b></span>"},jixiaoaver:function(b,c,a){return"<span class='cnoa_color_green'><b>"+b+"</b></span>"}};var CNOA_monitor_mgr_tasktotaldetailClass,CNOA_monitor_mgr_tasktotaldetail;CNOA_monitor_mgr_tasktotaldetailClass=CNOA.Class.create();CNOA_monitor_mgr_tasktotaldetailClass.prototype={init:function(){var a=this;this.ID_title_text=Ext.id();this.status=CNOA.monitor.mgr.tasktotaldetail.status;this.execman=CNOA.monitor.mgr.tasktotaldetail.execman;this.uname=CNOA.monitor.mgr.tasktotaldetail.uname;this.baseUrl="index.php?app=monitor&func=mgr&action=tasktotal";this.fields=[{name:"tid"},{name:"from"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getTaskDetailList&status="+this.status+"&execman="+this.execman,disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.store.load();this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskTitle"),dataIndex:"title",width:300,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:150,sortable:false,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:100,sortable:false,menuDisabled:true},{header:lang("bzr"),dataIndex:"postter",width:100,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:100,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:100,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBar=new Ext.PagingToolbar({displayInfo:true,store:this.store,pageSize:15,listeners:{beforechange:function(b,c){}}});this.grid=new Ext.grid.GridPanel({stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,region:"center",layout:"fit",scriptRows:true,tbar:[new Ext.BoxComponent({id:this.ID_title_text,autoEl:{tag:"div",style:"font-weight:bold;color:#535353;",html:lang("whosTaskList",this.uname)}}),"-",{handler:function(b,c){a.store.reload()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")}],bbar:this.pagingBar});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.grid]})},makeStatus:function(k,g,d,i,f,b){var m=d.data;var l=m.status;var j="&nbsp;";var a=0;var c="#5B5B5B";j=m.statusText;a=m.progress;c=m.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+j+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e}};CNOA_monitor_mgr_taskViewClass=CNOA.Class.create();CNOA_monitor_mgr_taskViewClass.prototype={init:function(){var a=this;this.tid=CNOA.monitor.mgr.taskView.tid;this.status=CNOA.monitor.mgr.taskView.status;this.from=CNOA.monitor.mgr.taskView.from;this.title="";this.etime="";this.baseUrl="index.php?app=monitor&func=mgr&action=task&tid="+this.tid+"&status="+this.status;this.ID_btn_edit=Ext.id();this.ID_btn_delete=Ext.id();this.ID_btn_repeal=Ext.id();this.ID_btn_complete=Ext.id();this.ID_btn_accept=Ext.id();this.ID_btn_reject=Ext.id();this.ID_btn_agree=Ext.id();this.ID_btn_disagree=Ext.id();this.ID_btn_finish=Ext.id();this.ID_btn_nofinish=Ext.id();this.ID_btn_viewedurge=Ext.id();this.ID_btn_fail=Ext.id();this.ID_btn_report_window_report=Ext.id();this.dataSource=null;this.tab_event_loadCount=0;this.tab_discuss_loadCount=0;this.tab_document_loadCount=0;this.tplTitle=new Ext.XTemplate('<div style="width:770px;margin-bottom:5px;height:40px;background-color:#FEFBDC;font-size:16px;font-weight:bold;line-height:40px; text-align: center;">['+lang("task")+"]{title}","</div>",'<div style="width:768px;height:auto;padding-bottom:3px;border:1px solid #F6C4AB;margin-top:5px;margin-bottom:5px;background-color:#FFF1CC;font-size:16px;display:{showTip}">','	<div style="font-size:12px;padding:5px;">',"	{tip}","	</div>",'	<div style="padding-left:5px;" id="CNOA_task_view_btn_job">',"	</div>",'	<div class="clear"></div>',"</div>");this.tplBody=new Ext.XTemplate('<div style="margin-bottom:5px;margin-top:1px;width:770px;">','	<div style="display:none;" id="CNOA_task_view_btn_operate_Ct"><div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("optArea")+"</span></div>",'	<div style="background-color:#EFF5FF;height:22px;padding:5px;" id="CNOA_task_view_btn_operate">',"	</div>",'	<div class="clear"></div></div>','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("baseInfo2")+"</span></div>",'	<div style="background-color:#EFF5FF;padding-bottom:5px;">','		<ul class="user_task_view_ul">','			<li><span class="first">'+lang("nowStatus")+': </span><span class="second" style="color:{statusColor};">{statusText}</span></li>','			<li><span class="first">'+lang("taskAddTime")+': </span><span class="second">{posttime}</span></li>',"			<li>&nbsp;</li>",'			<li><span class="first">'+lang("taskStartTime")+': </span><span class="second">{stime}</span></li>','			<li><span class="first">'+lang("taskAddEndTime")+': </span><span class="second">{etime}</span></li>','			<li><span class="first">'+lang("taskRatings")+': </span><span class="second">{point}</span></li>','			<li><span class="first">'+lang("sjStartTime")+': </span><span class="second">{sttime}</span></li>','			<li><span class="first">'+lang("sjwcsj")+': </span><span class="second">{entime}</span></li>','			<li><span class="first">'+lang("taskProgress")+': </span><span class="second" style="text-align:left;"><div style="width:100px;height:5px;background-color:#D4D4D4;float:left;margin-top:10px;"><div style="font-size:0;line-height:0;height:5px;width:{progress}px;background-color:{statusColor};"></div></div><span style="font-family:\'Arial\';font-size:9px;line-heigth:9px;height:9px;color:#7C7C7C;">&nbsp;{progress}%</span></span></li>','			<li><span class="first">'+lang("bzr")+': </span><span class="second"><a>{postter}</a></span></li>','			<li><span class="first">'+lang("principal")+': </span><span class="second"><a>{execman}</a></span></li>','			<li><span class="first">'+lang("approvalor")+': </span><span class="second"><a>{examapp}</a></span></li>','			<li style="width:700px;"><span class="first">'+lang("participant")+': </span><span class="second" style="width:600px;text-align:left;">{participant}</span></li>',"		</ul>",'		<div class="clear"></div>',"	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("taskContent")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{content}","	</div>",'	<tpl if="attachCount &gt; 0">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("attach")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"		{attach}","	</div>","	</tpl>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("jfbz")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{prizepunish}","	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("leaderInstruction")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"	{leadersay}","	</div>","</div>");this.infoPanel=new Ext.Panel({border:false,listeners:{render:function(){a.readInfo()}}});this.infoPanelBody=new Ext.Panel({border:false,listeners:{render:function(){}}});this.fieldsEvent=[{name:"id"},{name:"type"},{name:"typename"},{name:"title"},{name:"content"},{name:"user"},{name:"posttime"}];this.storeEvent=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEventList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsEvent})});this.colModelEvent=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:20,sortable:true,menuDisabled:true,hidden:true},{header:lang("type"),dataIndex:"type",width:40,menuDisabled:true,sortable:true,renderer:a.renderEventType.createDelegate(this)},{header:lang("eventTitle")+" / "+lang("content"),dataIndex:"content",width:574,menuDisabled:true,sortable:false,renderer:a.renderEventContent.createDelegate(this)},{header:lang("operator")+" / "+lang("time"),dataIndex:"other",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderEventOther.createDelegate(this)}]);this.gridEvent=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeEvent,loadMask:{msg:lang("waiting")},cm:this.colModelEvent,hideBorders:true,border:false,autoHeight:true,listeners:{cellclick:function(b,i,c,g){var d=b.getStore().getAt(i).data;if(d.content!=""){var f=new Ext.Window({title:lang("viewTaskEvent"),layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}});this.fields=[{name:"tid"},{name:"title"},{name:"eenable"},{name:"denable"},{name:"repealenable"},{name:"urgeenable"},{name:"failenable"},{name:"status"},{name:"progress"},{name:"execman"},{name:"postter"},{name:"stime"},{name:"etime"},{name:"statusText"},{name:"statusColor"}];this.storeChild=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getJsonData",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.storeChild.load();this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskTitle"),dataIndex:"title",width:140,sortable:true,menuDisabled:true},{header:lang("status"),dataIndex:"status",width:100,sortable:false,menuDisabled:true,renderer:this.makeStatus.createDelegate(this)},{header:lang("principal"),dataIndex:"execman",width:90,sortable:false,menuDisabled:true},{header:lang("bzr"),dataIndex:"postter",width:90,sortable:false,menuDisabled:true},{header:lang("startTime"),dataIndex:"stime",width:90,sortable:false,menuDisabled:true},{header:lang("endTime"),dataIndex:"etime",width:90,sortable:false,menuDisabled:true},{header:lang("opt"),dataIndex:"",width:60,renderer:this.makeOperate.createDelegate(this)},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.gridChild=new Ext.grid.GridPanel({store:this.storeChild,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,autoHeight:true,stripeRows:true,tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.refreshChildTaskList()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.fieldsDocument=[{name:"id"},{name:"tid"},{name:"attach"},{name:"content"},{name:"user"},{name:"posttime"}];this.storeDocument=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getDocumentList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fieldsDocument})});this.colModelDocument=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",hidden:true},new Ext.grid.RowNumberer(),{header:lang("document"),dataIndex:"attach",width:300,menuDisabled:true,sortable:false},{header:lang("remark"),dataIndex:"content",width:294,menuDisabled:true,sortable:false,renderer:a.renderDocumentContent.createDelegate(this)},{header:lang("postter")+" / "+lang("time"),dataIndex:"",width:160,sortable:false,resizable:false,menuDisabled:true,renderer:a.renderDocumentOther.createDelegate(this)}]);this.gridDocument=new Ext.grid.GridPanel({stripeRows:true,ds:this.storeDocument,loadMask:{msg:lang("waiting")},cm:this.colModelDocument,hideBorders:true,border:false,autoHeight:true,listeners:{cellclick:function(b,i,c,g){if((c==3)||(c==4)){var d=b.getStore().getAt(i).data;if(d.content!=""){var f=new Ext.Window({title:lang("viewDetailDocument"),layout:"fit",width:400,height:260,modal:true,maximizable:true,items:[{xtype:"panel",border:false,autoScroll:true,bodyStyle:"padding:10px;",html:d.content.replace(/\r\n/ig,"<br />").replace(/\n/ig,"<br />")}],buttons:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){f.close()}.createDelegate(this)}]}).show()}}}},tbar:new Ext.Toolbar({items:[{handler:function(b,c){a.storeDocument.load()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")}]})});this.tabItems=new Array();this.tabItems.push({xtype:"panel",title:lang("baseInfo"),autoHeight:true,items:[this.infoPanelBody]});this.tabItems.push({xtype:"panel",title:lang("viewDetailDocument"),autoHeight:true,items:[this.gridEvent],listeners:{activate:function(){if(a.tab_event_loadCount<1){a.storeEvent.load()}a.tab_event_loadCount++}.createDelegate(this)}});if(a.from!="mothertask"){this.tabItems.push({xtype:"panel",title:lang("subtaskArea"),autoHeight:true,items:[this.gridChild],listeners:{activate:function(){if(a.tab_discuss_loadCount<1){a.storeChild.load()}a.tab_discuss_loadCount++}.createDelegate(this)}})}this.tabItems.push({xtype:"panel",title:lang("taskDocumentArea"),autoHeight:true,items:[this.gridDocument],listeners:{activate:function(){if(a.tab_document_loadCount<1){a.storeDocument.load()}a.tab_document_loadCount++}.createDelegate(this)}});this.tabPanel=new Ext.TabPanel({width:770,border:false,activeTab:0,autoHeight:true,bodyStyle:"margin-bottom:100px;",items:this.tabItems});this.centerPanel=new Ext.Panel({region:"center",autoScroll:true,bodyStyle:"padding:5px",items:[this.infoPanel,this.tabPanel],tbar:new Ext.Toolbar({items:["<span style='font-weight:bold;margin-right:20px;'>"+lang("task2")+" - "+lang("viewTask")+"</span>",{handler:function(b,c){a.goToList()}.createDelegate(this),iconCls:"icon-system-reset",cls:"btn-gray1",text:lang("backToList")},{handler:function(b,c){a.reloadInfo()}.createDelegate(this),iconCls:"icon-system-refresh",text:lang("refresh")},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){a.closeTab()}.createDelegate(this)},"->",{xtype:"cnoa_helpBtn",helpid:67}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},makeStatus:function(k,g,d,i,f,b){var m=d.data;var l=m.status;var j="&nbsp;";var a=0;var c="#5B5B5B";j=m.statusText;a=m.progress;c=m.statusColor;var e="<div style='color:#808080;margin-top:3px;'>"+j+"</div>";e+="<div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+a+"px;background-color:"+c+";'></div></div>";return e},makeOperate:function(m,j,e,k,i,b){var o=e.data;var n=o.status;var a=false;var d=false;var g=false;var f=false;var l=false;a=o.eenable;d=o.denable;g=o.repealenable;f=o.urgeenable;l=o.failenable;var c="<a href='javascript:void(0);' onclick='CNOA_monitor_mgr_taskView.viewTask("+o.tid+");'>"+lang("view")+"</a>";return c},viewTask:function(a){mainPanel.closeTab("CNOA_MENU_USER_TASK_VIEW");mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+a,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"),"icon-page-view")},refreshChildTaskList:function(){var a=this;a.storeChild.reload()},renderEventType:function(i,e,c,f,d,a){var j=c.data;var g="#00000";if(j.type==1){g="#FF0000"}else{if(j.type==2){g="#804040"}else{if(j.type==3){g="#FF8040"}else{if(j.type==4){g="#FF00FF"}else{if(j.type==5){g="#008000"}else{if(j.type==6){g="#408080"}else{if(j.type==7){g="#0080FF"}else{if(j.type==8){g="#8000FF"}else{if(j.type==9){g="#FF0000"}else{if(j.type==10){g="#2BB7D5"}else{if(j.type==11){g="#808080"}else{if(j.type==12){g="#0080C0"}}}}}}}}}}}}var b="<span style='color:#FFF;display:block;width:30px;height:16px;background-color:"+g+";text-indent:3px;'>"+j.typename+"</span>";return b},renderEventContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderEventOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDiscussContent:function(e,d,a){var c=a.data;var b=c.title+"<br />";b+="<span style='color:#8C8C8C'>"+e.substr(0,150)+"</span>";return b},renderDiscussOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},renderDocumentContent:function(g,f,c){var e=c.data;var b="";if(g!==""){var b="<br /><span style='color:#00006F'>("+lang("clickToView")+")</span>"}var d="<span style='color:#676767'>"+g.substr(0,150)+"</span>"+b;return d},renderDocumentOther:function(e,d,a){var c=a.data;var b=c.user+"<br />";b+="<span style='color:#8C8C8C'>"+c.posttime+"</span>";return b},reloadInfo:function(){this.closeTab();mainPanel.loadClass("index.php?app=user&func=task&action=default&task=loadPage&from=view&tid="+this.tid,"CNOA_MENU_USER_TASK_VIEW",lang("viewTask"))},readInfo:function(){var a=this;a.centerPanel.getEl().mask(lang("waiting"));Ext.Ajax.request({url:this.baseUrl+"&task=viewTask",method:"GET",params:{},success:function(d){var b=Ext.decode(d.responseText);if(b.success===true){var c=b.data;c.showTip=c.showTip?"block":"none";a.tplTitle.overwrite(a.infoPanel.body,c);a.tplBody.overwrite(a.infoPanelBody.body,c);a.status=c.status;a.title=c.title;a.etime=c.etime;a.centerPanel.getEl().unmask();a.storeEvent.reload()}else{CNOA.msg.alert(b.msg,function(){a.closeTab()})}}})},goToList:function(){mainPanel.loadClass("index.php?app=monitor&func=mgr&action=task&task=loadPage&from=list","CNOA_MENU_USER_TASK_WATCH",lang("monitorTask"))},closeTab:function(){mainPanel.closeTab(CNOA.monitor.mgr.taskView.parentID.replace("docs-",""))}};var CNOA_monitor_mgr_messageClass,CNOA_monitor_mgr_message;CNOA_monitor_mgr_messageClass=CNOA.Class.create();CNOA_monitor_mgr_messageClass.prototype={init:function(){this.baseUrl="index.php?app=monitor&func=mgr&action=message";this.VIEW_INBOX="inbox";this.VIEW_OUTBOX="outbox";this.actionView=this.VIEW_INBOX;this.selectUid=0;this.requestParams={uid:this.selectUid};this.organizationView=this.createOrganizationView();this.inboxView=this.createInboxView();this.outboxView=this.createOutboxView();this.centerView=this.createCenterView();this.inboxStore=this.inboxView.getStore();this.outboxStore=this.outboxView.getStore();this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerView,this.organizationView]})},createOrganizationView:function(){var a=this;return Ext.create({region:"west",xtype:"organization",title:lang("clickPersonViewEmail"),split:true,border:false,width:180,minWidth:80,maxWidth:380,dataUrl:this.baseUrl+"&task=getAllUserListsInDeptTree",listeners:{click:function(c){var b=c.attributes.uid;if(!c||c.disabled||b===undefined||b==CNOA_USER_UID){return}a.selectUid=b;a.requestParams.uid=b;a.loadStoreData(a.actionView)}}})},createInboxView:function(){var g=this;var f=[{name:"id"},{name:"sid"},{name:"smstype"},{name:"isread"},{name:"attach"},{name:"sender"},{name:"title"},{name:"content"},{name:"posttime"},{name:"uid"}];var i=new Ext.data.Store({baseParams:this.requestParams,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listInBox",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:f})});var b=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var j=function(m,n,l){if(l.data.isread==0){n.style+="font-weight: bold;"}return m};var d=function(m,n,l){if(!m){m=lang("userNotExists")}return j(m,n,l)};var c=function(m){var l=(m==1)?"sms-readed.gif":"sms-unread.gif";return'<img src="./resources/images/icons/'+l+'" width="16" height="16" />'};var k=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),b,{header:"id",dataIndex:"id",hidden:true},{header:"sid",dataIndex:"sid",hidden:true},{header:"smstype",dataIndex:"smstype",hidden:true},{header:'<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />',dataIndex:"isread",width:34,renderer:c},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attach",width:34,renderer:this.renderAttach,tooltip:lang("attach")},{header:lang("sender"),dataIndex:"sender",width:200,renderer:d},{header:lang("title"),dataIndex:"title",width:180,renderer:j},{header:lang("content"),dataIndex:"content",width:290,renderer:j},{header:lang("posttime"),dataIndex:"posttime",width:120,renderer:j},{header:"",dataIndex:"noIndex",width:1,resizable:false}]});var e=new Ext.PagingToolbar({displayInfo:true,plugins:[new Ext.grid.plugins.ComboPageSize()],store:i,pageSize:15});var a=new Ext.grid.GridPanel({border:false,hideBorders:true,stripeRows:true,loadMask:{msg:lang("waiting")},sm:b,cm:k,store:i,listeners:{cellclick:function(m,p,n){var l=m.getStore().getAt(p);if(l.get("isread")==0){l.set("isread",1)}if(n!=0){var o=l.get("smstype")=="sys"?l.get("sid"):l.get("id");g.viewInboxEmail(o,l.get("smstype"),l.get("uid"),g.VIEW_INBOX)}}},bbar:e});return a},createOutboxView:function(){var i=this;var g=[{name:"id"},{name:"attach"},{name:"receiver"},{name:"title"},{name:"content"},{name:"posttime"},{name:"readed"},{name:"uid"}];var d=new Ext.data.Store({baseParams:this.requestParams,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listOutBox",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:g})});var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var f=function(l,m,k){return'<a href="javascript:void(0)", onclick="CNOA_monitor_mgr_message.viewReader('+k.data.id+')">'+l+"</a>"};var b=function(k){return'<a href="javascript:void(0)" onclick="CNOA_monitor_mgr_message.operate('+k+')">'+lang("recell")+"</a>"};var j=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),e,{header:"id",dataIndex:"id",hidden:true},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attach",width:34,resizable:false,renderer:this.renderAttach,tooltip:lang("attach")},{header:lang("receiver"),dataIndex:"receiver",width:200},{header:lang("title"),dataIndex:"title",width:180},{header:lang("content"),dataIndex:"content",width:340},{header:lang("receiverReadNum"),dataIndex:"readed",width:120,renderer:f},{header:lang("posttime"),dataIndex:"posttime",width:120},{header:lang("opt"),dataIndex:"id",width:80,renderer:b},{header:"",dataIndex:"noIndex",width:1}]});var a=new Ext.PagingToolbar({displayInfo:true,plugins:[new Ext.grid.plugins.ComboPageSize()],store:d,pageSize:15});var c=new Ext.grid.GridPanel({border:false,hideBorders:true,stripeRows:true,loadMask:{msg:lang("waiting")},sm:e,cm:j,store:d,viewConfig:{forceFit:true},listeners:{cellclick:function(l,p,m,n){var k=l.getStore().getAt(p);if(jQuery.inArray(m,[0,1,3,7,9])==-1){var o=k.get("smstype")=="sys"?k.get("sid"):k.get("id");i.viewInboxEmail(o,k.get("smstype"),k.get("uid"),i.VIEW_OUTBOX)}}},bbar:a});return c},createCenterView:function(){var a=this;return new Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,items:[this.inboxView,this.outboxView],tbar:[{text:lang("inbox"),enableToggle:true,allowDepress:false,pressed:true,cls:"btn-green1",toggleGroup:"MAIL_RECORD_LIST",iconCls:"icon-inbox",handler:function(){a.switchCenterView(a.VIEW_INBOX)}},{text:lang("sendBox"),enableToggle:true,allowDepress:false,cls:"btn-blue4",toggleGroup:"MAIL_RECORD_LIST",iconCls:"icon-send-sms",handler:function(){a.switchCenterView(a.VIEW_OUTBOX)}}]})},switchCenterView:function(a){this.actionView=a;switch(a){case this.VIEW_INBOX:this.centerView.getLayout().setActiveItem(0);break;case this.VIEW_OUTBOX:this.centerView.getLayout().setActiveItem(1);break}this.loadStoreData(a)},loadStoreData:function(a){switch(a){case this.VIEW_INBOX:this.inboxStore.load();break;case this.VIEW_OUTBOX:this.outboxStore.load();break}},renderAttach:function(a){return(a!=1)?"":'<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'},viewInboxEmail:function(e,a,d,b){var c=this.baseUrl+"&task=loadPage&from=view&folder="+b+"&smstype="+a+"&id="+e+"&uid="+d;mainPanel.closeTab("CNOA_MENU_COMMUNICATION_MESSAGE_VIEW");mainPanel.loadClass(c,"CNOA_MENU_COMMUNICATION_MESSAGE_VIEW",lang("viewMsg"),"icon-cnoa-mail")},operate:function(b){var a=this;CNOA.msg.cf(lang("recellMSgNotice"),function(c){if(c=="yes"){Ext.Ajax.request({url:a.baseUrl+"&task=cancelmail",method:"POST",params:{fromId:b},success:function(e){var d=Ext.decode(e.responseText);if(d.success===true){a.outboxStore.reload();CNOA.msg.notice2(lang("recellSucess"))}else{CNOA.msg.alert(d.msg)}}})}})},viewReader:function(a){this.createReaderView(a).show()},createReaderView:function(g){var a=[{name:"id"},{name:"truename"},{name:"isread"},{name:"readtime"}];var b=new Ext.data.Store({autoLoad:true,baseParams:{id:g},proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getReaderList"}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:a})});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var c=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[f,{header:"id",dataIndex:"id",hidden:true},{header:"readed",dataIndex:"isread",hidden:true},{header:lang("reader"),dataIndex:"truename",width:100},{header:lang("firstReadTime"),dataIndex:"readtime",width:180},{header:"",dataIndex:"noIndex",width:1}]});var d=new Ext.grid.GridPanel({border:false,loadMask:{msg:lang("waiting")},sm:f,cm:c,store:b,tbar:new Ext.Toolbar({items:[{text:lang("refresh"),iconCls:"icon-system-refresh",handler:function(i,j){b.reload()}},lang("ReaderMarkNotice")]})});var e=new Ext.Window({title:lang("readerStatus"),width:500,height:makeWindowHeight(500),modal:true,layout:"fit",items:[d],buttons:[{text:lang("close"),handler:function(){e.close()}}]});return e}};var CNOA_monitor_mgr_messageViewClass,CNOA_monitor_mgr_messageView;CNOA_monitor_mgr_messageViewClass=CNOA.Class.create();CNOA_monitor_mgr_messageViewClass.prototype={init:function(){var a=this;this.baseUrl="index.php?app=monitor&func=mgr&action=message";this.id=CNOA.monitor.mgr.messageView.id;this.uid=CNOA.monitor.mgr.messageView.uid;this.smstype=CNOA.monitor.mgr.messageView.smstype;this.actionFolder=CNOA.monitor.mgr.messageView.folder;this.previewPanel=new Ext.Panel({border:false,tbar:new Ext.Toolbar({items:[{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(b){a.closeTab()}},"->",{xtype:"cnoa_helpBtn",helpid:77}]}),listeners:{render:function(){a.preview()}}});this.mainPanel=this.previewPanel},preview:function(){var b=this;var a=new Ext.XTemplate('<div style="margin: 5px;">','	<div style="background-color:#F5F5F5;padding:3px 10px;border-bottom:1px solid #D9D9D9;">','		<div style="font-size:14px;font-weight:bold;line-height:22px;">{title}</div>','		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("sender2")+":{sender}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("time")+":{posttime}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("receiver")+":{receiver}</div>","		<div >{receiver2}</div>","		<div >{receiver3}</div>","	</div>",'	<div class="content" style="font-size:12px;margin:5px 0 0 15px;">{content}</div>','	<tpl if="attachCount &gt; 0">','	<div style="border:2px solid #E6E6E6;height:auto;margin-top:100px;">','		<div style="height:32px;background-color:#E6E6E6;line-height:32px;">','			<img src="./resources/images/icons/attach.gif">','			<span style="font-size:14px;font-weight:bold;">'+lang("attach")+"</span>({attachCount}个)","		</div>","		{attach}","	</div>","	</tpl>","</div>");this.previewPanel.getEl().mask(lang("waiting"));this.previewPanel.body.update("");Ext.Ajax.request({url:this.baseUrl+"&task=view",method:"POST",params:{id:b.id,folder:b.actionFolder,smstype:b.smstype,uid:this.uid},success:function(d){var c=Ext.decode(d.responseText);a.overwrite(b.previewPanel.body,c.data);b.previewPanel.getEl().unmask()}})},closeTab:function(){mainPanel.closeTab(CNOA.monitor.mgr.messageView.parentID.replace("docs-",""))}};var CNOA_monitor_mgr_emailClass,CNOA_monitor_mgr_email;CNOA_monitor_mgr_emailClass=CNOA.Class.create();CNOA_monitor_mgr_emailClass.prototype={init:function(){var c=this;this.ID_btn_collapseExpand=Ext.id();this.ID_tree_treeRoot=Ext.id();this.baseUrl="index.php?app=monitor&func=mgr&action=email";this.inFields=[{name:"id"},{name:"from"},{name:"subject"},{name:"content"},{name:"date"},{name:"isread"},{name:"attachs"}];this.inStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listInBox",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.inFields})});this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:false});this.inColModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:'<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" /><img src="./resources/images/icons/attach2.gif" width="16" height="16" />',dataIndex:"isread",width:45,sortable:true,menuDisabled:true,renderer:this.statusCheck.createDelegate(this)},{header:lang("sender"),dataIndex:"from",width:230,sortable:false,menuDisabled:true,renderer:this.makeFrom.createDelegate(this)},{header:lang("title"),dataIndex:"subject",width:180,id:"subject",sortable:false,menuDisabled:true,renderer:this.contentCheck.createDelegate(this)},{header:lang("receiveTime"),dataIndex:"date",width:120,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);var b=new Ext.PagingToolbar({displayInfo:true,store:this.inStore,pageSize:15,plugins:[new Ext.grid.plugins.ComboPageSize()],listeners:{beforechange:function(e,g){var f=c.grid.selModel.selections.items[0].data,d=f.uid,i=f.id;g.srcmail=i;g.uid=d}}});this.ingrid=new Ext.grid.GridPanel({sm:this.sm,stripeRows:true,store:this.inStore,loadMask:{msg:lang("waiting")},cm:this.inColModel,hideBorders:true,border:false,layout:"fit",region:"center",autoExpandColumn:"subject",bbar:b,listeners:{cellclick:function(f,k,g,i){var d=f.getStore().getAt(k);c.rowClick(f,d);if(g!=0){var j=d.data.smstype=="sys"?d.data.sid:d.data.id;c.view(j,"inbox")}}}});this.treeRoot=new Ext.tree.AsyncTreeNode({name:"",text:lang("allEmailList"),iconCls:"icon-tree-root-cnoa",cls:"feeds-node",id:this.ID_tree_treeRoot,expanded:true});this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.baseUrl+"&task=getAllUserListsInDeptTree",preloadChildren:true,clearOnLoad:false,listeners:{load:function(d){this.treeRoot.firstChild.collapse(true);try{if(Ext.getCmp(this.ID_btn_collapseExpand).pressed){this.treeRoot.expand(true)}else{this.treeRoot.firstChild.expand()}}catch(f){}try{if(Ext.getCmp(this.ID_btn_collapseExpand2).pressed){this.treeRoot2.expand(true)}else{this.treeRoot2.firstChild.expand()}}catch(f){}this.deptTree.getEl().unmask()}.createDelegate(this)}});this.deptTree=new Ext.tree.TreePanel({hideBorders:true,border:false,rootVisible:false,lines:true,animCollapse:false,animate:false,loader:this.treeLoader,root:this.treeRoot,autoScroll:true,listeners:{click:function(e){if((e==undefined)||e.disabled||(e.attributes.uid==undefined)){return}var d=e.attributes.uid;this.store.load({params:{uid:d}})}.createDelegate(this)}});this.deptPanel=new Ext.Panel({title:lang("clickPersonViewEmail"),region:"west",layout:"fit",split:false,width:200,minWidth:80,maxWidth:380,bodyStyle:"border-right-width:1px;",items:[this.deptTree],tbar:new Ext.Toolbar({style:"border-right-width:1px;",items:[{handler:function(d,e){c.treeRoot.reload()}.createDelegate(this),iconCls:"icon-system-refresh",tooltip:lang("refresh"),text:lang("refresh")},"->",{text:lang("expand"),id:this.ID_btn_collapseExpand,tooltip:lang("expandMenuTip"),enableToggle:true,toggleHandler:function(d,e){if(e){d.setText(lang("collapse"));d.setTooltip(lang("collapseMenuTip"));c.treeRoot.expand(true)}else{d.setText(lang("expand"));d.setTooltip(lang("expandMenuTip"));c.treeRoot.collapse(true);c.treeRoot.firstChild.expand()}}}]})});this.fields=[{name:"id"},{name:"name"},{name:"uid"}];this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getEmailList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});this.colModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("email"),dataIndex:"name",width:180,sortable:false,menuDisabled:true}]);this.grid=new Ext.grid.GridPanel({title:lang("emailList"),width:220,minWidth:80,maxWidth:230,stripeRows:true,store:this.store,loadMask:{msg:lang("waiting")},cm:this.colModel,hideBorders:true,border:false,region:"center",layout:"fit",scriptRows:true,bodyStyle:"border-right-width:1px;",listeners:{rowclick:function(f,i,g){var d=f.getStore().getAt(i);this.inStore.load({params:{srcmail:d.data.id,uid:d.data.uid}})}.createDelegate(this)}});this.cctoCenterPanel=new Ext.Panel({layout:"border",region:"center",hideBorders:true,bodyStyle:"border-right-width:1px;border-left-width:1px;",items:[this.grid]});this.ccmainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,region:"west",layout:"border",width:400,items:[this.deptPanel,this.cctoCenterPanel]});this.outFields=[{name:"id"},{name:"to"},{name:"from"},{name:"subject"},{name:"content"},{name:"date"},{name:"attachs"}];this.outStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=listOutBox",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.outFields})});this.outColModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),this.sm,{header:"id",dataIndex:"id",hidden:true},{header:'<img src="./resources/images/icons/attach.gif" width="13" height="13" />',dataIndex:"attachs",width:34,sortable:true,menuDisabled:true,resizable:false,renderer:this.attachCheck,tooltip:lang("attach")},{header:lang("receiver"),dataIndex:"to",width:135,sortable:false,menuDisabled:true,renderer:this.makeOutFrom.createDelegate(this)},{header:lang("sentFromEmail"),dataIndex:"from",width:135,sortable:false,menuDisabled:true},{header:lang("title"),dataIndex:"subject",width:180,sortable:false,menuDisabled:true,renderer:this.contentOutCheck.createDelegate(this)},{header:lang("receiveTime"),dataIndex:"date",width:120,sortable:false,menuDisabled:true},{header:"",dataIndex:"noIndex",width:1,menuDisabled:true,resizable:false}]);this.pagingBarInbox=new Ext.PagingToolbar({displayInfo:true,store:this.outStore,pageSize:15});this.outgrid=new Ext.grid.GridPanel({sm:this.sm,stripeRows:true,store:this.outStore,loadMask:{msg:lang("waiting")},cm:this.outColModel,hideBorders:true,border:false,region:"center",viewConfig:{forceFit:true},scriptRows:true,bbar:this.pagingBarInbox,listeners:{cellclick:function(f,k,g,i){var d=f.getStore().getAt(k);if(jQuery.inArray(g,[0,1,2])==-1){var j=d.data.smstype=="sys"?d.data.sid:d.data.id;c.view(j,"outbox")}}}});var a=Ext.id();this.gridCt=new Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,items:[this.ingrid,this.outgrid],tbar:[{xtype:"hidden",value:"inbox",id:a},{enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"MAIL_RECORD_LIST",iconCls:"icon-inbox",text:lang("inbox"),cls:"btn-green1",handler:function(){c.gridCt.getLayout().setActiveItem(0);if(c.grid.getSelectionModel().selections.length>0){var d=c.grid.getSelectionModel().selections.items[0];c.outStore.load({params:{uid:d.data.uid,id:d.data.id}})}}.createDelegate(this)},{enableToggle:true,allowDepress:false,toggleGroup:"MAIL_RECORD_LIST",iconCls:"icon-send-sms",cls:"btn-blue4",text:lang("sendBox"),handler:function(){c.gridCt.getLayout().setActiveItem(1);if(c.grid.getSelectionModel().selections.length>0){var d=c.grid.getSelectionModel().selections.items[0].data.uid;c.outStore.load({params:{uid:d}})}}.createDelegate(this)}]});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.gridCt,this.ccmainPanel]})},rowClick:function(d,b){var a=d.getEl().query("span[comm_mail_gridid="+this.actionFolder+"_"+b.data.id+"]");for(var c=0;c<a.length;c++){a[c].style.fontWeight="normal"}try{var g=d.getEl().query("img[comm_mail_gridid="+this.actionFolder+"_"+b.data.id+"]");g[0].src="./resources/images/icons/sms-readed.gif"}catch(f){}},view:function(c,b){var a=this.grid.getSelectionModel().selections.items[0].data.uid;mainPanel.closeTab("CNOA_MENU_COMMUNICATION_EMAIL_VIEW");mainPanel.loadClass("index.php?app=monitor&func=mgr&action=email&task=loadPage&from=view&folder="+b+"&id="+c+"&uid="+a+"&isMonitor=1","CNOA_MENU_COMMUNICATION_EMAIL_VIEW",lang("viewMail"),"icon-cnoa-mail")},makeFrom:function(f,g,b){var e=b.data;var d="";var c="";if(f[0].name!=null){d=f[0].name;c=""}else{d='<a href="javascript:void(0)" onclick="CNOA_communication_email_index_inbox.addNewAddress(\''+f[0].address+"')\">"+f[0].address+"</a>"}if(b.data.isread==0){var a="font-weight: bold;"}return String.format('<span style="{1}" comm_mail_gridid="{3}_{2}">{0}</span>{4}',d,a,b.data.id,this.actionFolder,c)},contentCheck:function(e,f,c){var d=c.data;var b="";if(c.data.isread==0){b="font-weight: bold;"}var a=String.format('<span style="{1}" comm_mail_gridid="{3}_{2}">{0}</span>',e,b,c.data.id,this.actionFolder);return a+"&nbsp;<span class='cnoa_color_gray'> - "+d.content+"&nbsp;</span>"},statusCheck:function(d,e,a){var c=a.data;var b="";if(d==1){b+='<img src="./resources/images/icons/sms-readed.gif" width="16" height="16" />'}else{b+='<img src="./resources/images/icons/sms-unread.gif" width="16" height="16" comm_mail_gridid="'+this.actionFolder+"_"+a.data.id+'" />'}if(c.attachs>0){b+='<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}return b},attachCheck:function(a){if(a==1){return'<img src="./resources/images/icons/attach2.gif" width="16" height="16" />'}else{return""}},makeOutFrom:function(c,d,a){var b=a.data;return b.to},contentOutCheck:function(f,i,c){var d=c.data;var b="";try{f=f.replace(new RegExp("<br />","g"),"\n");f=f.replace(/<\/div>(.*)$/gi,"")}catch(g){f=lang("userNotExists")}var a=String.format("<span>{0}</span>",f);return a+"<br><span class='cnoa_color_gray'>"+d.content+"</span>"}};var CNOA_monitor_mgr_emailViewClass,CNOA_monitor_mgr_emailView;CNOA_monitor_mgr_emailViewClass=CNOA.Class.create();CNOA_monitor_mgr_emailViewClass.prototype={init:function(){var a=this;this.actionFolder=CNOA.monitor.mgr.emailView.folder;this.id=CNOA.monitor.mgr.emailView.id;this.isMonitor=CNOA.monitor.mgr.emailView.isMonitor;this.uid=CNOA.monitor.mgr.emailView.uid;this.baseUrl="index.php?app=monitor&func=mgr&action=email&folder="+this.actionFolder+"&isMonitor="+this.isMonitor+"&uid="+this.uid;this.previewPanel=new Ext.Panel({border:false,autoHeight:true,region:"north",listeners:{render:function(){a.preview()}}});this.contentPanel=new Ext.Panel({border:false,html:'<div style="width:100%;height:100%;"><iframe scrolling=auto frameborder=0 width=100% height=100% src="'+this.baseUrl+"&task=getContent&id="+this.id+'"></iframe></div>',region:"center"});this.centerPanel=new Ext.Panel({layout:"border",region:"center",border:false,autoScroll:false,items:[this.previewPanel,this.contentPanel],tbar:new Ext.Toolbar({items:[{text:lang("del"),hidden:true,iconCls:"icon-utils-s-delete",handler:function(b){CNOA.miniMsg.cfShowAt(b,lang("confirmToDelete"),function(){a.deleteMsg()})}.createDelegate(this)},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(b){a.closeTab()}.createDelegate(this)},"<span class='cnoa_color_gray'>"+lang("emailCantViewNotice")+"</span>","->",{xtype:"cnoa_helpBtn",helpid:126}]})});this.mainPanel=new Ext.Panel({collapsible:false,hideBorders:true,border:false,layout:"border",autoScroll:false,items:[this.centerPanel]})},preview:function(){var b=this;var a=new Ext.XTemplate("<div>",'	<div style="background-color:#F5F5F5;padding:3px 10px;border-bottom:1px solid #D9D9D9;">','		<div style="font-size:14px;font-weight:bold;line-height:22px;">{subject}</div>','		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("sender2")+":{from}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("time")+":{date}</div>",'		<div style="font-size:12px;line-height:18px;color:#919191;">'+lang("receiver")+":{to}</div>","	</div>",'	<tpl if="attachCount &gt; 0">','	<div style="border:2px solid #E6E6E6;height:160px;overflow-y:auto;">','		<div style="height:32px;background-color:#E6E6E6;line-height:32px;">','			<img src="./resources/images/icons/attach.gif">','			<span style="font-size:14px;font-weight:bold;">'+lang("attach")+"</span>","		</div>","		{attach}","	</div>","	</tpl>","</div>");b.previewPanel.getEl().mask(lang("waiting"));b.previewPanel.body.update("");Ext.Ajax.request({url:b.baseUrl+"&task=view",method:"POST",params:{id:b.id,folder:b.actionFolder,smstype:b.smstype},success:function(d){var c=Ext.decode(d.responseText);a.overwrite(b.previewPanel.body,c.data);b.previewPanel.getEl().unmask()}})},doLayout:function(){this.centerPanel.doLayout()},closeTab:function(){mainPanel.closeTab(CNOA.monitor.mgr.emailView.parentID.replace("docs-",""))},deleteMsg:function(){var a=this;Ext.Ajax.request({url:a.baseUrl,method:"POST",params:{ids:this.id,task:"delete",folder:this.actionFolder},success:function(c){var b=Ext.decode(c.responseText);if(b.success===true){CNOA.msg.notice2(b.msg);try{CNOA_communication_email_index_inbox.storeInbox.reload()}catch(d){}try{CNOA_communication_email_index_outbox.storeOutbox.reload()}catch(d){}a.closeTab()}else{CNOA.msg.alert(b.msg)}}})}};var CNOA_monitor_mgr_planClass,CNOA_monitor_mgr_plan;CNOA_monitor_mgr_planClass=CNOA.Class.create();CNOA_monitor_mgr_planClass.prototype={init:function(){var i=this;this.baseUrl="index.php?app=monitor&func=mgr&action=plan";this.mode=2;this.searchStore={planer:0,title:"",stime:0,etime:0,status:"",dateMode:""};this.ID_Search_title=Ext.id();this.ID_Search_stime=Ext.id();this.ID_Search_etime=Ext.id();this.ID_Search_status=Ext.id();this.ID_Search_dateMode=Ext.id();this.ID_Search_readed=Ext.id();this.ID_ruler=Ext.id();this.fields=[{name:"id"},{name:"title"},{name:"plantime"},{name:"plantype"},{name:"statusText"},{name:"dateMode"},{name:"updatetime"},{name:"readed"},{name:"planer"}];this.store=new Ext.data.Store({autoLoad:true,baseParams:this.searchStore,proxy:new Ext.data.HttpProxy({url:this.baseUrl+"&task=getPlanList",disableCaching:true}),reader:new Ext.data.JsonReader({totalProperty:"total",root:"data",fields:this.fields})});var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:lang("planTitle"),dataIndex:"title",width:300,sortable:true},{header:lang("planTime"),dataIndex:"plantime",width:190},{header:lang("srcComeFrom"),dataIndex:"plantype",width:80},{header:lang("planStatus"),dataIndex:"statusText",width:70},{header:lang("planer"),dataIndex:"planer",width:80},{header:lang("reportTime"),dataIndex:"updatetime",width:111},{header:lang("opt"),dataIndex:"id",width:80,renderer:this.makeOperate},{header:"",dataIndex:"noIndex",width:1}]});var d=new Ext.form.TextField({width:100}),e=new Ext.form.DateField({format:"Y-m-d",width:100}),c=new Ext.form.DateField({format:"Y-m-d",width:100}),a=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","status"],data:[["0",lang("inProgress")],["1",lang("finished")],["2",lang("delayeFinish")]]}),width:80,hiddenName:"status",valueField:"value",displayField:"status",mode:"local",triggerAction:"all",forceSelection:true,editable:false}),f=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","display"],data:[["1",lang("weekPlan")],["2",lang("monthPlan")],["3",lang("yearReport")]]}),width:80,hiddenName:"dateMode",name:"dateMode",valueField:"value",displayField:"display",mode:"local",triggerAction:"all",forceSelection:true,editable:false});this.grid=new Ext.grid.PageGridPanel({store:this.store,cm:b,stripeRows:true,viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(j,k){i.store.reload()}},lang("reportTitle"),d,lang("createTime"),e,lang("to"),c,lang("status"),a,lang("planType"),f,{xtype:"button",text:lang("search"),style:"margin-left:5px",handler:function(){i.searchStore.title=d.getValue();i.searchStore.stime=e.getRawValue();i.searchStore.etime=c.getRawValue();i.searchStore.status=a.getValue();i.searchStore.dateMode=f.getValue();i.store.load()}},{xtype:"button",text:lang("clear"),style:"margin-left:5px",handler:function(){d.setValue();e.setValue();c.setValue();a.setValue();f.setValue();i.searchStore.title="";i.searchStore.stime="";i.searchStore.etime="";i.searchStore.status="";i.searchStore.readed="";i.searchStore.dateMode="";i.store.load()}}]})});function g(j){var k=Ext.getCmp(i.ID_ruler).getRawValue();if(j==0){k=""}i.store.setBaseParam("dateType",j);i.store.setBaseParam("date",k);i.store.load()}this.menuPanel=new Ext.Panel({items:[this.grid],layout:"fit",hideBorders:true,border:false,tbar:new Ext.Toolbar({items:[{enableToggle:true,pressed:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("allPlan"),handler:function(j,k){g(0)}},lang("date")+"：",{xtype:"datefield",name:"ruler",format:"Y-m-d",editable:false,id:i.ID_ruler,value:new Date()},{handler:function(j,k){g(1)},enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisMonth")},{enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("thisWeek"),handler:function(j,k){g(2)}},{handler:function(j,k){g(3)},enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevMonth")},{handler:function(j,k){g(4)},enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("prevWeek")},{handler:function(j,k){g(5)},enableToggle:true,allowDepress:false,toggleGroup:"user_plan_report_dateMode",text:lang("daysUnread",15)}]})});this.mainPanel=new Ext.Panel({autoScroll:true,layout:"fit",border:false,items:[this.menuPanel],tbar:new Ext.Toolbar({items:[{iconCls:"icon-all-contracts",enableToggle:true,allowDepress:false,pressed:true,toggleGroup:"user_plan_report_plantype",text:lang("All"),cls:"btn-yellow1",handler:function(j,k){i.store.setBaseParam("plantype","");i.store.load()}},{iconCls:"icon-my-entrust-rule",enableToggle:true,cls:"btn-blue2",allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("personPlan"),handler:function(j,k){i.store.setBaseParam("plantype",1);i.store.load()}},{iconCls:"icon-group",enableToggle:true,cls:"btn-blue2",allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("deptPlan"),handler:function(j,k){i.store.setBaseParam("plantype",2);i.store.load()}},{iconCls:"icon-calendar",enableToggle:true,cls:"btn-blue4",allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workReport2"),handler:function(j,k){i.store.setBaseParam("plantype",3);i.store.load()}},{iconCls:"icon-arrow_down",enableToggle:true,cls:"btn-red1",allowDepress:false,toggleGroup:"user_plan_report_plantype",text:lang("workSummary"),handler:function(j,k){i.store.setBaseParam("plantype",4);i.store.load()}}]})})},makeOperate:function(a){return"<a  class='gridview' onclick='CNOA_monitor_mgr_plan.viewPlan("+a+")'>"+lang("view")+"</a>"},showList:function(a){var b=this;if(a=="share"){b.mode=1}else{if(a=="report"){b.mode=2}}b.store.removeAll();b.store.load({params:{type:b.mode}})},viewPlan:function(b){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=monitor&func=mgr&action=plan&task=loadPage&from=view&pid="+b+"&comefrom=share";mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewPlan"),"icon-page-view")}};var CNOA_monitor_mgr_planViewClass,CNOA_monitor_mgr_planView;CNOA_monitor_mgr_planViewClass=CNOA.Class.create();CNOA_monitor_mgr_planViewClass.prototype={init:function(){var d=this;this.baseUrl="index.php?app=monitor&func=mgr&action=plan";this.pid=CNOA.monitor.mgr.plan.view.pid;this.status=0;var a=[{name:"tid"},{name:"title"},{name:"status"},{name:"execman"},{name:"statusText"},{name:"statusColor"},{name:"progress"},{name:"stime"},{name:"etime"}];this.planTaskGridStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.baseUrl+"&task=getPlanTaskList&pid="+this.pid}),reader:new Ext.data.JsonReader({root:"data",fields:a})});var c=function(e){return"<a href='javascript:void(0);' onclick='CNOA_monitor_mgr_planView.viewTask("+e+");'>"+lang("view")+"</a>"};var b=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:true},columns:[new Ext.grid.RowNumberer(),{header:"tid",dataIndex:"tid",hidden:true},{header:lang("taskName"),dataIndex:"title",width:200},{header:lang("status"),dataIndex:"status",width:130,renderer:this.makeStatus},{header:lang("principal"),dataIndex:"execman",width:110},{header:lang("startTime"),dataIndex:"stime",width:100},{header:lang("endTime"),dataIndex:"etime",width:100},{header:lang("opt"),dataIndex:"tid",width:70,renderer:c}]});this.planTaskGrid=new Ext.grid.GridPanel({stripeRows:true,autoScroll:true,border:false,autoWidth:true,autoHeight:true,loadMask:lang("waiting"),cm:b,store:this.planTaskGridStore,tbar:new Ext.Toolbar({items:[lang("taskInPlan")]})});this.planTaskPanel=new Ext.Panel({width:775,bodyStyle:"margin:5px;margin-bottom:25px;",border:false,hidden:true,items:[this.planTaskGrid]});this.reportPanel=new Ext.Panel({border:false,html:lang("nodata")});this.planreportField=[{xtype:"fieldset",title:lang("planOfLeader"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.reportPanel]}];this.commentPanel=new Ext.Panel({border:false,html:lang("nodata")});this.plancommentField=[{xtype:"fieldset",title:lang("commentOfPlan"),style:"margin:5px",width:770,height:350,collapsible:true,autoHeight:true,items:[this.commentPanel]}];this.infoPanel=new Ext.Panel({border:false,bodyStyle:"padding:5px",listeners:{render:function(){d.readInfo(d.pid);d.loadComment(d.pid)}}});this.mainPanel=new Ext.Panel({region:"center",autoScroll:true,border:false,items:[this.infoPanel,this.planTaskPanel,this.planreportField,this.plancommentField],tbar:new Ext.Toolbar({items:[{iconCls:"icon-system-refresh",text:lang("refresh"),handler:function(e,f){d.refresh()}},{text:lang("close"),iconCls:"icon-dialog-cancel",handler:function(){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW")}}]})})},makeStatus:function(e,d,a){var c=a.data;var b="<div style='color:#808080;margin-top:3px;'>"+c.statusText+"</div><div style='width:100px;height:5px;background-color:#D4D4D4;'><div style='font-size:0;line-height:0;height:5px;width:"+c.progress+"px;background-color:"+c.statusColor+"'></div></div>";return b},readInfo:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=loadPlanInfo",method:"POST",params:{pid:a,comefrom:this.from},success:function(e){var c=Ext.decode(e.responseText);if(c.success===true){var d=c.data;b.getPlanInfoTpl().overwrite(b.infoPanel.body,d);if(d.plantype==2){b.planTaskPanel.show();b.planTaskPanel.doLayout();b.planTaskGridStore.load()}}else{CNOA.msg.alert(c.msg,function(){CNOA_USER_PLAN_TAB_CLOSE("view")})}}})},refresh:function(){mainPanel.closeTab("CNOA_MENU_USER_PLAN_VIEW");var a="index.php?app=monitor&func=mgr&action=plan&task=loadPage&from=view&pid="+this.pid+"&comefrom="+this.from;mainPanel.loadClass(a,"CNOA_MENU_USER_PLAN_VIEW",lang("viewTask"),"icon-page-view")},viewTask:function(a){mainPanel.closeTab("CNOA_MONITOR_TASK_VIEW");mainPanel.loadClass("index.php?app=monitor&func=mgr&action=plan&task=loadPage&from=viewTask&tid="+a,"CNOA_MONITOR_TASK_VIEW",lang("viewTask"),"icon-page-view")},loadComment:function(a){var b=this;Ext.Ajax.request({url:b.baseUrl+"&task=loadPlanComment",method:"POST",params:{pid:a,from:"comment"},success:function(e){var c=Ext.decode(e.responseText);var f=c.data.comment,d=c.data.report;if(f){f.title=lang("planComment");b.getCommentTpl().overwrite(b.commentPanel.body,f)}if(d){d.title=lang("planLeadSay");b.getCommentTpl().overwrite(b.reportPanel.body,d)}}})},getCommentTpl:function(){return new Ext.XTemplate('<div style="border-width:0px;background-color:#F5F5F5">','	<div style="border:2px solid #E6E6E6;border-bottom-width:0px;height:auto;">','		<div style="height:25px;background-color:#E6E6E6;line-height:25px;">','			<span style="font-size:12px;font-weight:bold;">{title}</span>({totalCount}'+lang("tiao")+")","		</div>",'	   <tpl if="totalCount &gt; 0">','		<ul style="margin-top:10px;">','			<tpl for="list">','			<li style="border-bottom:1px solid #DDDDDD;margin:2px 0;background-color:{[xindex % 2 === 0 ? "#FFF" : "##F6F6F6"]}">','				<div style="height:160px;width:130px;float:left;border:1px solid #D8D8D8;margin:3px 5px 5px 5px;"><img src="{face}" width="120" height="130" onerror="this.src=\'./resources/images/default.jpg\'" style="background-color:#FFF;"></div>','				<div style="float:left;width:590px;"><div style="height:22px;line-height:22px;border-bottom:1px solid #DDDDDD;">#{[xindex]} '+lang("postter")+':<a  style="font-weight:bold;">{user}</a>&nbsp;&nbsp;&nbsp;'+lang("inDepartment")+':<a style="font-weight:bold;">{dept}</a>&nbsp;&nbsp;&nbsp;'+lang("posttime2")+":{posttime}</div>",'				<div style="padding:10px;">{content}</div></div>','				<div style="clear:both;"></div>',"			</li>","			</tpl>","		</ul>","	</div>","	</tpl>","</div>")},getPlanInfoTpl:function(){return new Ext.XTemplate('<div style="width:770px;height:40px;background-color:#FEFBDC;font-size:16px;font-weight:bold;line-height:40px; text-align: center;">[{plantypeName}]{title}',"</div>",'<div style="margin-top:5px;margin-bottom:5px;width:770px;">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("baseInfo2")+"</span></div>",'	<div style="background-color:#EFF5FF;padding-bottom:5px;">','		<ul class="user_task_view_ul">','			<li><span class="first">'+lang("planType")+': </span><span class="second" style="color:#800000;">{plantypeName}</span></li>','			<li><span class="first">'+lang("planer")+': </span><span class="second">{planer}</span></li>','			<li><span class="first">'+lang("planStatus")+': </span><span class="second">{statusText}</span></li>','			<li><span class="first">'+lang("startTime")+': </span><span class="second">{stime}</span></li>','			<li><span class="first">'+lang("endTime")+': </span><span class="second">{etime}</span></li>',"			<li>&nbsp;</li>","		</ul>",'		<div class="clear"></div>',"	</div>",'	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("content")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">','	<tpl for="contentList">','	  <div style="border-bottom:1px dashed #969AA7;margin:10px 0;line-heigth:20px;">{c}</div>',"	</tpl>","	</div>",'	<div id="user_plan_view_summary"><div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("planSummary")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">{summary}</div></div>','	<tpl if="attachCount &gt; 0">','	<div style="background-color:#D5E7F3;height:30px;line-height:30px;"><span style="margin-left:5px;font-weight:bold;font-size:12px;">'+lang("attach")+"</span></div>",'	<div style="padding:20px;background-color:#EFF5FF;">',"		{attach}","	</div>","	</tpl>","</div>")}};var sm_monitor_mgr=1;